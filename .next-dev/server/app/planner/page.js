(()=>{var exports={};exports.id=136,exports.ids=[136],exports.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9523:e=>{"use strict";e.exports=require("dns")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5158:e=>{"use strict";e.exports=require("http2")},1808:e=>{"use strict";e.exports=require("net")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")},7282:e=>{"use strict";e.exports=require("process")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},4736:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>a.a,__next_app__:()=>h,originalPathname:()=>d,pages:()=>c,routeModule:()=>p,tree:()=>u}),r(1535),r(5582),r(5866);var n=r(3191),i=r(8716),s=r(7922),a=r.n(s),o=r(5231),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let u=["",{children:["planner",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,1535)),"C:\\Users\\pedro\\OneDrive\\\xc1rea de Trabalho\\logistica_web\\src\\app\\planner\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,5582)),"C:\\Users\\pedro\\OneDrive\\\xc1rea de Trabalho\\logistica_web\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\pedro\\OneDrive\\\xc1rea de Trabalho\\logistica_web\\src\\app\\planner\\page.tsx"],d="/planner/page",h={require:r,loadChunk:()=>Promise.resolve()},p=new n.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/planner/page",pathname:"/planner",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:u}})},3263:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2994,23)),Promise.resolve().then(r.t.bind(r,6114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,9671,23)),Promise.resolve().then(r.t.bind(r,1868,23)),Promise.resolve().then(r.t.bind(r,4759,23))},9855:(e,t,r)=>{Promise.resolve().then(r.bind(r,8015))},1123:(e,t,r)=>{Promise.resolve().then(r.bind(r,1357))},7749:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addAdminServicesToServer=t.registerAdminService=void 0;let r=[];function n(e,t){r.push({getServiceDefinition:e,getHandlers:t})}function i(e){for(let{getServiceDefinition:t,getHandlers:n}of r)e.addService(t(),n())}t.registerAdminService=n,t.addAdminServicesToServer=i},1742:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackoffTimeout=void 0;let r=1e3,n=1.6,i=12e4,s=.2;function a(e,t){return Math.random()*(t-e)+e}class o{constructor(e,t){this.callback=e,this.initialDelay=r,this.multiplier=n,this.maxDelay=i,this.jitter=s,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||null===(r=(t=this.timerId).unref)||void 0===r||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+a(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,null===(t=(e=this.timerId).ref)||void 0===t||t.call(e)}unref(){var e,t;this.hasRef=!1,null===(t=(e=this.timerId).unref)||void 0===t||t.call(e)}getEndTime(){return this.endTime}}t.BackoffTimeout=o},5402:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallCredentials=void 0;let n=r(6281);function i(e){return"getRequestHeaders"in e&&"function"==typeof e.getRequestHeaders}class s{static createFromMetadataGenerator(e){return new o(e)}static createFromGoogleCredential(e){return s.createFromMetadataGenerator((t,r)=>{let s;(s=i(e)?e.getRequestHeaders(t.service_url):new Promise((r,n)=>{e.getRequestMetadata(t.service_url,(e,t)=>{if(e){n(e);return}if(!t){n(Error("Headers not set by metadata plugin"));return}r(t)})})).then(e=>{let t=new n.Metadata;for(let r of Object.keys(e))t.add(r,e[r]);r(null,t)},e=>{r(e)})})}static createEmpty(){return new l}}t.CallCredentials=s;class a extends s{constructor(e){super(),this.creds=e}async generateMetadata(e){let t=new n.Metadata;for(let r of(await Promise.all(this.creds.map(t=>t.generateMetadata(e)))))t.merge(r);return t}compose(e){return new a(this.creds.concat([e]))}_equals(e){return this===e||e instanceof a&&this.creds.every((t,r)=>t._equals(e.creds[r]))}}class o extends s{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(e,n)=>{void 0!==n?t(n):r(e)})})}compose(e){return new a([this,e])}_equals(e){return this===e||e instanceof o&&this.metadataGenerator===e.metadataGenerator}}class l extends s{generateMetadata(e){return Promise.resolve(new n.Metadata)}compose(e){return e}_equals(e){return e instanceof l}}},1218:(e,t)=>{"use strict";function r(e){return void 0!==e.onReceiveMetadata&&1===e.onReceiveMetadata.length}Object.defineProperty(t,"__esModule",{value:!0}),t.InterceptingListenerImpl=t.isInterceptingListener=void 0,t.isInterceptingListener=r;class n{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,e=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(e),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,e=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=e,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(e),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,e=>{this.processingMetadata||this.processingMessage?this.pendingStatus=e:this.nextListener.onReceiveStatus(e)})}}t.InterceptingListenerImpl=n},1801:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNextCallNumber=void 0;let r=0;function n(){return r++}t.getNextCallNumber=n},7639:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientDuplexStreamImpl=t.ClientWritableStreamImpl=t.ClientReadableStreamImpl=t.ClientUnaryCallImpl=t.callErrorFromStatus=void 0;let n=r(2361),i=r(2781),s=r(9572);function a(e,t){let r=`${e.code} ${s.Status[e.code]}: ${e.details}`,n=Error(r),i=`${n.stack}
for call at
${t}`;return Object.assign(Error(r),e,{stack:i})}t.callErrorFromStatus=a;class o extends n.EventEmitter{constructor(){super()}cancel(){var e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}}t.ClientUnaryCallImpl=o;class l extends i.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}_read(e){var t;null===(t=this.call)||void 0===t||t.startRead()}}t.ClientReadableStreamImpl=l;class u extends i.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}_write(e,t,r){var n;let i={callback:r},s=Number(t);Number.isNaN(s)||(i.flags=s),null===(n=this.call)||void 0===n||n.sendMessageWithContext(i,e)}_final(e){var t;null===(t=this.call)||void 0===t||t.halfClose(),e()}}t.ClientWritableStreamImpl=u;class c extends i.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}_read(e){var t;null===(t=this.call)||void 0===t||t.startRead()}_write(e,t,r){var n;let i={callback:r},s=Number(t);Number.isNaN(s)||(i.flags=s),null===(n=this.call)||void 0===n||n.sendMessageWithContext(i,e)}_final(e){var t;null===(t=this.call)||void 0===t||t.halfClose(),e()}}t.ClientDuplexStreamImpl=c},499:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelCredentials=void 0;let n=r(4404),i=r(5402),s=r(606);function a(e,t){if(e&&!(e instanceof Buffer))throw TypeError(`${t}, if provided, must be a Buffer.`)}class o{constructor(e){this.callCredentials=e||i.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var o;if(a(e,"Root certificate"),a(t,"Private key"),a(r,"Certificate chain"),t&&!r)throw Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw Error("Certificate chain must be given with accompanying private key");return new u((0,n.createSecureContext)({ca:null!==(o=null!=e?e:(0,s.getDefaultRootsData)())&&void 0!==o?o:void 0,key:null!=t?t:void 0,cert:null!=r?r:void 0,ciphers:s.CIPHER_SUITES}),null!=i?i:{})}static createFromSecureContext(e,t){return new u(e,null!=t?t:{})}static createInsecure(){return new l}}t.ChannelCredentials=o;class l extends o{constructor(e){super(e)}compose(e){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof l}}class u extends o{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},(null==t?void 0:t.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){return new c(this,this.callCredentials.compose(e))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e||e instanceof u&&this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity}}class c extends o{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new c(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e||e instanceof c&&this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials)}}},9455:(e,t)=>{"use strict";function r(e,t){let r=Object.keys(e).sort(),n=Object.keys(t).sort();if(r.length!==n.length)return!1;for(let i=0;i<r.length;i+=1)if(r[i]!==n[i]||e[r[i]]!==t[n[i]])return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.channelOptionsEqual=t.recognizedOptions=void 0,t.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},t.channelOptionsEqual=r},9452:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelImplementation=void 0;let n=r(499),i=r(9359);class s{constructor(e,t,r){if("string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof n.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(r&&"object"!=typeof r)throw TypeError("Channel options must be an object");this.internalChannel=new i.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,n,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,n,i)}}t.ChannelImplementation=s},5962:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.getChannelzServiceDefinition=t.getChannelzHandlers=t.unregisterChannelzRef=t.registerChannelzSocket=t.registerChannelzServer=t.registerChannelzSubchannel=t.registerChannelzChannel=t.ChannelzCallTracker=t.ChannelzChildrenTracker=t.ChannelzTrace=void 0;let n=r(1808),i=r(2409),s=r(9572),a=r(4955),o=r(7749),l=r(4529);function u(e){return{channel_id:e.id,name:e.name}}function c(e){return{subchannel_id:e.id,name:e.name}}function d(e){return{server_id:e.id}}function h(e){return{socket_id:e.id,name:e.name}}let p=32;class f{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let n=new Date;this.events.push({description:t,severity:e,timestamp:n,childChannel:(null==r?void 0:r.kind)==="channel"?r:void 0,childSubchannel:(null==r?void 0:r.kind)==="subchannel"?r:void 0}),this.events.length>=2*p&&(this.events=this.events.slice(p)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:O(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:O(e.timestamp),channel_ref:e.childChannel?u(e.childChannel):null,subchannel_ref:e.childSubchannel?c(e.childSubchannel):null}))}}}t.ChannelzTrace=f;class m{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,n;switch(e.kind){case"channel":{let r=null!==(t=this.channelChildren.get(e.id))&&void 0!==t?t:{ref:e,count:0};r.count+=1,this.channelChildren.set(e.id,r);break}case"subchannel":{let t=null!==(r=this.subchannelChildren.get(e.id))&&void 0!==r?r:{ref:e,count:0};t.count+=1,this.subchannelChildren.set(e.id,t);break}case"socket":{let t=null!==(n=this.socketChildren.get(e.id))&&void 0!==n?n:{ref:e,count:0};t.count+=1,this.socketChildren.set(e.id,t)}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t))}}}getChildLists(){let e=[];for(let{ref:t}of this.channelChildren.values())e.push(t);let t=[];for(let{ref:e}of this.subchannelChildren.values())t.push(e);let r=[];for(let{ref:e}of this.socketChildren.values())r.push(e);return{channels:e,subchannels:t,sockets:r}}}t.ChannelzChildrenTracker=m;class g{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}t.ChannelzCallTracker=g;let y=1;function v(){return y++}let b=[],_=[],T=[],S=[];function w(e,t,r){let n=v(),i={id:n,name:e,kind:"channel"};return r&&(b[n]={ref:i,getInfo:t}),i}function E(e,t,r){let n=v(),i={id:n,name:e,kind:"subchannel"};return r&&(_[n]={ref:i,getInfo:t}),i}function C(e,t){let r=v(),n={id:r,kind:"server"};return t&&(T[r]={ref:n,getInfo:e}),n}function I(e,t,r){let n=v(),i={id:n,name:e,kind:"socket"};return r&&(S[n]={ref:i,getInfo:t}),i}function x(e){switch(e.kind){case"channel":delete b[e.id];return;case"subchannel":delete _[e.id];return;case"server":delete T[e.id];return;case"socket":delete S[e.id];return}}function k(e){let t=Number.parseInt(e,16);return[t/256|0,t%256]}function N(e){return""===e?[]:[].concat(...e.split(":").map(e=>k(e)))}function R(e){if((0,n.isIPv4)(e))return Buffer.from(Uint8Array.from(e.split(".").map(e=>Number.parseInt(e))));if(!(0,n.isIPv6)(e))return null;{let t,r;let n=e.indexOf("::");-1===n?(t=e,r=""):(t=e.substring(0,n),r=e.substring(n+2));let i=Buffer.from(N(t)),s=Buffer.from(N(r)),a=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,a,s])}}function A(e){switch(e){case i.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case i.ConnectivityState.IDLE:return{state:"IDLE"};case i.ConnectivityState.READY:return{state:"READY"};case i.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case i.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function O(e){if(!e)return null;let t=e.getTime();return{seconds:t/1e3|0,nanos:t%1e3*1e6}}function D(e){let t=e.getInfo();return{ref:u(e.ref),data:{target:t.target,state:A(t.state),calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:O(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},channel_ref:t.children.channels.map(e=>u(e)),subchannel_ref:t.children.subchannels.map(e=>c(e))}}function P(e,t){let r=Number.parseInt(e.request.channel_id),n=b[r];if(void 0===n){t({code:s.Status.NOT_FOUND,details:"No channel data found for id "+r});return}t(null,{channel:D(n)})}function L(e,t){let r=Number.parseInt(e.request.max_results),n=[],i=Number.parseInt(e.request.start_channel_id);for(;i<b.length;i++){let e=b[i];if(void 0!==e&&(n.push(D(e)),n.length>=r))break}t(null,{channel:n,end:i>=T.length})}function M(e){let t=e.getInfo();return{ref:d(e.ref),data:{calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:O(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},listen_socket:t.listenerChildren.sockets.map(e=>h(e))}}function F(e,t){let r=Number.parseInt(e.request.server_id),n=T[r];if(void 0===n){t({code:s.Status.NOT_FOUND,details:"No server data found for id "+r});return}t(null,{server:M(n)})}function j(e,t){let r=Number.parseInt(e.request.max_results),n=[],i=Number.parseInt(e.request.start_server_id);for(;i<T.length;i++){let e=T[i];if(void 0!==e&&(n.push(M(e)),n.length>=r))break}t(null,{server:n,end:i>=T.length})}function B(e,t){let r=Number.parseInt(e.request.subchannel_id),n=_[r];if(void 0===n){t({code:s.Status.NOT_FOUND,details:"No subchannel data found for id "+r});return}let i=n.getInfo();t(null,{subchannel:{ref:c(n.ref),data:{target:i.target,state:A(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:O(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(e=>h(e))}})}function U(e){var t;return(0,a.isTcpSubchannelAddress)(e)?{address:"tcpip_address",tcpip_address:{ip_address:null!==(t=R(e.host))&&void 0!==t?t:void 0,port:e.port}}:{address:"uds_address",uds_address:{filename:e.path}}}function V(e,t){var r,n,i,a,o;let l=Number.parseInt(e.request.socket_id),u=S[l];if(void 0===u){t({code:s.Status.NOT_FOUND,details:"No socket data found for id "+l});return}let c=u.getInfo(),d=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!==(r=c.security.cipherSuiteStandardName)&&void 0!==r?r:void 0,other_name:null!==(n=c.security.cipherSuiteOtherName)&&void 0!==n?n:void 0,local_certificate:null!==(i=c.security.localCertificate)&&void 0!==i?i:void 0,remote_certificate:null!==(a=c.security.remoteCertificate)&&void 0!==a?a:void 0}}:null;t(null,{socket:{ref:h(u.ref),local:c.localAddress?U(c.localAddress):null,remote:c.remoteAddress?U(c.remoteAddress):null,remote_name:null!==(o=c.remoteName)&&void 0!==o?o:void 0,security:d,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:O(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:O(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:O(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:O(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}}})}function z(e,t){let r=Number.parseInt(e.request.server_id),n=T[r];if(void 0===n){t({code:s.Status.NOT_FOUND,details:"No server data found for id "+r});return}let i=Number.parseInt(e.request.start_socket_id),a=Number.parseInt(e.request.max_results),o=n.getInfo().sessionChildren.sockets.sort((e,t)=>e.id-t.id),l=[],u=0;for(;u<o.length&&(!(o[u].id>=i)||(l.push(h(o[u])),!(l.length>=a)));u++);t(null,{socket_ref:l,end:u>=o.length})}function q(){return{GetChannel:P,GetTopChannels:L,GetServer:F,GetServers:j,GetSubchannel:B,GetSocket:V,GetServerSockets:z}}t.registerChannelzChannel=w,t.registerChannelzSubchannel=E,t.registerChannelzServer=C,t.registerChannelzSocket=I,t.unregisterChannelzRef=x,t.getChannelzHandlers=q;let $=null;function G(){if($)return $;let e=(0,r(3716).J_)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return $=(0,l.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service}function W(){(0,o.registerAdminService)(G,q)}t.getChannelzServiceDefinition=G,t.setup=W},1809:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInterceptingCall=t.InterceptingCall=t.RequesterBuilder=t.ListenerBuilder=t.InterceptorConfigurationError=void 0;let n=r(6281),i=r(1218),s=r(9572),a=r(6027);class o extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,o)}}t.InterceptorConfigurationError=o;class l{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}t.ListenerBuilder=l;class u{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}t.RequesterBuilder=u;let c={onReceiveMetadata:(e,t)=>{t(e)},onReceiveMessage:(e,t)=>{t(e)},onReceiveStatus:(e,t)=>{t(e)}},d={start:(e,t,r)=>{r(e,t)},sendMessage:(e,t)=>{t(e)},halfClose:e=>{e()},cancel:e=>{e()}};class h{constructor(e,t){var r,n,i,s;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:null!==(r=t.start)&&void 0!==r?r:d.start,sendMessage:null!==(n=t.sendMessage)&&void 0!==n?n:d.sendMessage,halfClose:null!==(i=t.halfClose)&&void 0!==i?i:d.halfClose,cancel:null!==(s=t.cancel)&&void 0!==s?s:d.cancel}:this.requester=d}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,n,s,a,o,l;let u={onReceiveMetadata:null!==(n=null===(r=null==t?void 0:t.onReceiveMetadata)||void 0===r?void 0:r.bind(t))&&void 0!==n?n:e=>{},onReceiveMessage:null!==(a=null===(s=null==t?void 0:t.onReceiveMessage)||void 0===s?void 0:s.bind(t))&&void 0!==a?a:e=>{},onReceiveStatus:null!==(l=null===(o=null==t?void 0:t.onReceiveStatus)||void 0===o?void 0:o.bind(t))&&void 0!==l?l:e=>{}};this.processingMetadata=!0,this.requester.start(e,u,(e,t)=>{var r,n,s;let a;if(this.processingMetadata=!1,(0,i.isInterceptingListener)(t))a=t;else{let e={onReceiveMetadata:null!==(r=t.onReceiveMetadata)&&void 0!==r?r:c.onReceiveMetadata,onReceiveMessage:null!==(n=t.onReceiveMessage)&&void 0!==n?n:c.onReceiveMessage,onReceiveStatus:null!==(s=t.onReceiveStatus)&&void 0!==s?s:c.onReceiveStatus};a=new i.InterceptingListenerImpl(e,u)}this.nextCall.start(e,a),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}}function p(e,t,r){var n,i;let s=null!==(n=r.deadline)&&void 0!==n?n:1/0,a=r.host,o=null!==(i=r.parent)&&void 0!==i?i:null,l=r.propagate_flags,u=r.credentials,c=e.createCall(t,s,a,o,l);return u&&c.setCredentials(u),c}t.InterceptingCall=h;class f{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(e){this.call.cancelWithStatus(s.Status.INTERNAL,`Request message serialization failure: ${(0,a.getErrorMessage)(e)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:e=>{var r;null===(r=null==t?void 0:t.onReceiveMetadata)||void 0===r||r.call(t,e)},onReceiveMessage:e=>{var i;let o;try{o=this.methodDefinition.responseDeserialize(e)}catch(e){r={code:s.Status.INTERNAL,details:`Response message parsing error: ${(0,a.getErrorMessage)(e)}`,metadata:new n.Metadata},this.call.cancelWithStatus(r.code,r.details);return}null===(i=null==t?void 0:t.onReceiveMessage)||void 0===i||i.call(t,o)},onReceiveStatus:e=>{var n,i;r?null===(n=null==t?void 0:t.onReceiveStatus)||void 0===n||n.call(t,r):null===(i=null==t?void 0:t.onReceiveStatus)||void 0===i||i.call(t,e)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class m extends f{constructor(e,t){super(e,t)}start(e,t){var r,n;let i=!1,s={onReceiveMetadata:null!==(n=null===(r=null==t?void 0:t.onReceiveMetadata)||void 0===r?void 0:r.bind(t))&&void 0!==n?n:e=>{},onReceiveMessage:e=>{var r;i=!0,null===(r=null==t?void 0:t.onReceiveMessage)||void 0===r||r.call(t,e)},onReceiveStatus:e=>{var r,n;i||null===(r=null==t?void 0:t.onReceiveMessage)||void 0===r||r.call(t,null),null===(n=null==t?void 0:t.onReceiveStatus)||void 0===n||n.call(t,e)}};super.start(e,s),this.call.startRead()}}class g extends f{}function y(e,t,r){let n=p(e,r.path,t);return r.responseStream?new g(n,r):new m(n,r)}function v(e,t,r,n){if(e.clientInterceptors.length>0&&e.clientInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(e.callInterceptors.length>0&&e.callInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];i=e.callInterceptors.length>0||e.callInterceptorProviders.length>0?[].concat(e.callInterceptors,e.callInterceptorProviders.map(e=>e(t))).filter(e=>e):[].concat(e.clientInterceptors,e.clientInterceptorProviders.map(e=>e(t))).filter(e=>e);let s=Object.assign({},r,{method_definition:t});return i.reduceRight((e,t)=>r=>t(r,e),e=>y(n,e,t))(s)}t.getInterceptingCall=v},1865:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;let n=r(7639),i=r(9452),s=r(2409),a=r(9572),o=r(6281),l=r(1809),u=Symbol(),c=Symbol(),d=Symbol(),h=Symbol();function p(e){return"function"==typeof e}function f(e){return e.stack.split("\n").slice(1).join("\n")}class m{constructor(e,t,r={}){var n,s;if(r=Object.assign({},r),this[c]=null!==(n=r.interceptors)&&void 0!==n?n:[],delete r.interceptors,this[d]=null!==(s=r.interceptor_providers)&&void 0!==s?s:[],delete r.interceptor_providers,this[c].length>0&&this[d].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[h]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[u]=r.channelOverride;else if(r.channelFactoryOverride){let n=r.channelFactoryOverride;delete r.channelFactoryOverride,this[u]=n(e,t,r)}else this[u]=new i.ChannelImplementation(e,t,r)}close(){this[u].close()}getChannel(){return this[u]}waitForReady(e,t){let r=n=>{let i;if(n){t(Error("Failed to connect before the deadline"));return}try{i=this[u].getConnectivityState(!0)}catch(e){t(Error("The channel has been closed"));return}if(i===s.ConnectivityState.READY)t();else try{this[u].watchConnectivityState(i,e,r)}catch(e){t(Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(p(e))return{metadata:new o.Metadata,options:{},callback:e};if(p(t))return e instanceof o.Metadata?{metadata:e,options:{},callback:t}:{metadata:new o.Metadata,options:e,callback:t};if(!(e instanceof o.Metadata&&t instanceof Object&&p(r)))throw Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,p){var m,g;let y=this.checkOptionalUnaryResponseArguments(s,o,p),v={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},b={argument:i,metadata:y.metadata,call:new n.ClientUnaryCallImpl,channel:this[u],methodDefinition:v,callOptions:y.options,callback:y.callback};this[h]&&(b=this[h](b));let _=b.call,T={clientInterceptors:this[c],clientInterceptorProviders:this[d],callInterceptors:null!==(m=b.callOptions.interceptors)&&void 0!==m?m:[],callInterceptorProviders:null!==(g=b.callOptions.interceptor_providers)&&void 0!==g?g:[]},S=(0,l.getInterceptingCall)(T,b.methodDefinition,b.callOptions,b.channel);_.call=S;let w=null,E=!1,C=Error();return S.start(b.metadata,{onReceiveMetadata:e=>{_.emit("metadata",e)},onReceiveMessage(e){null!==w&&S.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),w=e},onReceiveStatus(e){if(!E){if(E=!0,e.code===a.Status.OK){if(null===w){let t=f(C);b.callback((0,n.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else b.callback(null,w)}else{let t=f(C);b.callback((0,n.callErrorFromStatus)(e,t))}C=null,_.emit("status",e)}}}),S.sendMessage(i),S.halfClose(),_}makeClientStreamRequest(e,t,r,i,s,o){var p,m;let g=this.checkOptionalUnaryResponseArguments(i,s,o),y={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},v={metadata:g.metadata,call:new n.ClientWritableStreamImpl(t),channel:this[u],methodDefinition:y,callOptions:g.options,callback:g.callback};this[h]&&(v=this[h](v));let b=v.call,_={clientInterceptors:this[c],clientInterceptorProviders:this[d],callInterceptors:null!==(p=v.callOptions.interceptors)&&void 0!==p?p:[],callInterceptorProviders:null!==(m=v.callOptions.interceptor_providers)&&void 0!==m?m:[]},T=(0,l.getInterceptingCall)(_,v.methodDefinition,v.callOptions,v.channel);b.call=T;let S=null,w=!1,E=Error();return T.start(v.metadata,{onReceiveMetadata:e=>{b.emit("metadata",e)},onReceiveMessage(e){null!==S&&T.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),S=e},onReceiveStatus(e){if(!w){if(w=!0,e.code===a.Status.OK){if(null===S){let t=f(E);v.callback((0,n.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else v.callback(null,S)}else{let t=f(E);v.callback((0,n.callErrorFromStatus)(e,t))}E=null,b.emit("status",e)}}}),b}checkMetadataAndOptions(e,t){let r,n;return e instanceof o.Metadata?(r=e,n=t||{}):(n=e||{},r=new o.Metadata),{metadata:r,options:n}}makeServerStreamRequest(e,t,r,i,s,o){var p,m;let g=this.checkMetadataAndOptions(s,o),y={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},v={argument:i,metadata:g.metadata,call:new n.ClientReadableStreamImpl(r),channel:this[u],methodDefinition:y,callOptions:g.options};this[h]&&(v=this[h](v));let b=v.call,_={clientInterceptors:this[c],clientInterceptorProviders:this[d],callInterceptors:null!==(p=v.callOptions.interceptors)&&void 0!==p?p:[],callInterceptorProviders:null!==(m=v.callOptions.interceptor_providers)&&void 0!==m?m:[]},T=(0,l.getInterceptingCall)(_,v.methodDefinition,v.callOptions,v.channel);b.call=T;let S=!1,w=Error();return T.start(v.metadata,{onReceiveMetadata(e){b.emit("metadata",e)},onReceiveMessage(e){b.push(e)},onReceiveStatus(e){if(!S){if(S=!0,b.push(null),e.code!==a.Status.OK){let t=f(w);b.emit("error",(0,n.callErrorFromStatus)(e,t))}w=null,b.emit("status",e)}}}),T.sendMessage(i),T.halfClose(),b}makeBidiStreamRequest(e,t,r,i,s){var o,p;let m=this.checkMetadataAndOptions(i,s),g={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},y={metadata:m.metadata,call:new n.ClientDuplexStreamImpl(t,r),channel:this[u],methodDefinition:g,callOptions:m.options};this[h]&&(y=this[h](y));let v=y.call,b={clientInterceptors:this[c],clientInterceptorProviders:this[d],callInterceptors:null!==(o=y.callOptions.interceptors)&&void 0!==o?o:[],callInterceptorProviders:null!==(p=y.callOptions.interceptor_providers)&&void 0!==p?p:[]},_=(0,l.getInterceptingCall)(b,y.methodDefinition,y.callOptions,y.channel);v.call=_;let T=!1,S=Error();return _.start(y.metadata,{onReceiveMetadata(e){v.emit("metadata",e)},onReceiveMessage(e){v.push(e)},onReceiveStatus(e){if(!T){if(T=!0,v.push(null),e.code!==a.Status.OK){let t=f(S);v.emit("error",(0,n.callErrorFromStatus)(e,t))}S=null,v.emit("status",e)}}}),v}}t.Client=m},4334:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.CompressionAlgorithms=void 0,function(e){e[e.identity=0]="identity",e[e.deflate=1]="deflate",e[e.gzip=2]="gzip"}(r||(t.CompressionAlgorithms=r={}))},6289:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CompressionFilterFactory=t.CompressionFilter=void 0;let n=r(9796),i=r(4334),s=r(9572),a=r(3223),o=r(5792),l=e=>"number"==typeof e&&"string"==typeof i.CompressionAlgorithms[e];class u{async writeMessage(e,t){let r=e;t&&(r=await this.compressMessage(r));let n=Buffer.allocUnsafe(r.length+5);return n.writeUInt8(t?1:0,0),n.writeUInt32BE(r.length,1),r.copy(n,5),n}async readMessage(e){let t=1===e.readUInt8(0),r=e.slice(5);return t&&(r=await this.decompressMessage(r)),r}}class c extends u{async compressMessage(e){return e}async writeMessage(e,t){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r}decompressMessage(e){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class d extends u{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{n.deflate(e,(e,n)=>{e?r(e):t(n)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,a=[],o=n.createInflate();o.on("data",e=>{a.push(e),i+=e.byteLength,-1!==this.maxRecvMessageLength&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:s.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(a))}),o.write(e),o.end()})}}class h extends u{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{n.gzip(e,(e,n)=>{e?r(e):t(n)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,a=[],o=n.createGunzip();o.on("data",e=>{a.push(e),i+=e.byteLength,-1!==this.maxRecvMessageLength&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:s.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(a))}),o.write(e),o.end()})}}class p extends u{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function f(e,t){switch(e){case"identity":return new c;case"deflate":return new d(t);case"gzip":return new h(t);default:return new p(e)}}class m extends a.BaseFilter{constructor(e,t){var r,n;super(),this.sharedFilterConfig=t,this.sendCompression=new c,this.receiveCompression=new c,this.currentCompressionAlgorithm="identity";let a=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=null!==(r=e["grpc.max_receive_message_length"])&&void 0!==r?r:s.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,void 0!==a){if(l(a)){let e=i.CompressionAlgorithms[a],r=null===(n=t.serverSupportedEncodingHeader)||void 0===n?void 0:n.split(",");(!r||r.includes(e))&&(this.currentCompressionAlgorithm=e,this.sendCompression=f(this.currentCompressionAlgorithm,-1))}else o.log(s.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${a}`)}}async sendMetadata(e){let t=await e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let e=t[0];"string"==typeof e&&(this.receiveCompression=f(e,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new c,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}async sendMessage(e){var t;let r;let n=await e;return r=!(this.sendCompression instanceof c)&&((null!==(t=n.flags)&&void 0!==t?t:0)&2)==0,{message:await this.sendCompression.writeMessage(n.message,r),flags:n.flags}}async receiveMessage(e){return this.receiveCompression.readMessage(await e)}}t.CompressionFilter=m;class g{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new m(this.options,this.sharedFilterConfig)}}t.CompressionFilterFactory=g},2409:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectivityState=void 0,function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.READY=2]="READY",e[e.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",e[e.SHUTDOWN=4]="SHUTDOWN"}(r||(t.ConnectivityState=r={}))},9572:(e,t)=>{"use strict";var r,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=t.DEFAULT_MAX_SEND_MESSAGE_LENGTH=t.Propagate=t.LogVerbosity=t.Status=void 0,function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(r||(t.Status=r={})),function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.NONE=3]="NONE"}(n||(t.LogVerbosity=n={})),function(e){e[e.DEADLINE=1]="DEADLINE",e[e.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",e[e.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",e[e.CANCELLATION=8]="CANCELLATION",e[e.DEFAULTS=65535]="DEFAULTS"}(i||(t.Propagate=i={})),t.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,t.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},5607:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.restrictControlPlaneStatusCode=void 0;let n=r(9572),i=[n.Status.OK,n.Status.INVALID_ARGUMENT,n.Status.NOT_FOUND,n.Status.ALREADY_EXISTS,n.Status.FAILED_PRECONDITION,n.Status.ABORTED,n.Status.OUT_OF_RANGE,n.Status.DATA_LOSS];function s(e,t){return i.includes(e)?{code:n.Status.INTERNAL,details:`Invalid status from control plane: ${e} ${n.Status[e]} ${t}`}:{code:e,details:t}}t.restrictControlPlaneStatusCode=s},7360:(e,t)=>{"use strict";function r(...e){let t=1/0;for(let r of e){let e=r instanceof Date?r.getTime():r;e<t&&(t=e)}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.deadlineToString=t.getRelativeTimeout=t.getDeadlineTimeoutString=t.minDeadline=void 0,t.minDeadline=r;let n=[["m",1],["S",1e3],["M",6e4],["H",36e5]];function i(e){let t=new Date().getTime();e instanceof Date&&(e=e.getTime());let r=Math.max(e-t,0);for(let[e,t]of n){let n=r/t;if(n<1e8)return String(Math.ceil(n))+e}throw Error("Deadline is too far in the future")}t.getDeadlineTimeoutString=i;let s=2147483647;function a(e){let t=(e instanceof Date?e.getTime():e)-new Date().getTime();return t<0?0:t>s?1/0:t}function o(e){if(e instanceof Date)return e.toISOString();{let t=new Date(e);return Number.isNaN(t.getTime())?""+e:t.toISOString()}}t.getRelativeTimeout=a,t.deadlineToString=o},7974:(e,t)=>{"use strict";function r(e){return{seconds:e/1e3|0,nanos:e%1e3*1e6|0}}function n(e){return 1e3*e.seconds+e.nanos/1e6|0}function i(e){return"number"==typeof e.seconds&&"number"==typeof e.nanos}Object.defineProperty(t,"__esModule",{value:!0}),t.isDuration=t.durationToMs=t.msToDuration=void 0,t.msToDuration=r,t.durationToMs=n,t.isDuration=i},6027:(e,t)=>{"use strict";function r(e){return e instanceof Error?e.message:String(e)}function n(e){return"object"==typeof e&&null!==e&&"code"in e&&"number"==typeof e.code?e.code:null}Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorCode=t.getErrorMessage=void 0,t.getErrorMessage=r,t.getErrorCode=n},8779:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OutlierDetectionLoadBalancingConfig=t.BaseSubchannelWrapper=t.registerAdminService=t.FilterStackFactory=t.BaseFilter=t.PickResultType=t.QueuePicker=t.UnavailablePicker=t.ChildLoadBalancerHandler=t.subchannelAddressToString=t.validateLoadBalancingConfig=t.getFirstUsableConfig=t.registerLoadBalancerType=t.createChildChannelControlHelper=t.BackoffTimeout=t.durationToMs=t.uriToString=t.createResolver=t.registerResolver=t.log=t.trace=void 0;var n=r(5792);Object.defineProperty(t,"trace",{enumerable:!0,get:function(){return n.trace}}),Object.defineProperty(t,"log",{enumerable:!0,get:function(){return n.log}});var i=r(4063);Object.defineProperty(t,"registerResolver",{enumerable:!0,get:function(){return i.registerResolver}}),Object.defineProperty(t,"createResolver",{enumerable:!0,get:function(){return i.createResolver}});var s=r(5773);Object.defineProperty(t,"uriToString",{enumerable:!0,get:function(){return s.uriToString}});var a=r(7974);Object.defineProperty(t,"durationToMs",{enumerable:!0,get:function(){return a.durationToMs}});var o=r(1742);Object.defineProperty(t,"BackoffTimeout",{enumerable:!0,get:function(){return o.BackoffTimeout}});var l=r(9884);Object.defineProperty(t,"createChildChannelControlHelper",{enumerable:!0,get:function(){return l.createChildChannelControlHelper}}),Object.defineProperty(t,"registerLoadBalancerType",{enumerable:!0,get:function(){return l.registerLoadBalancerType}}),Object.defineProperty(t,"getFirstUsableConfig",{enumerable:!0,get:function(){return l.getFirstUsableConfig}}),Object.defineProperty(t,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return l.validateLoadBalancingConfig}});var u=r(4955);Object.defineProperty(t,"subchannelAddressToString",{enumerable:!0,get:function(){return u.subchannelAddressToString}});var c=r(6372);Object.defineProperty(t,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return c.ChildLoadBalancerHandler}});var d=r(2352);Object.defineProperty(t,"UnavailablePicker",{enumerable:!0,get:function(){return d.UnavailablePicker}}),Object.defineProperty(t,"QueuePicker",{enumerable:!0,get:function(){return d.QueuePicker}}),Object.defineProperty(t,"PickResultType",{enumerable:!0,get:function(){return d.PickResultType}});var h=r(3223);Object.defineProperty(t,"BaseFilter",{enumerable:!0,get:function(){return h.BaseFilter}});var p=r(9386);Object.defineProperty(t,"FilterStackFactory",{enumerable:!0,get:function(){return p.FilterStackFactory}});var f=r(7749);Object.defineProperty(t,"registerAdminService",{enumerable:!0,get:function(){return f.registerAdminService}});var m=r(487);Object.defineProperty(t,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return m.BaseSubchannelWrapper}});var g=r(7542);Object.defineProperty(t,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return g.OutlierDetectionLoadBalancingConfig}})},9386:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilterStackFactory=t.FilterStack=void 0;class r{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMessage(t);return t}receiveMessage(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}}t.FilterStack=r;class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new r(this.factories.map(e=>e.createFilter()))}}t.FilterStackFactory=n},3223:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseFilter=void 0;class r{async sendMetadata(e){return e}receiveMetadata(e){return e}async sendMessage(e){return e}async receiveMessage(e){return e}receiveTrailers(e){return e}}t.BaseFilter=r},5242:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getProxiedConnection=t.mapProxyName=void 0;let n=r(5792),i=r(9572),s=r(4063),a=r(3685),o=r(4404),l=r(5792),u=r(4955),c=r(5773),d=r(7310),h=r(8501),p="proxy";function f(e){l.trace(i.LogVerbosity.DEBUG,p,e)}function m(){let e,t="",r="";if(process.env.grpc_proxy)r="grpc_proxy",t=process.env.grpc_proxy;else if(process.env.https_proxy)r="https_proxy",t=process.env.https_proxy;else{if(!process.env.http_proxy)return{};r="http_proxy",t=process.env.http_proxy}try{e=new d.URL(t)}catch(e){return(0,n.log)(i.LogVerbosity.ERROR,`cannot parse value of "${r}" env var`),{}}if("http:"!==e.protocol)return(0,n.log)(i.LogVerbosity.ERROR,`"${e.protocol}" scheme not supported in proxy URI`),{};let s=null;e.username&&(e.password?((0,n.log)(i.LogVerbosity.INFO,"userinfo found in proxy URI"),s=`${e.username}:${e.password}`):s=e.username);let a=e.hostname,o=e.port;""===o&&(o="80");let l={address:`${a}:${o}`};return s&&(l.creds=s),f("Proxy server "+l.address+" set by environment variable "+r),l}function g(){let e=process.env.no_grpc_proxy,t="no_grpc_proxy";return(e||(e=process.env.no_proxy,t="no_proxy"),e)?(f("No proxy server list set by environment variable "+t),e.split(",")):[]}function y(e,t){var r;let n={target:e,extraOptions:{}};if((null!==(r=t["grpc.enable_http_proxy"])&&void 0!==r?r:1)===0||"unix"===e.scheme)return n;let i=m();if(!i.address)return n;let s=(0,c.splitHostPort)(e.path);if(!s)return n;let a=s.host;for(let t of g())if(t===a)return f("Not using proxy for target in no_proxy list: "+(0,c.uriToString)(e)),n;let o={"grpc.http_connect_target":(0,c.uriToString)(e)};return i.creds&&(o["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:o}}function v(e,t,r){var l;if(!("grpc.http_connect_target"in t))return Promise.resolve({});let d=t["grpc.http_connect_target"],p=(0,c.parseUri)(d);if(null===p)return Promise.resolve({});let m=(0,c.splitHostPort)(p.path);if(null===m)return Promise.resolve({});let g=`${m.host}:${null!==(l=m.port)&&void 0!==l?l:h.DEFAULT_PORT}`,y={method:"CONNECT",path:g},v={Host:g};(0,u.isTcpSubchannelAddress)(e)?(y.host=e.host,y.port=e.port):y.socketPath=e.path,"grpc.http_connect_creds"in t&&(v["Proxy-Authorization"]="Basic "+Buffer.from(t["grpc.http_connect_creds"]).toString("base64")),y.headers=v;let b=(0,u.subchannelAddressToString)(e);return f("Using proxy "+b+" to connect to "+y.path),new Promise((e,t)=>{let l=a.request(y);l.once("connect",(a,u,d)=>{var h;if(l.removeAllListeners(),u.removeAllListeners(),200===a.statusCode){if(f("Successfully connected to "+y.path+" through proxy "+b),"secureContext"in r){let n=(0,s.getDefaultAuthority)(p),i=(0,c.splitHostPort)(n),a=null!==(h=null==i?void 0:i.host)&&void 0!==h?h:n,l=o.connect(Object.assign({host:a,servername:a,socket:u},r),()=>{f("Successfully established a TLS connection to "+y.path+" through proxy "+b),e({socket:l,realTarget:p})});l.on("error",e=>{f("Failed to establish a TLS connection to "+y.path+" through proxy "+b+" with error "+e.message),t()})}else f("Successfully established a plaintext connection to "+y.path+" through proxy "+b),e({socket:u,realTarget:p})}else(0,n.log)(i.LogVerbosity.ERROR,"Failed to connect to "+y.path+" through proxy "+b+" with status "+a.statusCode),t()}),l.once("error",e=>{l.removeAllListeners(),(0,n.log)(i.LogVerbosity.ERROR,"Failed to connect to proxy "+b+" with error "+e.message),t()}),l.end()})}t.mapProxyName=y,t.getProxiedConnection=v},1968:(e,t,r)=>{"use strict";g={value:!0},g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=t.Rz=g=g=g=g=g=g=t.SF=t.K9=void 0;let n=r(5402);g={enumerable:!0,get:function(){return n.CallCredentials}};let i=r(9452);g={enumerable:!0,get:function(){return i.ChannelImplementation}};let s=r(4334);g={enumerable:!0,get:function(){return s.CompressionAlgorithms}};let a=r(2409);g={enumerable:!0,get:function(){return a.ConnectivityState}};let o=r(499);g={enumerable:!0,get:function(){return o.ChannelCredentials}};let l=r(1865);g={enumerable:!0,get:function(){return l.Client}};let u=r(9572);g={enumerable:!0,get:function(){return u.LogVerbosity}},g={enumerable:!0,get:function(){return u.Status}},g={enumerable:!0,get:function(){return u.Propagate}};let c=r(5792),d=r(4529);Object.defineProperty(t,"Rz",{enumerable:!0,get:function(){return d.loadPackageDefinition}}),g={enumerable:!0,get:function(){return d.makeClientConstructor}},g={enumerable:!0,get:function(){return d.makeClientConstructor}};let h=r(6281);Object.defineProperty(t,"SF",{enumerable:!0,get:function(){return h.Metadata}});let p=r(6418);g={enumerable:!0,get:function(){return p.Server}};let f=r(3783);g={enumerable:!0,get:function(){return f.ServerCredentials}};let m=r(4339);g={enumerable:!0,get:function(){return m.StatusBuilder}},t.K9={combineChannelCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),combineCallCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),createInsecure:o.ChannelCredentials.createInsecure,createSsl:o.ChannelCredentials.createSsl,createFromSecureContext:o.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:n.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:n.CallCredentials.createFromGoogleCredential,createEmpty:n.CallCredentials.createEmpty},g=e=>e.close(),g=(e,t,r)=>e.waitForReady(t,r),g=(e,t)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},g=(e,t,r)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},g=e=>{c.setLogger(e)},g=e=>{c.setLoggerVerbosity(e)},g=e=>l.Client.prototype.getChannel.call(e);var g,y=r(1809);g={enumerable:!0,get:function(){return y.ListenerBuilder}},g={enumerable:!0,get:function(){return y.RequesterBuilder}},g={enumerable:!0,get:function(){return y.InterceptingCall}},g={enumerable:!0,get:function(){return y.InterceptorConfigurationError}};var v=r(5962);g={enumerable:!0,get:function(){return v.getChannelzServiceDefinition}},g={enumerable:!0,get:function(){return v.getChannelzHandlers}};var b=r(7749);g={enumerable:!0,get:function(){return b.addAdminServicesToServer}},g=r(8779);let _=r(8501),T=r(7255),S=r(3988),w=r(5102),E=r(4556),C=r(7542),I=r(5962);(()=>{_.setup(),T.setup(),S.setup(),w.setup(),E.setup(),C.setup(),I.setup()})()},9359:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InternalChannel=void 0;let n=r(499),i=r(7661),s=r(7328),a=r(2352),o=r(9572),l=r(9386),u=r(6289),c=r(4063),d=r(5792),h=r(5242),p=r(5773),f=r(2409),m=r(5962),g=r(1690),y=r(7360),v=r(80),b=r(1801),_=r(5607),T=r(5627),S=r(487),w=2147483647,E=1e3,C=18e5,I=new Map,x=16777216,k=1048576;class N extends S.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(e,r,n,i)=>{t.throttleKeepalive(i)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}}class R{constructor(e,t,r){var g,y,v,b,S,R,A,O;if(this.credentials=t,this.options=r,this.connectivityState=f.ConnectivityState.IDLE,this.currentPicker=new a.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new m.ChannelzCallTracker,this.childrenTracker=new m.ChannelzChildrenTracker,"string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof n.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(r&&"object"!=typeof r)throw TypeError("Channel options must be an object");this.originalTarget=e;let D=(0,p.parseUri)(e);if(null===D)throw Error(`Could not parse target name "${e}"`);let P=(0,c.mapUriDefaultScheme)(D);if(null===P)throw Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},w),null===(y=(g=this.callRefTimer).unref)||void 0===y||y.call(g),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new m.ChannelzTrace,this.channelzRef=(0,m.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,c.getDefaultAuthority)(P);let L=(0,h.mapProxyName)(P,r);this.target=L.target,this.options=Object.assign({},this.options,L.extraOptions),this.subchannelPool=(0,s.getSubchannelPool)((null!==(v=r["grpc.use_local_subchannel_pool"])&&void 0!==v?v:0)===0),this.retryBufferTracker=new T.MessageBufferTracker(null!==(b=r["grpc.retry_buffer_size"])&&void 0!==b?b:x,null!==(S=r["grpc.per_rpc_retry_buffer_size"])&&void 0!==S?S:k),this.keepaliveTime=null!==(R=r["grpc.keepalive_time_ms"])&&void 0!==R?R:-1,this.idleTimeoutMs=Math.max(null!==(A=r["grpc.client_idle_timeout_ms"])&&void 0!==A?A:C,E);let M={createSubchannel:(e,t)=>{let r=this.subchannelPool.getOrCreateSubchannel(this.target,e,Object.assign({},this.options,t),this.credentials);r.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",r.getChannelzRef());let n=new N(r,this);return this.wrappedSubchannels.add(n),n},updateState:(e,t)=>{this.currentPicker=t;let r=this.pickQueue.slice();for(let e of(this.pickQueue=[],r.length>0&&this.callRefTimerUnref(),r))e.doPick();this.updateState(e)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.refChild(e)},removeChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.unrefChild(e)}};this.resolvingLoadBalancer=new i.ResolvingLoadBalancer(this.target,M,r,(e,t)=>{e.retryThrottling?I.set(this.getTarget(),new T.RetryThrottler(e.retryThrottling.maxTokens,e.retryThrottling.tokenRatio,I.get(this.getTarget()))):I.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=t,this.currentResolutionError=null,process.nextTick(()=>{let e=this.configSelectionQueue;for(let t of(this.configSelectionQueue=[],e.length>0&&this.callRefTimerUnref(),e))t.getConfig()})},e=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+e.code+' and details "'+e.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,_.restrictControlPlaneStatusCode)(e.code,e.details)),{metadata:e.metadata}));let t=this.configSelectionQueue;for(let r of(this.configSelectionQueue=[],t.length>0&&this.callRefTimerUnref(),t))r.reportResolverError(e)}),this.filterStackFactory=new l.FilterStackFactory([new u.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let F=Error();(0,d.trace)(o.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null===(O=F.stack)||void 0===O?void 0:O.substring(F.stack.indexOf("\n")+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,d.trace)(null!=t?t:o.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,p.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,n;(null===(t=(e=this.callRefTimer).hasRef)||void 0===t?void 0:t.call(e))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null===(n=(r=this.callRefTimer).ref)||void 0===n||n.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null===(t=(e=this.callRefTimer).unref)||void 0===t||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(t=>t===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){for(let t of((0,d.trace)(o.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,p.uriToString)(this.target)+" "+f.ConnectivityState[this.connectivityState]+" -> "+f.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+f.ConnectivityState[e]),this.connectivityState=e,this.connectivityStateWatchers.slice()))e!==t.currentState&&(t.timer&&clearTimeout(t.timer),this.removeConnectivityStateWatcher(t),t.callback());e!==f.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime)for(let t of(this.keepaliveTime=e,this.wrappedSubchannels))t.throttleKeepalive(e)}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(f.ConnectivityState.IDLE),this.currentPicker=new a.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let e=new Date().valueOf()-this.lastActivityTimestamp.valueOf();e>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-e)},e),null===(r=(t=this.idleTimer).unref)||void 0===r||r.call(t)}maybeStartIdleTimer(){this.connectivityState===f.ConnectivityState.SHUTDOWN||this.idleTimer||this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===o.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,n,i){let s=(0,b.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+s+'] method="'+t+'"'),new g.LoadBalancingCall(this,e,t,r,n,i,s)}createRetryingCall(e,t,r,n,i){let s=(0,b.getNextCallNumber)();return this.trace("createRetryingCall ["+s+'] method="'+t+'"'),new T.RetryingCall(this,e,t,r,n,i,s,this.retryBufferTracker,I.get(this.getTarget()))}createInnerCall(e,t,r,n,i){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall(e,t,r,n,i):this.createRetryingCall(e,t,r,n,i)}createResolvingCall(e,t,r,n,i){let s=(0,b.getNextCallNumber)();this.trace("createResolvingCall ["+s+'] method="'+e+'", deadline='+(0,y.deadlineToString)(t));let a={deadline:t,flags:null!=i?i:o.Propagate.DEFAULTS,host:null!=r?r:this.defaultAuthority,parentCall:n},l=new v.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),s);return this.onCallStart(),l.addStatusWatcher(e=>{this.onCallEnd(e)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(f.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,m.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,p.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===f.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let n=null;if(t!==1/0){let e=t instanceof Date?t:new Date(t),s=new Date;if(t===-1/0||e<=s){process.nextTick(r,Error("Deadline passed without connectivity state change"));return}n=setTimeout(()=>{this.removeConnectivityStateWatcher(i),r(Error("Deadline passed without connectivity state change"))},e.getTime()-s.getTime())}let i={currentState:e,callback:r,timer:n};this.connectivityStateWatchers.push(i)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,n,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===f.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall(e,t,r,n,i)}}t.InternalChannel=R},6372:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChildLoadBalancerHandler=void 0;let n=r(9884),i=r(2409),s="child_load_balancer_helper";class a{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(e){this.parent=e,this.child=null}createSubchannel(e,t){return this.parent.channelControlHelper.createSubchannel(e,t)}updateState(e,t){var r;if(this.calledByPendingChild()){if(e===i.ConnectivityState.CONNECTING)return;null===(r=this.parent.currentChild)||void 0===r||r.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(e,t)}requestReresolution(){var e;let t=null!==(e=this.parent.pendingChild)&&void 0!==e?e:this.parent.currentChild;this.child===t&&this.parent.channelControlHelper.requestReresolution()}setChild(e){this.child=e}addChannelzChild(e){this.parent.channelControlHelper.addChannelzChild(e)}removeChannelzChild(e){this.parent.channelControlHelper.removeChannelzChild(e)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let e=new this.ChildPolicyHelper(this),r=(0,n.createLoadBalancer)(t,e);e.setChild(r),null===this.currentChild?(this.currentChild=r,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=r,i=this.pendingChild)}else i=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return s}}t.ChildLoadBalancerHandler=a},7542:(e,t,r)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.OutlierDetectionLoadBalancer=t.OutlierDetectionLoadBalancingConfig=void 0;let i=r(2409),s=r(9572),a=r(7974),o=r(8779),l=r(9884),u=r(6372),c=r(2352),d=r(4955),h=r(487),p=r(5792),f="outlier_detection";function m(e){p.trace(s.LogVerbosity.DEBUG,f,e)}let g="outlier_detection",y=(null!==(n=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)&&void 0!==n?n:"true")==="true",v={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},b={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function _(e,t,r,n){if(t in e&&typeof e[t]!==r){let i=n?`${n}.${t}`:t;throw Error(`outlier detection config ${i} parse error: expected ${r}, got ${typeof e[t]}`)}}function T(e,t,r){let n=r?`${r}.${t}`:t;if(t in e){if(!(0,a.isDuration)(e[t]))throw Error(`outlier detection config ${n} parse error: expected Duration, got ${typeof e[t]}`);if(!(e[t].seconds>=0&&e[t].seconds<=315576e6&&e[t].nanos>=0&&e[t].nanos<=999999999))throw Error(`outlier detection config ${n} parse error: values out of range for non-negative Duaration`)}}function S(e,t,r){let n=r?`${r}.${t}`:t;if(_(e,t,"number",r),t in e&&!(e[t]>=0&&e[t]<=100))throw Error(`outlier detection config ${n} parse error: value out of range for percentage (0-100)`)}class w{constructor(e,t,r,n,i,s,a){if(this.childPolicy=a,a.length>0&&"pick_first"===a[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=e?e:1e4,this.baseEjectionTimeMs=null!=t?t:3e4,this.maxEjectionTimeMs=null!=r?r:3e5,this.maxEjectionPercent=null!=n?n:10,this.successRateEjection=i?Object.assign(Object.assign({},v),i):null,this.failurePercentageEjection=s?Object.assign(Object.assign({},b),s):null}getLoadBalancerName(){return g}toJsonObject(){return{interval:(0,a.msToDuration)(this.intervalMs),base_ejection_time:(0,a.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,a.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new w(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(T(e,"interval"),T(e,"base_ejection_time"),T(e,"max_ejection_time"),S(e,"max_ejection_percent"),"success_rate_ejection"in e){if("object"!=typeof e.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");_(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),S(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),_(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),_(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if("object"!=typeof e.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");S(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),S(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),_(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),_(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new w(e.interval?(0,a.durationToMs)(e.interval):null,e.base_ejection_time?(0,a.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,a.durationToMs)(e.max_ejection_time):null,null!==(t=e.max_ejection_percent)&&void 0!==t?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(l.validateLoadBalancingConfig))}}t.OutlierDetectionLoadBalancingConfig=w;class E extends h.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((e,t,r,n)=>{if(this.childSubchannelState=r,!this.ejected)for(let e of this.stateListeners)e(this,t,r,n)})}getConnectivityState(){return this.ejected?i.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){for(let e of(this.ejected=!0,this.stateListeners))e(this,this.childSubchannelState,i.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(let e of(this.ejected=!1,this.stateListeners))e(this,i.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function C(){return{success:0,failure:0}}class I{constructor(){this.activeBucket=C(),this.inactiveBucket=C()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=C()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class x{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType!==c.PickResultType.COMPLETE)return t;{let e=t.subchannel,r=e.getMapEntry();if(!r)return Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel()});{let n=t.onCallEnded;return this.countCalls&&(n=e=>{var n;e===s.Status.OK?r.counter.addSuccess():r.counter.addFailure(),null===(n=t.onCallEnded)||void 0===n||n.call(t,e)}),Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel(),onCallEnded:n})}}}}class k{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new u.ChildLoadBalancerHandler((0,o.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let n=e.createSubchannel(t,r),i=this.addressMap.get((0,d.subchannelAddressToString)(t)),s=new E(n,i);return(null==i?void 0:i.currentEjectionTimestamp)!==null&&s.eject(),null==i||i.subchannelWrappers.push(s),s},updateState:(t,r)=>{t===i.ConnectivityState.READY?e.updateState(t,new x(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())null!==t.currentEjectionTimestamp&&(e+=1);return 100*e/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;m("Running success rate check");let r=t.request_volume,n=0,i=[];for(let[e,t]of this.addressMap){let s=t.counter.getLastSuccesses(),a=t.counter.getLastFailures();m("Stats for "+e+": successes="+s+" failures="+a+" targetRequestVolume="+r),s+a>=r&&(n+=1,i.push(s/(s+a)))}if(m("Found "+n+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+i+"]"),n<t.minimum_hosts)return;let s=i.reduce((e,t)=>e+t)/i.length,a=0;for(let e of i){let t=e-s;a+=t*t}let o=Math.sqrt(a/i.length),l=s-t.stdev_factor/1e3*o;for(let[n,i]of(m("stdev="+o+" ejectionThreshold="+l),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let s=i.counter.getLastSuccesses(),a=i.counter.getLastFailures();if(s+a<r)continue;let o=s/(s+a);if(m("Checking candidate "+n+" successRate="+o),o<l){let r=100*Math.random();m("Candidate "+n+" randomNumber="+r+" enforcement_percentage="+t.enforcement_percentage),r<t.enforcement_percentage&&(m("Ejecting candidate "+n),this.eject(i,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;m("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let e of this.addressMap.values())e.counter.getLastSuccesses()+e.counter.getLastFailures()>=t.request_volume&&(r+=1);if(!(r<t.minimum_hosts))for(let[r,n]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let i=n.counter.getLastSuccesses(),s=n.counter.getLastFailures();if(m("Candidate successes="+i+" failures="+s),!(i+s<t.request_volume)&&100*s/(s+i)>t.threshold){let i=100*Math.random();m("Candidate "+r+" randomNumber="+i+" enforcement_percentage="+t.enforcement_percentage),i<t.enforcement_percentage&&(m("Ejecting candidate "+r),this.eject(n,e))}}}eject(e,t){for(let t of(e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1,e.subchannelWrappers))t.eject()}uneject(e){for(let t of(e.currentEjectionTimestamp=null,e.subchannelWrappers))t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),null===(r=(t=this.ejectionTimer).unref)||void 0===r||r.call(t)}runChecks(){let e=new Date;if(m("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[t,r]of(this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e),this.addressMap.entries()))if(null===r.currentEjectionTimestamp)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let e=this.latestConfig.getBaseEjectionTimeMs(),n=this.latestConfig.getMaxEjectionTimeMs(),i=new Date(r.currentEjectionTimestamp.getTime());i.setMilliseconds(i.getMilliseconds()+Math.min(e*r.ejectionTimeMultiplier,Math.max(e,n))),i<new Date&&(m("Unejecting "+t),this.uneject(r))}}updateAddressList(e,t,r){if(!(t instanceof w))return;let n=new Set;for(let t of e)n.add((0,d.subchannelAddressToString)(t));for(let e of n)this.addressMap.has(e)||(m("Adding map entry for "+e),this.addressMap.set(e,{counter:new I,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let e of this.addressMap.keys())n.has(e)||(m("Removing map entry for "+e),this.addressMap.delete(e));let i=(0,l.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,i,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig()){if(this.timerStartTime){m("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let e=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(e)}else m("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets()}else for(let e of(m("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(e),e.ejectionTimeMultiplier=0;this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return g}}function N(){y&&(0,o.registerLoadBalancerType)(g,k,w)}t.OutlierDetectionLoadBalancer=k,t.setup=N},5102:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.PickFirstLoadBalancer=t.shuffled=t.PickFirstLoadBalancingConfig=void 0;let n=r(9884),i=r(2409),s=r(2352),a=r(5792),o=r(9572),l="pick_first";function u(e){a.trace(o.LogVerbosity.DEBUG,l,e)}let c="pick_first",d=250;class h{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return c}toJsonObject(){return{[c]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&"boolean"!=typeof e.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new h(!0===e.shuffleAddressList)}}t.PickFirstLoadBalancingConfig=h;class p{constructor(e){this.subchannel=e}pick(e){return{pickResultType:s.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}}function f(e){let t=e.slice();for(let e=t.length-1;e>1;e--){let r=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[r],t[r]=n}return t}t.shuffled=f;class m{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=i.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(e,t,r,n,i)=>{this.onSubchannelStateUpdate(e,t,r,i)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(i.ConnectivityState.READY,new p(this.currentPick)):0===this.children.length?this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){for(let{subchannel:e}of(this.stickyTransientFailureMode=!0,this.children))e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,n){var s;if(null===(s=this.currentPick)||void 0===s?void 0:s.realSubchannelEquals(e)){r!==i.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[t,s]of this.children.entries())if(e.realSubchannelEquals(s.subchannel)){r===i.ConnectivityState.READY&&this.pickSubchannel(s.subchannel),r===i.ConnectivityState.TRANSIENT_FAILURE&&(s.hasReportedTransientFailure=!0,n&&(this.lastError=n),this.maybeEnterStickyTransientFailureMode(),t===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(t+1)),s.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let e=r.subchannel.getConnectivityState();if(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===i.ConnectivityState.IDLE&&(u("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var t;null===(t=this.children[e])||void 0===t||t.subchannel.startConnecting()})),this.connectionDelayTimeout=null===(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},d)).unref)||void 0===r?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(u("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){u(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(e=>({subchannel:this.channelControlHelper.createSubchannel(e,{}),hasReportedTransientFailure:!1}));for(let{subchannel:e}of t)e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef());for(let{subchannel:e}of(this.resetSubchannelList(),this.children=t,this.children))if(e.addConnectivityStateListener(this.subchannelStateListener),e.getConnectivityState()===i.ConnectivityState.READY){this.pickSubchannel(e);return}for(let e of this.children)e.subchannel.getConnectivityState()===i.ConnectivityState.TRANSIENT_FAILURE&&(e.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof h&&(t.getShuffleAddressList()&&(e=f(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===i.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return c}}function g(){(0,n.registerLoadBalancerType)(c,m,h),(0,n.registerDefaultLoadBalancerType)(c)}t.PickFirstLoadBalancer=m,t.setup=g},4556:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.RoundRobinLoadBalancer=void 0;let n=r(9884),i=r(2409),s=r(2352),a=r(4955),o=r(5792),l=r(9572),u="round_robin";function c(e){o.trace(l.LogVerbosity.DEBUG,u,e)}let d="round_robin";class h{getLoadBalancerName(){return d}constructor(){}toJsonObject(){return{[d]:{}}}static createFromJson(e){return new h}}class p{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:s.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class f{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=i.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(e,t,r,n,s)=>{this.calculateAndUpdateState(),(r===i.ConnectivityState.TRANSIENT_FAILURE||r===i.ConnectivityState.IDLE)&&(s&&(this.lastError=s),this.channelControlHelper.requestReresolution(),e.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(i.ConnectivityState.READY)>0){let e=this.subchannels.filter(e=>e.getConnectivityState()===i.ConnectivityState.READY),t=0;null!==this.currentReadyPicker&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(t=0),this.updateState(i.ConnectivityState.READY,new p(e,t))}else this.countSubchannelsWithState(i.ConnectivityState.CONNECTING)>0?this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this)):this.countSubchannelsWithState(i.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this))}updateState(e,t){c(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),e===i.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){for(let t of(this.resetSubchannelList(),c("Connect to address list "+e.map(e=>(0,a.subchannelAddressToString)(e))),this.subchannels=e.map(e=>this.channelControlHelper.createSubchannel(e,{})),this.subchannels)){t.ref(),t.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(t.getChannelzRef());let e=t.getConnectivityState();(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.TRANSIENT_FAILURE)&&t.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return d}}function m(){(0,n.registerLoadBalancerType)(d,f,h)}t.RoundRobinLoadBalancer=f,t.setup=m},9884:(e,t)=>{"use strict";function r(e,t){var r,n,i,s,a,o,l,u,c,d;return{createSubchannel:null!==(n=null===(r=t.createSubchannel)||void 0===r?void 0:r.bind(t))&&void 0!==n?n:e.createSubchannel.bind(e),updateState:null!==(s=null===(i=t.updateState)||void 0===i?void 0:i.bind(t))&&void 0!==s?s:e.updateState.bind(e),requestReresolution:null!==(o=null===(a=t.requestReresolution)||void 0===a?void 0:a.bind(t))&&void 0!==o?o:e.requestReresolution.bind(e),addChannelzChild:null!==(u=null===(l=t.addChannelzChild)||void 0===l?void 0:l.bind(t))&&void 0!==u?u:e.addChannelzChild.bind(e),removeChannelzChild:null!==(d=null===(c=t.removeChannelzChild)||void 0===c?void 0:c.bind(t))&&void 0!==d?d:e.removeChannelzChild.bind(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.validateLoadBalancingConfig=t.getFirstUsableConfig=t.isLoadBalancerNameRegistered=t.createLoadBalancer=t.registerDefaultLoadBalancerType=t.registerLoadBalancerType=t.createChildChannelControlHelper=void 0,t.createChildChannelControlHelper=r;let n={},i=null;function s(e,t,r){n[e]={LoadBalancer:t,LoadBalancingConfig:r}}function a(e){i=e}function o(e,t){let r=e.getLoadBalancerName();return r in n?new n[r].LoadBalancer(t):null}function l(e){return e in n}function u(e,t=!1){for(let t of e)if(t.getLoadBalancerName() in n)return t;return t&&i?new n[i].LoadBalancingConfig:null}function c(e){if(!(null!==e&&"object"==typeof e))throw Error("Load balancing config must be an object");let t=Object.keys(e);if(1!==t.length)throw Error("Provided load balancing config has multiple conflicting entries");let r=t[0];if(r in n)return n[r].LoadBalancingConfig.createFromJson(e[r]);throw Error(`Unrecognized load balancing config name ${r}`)}t.registerLoadBalancerType=s,t.registerDefaultLoadBalancerType=a,t.createLoadBalancer=o,t.isLoadBalancerNameRegistered=l,t.getFirstUsableConfig=u,t.validateLoadBalancingConfig=c},1690:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadBalancingCall=void 0;let n=r(2409),i=r(9572),s=r(7360),a=r(6281),o=r(2352),l=r(5773),u=r(5792),c=r(5607),d=r(5158),h="load_balancing_call";class p{constructor(e,t,r,n,i,s,a){var o,u;this.channel=e,this.callConfig=t,this.methodName=r,this.host=n,this.credentials=i,this.deadline=s,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let c=this.methodName.split("/"),d="";c.length>=2&&(d=c[1]);let h=null!==(u=null===(o=(0,l.splitHostPort)(this.host))||void 0===o?void 0:o.host)&&void 0!==u?u:"localhost";this.serviceUrl=`https://${h}/${d}`}trace(e){u.trace(i.LogVerbosity.DEBUG,h,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,n;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let i=Object.assign(Object.assign({},e),{progress:t});null===(r=this.listener)||void 0===r||r.onReceiveStatus(i),null===(n=this.onCallEnded)||void 0===n||n.call(this,i.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),l=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+o.PickResultType[r.pickResultType]+" subchannel: "+l+" status: "+(null===(e=r.status)||void 0===e?void 0:e.code)+" "+(null===(t=r.status)||void 0===t?void 0:t.details)),r.pickResultType){case o.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(e=>{var t,o,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let c=this.metadata.clone();if(c.merge(e),c.get("authorization").length>1&&this.outputStatus({code:i.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new a.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==n.ConnectivityState.READY){this.trace("Picked subchannel "+l+" has state "+n.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&c.set("grpc-timeout",(0,s.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(c,this.host,this.methodName,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(e)},onReceiveMessage:e=>{this.trace("Received message"),this.listener.onReceiveMessage(e)},onReceiveStatus:e=>{this.trace("Received status"),e.rstCode===d.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(e,"REFUSED"):this.outputStatus(e,"PROCESSED")}})}catch(e){this.trace("Failed to start call on picked subchannel "+l+" with error "+e.message),this.outputStatus({code:i.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+e.message,metadata:new a.Metadata},"NOT_STARTED");return}null===(o=(t=this.callConfig).onCommitted)||void 0===o||o.call(t),null===(u=r.onCallStarted)||void 0===u||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},e=>{let{code:t,details:r}=(0,c.restrictControlPlaneStatusCode)("number"==typeof e.code?e.code:i.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${e.message}`);this.outputStatus({code:t,details:r,metadata:new a.Metadata},"PROCESSED")});break;case o.PickResultType.DROP:let{code:u,details:h}=(0,c.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:u,details:h,metadata:r.status.metadata},"DROP")});break;case o.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:e,details:t}=(0,c.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:e,details:t,metadata:r.status.metadata},"PROCESSED")})}break;case o.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null===(r=this.child)||void 0===r||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new a.Metadata},"PROCESSED")}getPeer(){var e,t;return null!==(t=null===(e=this.child)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}}t.LoadBalancingCall=p},5792:(e,t,r)=>{"use strict";var n,i,s,a;Object.defineProperty(t,"__esModule",{value:!0}),t.isTracerEnabled=t.trace=t.log=t.setLoggerVerbosity=t.setLogger=t.getLogger=void 0;let o=r(9572),l=r(7282),u=r(1513).i8,c={error:(e,...t)=>{console.error("E "+e,...t)},info:(e,...t)=>{console.error("I "+e,...t)},debug:(e,...t)=>{console.error("D "+e,...t)}},d=o.LogVerbosity.ERROR;switch((null!==(i=null!==(n=process.env.GRPC_NODE_VERBOSITY)&&void 0!==n?n:process.env.GRPC_VERBOSITY)&&void 0!==i?i:"").toUpperCase()){case"DEBUG":d=o.LogVerbosity.DEBUG;break;case"INFO":d=o.LogVerbosity.INFO;break;case"ERROR":d=o.LogVerbosity.ERROR;break;case"NONE":d=o.LogVerbosity.NONE}let h=()=>c;t.getLogger=h;let p=e=>{c=e};t.setLogger=p;let f=e=>{d=e};t.setLoggerVerbosity=f;let m=(e,...t)=>{let r;if(e>=d){switch(e){case o.LogVerbosity.DEBUG:r=c.debug;break;case o.LogVerbosity.INFO:r=c.info;break;case o.LogVerbosity.ERROR:r=c.error}r||(r=c.error),r&&r.bind(c)(...t)}};t.log=m;let g=null!==(a=null!==(s=process.env.GRPC_NODE_TRACE)&&void 0!==s?s:process.env.GRPC_TRACE)&&void 0!==a?a:"",y=new Set,v=new Set;for(let e of g.split(","))e.startsWith("-")?v.add(e.substring(1)):y.add(e);let b=y.has("all");function _(e,r,n){T(r)&&(0,t.log)(e,new Date().toISOString()+" | v"+u+" "+l.pid+" | "+r+" | "+n)}function T(e){return!v.has(e)&&(b||y.has(e))}t.trace=_,t.isTracerEnabled=T},4529:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadPackageDefinition=t.makeClientConstructor=void 0;let n=r(1865),i={unary:n.Client.prototype.makeUnaryRequest,server_stream:n.Client.prototype.makeServerStreamRequest,client_stream:n.Client.prototype.makeClientStreamRequest,bidi:n.Client.prototype.makeBidiStreamRequest};function s(e){return["__proto__","prototype","constructor"].includes(e)}function a(e,t,r){r||(r={});class a extends n.Client{}return Object.keys(e).forEach(t=>{let r;if(s(t))return;let n=e[t];if("string"==typeof t&&"$"===t.charAt(0))throw Error("Method names cannot start with $");r=n.requestStream?n.responseStream?"bidi":"client_stream":n.responseStream?"server_stream":"unary";let l=n.requestSerialize,u=n.responseDeserialize,c=o(i[r],n.path,l,u);a.prototype[t]=c,Object.assign(a.prototype[t],n),n.originalName&&!s(n.originalName)&&(a.prototype[n.originalName]=a.prototype[t])}),a.service=e,a.serviceName=t,a}function o(e,t,r,n){return function(...i){return e.call(this,t,r,n,...i)}}function l(e){return"format"in e}function u(e){let t={};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let n=e[r],i=r.split(".");if(i.some(e=>s(e)))continue;let o=i[i.length-1],u=t;for(let e of i.slice(0,-1))u[e]||(u[e]={}),u=u[e];l(n)?u[o]=n:u[o]=a(n,o,{})}return t}t.makeClientConstructor=a,t.loadPackageDefinition=u},6281:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;let n=r(5792),i=r(9572),s=r(6027),a=/^[0-9a-z_.-]+$/,o=/^[ -~]*$/;function l(e){return a.test(e)}function u(e){return o.test(e)}function c(e){return e.endsWith("-bin")}function d(e){return!e.startsWith("grpc-")}function h(e){return e.toLowerCase()}function p(e,t){if(!l(e))throw Error('Metadata key "'+e+'" contains illegal characters');if(null!=t){if(c(e)){if(!Buffer.isBuffer(t))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(t))throw Error("keys that don't end with '-bin' must have String values");if(!u(t))throw Error('Metadata string value "'+t+'" contains illegal characters')}}}class f{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){p(e=h(e),t),this.internalRepr.set(e,[t])}add(e,t){p(e=h(e),t);let r=this.internalRepr.get(e);void 0===r?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=h(e),this.internalRepr.delete(e)}get(e){return e=h(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let n=r[0];e[t]=Buffer.isBuffer(n)?Buffer.from(n):n}return e}clone(){let e=new f(this.options),t=e.internalRepr;for(let[e,r]of this.internalRepr){let n=r.map(e=>Buffer.isBuffer(e)?Buffer.from(e):e);t.set(e,n)}return e}merge(e){for(let[t,r]of e.internalRepr){let e=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,e)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(m);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new f;for(let r of Object.keys(e)){if(":"===r.charAt(0))continue;let a=e[r];try{c(r)?Array.isArray(a)?a.forEach(e=>{t.add(r,Buffer.from(e,"base64"))}):void 0!==a&&(d(r)?a.split(",").forEach(e=>{t.add(r,Buffer.from(e.trim(),"base64"))}):t.add(r,Buffer.from(a,"base64"))):Array.isArray(a)?a.forEach(e=>{t.add(r,e)}):void 0!==a&&t.add(r,a)}catch(t){let e=`Failed to add metadata entry ${r}: ${a}. ${(0,s.getErrorMessage)(t)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,n.log)(i.LogVerbosity.ERROR,e)}}return t}}t.Metadata=f;let m=e=>Buffer.isBuffer(e)?e.toString("base64"):e},2352:(e,t,r)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.QueuePicker=t.UnavailablePicker=t.PickResultType=void 0;let i=r(6281),s=r(9572);!function(e){e[e.COMPLETE=0]="COMPLETE",e[e.QUEUE=1]="QUEUE",e[e.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",e[e.DROP=3]="DROP"}(n||(t.PickResultType=n={}));class a{constructor(e){this.status=Object.assign({code:s.Status.UNAVAILABLE,details:"No connection established",metadata:new i.Metadata},e)}pick(e){return{pickResultType:n.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}}t.UnavailablePicker=a;class o{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:n.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}}t.QueuePicker=o},8501:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.DEFAULT_PORT=void 0;let n=r(4063),i=r(9523),s=r(3837),a=r(4298),o=r(9572),l=r(6281),u=r(5792),c=r(9572),d=r(5773),h=r(1808),p=r(1742),f="dns_resolver";function m(e){u.trace(c.LogVerbosity.DEBUG,f,e)}t.DEFAULT_PORT=443;let g=3e4,y=s.promisify(i.resolveTxt),v=s.promisify(i.lookup);function b(...e){let t=[];for(let r=0;r<Math.max.apply(null,e.map(e=>e.length));r++)for(let n of e)r<n.length&&t.push(n[r]);return t}class _{constructor(e,r,n){var i,s,a;this.target=e,this.listener=r,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,m("Resolver constructed for target "+(0,d.uriToString)(e));let u=(0,d.splitHostPort)(e.path);null===u?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,h.isIPv4)(u.host)||(0,h.isIPv6)(u.host)?(this.ipResult=[{host:u.host,port:null!==(i=u.port)&&void 0!==i?i:t.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=u.host,this.port=null!==(s=u.port)&&void 0!==s?s:t.DEFAULT_PORT),this.percentage=100*Math.random(),1===n["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:o.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,d.uriToString)(this.target)}`,metadata:new l.Metadata};let c={initialDelay:n["grpc.initial_reconnect_backoff_ms"],maxDelay:n["grpc.max_reconnect_backoff_ms"]};this.backoff=new p.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},c),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!==(a=n["grpc.dns_min_time_between_resolutions_ms"])&&void 0!==a?a:g,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){this.returnedIpResult||(m("Returning IP address for target "+(0,d.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)m("Failed to parse DNS address "+(0,d.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:o.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,d.uriToString)(this.target)}`,metadata:new l.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;m("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=v(e,{all:!0}),this.pendingLookupPromise.then(e=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let t=e.filter(e=>4===e.family),r=e.filter(e=>6===e.family);this.latestLookupResult=b(r,t).map(e=>({host:e.address,port:+this.port}));let n="["+this.latestLookupResult.map(e=>e.host+":"+e.port).join(",")+"]";if(m("Resolved addresses for target "+(0,d.uriToString)(this.target)+": "+n),0===this.latestLookupResult.length){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},e=>{null!==this.pendingLookupPromise&&(m("Resolution error for target "+(0,d.uriToString)(this.target)+": "+e.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=y(e),this.pendingTxtPromise.then(e=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,a.extractAndSelectServiceConfig)(e,this.percentage)}catch(e){this.latestServiceConfigError={code:o.Status.UNAVAILABLE,details:`Parsing service config failed with error ${e.message}`,metadata:new l.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},e=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null===(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)||void 0===t?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?m('resolution update delayed by "min time between resolutions" rate limit'):m("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}}function T(){(0,n.registerResolver)("dns",_),(0,n.registerDefaultScheme)("dns")}t.setup=T},3988:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=void 0;let n=r(1808),i=r(9572),s=r(6281),a=r(4063),o=r(5773),l=r(5792),u="ip_resolver";function c(e){l.trace(i.LogVerbosity.DEBUG,u,e)}let d="ipv4",h="ipv6",p=443;class f{constructor(e,t,r){var a;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,c("Resolver constructed for target "+(0,o.uriToString)(e));let l=[];if(!(e.scheme===d||e.scheme===h)){this.error={code:i.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new s.Metadata};return}for(let t of e.path.split(",")){let r=(0,o.splitHostPort)(t);if(null===r||e.scheme===d&&!(0,n.isIPv4)(r.host)||e.scheme===h&&!(0,n.isIPv6)(r.host)){this.error={code:i.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${t}`,metadata:new s.Metadata};return}l.push({host:r.host,port:null!==(a=r.port)&&void 0!==a?a:p})}this.addresses=l,c("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}}function m(){(0,a.registerResolver)(d,f),(0,a.registerResolver)(h,f)}t.setup=m},7255:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=void 0;let n=r(4063);class i{constructor(e,t,r){let n;this.listener=t,this.addresses=[],this.hasReturnedResult=!1,n=""===e.authority?"/"+e.path:e.path,this.addresses=[{path:n}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}}function s(){(0,n.registerResolver)("unix",i)}t.setup=s},4063:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapUriDefaultScheme=t.getDefaultAuthority=t.createResolver=t.registerDefaultScheme=t.registerResolver=void 0;let n=r(5773),i={},s=null;function a(e,t){i[e]=t}function o(e){s=e}function l(e,t,r){if(void 0!==e.scheme&&e.scheme in i)return new i[e.scheme](e,t,r);throw Error(`No resolver could be created for target ${(0,n.uriToString)(e)}`)}function u(e){if(void 0!==e.scheme&&e.scheme in i)return i[e.scheme].getDefaultAuthority(e);throw Error(`Invalid target ${(0,n.uriToString)(e)}`)}function c(e){return void 0!==e.scheme&&e.scheme in i?e:null!==s?{scheme:s,authority:void 0,path:(0,n.uriToString)(e)}:null}t.registerResolver=a,t.registerDefaultScheme=o,t.createResolver=l,t.getDefaultAuthority=u,t.mapUriDefaultScheme=c},80:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResolvingCall=void 0;let n=r(9572),i=r(7360),s=r(6281),a=r(5792),o=r(5607),l="resolving_call";class u{constructor(e,t,r,s,a,o){this.channel=e,this.method=t,this.filterStackFactory=s,this.credentials=a,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&n.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(n.Status.CANCELLED,"Cancelled by parent call")}),r.flags&n.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,i.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){a.trace(n.LogVerbosity.DEBUG,l,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,i.deadlineToString)(this.deadline));let e=(0,i.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(n.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(e=>e(t)),process.nextTick(()=>{var e;null===(e=this.listener)||void 0===e||e.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(t=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,t.message),this.pendingHalfClose&&r.halfClose()},e=>{this.cancelWithStatus(e.code,e.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if("NONE"===e.type){this.channel.queueCallForConfig(this);return}if("ERROR"===e.type){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==n.Status.OK){let{code:e,details:r}=(0,o.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:e,details:r,metadata:new s.Metadata});return}if(t.methodConfig.timeout){let e=new Date;e.setSeconds(e.getSeconds()+t.methodConfig.timeout.seconds),e.setMilliseconds(e.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,i.minDeadline)(this.deadline,e),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(e=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(e,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(e))},onReceiveMessage:e=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(e).then(e=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(e),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},e=>{this.cancelWithStatus(e.code,e.details)})},onReceiveStatus:e=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=e:this.outputStatus(e)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},e=>{this.outputStatus(e)})}reportResolverError(e){var t;(null===(t=this.metadata)||void 0===t?void 0:t.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null===(r=this.child)||void 0===r||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new s.Metadata})}getPeer(){var e,t;return null!==(t=null===(e=this.child)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}}t.ResolvingCall=u},7661:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResolvingLoadBalancer=void 0;let n=r(9884),i=r(4298),s=r(2409),a=r(4063),o=r(2352),l=r(1742),u=r(9572),c=r(6281),d=r(5792),h=r(9572),p=r(5773),f=r(6372),m="resolving_load_balancer";function g(e){d.trace(h.LogVerbosity.DEBUG,m,e)}let y=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function v(e,t,r,n){for(let i of r.name)switch(n){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===e&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===e&&i.method===t)return!0}return!1}function b(e,t,r,n){for(let i of r)if(v(e,t,i,n))return i;return null}function _(e){return function(t,r){var n,i;let s=t.split("/").filter(e=>e.length>0),a=null!==(n=s[0])&&void 0!==n?n:"",o=null!==(i=s[1])&&void 0!==i?i:"";if(e&&e.methodConfig)for(let t of y){let r=b(a,o,e.methodConfig,t);if(r)return{methodConfig:r,pickInformation:{},status:u.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:u.Status.OK,dynamicFilterFactories:[]}}}class T{constructor(e,t,r,d,h){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=d,this.onFailedResolution=h,this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,i.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(s.ConnectivityState.IDLE,new o.QueuePicker(this)),this.childLoadBalancer=new f.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(g("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(e,t)=>{this.latestChildState=e,this.latestChildPicker=t,this.updateState(e,t)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,a.createResolver)(e,{onSuccessfulResolution:(e,t,r,i,s)=>{var a;this.backoffTimeout.stop(),this.backoffTimeout.reset();let o=null;null===t?null===r?(this.previousServiceConfig=null,o=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(r):o=this.previousServiceConfig:(o=t,this.previousServiceConfig=t);let l=null!==(a=null==o?void 0:o.loadBalancingConfig)&&void 0!==a?a:[],d=(0,n.getFirstUsableConfig)(l,!0);if(null===d){this.handleResolutionFailure({code:u.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new c.Metadata});return}this.childLoadBalancer.updateAddressList(e,d,s);let h=null!=o?o:this.defaultServiceConfig;this.onSuccessfulResolution(h,null!=i?i:_(h))},onError:e=>{this.handleResolutionFailure(e)}},r);let p={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new l.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},p),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===s.ConnectivityState.IDLE&&this.updateState(s.ConnectivityState.CONNECTING,new o.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){g((0,p.uriToString)(this.target)+" "+s.ConnectivityState[this.currentState]+" -> "+s.ConnectivityState[e]),e===s.ConnectivityState.IDLE&&(t=new o.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===s.ConnectivityState.IDLE&&(this.updateState(s.ConnectivityState.TRANSIENT_FAILURE,new o.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===s.ConnectivityState.IDLE||this.currentState===s.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}}t.ResolvingLoadBalancer=T},5627:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RetryingCall=t.MessageBufferTracker=t.RetryThrottler=void 0;let n=r(9572),i=r(6281),s=r(5792),a="retrying_call";class o{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}t.RetryThrottler=o;class l{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let n=null!==(r=this.allocatedPerCall.get(t))&&void 0!==r?r:0;return!(this.limitPerCall-n<e)&&!(this.totalLimit-this.totalAllocated<e)&&(this.allocatedPerCall.set(t,n+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let n=null!==(r=this.allocatedPerCall.get(t))&&void 0!==r?r:0;if(n<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${n}`);this.allocatedPerCall.set(t,n-e)}freeAll(e){var t;let r=null!==(t=this.allocatedPerCall.get(e))&&void 0!==t?t:0;if(this.totalAllocated<r)throw Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}}t.MessageBufferTracker=l;let u="grpc-previous-rpc-attempts";class c{constructor(e,t,r,n,i,s,a,o,l){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=n,this.credentials=i,this.deadline=s,this.callNumber=a,this.bufferTracker=o,this.retryThrottler=l,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let e=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(e.initialBackoff.substring(0,e.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){s.trace(n.LogVerbosity.DEBUG,a,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;null===(t=this.listener)||void 0===t||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){for(let{call:r}of(this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new i.Metadata}),this.underlyingCalls))r.cancelWithStatus(e,t)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return null!==(t=this.writeBuffer[e-this.writeBufferOffset])&&void 0!==t?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let e=this.getBufferEntry(t);e.allocated&&this.bufferTracker.free(e.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[e].state){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&"COMPLETED"!==this.underlyingCalls[t].state&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(n.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let e=-1,t=-1;for(let[r,n]of this.underlyingCalls.entries())"ACTIVE"===n.state&&n.nextMessageToSend>e&&(e=n.nextMessageToSend,t=r);-1===t?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(e=>e===t||e.toString().toLowerCase()===n.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=null===(e=this.callConfig)||void 0===e?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,n=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,n),r}maybeRetryCall(e,t){let r;if("RETRY"!==this.state){t(!1);return}let n=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(n.maxAttempts,5)){t(!1);return}if(null===e)r=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else r=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var e,r;if("RETRY"!==this.state){t(!1);return}(null===(r=null===(e=this.retryThrottler)||void 0===e?void 0:e.canRetryCall())||void 0===r||r)&&(t(!0),this.attempts+=1,this.startNewAttempt())},r)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)(null==t?void 0:t.state)==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var n,i,s;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList(null!==(n=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)&&void 0!==n?n:[],e.code)){let n;if(null===(i=this.retryThrottler)||void 0===i||i.addCallFailed(),null===r)n=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else n=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(t),this.reportStatus(e))},n)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?(null===(s=this.retryThrottler)||void 0===s||s.addCallFailed(),this.maybeRetryCall(r,r=>{r||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e))}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(0===t.length)return null;try{return parseInt(t[0])}catch(e){return -1}}handleChildStatus(e,t){var r;if("COMPLETED"===this.underlyingCalls[t].state)return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===n.Status.OK){null===(r=this.retryThrottler)||void 0===r||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if("COMMITTED"===this.state){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let n=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(n.maxAttempts,5))return;let i=null!==(e=n.hedgingDelay)&&void 0!==e?e:"0s",s=Number(i.substring(0,i.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*s),null===(r=(t=this.hedgingTimer).unref)||void 0===r||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,n=this.initialMetadata.clone();r>0&&n.set(u,`${r}`);let i=!1;e.start(n,{onReceiveMetadata:n=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),i=!0,r>0&&n.set(u,`${r}`),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMetadata(n)},onReceiveMessage:r=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMessage(r)},onReceiveStatus:n=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!i&&r>0&&n.metadata.set(u,`${r}`),this.handleChildStatus(n,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let n=this.underlyingCalls[e],i=n.nextMessageToSend;null===(r=(t=this.getBufferEntry(i)).callback)||void 0===r||r.call(t),this.clearSentMessages(),n.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if("COMPLETED"!==t.state&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:t=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose()}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let n={message:t,flags:e.flags},i=this.getNextBufferIndex(),s={entryType:"MESSAGE",message:n,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(s),s.allocated)for(let[n,s]of(null===(r=e.callback)||void 0===r||r.call(e),this.underlyingCalls.entries()))"ACTIVE"===s.state&&s.nextMessageToSend===i&&s.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(n)}},t);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;let r=this.underlyingCalls[this.committedCallIndex];s.callback=e.callback,"ACTIVE"===r.state&&r.nextMessageToSend===i&&r.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){for(let e of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==e?void 0:e.state)==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();for(let t of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==t?void 0:t.state)==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}}t.RetryingCall=c},2025:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Http2ServerCallStream=t.ServerDuplexStreamImpl=t.ServerWritableStreamImpl=t.ServerReadableStreamImpl=t.ServerUnaryCallImpl=void 0;let n=r(2361),i=r(5158),s=r(2781),a=r(9796),o=r(9572),l=r(6281),u=r(615),c=r(5792),d=r(6027),h="server_call";function p(e){c.trace(o.LogVerbosity.DEBUG,h,e)}let f="grpc-message",m="grpc-status",g="grpc-timeout",y=/(\d{1,8})\s*([HMSmun])/,v={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},b={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity"},_={[i.constants.HTTP2_HEADER_STATUS]:i.constants.HTTP_STATUS_OK,[i.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},T={waitForTrailers:!0};class S extends n.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}t.ServerUnaryCallImpl=S;class w extends s.Readable{constructor(e,t,r,n){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,n)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}t.ServerReadableStreamImpl=w;class E extends s.Writable{constructor(e,t,r,n){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=n,this.cancelled=!1,this.trailingMetadata=new l.Metadata,this.call.setupSurfaceCall(this),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let t=this.call.serializeMessage(e);if(!this.call.write(t)){this.call.once("drain",r);return}}catch(e){this.emit("error",{details:(0,d.getErrorMessage)(e),code:o.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:o.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}}t.ServerWritableStreamImpl=E;class C extends s.Duplex{constructor(e,t,r,n,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=n,this.cancelled=!1,this.trailingMetadata=new l.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}}t.ServerDuplexStreamImpl=C,C.prototype._read=w.prototype._read,C.prototype._write=E.prototype._write,C.prototype._final=E.prototype._final;class I extends n.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=o.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=o.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",e=>{}),this.stream.once("close",()=>{var e;p("Request to method "+(null===(e=this.handler)||void 0===e?void 0:e.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:o.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let r=e.subarray(5);if("identity"===t)return r;if("deflate"!==t&&"gzip"!==t)return Promise.reject({code:o.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`});{let e;return e="deflate"===t?a.createInflate():a.createGunzip(),new Promise((t,n)=>{let i=0,s=[];e.on("data",t=>{s.push(t),i+=t.byteLength,-1!==this.maxReceiveMessageSize&&i>this.maxReceiveMessageSize&&(e.destroy(),n({code:o.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),e.on("end",()=>{t(Buffer.concat(s))}),e.write(r),e.end()})}}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},_),b),t);this.stream.respond(r,T)}receiveMetadata(e){let t=l.Metadata.fromHttp2Headers(e);c.isTracerEnabled(h)&&p("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(g);if(r.length>0){let e=r[0].toString().match(y);if(null===e){let e=Error("Invalid deadline");return e.code=o.Status.OUT_OF_RANGE,this.sendError(e),t}let n=+e[1]*v[e[2]]|0,i=new Date;this.deadline=i.setMilliseconds(i.getMilliseconds()+n),this.deadlineTimer=setTimeout(x,n,this),t.remove(g)}return t.remove(i.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(i.constants.HTTP2_HEADER_TE),t.remove(i.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:n}=this,i=0,s=this,a=[],l=this.maxReceiveMessageSize;function u(e){if(i+=e.byteLength,-1!==l&&i>l){n.removeListener("data",u),n.removeListener("end",c),n.removeListener("error",c),r({code:o.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${i} vs. ${l})`});return}a.push(e)}function c(l){if(n.removeListener("data",u),n.removeListener("end",c),n.removeListener("error",c),void 0!==l){r({code:o.Status.INTERNAL,details:l.message});return}if(0===i){r({code:o.Status.INTERNAL,details:"received empty unary message"});return}s.emit("receiveMessage");let d=Buffer.concat(a,i),h=1===d.readUInt8(0)?e:"identity",p=s.getDecompressedMessage(d,h);if(Buffer.isBuffer(p)){t(s.deserializeMessageWithInternalError(p));return}p.then(e=>t(s.deserializeMessageWithInternalError(e)),t=>r(t.code?t:{code:o.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}this.stream.on("data",u),this.stream.on("end",c),this.stream.on("error",c)})}async deserializeMessageWithInternalError(e){try{return this.deserializeMessage(e)}catch(e){throw{details:(0,d.getErrorMessage)(e),code:o.Status.INTERNAL}}}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,n=Buffer.allocUnsafe(r+5);return n.writeUInt8(0,0),n.writeUInt32BE(r,1),t.copy(n,5),n}deserializeMessage(e){return this.handler.deserialize(e)}async sendUnaryMessage(e,t,r,n){if(!this.checkCancelled()){if(void 0===r&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let e=this.serializeMessage(t);this.write(e),this.sendStatus({code:o.Status.OK,details:"OK",metadata:r})}catch(e){this.sendError({details:(0,d.getErrorMessage)(e),code:o.Status.INTERNAL})}}}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===o.Status.OK),!this.checkCancelled()){if(p("Request to method "+(null===(t=this.handler)||void 0===t?void 0:t.path)+" ended with status code: "+o.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var t;let r=Object.assign({[m]:e.code,[f]:encodeURI(e.details)},null===(t=e.metadata)||void 0===t?void 0:t.toHttp2Headers());this.stream.sendTrailers(r),this.statusSent=!0}),this.stream.end());else{let t=Object.assign(Object.assign({[m]:e.code,[f]:encodeURI(e.details)},_),null===(r=e.metadata)||void 0===r?void 0:r.toHttp2Headers());this.stream.respond(t,{endStream:!0}),this.statusSent=!0}}}sendError(e){let t={code:o.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&void 0!==e.metadata?e.metadata:null};"code"in e&&"number"==typeof e.code&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&"string"==typeof e.details&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(-1!==this.maxSendMessageSize&&e.length>this.maxSendMessageSize){this.sendError({code:o.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new u.StreamDecoder(this.maxReceiveMessageSize),n=!1,i=!1,s=!1,a=async()=>{s||!n||i||(s=!0,await this.pushOrBufferMessage(e,null))};this.stream.on("data",async n=>{let s;try{s=r.write(n)}catch(e){this.sendError({code:o.Status.RESOURCE_EXHAUSTED,details:e.message});return}for(let r of(i=!0,this.stream.pause(),s)){let n;this.emit("receiveMessage");let i=1===r.readUInt8(0)?t:"identity";try{n=await this.getDecompressedMessage(r,i)}catch(e){this.sendError(e);return}if(!n)return;await this.pushOrBufferMessage(e,n)}i=!1,this.stream.resume(),await a()}),this.stream.once("end",async()=>{n=!0,await a()})}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(null===t||!1===r){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(e,t){this.isPushPending?this.bufferedMessages.push(t):await this.pushMessage(e,t)}async pushMessage(e,t){if(null===t){p("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}p("Received message of length "+t.length),this.isPushPending=!0;try{let r=await this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let t=(0,d.getErrorCode)(r);(null===t||t<o.Status.OK||t>o.Status.UNAUTHENTICATED)&&(t=o.Status.INTERNAL),e.emit("error",{details:(0,d.getErrorMessage)(r),code:t})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(e,this.bufferedMessages.shift())}getPeer(){var e;let t=null===(e=this.stream.session)||void 0===e?void 0:e.socket;return null!=t&&t.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function x(e){let t=Error("Deadline exceeded");t.code=o.Status.DEADLINE_EXCEEDED,e.sendError(t),e.cancelled=!0,e.emit("cancelled","deadline")}t.Http2ServerCallStream=I},3783:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerCredentials=void 0;let n=r(606);class i{static createInsecure(){return new s}static createSsl(e,t,r=!1){if(null!==e&&!Buffer.isBuffer(e))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof r)throw TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let e=0;e<t.length;e++){let r=t[e];if(null===r||"object"!=typeof r)throw TypeError(`keyCertPair[${e}] must be an object`);if(!Buffer.isBuffer(r.private_key))throw TypeError(`keyCertPair[${e}].private_key must be a Buffer`);if(!Buffer.isBuffer(r.cert_chain))throw TypeError(`keyCertPair[${e}].cert_chain must be a Buffer`);i.push(r.cert_chain),s.push(r.private_key)}return new a({ca:e||(0,n.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:n.CIPHER_SUITES})}}t.ServerCredentials=i;class s extends i{_isSecure(){return!1}_getSettings(){return null}}class a extends i{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}},6418:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Server=void 0;let n=r(5158),i=r(9572),s=r(2025),a=r(3783),o=r(4063),l=r(5792),u=r(4955),c=r(5773),d=r(5962),h=2147483647,p=2147483647,f=2e4,{HTTP2_HEADER_PATH:m}=n.constants,g="server";function y(){}function v(e){return{code:i.Status.UNIMPLEMENTED,details:`The server does not implement the method ${e}`}}function b(e,t){let r=v(t);switch(e){case"unary":return(e,t)=>{t(r,null)};case"clientStream":return(e,t)=>{t(r,null)};case"serverStream":return e=>{e.emit("error",r)};case"bidi":return e=>{e.emit("error",r)};default:throw Error(`Invalid handlerType ${e}`)}}class _{constructor(e){var t,r,n,i;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new d.ChannelzTrace,this.callTracker=new d.ChannelzCallTracker,this.listenerChildrenTracker=new d.ChannelzChildrenTracker,this.sessionChildrenTracker=new d.ChannelzChildrenTracker,this.options=null!=e?e:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,d.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!==(t=this.options["grpc.max_connection_age_ms"])&&void 0!==t?t:h,this.maxConnectionAgeGraceMs=null!==(r=this.options["grpc.max_connection_age_grace_ms"])&&void 0!==r?r:h,this.keepaliveTimeMs=null!==(n=this.options["grpc.keepalive_time_ms"])&&void 0!==n?n:p,this.keepaliveTimeoutMs=null!==(i=this.options["grpc.keepalive_timeout_ms"])&&void 0!==i?i:f,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,n;let i;let s=this.sessions.get(e),a=e.socket,o=a.remoteAddress?(0,u.stringToSubchannelAddress)(a.remoteAddress,a.remotePort):null,l=a.localAddress?(0,u.stringToSubchannelAddress)(a.localAddress,a.localPort):null;if(e.encrypted){let e=a,r=e.getCipher(),n=e.getCertificate(),s=e.getPeerCertificate();i={cipherSuiteStandardName:null!==(t=r.standardName)&&void 0!==t?t:null,cipherSuiteOtherName:r.standardName?null:r.name,localCertificate:n&&"raw"in n?n.raw:null,remoteCertificate:s&&"raw"in s?s.raw:null}}else i=null;return{remoteAddress:o,localAddress:l,security:i,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:null!==(r=e.state.localWindowSize)&&void 0!==r?r:null,remoteFlowControlWindow:null!==(n=e.state.remoteWindowSize)&&void 0!==n?n:null}}}trace(e){l.trace(i.LogVerbosity.DEBUG,g,"("+this.channelzRef.id+") "+e)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(e,t){if(null===e||"object"!=typeof e||null===t||"object"!=typeof t)throw Error("addService() requires two objects as arguments");let r=Object.keys(e);if(0===r.length)throw Error("Cannot add an empty service to a server");r.forEach(r=>{let n,i;let s=e[r];n=s.requestStream?s.responseStream?"bidi":"clientStream":s.responseStream?"serverStream":"unary";let a=t[r];if(void 0===a&&"string"==typeof s.originalName&&(a=t[s.originalName]),i=void 0!==a?a.bind(t):b(n,r),!1===this.register(s.path,i,s.responseSerialize,s.requestDeserialize,n))throw Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(null===e||"object"!=typeof e)throw Error("removeService() requires object as argument");Object.keys(e).forEach(t=>{let r=e[t];this.unregister(r.path)})}bind(e,t){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof e)throw TypeError("port must be a string");if(null===t||!(t instanceof a.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof r)throw TypeError("callback must be a function");let s=(0,c.parseUri)(e);if(null===s)throw Error(`Could not parse port "${e}"`);let h=(0,o.mapUriDefaultScheme)(s);if(null===h)throw Error(`Could not get a default scheme for port "${e}"`);let p={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?p.maxSessionMemory=this.options["grpc-node.max_session_memory"]:p.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(p.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let f=(e,t)=>{process.nextTick(()=>r(e,t))},m=()=>{let e;if(t._isSecure()){let r=Object.assign(p,t._getSettings());r.enableTrace=1===this.options["grpc-node.tls_enable_trace"],(e=n.createSecureServer(r)).on("secureConnection",e=>{e.on("error",e=>{this.trace("An incoming TLS connection closed with error: "+e.message)})})}else e=n.createServer(p);return e.setTimeout(0,y),this._setupHandlers(e),e},g=(e,t,r)=>0===e.length?Promise.resolve({port:t,count:r}):Promise.all(e.map(e=>{let r;this.trace("Attempting to bind "+(0,u.subchannelAddressToString)(e)),r=(0,u.isTcpSubchannelAddress)(e)?{host:e.host,port:t}:e;let n=m();return new Promise((i,s)=>{let a=t=>{this.trace("Failed to bind "+(0,u.subchannelAddressToString)(e)+" with error "+t.message),i(t)};n.once("error",a),n.listen(r,()=>{let e;if(this.shutdown){n.close(),i(Error("bindAsync failed because server is shutdown"));return}let r=n.address();e="string"==typeof r?{path:r}:{host:r.address,port:r.port};let s=(0,d.registerChannelzSocket)((0,u.subchannelAddressToString)(e),()=>({localAddress:e,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(s),this.http2ServerList.push({server:n,channelzRef:s}),this.trace("Successfully bound "+(0,u.subchannelAddressToString)(e)),i("port"in e?e.port:t),n.removeListener("error",a)})})})).then(e=>{let n=0;for(let r of e)if("number"==typeof r&&(n+=1,r!==t))throw Error("Invalid state: multiple port numbers added from single address");return{port:t,count:n+r}}),v=e=>{if(0===e.length)return Promise.resolve({port:0,count:0});let t=e[0],r=m();return new Promise((n,i)=>{let s=r=>{this.trace("Failed to bind "+(0,u.subchannelAddressToString)(t)+" with error "+r.message),n(v(e.slice(1)))};r.once("error",s),r.listen(t,()=>{if(this.shutdown){r.close(),n({port:0,count:0});return}let t=r.address(),i={host:t.address,port:t.port},a=(0,d.registerChannelzSocket)((0,u.subchannelAddressToString)(i),()=>({localAddress:i,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(a),this.http2ServerList.push({server:r,channelzRef:a}),this.trace("Successfully bound "+(0,u.subchannelAddressToString)(i)),n(g(e.slice(1),t.port,1)),r.removeListener("error",s)})})},b={onSuccessfulResolution:(t,r,n)=>{let s;if(b.onSuccessfulResolution=()=>{},this.shutdown&&f(Error("bindAsync failed because server is shutdown"),0),0===t.length){f(Error(`No addresses resolved for port ${e}`),0);return}(s=(0,u.isTcpSubchannelAddress)(t[0])?0===t[0].port?v(t):g(t,t[0].port,0):g(t,1,0)).then(e=>{if(0===e.count){let e=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,e),f(Error(e),0)}else e.count<t.length&&l.log(i.LogVerbosity.INFO,`WARNING Only ${e.count} addresses added out of total ${t.length} resolved`),f(null,e.port)},e=>{let r=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,r),f(Error(r),0)})},onError:e=>{f(Error(e.details),0)}};(0,o.createResolver)(h,b,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,d.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(n.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,d.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,n,i){return!this.handlers.has(e)&&(this.handlers.set(e,{func:t,serialize:r,deserialize:n,type:i,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:e})=>!0!==e.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=t=>{this.channelzEnabled&&(0,d.unregisterChannelzRef)(this.channelzRef),e(t)},r=0;function n(){0==--r&&t()}for(let{server:e,channelzRef:t}of(this.started=!1,this.shutdown=!0,this.http2ServerList))e.listening&&(r++,e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,d.unregisterChannelzRef)(t)),n()}));this.sessions.forEach((e,t)=>{t.closed||(r+=1,t.close(n))}),0===r&&t()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[n.constants.HTTP2_HEADER_CONTENT_TYPE];return!!("string"==typeof r&&r.startsWith("application/grpc"))||(e.respond({[n.constants.HTTP2_HEADER_STATUS]:n.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return void 0===t?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let n=new s.Http2ServerCallStream(t,null,this.options);void 0===e.code&&(e.code=i.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed()),n.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),null==r||r.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed();return}let n=t[m],a=this._retrieveHandler(n);if(!a){this._respondWithError(v(n),e,r);return}let o=new s.Http2ServerCallStream(e,a,this.options);o.once("callEnd",e=>{e===i.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",e=>{e?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,a,t)||(this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed(),o.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${a.type}`}))}_streamHandler(e,t){if(!0!==this._verifyContentType(e,t))return;let r=t[m],n=this._retrieveHandler(r);if(!n){this._respondWithError(v(r),e,null);return}let a=new s.Http2ServerCallStream(e,n,this.options);this._runHandlerForCall(a,n,t)||a.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${n.type}`})}_runHandlerForCall(e,t,r){var n;let i=e.receiveMetadata(r),s=null!==(n=i.get("grpc-encoding")[0])&&void 0!==n?n:"identity";i.remove("grpc-encoding");let{type:a}=t;if("unary"===a)T(e,t,i,s);else if("clientStream"===a)S(e,t,i,s);else if("serverStream"===a)w(e,t,i,s);else{if("bidi"!==a)return!1;E(e,t,i,s)}return!0}_setupHandlers(e){if(null===e)return;let t=e.address(),r="null";t&&(r="string"==typeof t?t:t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",e=>{var t,r,i,s,a;if(!this.started){e.destroy();return}let o=(0,d.registerChannelzSocket)(null!==(t=e.socket.remoteAddress)&&void 0!==t?t:"unknown",this.getChannelzSessionInfoGetter(e),this.channelzEnabled),l={ref:o,streamTracker:new d.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(e,l);let u=e.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+u),this.sessionChildrenTracker.refChild(o));let c=null,p=null,f=!1;if(this.maxConnectionAgeMs!==h){let t=this.maxConnectionAgeMs/10,s=Math.random()*t*2-t;c=null===(i=(r=setTimeout(()=>{var t,r;f=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+u);try{e.goaway(n.constants.NGHTTP2_NO_ERROR,2147483647,Buffer.from("max_age"))}catch(t){e.destroy();return}e.close(),this.maxConnectionAgeGraceMs!==h&&(p=null===(r=(t=setTimeout(()=>{e.destroy()},this.maxConnectionAgeGraceMs)).unref)||void 0===r?void 0:r.call(t))},this.maxConnectionAgeMs+s)).unref)||void 0===i?void 0:i.call(r)}let m=null===(a=(s=setInterval(()=>{var t,r;let n=null===(r=(t=setTimeout(()=>{f=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+u),e.close()},this.keepaliveTimeoutMs)).unref)||void 0===r?void 0:r.call(t);try{e.ping((e,t,r)=>{clearTimeout(n)})}catch(t){e.destroy()}},this.keepaliveTimeMs)).unref)||void 0===a?void 0:a.call(s);e.on("close",()=>{this.channelzEnabled&&(f||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+u),this.sessionChildrenTracker.unrefChild(o),(0,d.unregisterChannelzRef)(o)),c&&clearTimeout(c),p&&clearTimeout(p),m&&clearTimeout(m),this.sessions.delete(e)})})}}async function T(e,t,r,n){try{let i=await e.receiveUnaryMessage(n);if(void 0===i||e.cancelled)return;let a=new s.ServerUnaryCallImpl(e,r,i);t.func(a,(t,r,n,i)=>{e.sendUnaryMessage(t,r,n,i)})}catch(t){e.sendError(t)}}function S(e,t,r,n){let i=new s.ServerReadableStreamImpl(e,r,t.deserialize,n);function a(t,r,n,s){i.destroy(),e.sendUnaryMessage(t,r,n,s)}e.cancelled||(i.on("error",a),t.func(i,a))}async function w(e,t,r,n){try{let i=await e.receiveUnaryMessage(n);if(void 0===i||e.cancelled)return;let a=new s.ServerWritableStreamImpl(e,r,t.serialize,i);t.func(a)}catch(t){e.sendError(t)}}function E(e,t,r,n){let i=new s.ServerDuplexStreamImpl(e,r,t.serialize,t.deserialize,n);e.cancelled||t.func(i)}t.Server=_},4298:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractAndSelectServiceConfig=t.validateServiceConfig=t.validateRetryThrottling=void 0;let n=r(2037),i=r(9572),s=r(9884),a=/^\d+(\.\d{1,9})?s$/,o="node";function l(e){if("service"in e&&""!==e.service){if("string"!=typeof e.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof e.service}`);if(!("method"in e)||""===e.method)return{service:e.service};if("string"!=typeof e.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof e.service}`);return{service:e.service,method:e.method}}if("method"in e&&void 0!==e.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}function u(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in e)||"string"!=typeof e.initialBackoff||!a.test(e.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in e)||"string"!=typeof e.maxBackoff||!a.test(e.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in e)||"number"!=typeof e.backoffMultiplier||e.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in e&&Array.isArray(e.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===e.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let t of e.retryableStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:e.maxAttempts,initialBackoff:e.initialBackoff,maxBackoff:e.maxBackoff,backoffMultiplier:e.backoffMultiplier,retryableStatusCodes:e.retryableStatusCodes}}function c(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in e&&("string"!=typeof e.hedgingDelay||!a.test(e.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in e&&Array.isArray(e.nonFatalStatusCodes))for(let t of e.nonFatalStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let t={maxAttempts:e.maxAttempts};return e.hedgingDelay&&(t.hedgingDelay=e.hedgingDelay),e.nonFatalStatusCodes&&(t.nonFatalStatusCodes=e.nonFatalStatusCodes),t}function d(e){var t;let r={name:[]};if(!("name"in e)||!Array.isArray(e.name))throw Error("Invalid method config: invalid name array");for(let t of e.name)r.name.push(l(t));if("waitForReady"in e){if("boolean"!=typeof e.waitForReady)throw Error("Invalid method config: invalid waitForReady");r.waitForReady=e.waitForReady}if("timeout"in e){if("object"==typeof e.timeout){if(!("seconds"in e.timeout)||"number"!=typeof e.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in e.timeout)||"number"!=typeof e.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");r.timeout=e.timeout}else if("string"==typeof e.timeout&&a.test(e.timeout)){let n=e.timeout.substring(0,e.timeout.length-1).split(".");r.timeout={seconds:0|n[0],nanos:(null!==(t=n[1])&&void 0!==t?t:0)|0}}else throw Error("Invalid method config: invalid timeout")}if("maxRequestBytes"in e){if("number"!=typeof e.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");r.maxRequestBytes=e.maxRequestBytes}if("maxResponseBytes"in e){if("number"!=typeof e.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");r.maxResponseBytes=e.maxResponseBytes}if("retryPolicy"in e){if("hedgingPolicy"in e)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");r.retryPolicy=u(e.retryPolicy)}else"hedgingPolicy"in e&&(r.hedgingPolicy=c(e.hedgingPolicy));return r}function h(e){if(!("maxTokens"in e)||"number"!=typeof e.maxTokens||e.maxTokens<=0||e.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in e)||"number"!=typeof e.tokenRatio||e.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+e.maxTokens.toFixed(3),tokenRatio:+e.tokenRatio.toFixed(3)}}function p(e){let t={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in e){if("string"==typeof e.loadBalancingPolicy)t.loadBalancingPolicy=e.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy")}if("loadBalancingConfig"in e){if(Array.isArray(e.loadBalancingConfig))for(let r of e.loadBalancingConfig)t.loadBalancingConfig.push((0,s.validateLoadBalancingConfig)(r));else throw Error("Invalid service config: invalid loadBalancingConfig")}if("methodConfig"in e&&Array.isArray(e.methodConfig))for(let r of e.methodConfig)t.methodConfig.push(d(r));"retryThrottling"in e&&(t.retryThrottling=h(e.retryThrottling));let r=[];for(let e of t.methodConfig)for(let t of e.name){for(let e of r)if(t.service===e.service&&t.method===e.method)throw Error(`Invalid service config: duplicate name ${t.service}/${t.method}`);r.push(t)}return t}function f(e){if(!("serviceConfig"in e))throw Error("Invalid service config choice: missing service config");let t={serviceConfig:p(e.serviceConfig)};if("clientLanguage"in e){if(Array.isArray(e.clientLanguage))for(let r of(t.clientLanguage=[],e.clientLanguage))if("string"==typeof r)t.clientLanguage.push(r);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage")}if("clientHostname"in e){if(Array.isArray(e.clientHostname))for(let r of(t.clientHostname=[],e.clientHostname))if("string"==typeof r)t.clientHostname.push(r);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname")}if("percentage"in e){if("number"==typeof e.percentage&&0<=e.percentage&&e.percentage<=100)t.percentage=e.percentage;else throw Error("Invalid service config choice: invalid percentage")}let r=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let t in e)if(!r.includes(t))throw Error(`Invalid service config choice: unexpected field ${t}`);return t}function m(e,t){if(!Array.isArray(e))throw Error("Invalid service config list");for(let r of e){let e=f(r);if("number"!=typeof e.percentage||!(t>e.percentage)){if(Array.isArray(e.clientHostname)){let t=!1;for(let r of e.clientHostname)r===n.hostname()&&(t=!0);if(!t)continue}if(Array.isArray(e.clientLanguage)){let t=!1;for(let r of e.clientLanguage)r===o&&(t=!0);if(!t)continue}return e.serviceConfig}}throw Error("No matching service config found")}function g(e,t){for(let r of e)if(r.length>0&&r[0].startsWith("grpc_config="))return m(JSON.parse(r.join("").substring(12)),t);return null}t.validateRetryThrottling=h,t.validateServiceConfig=p,t.extractAndSelectServiceConfig=g},4339:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusBuilder=void 0;class r{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return null!==this.code&&(e.code=this.code),null!==this.details&&(e.details=this.details),null!==this.metadata&&(e.metadata=this.metadata),e}}t.StatusBuilder=r},615:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.StreamDecoder=void 0,function(e){e[e.NO_DATA=0]="NO_DATA",e[e.READING_SIZE=1]="READING_SIZE",e[e.READING_MESSAGE=2]="READING_MESSAGE"}(r||(r={}));class n{constructor(e){this.maxReadMessageLength=e,this.readState=r.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t,n=0,i=[];for(;n<e.length;)switch(this.readState){case r.NO_DATA:this.readCompressFlag=e.slice(n,n+1),n+=1,this.readState=r.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case r.READING_SIZE:if(t=Math.min(e.length-n,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,n,n+t),this.readSizeRemaining-=t,n+=t,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),-1!==this.maxReadMessageLength&&this.readMessageSize>this.maxReadMessageLength)throw Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=r.READING_MESSAGE;else{let e=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=r.NO_DATA,i.push(e)}}break;case r.READING_MESSAGE:if(t=Math.min(e.length-n,this.readMessageRemaining),this.readPartialMessage.push(e.slice(n,n+t)),this.readMessageRemaining-=t,n+=t,0===this.readMessageRemaining){let e=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),t=Buffer.concat(e,this.readMessageSize+5);this.readState=r.NO_DATA,i.push(t)}break;default:throw Error("Unexpected read state")}return i}}t.StreamDecoder=n},4955:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stringToSubchannelAddress=t.subchannelAddressToString=t.subchannelAddressEqual=t.isTcpSubchannelAddress=void 0;let n=r(1808);function i(e){return"port"in e}function s(e,t){return!e&&!t||!!e&&!!t&&(i(e)?i(t)&&e.host===t.host&&e.port===t.port:!i(t)&&e.path===t.path)}function a(e){return i(e)?e.host+":"+e.port:e.path}t.isTcpSubchannelAddress=i,t.subchannelAddressEqual=s,t.subchannelAddressToString=a;let o=443;function l(e,t){return(0,n.isIP)(e)?{host:e,port:null!=t?t:o}:{path:e}}t.stringToSubchannelAddress=l},4354:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Http2SubchannelCall=void 0;let n=r(5158),i=r(2037),s=r(9572),a=r(6281),o=r(615),l=r(5792),u=r(9572),c="subchannel_call";function d(e){for(let[t,r]of Object.entries(i.constants.errno))if(r===e)return t;return"Unknown system error "+e}class h{constructor(e,t,r,i,l){var u;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=l,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=s.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let c=null!==(u=i.getOptions()["grpc.max_receive_message_length"])&&void 0!==u?u:s.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new o.StreamDecoder(c),e.on("response",(e,t)=>{let r="";for(let t of Object.keys(e))r+="		"+t+": "+e[t]+"\n";switch(this.trace("Received server headers:\n"+r),e[":status"]){case 400:this.mappedStatusCode=s.Status.INTERNAL;break;case 401:this.mappedStatusCode=s.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=s.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=s.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=s.Status.UNAVAILABLE;break;default:this.mappedStatusCode=s.Status.UNKNOWN}if(t&n.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(e);else{let t;try{t=a.Metadata.fromHttp2Headers(e)}catch(e){this.endCall({code:s.Status.UNKNOWN,details:e.message,metadata:new a.Metadata});return}this.listener.onReceiveMetadata(t)}}),e.on("trailers",e=>{this.handleTrailers(e)}),e.on("data",e=>{let t;if(!this.statusOutput){this.trace("receive HTTP/2 data frame of length "+e.length);try{t=this.decoder.write(e)}catch(e){this.cancelWithStatus(s.Status.RESOURCE_EXHAUSTED,e.message);return}for(let e of t)this.trace("parsed message of length "+e.length),this.callEventTracker.addMessageReceived(),this.tryPush(e)}}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var t;let r;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),(null===(t=this.finalStatus)||void 0===t?void 0:t.code)===s.Status.OK)return;let i="";switch(e.rstCode){case n.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;r=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`;break;case n.constants.NGHTTP2_REFUSED_STREAM:r=s.Status.UNAVAILABLE,i="Stream refused by server";break;case n.constants.NGHTTP2_CANCEL:r=s.Status.CANCELLED,i="Call cancelled";break;case n.constants.NGHTTP2_ENHANCE_YOUR_CALM:r=s.Status.RESOURCE_EXHAUSTED,i="Bandwidth exhausted or memory limit exceeded";break;case n.constants.NGHTTP2_INADEQUATE_SECURITY:r=s.Status.PERMISSION_DENIED,i="Protocol not secure enough";break;case n.constants.NGHTTP2_INTERNAL_ERROR:r=s.Status.INTERNAL,null===this.internalError?i=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(r=s.Status.UNAVAILABLE,i=this.internalError.message):i=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:r=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:r,details:i,metadata:new a.Metadata,rstCode:e.rstCode})})}),e.on("error",e=>{"ERR_HTTP2_STREAM_ERROR"!==e.code&&(this.trace("Node error event: message="+e.message+" code="+e.code+" errno="+d(e.errno)+" syscall="+e.syscall),this.internalError=e),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:s.Status.UNAVAILABLE,details:"Connection dropped",metadata:new a.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){l.trace(u.LogVerbosity.DEBUG,c,"["+this.callId+"] "+e)}endCall(e){(null===this.finalStatus||this.finalStatus.code===s.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===s.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){let t;this.callEventTracker.onStreamEnd(!0);let r="";for(let t of Object.keys(e))r+="		"+t+": "+e[t]+"\n";this.trace("Received server trailers:\n"+r);try{t=a.Metadata.fromHttp2Headers(e)}catch(e){t=new a.Metadata}let n=t.getMap(),i=this.mappedStatusCode;if(i===s.Status.UNKNOWN&&"string"==typeof n["grpc-status"]){let e=Number(n["grpc-status"]);e in s.Status&&(i=e,this.trace("received status code "+e+" from server")),t.remove("grpc-status")}let o="";if("string"==typeof n["grpc-message"]){try{o=decodeURI(n["grpc-message"])}catch(e){o=n["grpc-message"]}t.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let l={code:i,details:o,metadata:t};this.endCall(l)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;t=(null===(e=this.finalStatus)||void 0===e?void 0:e.code)===s.Status.OK?n.constants.NGHTTP2_NO_ERROR:n.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new a.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==s.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=t=>{process.nextTick(()=>{var r;let n=s.Status.UNAVAILABLE;(null==t?void 0:t.code)==="ERR_STREAM_WRITE_AFTER_END"&&(n=s.Status.INTERNAL),t&&this.cancelWithStatus(n,`Write error: ${t.message}`),null===(r=e.callback)||void 0===r||r.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(e){this.endCall({code:s.Status.UNAVAILABLE,details:`Write failed with error ${e.message}`,metadata:new a.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}t.Http2SubchannelCall=h},487:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseSubchannelWrapper=void 0;class r{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}}t.BaseSubchannelWrapper=r},7328:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSubchannelPool=t.SubchannelPool=void 0;let n=r(9455),i=r(389),s=r(4955),a=r(5773),o=r(6983),l=1e4;class u{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let r=this.pool[t].filter(e=>!e.subchannel.unrefIfOneRef());r.length>0&&(e=!1),this.pool[t]=r}e&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},l),null===(t=(e=this.cleanupTimer).unref)||void 0===t||t.call(e))}getOrCreateSubchannel(e,t,r,l){this.ensureCleanupTask();let u=(0,a.uriToString)(e);if(u in this.pool){for(let e of this.pool[u])if((0,s.subchannelAddressEqual)(t,e.subchannelAddress)&&(0,n.channelOptionsEqual)(r,e.channelArguments)&&l._equals(e.channelCredentials))return e.subchannel}let c=new i.Subchannel(e,t,r,l,new o.Http2SubchannelConnector(e));return u in this.pool||(this.pool[u]=[]),this.pool[u].push({subchannelAddress:t,channelArguments:r,channelCredentials:l,subchannel:c}),c.ref(),c}}t.SubchannelPool=u;let c=new u;function d(e){return e?c:new u}t.getSubchannelPool=d},389:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Subchannel=void 0;let n=r(2409),i=r(1742),s=r(5792),a=r(9572),o=r(5773),l=r(4955),u=r(5962),c="subchannel",d=2147483647;class h{constructor(e,t,r,s,a){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=s,this.connector=a,this.connectivityState=n.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new u.ChannelzCallTracker,this.childrenTracker=new u.ChannelzChildrenTracker,this.streamTracker=new u.ChannelzCallTracker;let c={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new i.BackoffTimeout(()=>{this.handleBackoffTimer()},c),this.backoffTimeout.unref(),this.subchannelAddressString=(0,l.subchannelAddressToString)(t),this.keepaliveTime=null!==(o=r["grpc.keepalive_time_ms"])&&void 0!==o?o:-1,0===r["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new u.ChannelzTrace,this.channelzRef=(0,u.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){s.trace(a.LogVerbosity.DEBUG,c,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){s.trace(a.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.CONNECTING):this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,d);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(e=>{this.transitionToState([n.ConnectivityState.CONNECTING],n.ConnectivityState.READY)?(this.transport=e,this.channelzEnabled&&this.childrenTracker.refChild(e.getChannelzRef()),e.addDisconnectListener(e=>{this.transitionToState([n.ConnectivityState.READY],n.ConnectivityState.IDLE),e&&this.keepaliveTime>0&&(this.keepaliveTime*=2,s.log(a.LogVerbosity.ERROR,`Connection to ${(0,o.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):e.shutdown()},e=>{this.transitionToState([n.ConnectivityState.CONNECTING],n.ConnectivityState.TRANSIENT_FAILURE,`${e}`)})}transitionToState(e,t,r){var i,s;if(-1===e.indexOf(this.connectivityState))return!1;this.trace(n.ConnectivityState[this.connectivityState]+" -> "+n.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+n.ConnectivityState[t]);let a=this.connectivityState;switch(this.connectivityState=t,t){case n.ConnectivityState.READY:this.stopBackoff();break;case n.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case n.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null===(i=this.transport)||void 0===i||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case n.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null===(s=this.transport)||void 0===s||s.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let e of this.stateListeners)e(this,a,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,u.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([n.ConnectivityState.CONNECTING,n.ConnectivityState.READY],n.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall(e,t,r,n){let i;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),i={onCallEnd:e=>{e.code===a.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):i={},this.transport.createCall(e,t,r,n,i)}startConnecting(){process.nextTick(()=>{this.transitionToState([n.ConnectivityState.IDLE],n.ConnectivityState.CONNECTING)||this.connectivityState!==n.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}}t.Subchannel=h},606:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultRootsData=t.CIPHER_SUITES=void 0;let n=r(7147);t.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let i=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,s=null;function a(){return i?(null===s&&(s=n.readFileSync(i)),s):null}t.getDefaultRootsData=a},6983:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Http2SubchannelConnector=void 0;let n=r(5158),i=r(4404),s=r(5962),a=r(9572),o=r(5242),l=r(5792),u=r(4063),c=r(4955),d=r(5773),h=r(1808),p=r(4354),f=r(1801),m="transport",g="transport_flowctrl",y=r(1513).i8,{HTTP2_HEADER_AUTHORITY:v,HTTP2_HEADER_CONTENT_TYPE:b,HTTP2_HEADER_METHOD:_,HTTP2_HEADER_PATH:T,HTTP2_HEADER_TE:S,HTTP2_HEADER_USER_AGENT:w}=n.constants,E=2e4,C=Buffer.from("too_many_pings","ascii");class I{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=E,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new s.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,c.subchannelAddressToString)(t),0===r["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,s.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${y}`,r["grpc.secondary_user_agent"]].filter(e=>e).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=1===r["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(e,t,r)=>{let i=!1;e===n.constants.NGHTTP2_ENHANCE_YOUR_CALM&&r&&r.equals(C)&&(i=!0),this.trace("connection closed by GOAWAY with code "+e+" and data "+(null==r?void 0:r.toString())),this.reportDisconnectToOwner(i)}),e.once("error",e=>{this.trace("connection closed with error "+e.message)}),l.isTracerEnabled(m)&&(e.on("remoteSettings",t=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))}),e.on("localSettings",t=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let n;let i=this.session.socket,s=i.remoteAddress?(0,c.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,a=i.localAddress?(0,c.stringToSubchannelAddress)(i.localAddress,i.localPort):null;if(this.session.encrypted){let t=i,r=t.getCipher(),s=t.getCertificate(),a=t.getPeerCertificate();n={cipherSuiteStandardName:null!==(e=r.standardName)&&void 0!==e?e:null,cipherSuiteOtherName:r.standardName?null:r.name,localCertificate:s&&"raw"in s?s.raw:null,remoteCertificate:a&&"raw"in a?a.raw:null}}else n=null;return{remoteAddress:s,localAddress:a,security:n,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!==(t=this.session.state.localWindowSize)&&void 0!==t?t:null,remoteFlowControlWindow:null!==(r=this.session.state.remoteWindowSize)&&void 0!==r?r:null}}trace(e){l.trace(a.LogVerbosity.DEBUG,m,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){l.trace(a.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){l.trace(a.LogVerbosity.DEBUG,g,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){l.trace(a.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null===(t=(e=this.keepaliveTimeoutId).unref)||void 0===t||t.call(e));try{this.session.ping((e,t,r)=>{e&&(this.keepaliveTrace("Ping failed with error "+e.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch(e){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null===(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)||void 0===t?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),0===this.activeCalls.size&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),1!==this.activeCalls.size||(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,n,i){let s,a,o;let l=e.toHttp2Headers();l[v]=t,l[w]=this.userAgent,l[b]="application/grpc",l[_]="POST",l[T]=r,l[S]="trailers";try{s=this.session.request(l)}catch(e){throw this.handleDisconnect(),e}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),a={addMessageSent:()=>{var e;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null===(e=i.addMessageSent)||void 0===e||e.call(i)},addMessageReceived:()=>{var e;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null===(e=i.addMessageReceived)||void 0===e||e.call(i)},onCallEnd:e=>{var t;null===(t=i.onCallEnd)||void 0===t||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;e?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null===(t=i.onStreamEnd)||void 0===t||t.call(i,e)}}):a={addMessageSent:()=>{var e;null===(e=i.addMessageSent)||void 0===e||e.call(i)},addMessageReceived:()=>{var e;null===(e=i.addMessageReceived)||void 0===e||e.call(i)},onCallEnd:e=>{var t;null===(t=i.onCallEnd)||void 0===t||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;null===(t=i.onStreamEnd)||void 0===t||t.call(i,e)}},o=new p.Http2SubchannelCall(s,a,n,this,(0,f.getNextCallNumber)()),this.addActiveCall(o),o}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,s.unregisterChannelzRef)(this.channelzRef)}}class x{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){l.trace(a.LogVerbosity.DEBUG,m,(0,d.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,s){return this.isShutdown?Promise.reject():new Promise((a,o)=>{var l,p,f;let m;s.realTarget?(m=(0,d.uriToString)(s.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,d.uriToString)(s.realTarget))):(m=null,this.trace("creating HTTP/2 session to "+(0,c.subchannelAddressToString)(e)));let g=(0,u.getDefaultAuthority)(null!==(l=s.realTarget)&&void 0!==l?l:this.channelTarget),y=t._getConnectionOptions()||{};y.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?y.maxSessionMemory=r["grpc-node.max_session_memory"]:y.maxSessionMemory=Number.MAX_SAFE_INTEGER;let v="http://";if("secureContext"in y){if(v="https://",r["grpc.ssl_target_name_override"]){let e=r["grpc.ssl_target_name_override"];y.checkServerIdentity=(t,r)=>(0,i.checkServerIdentity)(e,r),y.servername=e}else{let e=null!==(f=null===(p=(0,d.splitHostPort)(g))||void 0===p?void 0:p.host)&&void 0!==f?f:"localhost";y.servername=e}s.socket&&(y.createConnection=(e,t)=>s.socket)}else y.createConnection=(t,r)=>s.socket?s.socket:h.connect(e);y=Object.assign(Object.assign(Object.assign({},y),e),{enableTrace:1===r["grpc-node.tls_enable_trace"]});let b=n.connect(v+g,y);this.session=b;let _="Failed to connect";b.unref(),b.once("connect",()=>{b.removeAllListeners(),a(new I(b,e,r,m)),this.session=null}),b.once("close",()=>{this.session=null,setImmediate(()=>{o(`${_} (${new Date().toISOString()})`)})}),b.once("error",e=>{_=e.message,this.trace("connection failed with error "+_)})})}connect(e,t,r){var n,s;if(this.isShutdown)return Promise.reject();let a=t._getConnectionOptions()||{};if("secureContext"in a){if(a.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let e=r["grpc.ssl_target_name_override"];a.checkServerIdentity=(t,r)=>(0,i.checkServerIdentity)(e,r),a.servername=e}else if("grpc.http_connect_target"in r){let e=(0,u.getDefaultAuthority)(null!==(n=(0,d.parseUri)(r["grpc.http_connect_target"]))&&void 0!==n?n:{path:"localhost"}),t=(0,d.splitHostPort)(e);a.servername=null!==(s=null==t?void 0:t.host)&&void 0!==s?s:e}r["grpc-node.tls_enable_trace"]&&(a.enableTrace=!0)}return(0,o.getProxiedConnection)(e,r,a).then(n=>this.createSession(e,t,r,n))}shutdown(){var e;this.isShutdown=!0,null===(e=this.session)||void 0===e||e.close(),this.session=null}}t.Http2SubchannelConnector=x},5773:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uriToString=t.splitHostPort=t.parseUri=void 0;let r=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function n(e){let t=r.exec(e);return null===t?null:{scheme:t[1],authority:t[2],path:t[3]}}t.parseUri=n;let i=/^\d+$/;function s(e){if(e.startsWith("[")){let t=e.indexOf("]");if(-1===t)return null;let r=e.substring(1,t);if(-1===r.indexOf(":"))return null;if(!(e.length>t+1))return{host:r};if(":"!==e[t+1])return null;{let n=e.substring(t+2);return i.test(n)?{host:r,port:+n}:null}}{let t=e.split(":");return 2!==t.length?{host:e}:i.test(t[1])?{host:t[0],port:+t[1]}:null}}function a(e){let t="";return void 0!==e.scheme&&(t+=e.scheme+":"),void 0!==e.authority&&(t+="//"+e.authority+"/"),t+=e.path}t.splitHostPort=s,t.uriToString=a},3716:(e,t,r)=>{"use strict";var n,i;/**
 * @license
 * Copyright 2018 gRPC authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */n={value:!0},n=n=t.im=t.J_=n=t.Cp=n=n=void 0;let s=r(9739),a=r(1101),o=r(2607),l=r(8720);n=r(29),n=function(e){return"@type"in e&&"string"==typeof e["@type"]},function(e){e.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",e.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",e.IDEMPOTENT="IDEMPOTENT"}(i=t.Cp||(t.Cp={}));let u={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function c(e,t){return""===e?t:e+"."+t}function d(e){return e instanceof a.Service||e instanceof a.Type||e instanceof a.Enum}function h(e){return e instanceof a.Namespace||e instanceof a.Root}function p(e,t){let r=c(t,e.name);return d(e)?[[r,e]]:h(e)&&void 0!==e.nested?Object.keys(e.nested).map(t=>p(e.nested[t],r)).reduce((e,t)=>e.concat(t),[]):[]}function f(e,t){return function(r){return e.toObject(e.decode(r),t)}}function m(e){return function(t){if(Array.isArray(t))throw Error(`Failed to serialize message: expected object with ${e.name} structure, got array instead`);let r=e.fromObject(t);return e.encode(r).finish()}}function g(e){return(e||[]).reduce((e,t)=>{for(let[r,n]of Object.entries(t))"uninterpreted_option"===r?e.uninterpreted_option.push(t.uninterpreted_option):e[r]=n;return e},{deprecated:!1,idempotency_level:i.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function y(e,t,r,n){let i=e.resolvedRequestType,a=e.resolvedResponseType;return{path:"/"+t+"/"+e.name,requestStream:!!e.requestStream,responseStream:!!e.responseStream,requestSerialize:m(i),requestDeserialize:f(i,r),responseSerialize:m(a),responseDeserialize:f(a,r),originalName:s(e.name),requestType:b(i,n),responseType:b(a,n),options:g(e.parsedOptions)}}function v(e,t,r,n){let i={};for(let s of e.methodsArray)i[s.name]=y(s,t,r,n);return i}function b(e,t){let r=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:r.$type.toObject(r,u),fileDescriptorProtos:t}}function _(e,t){let r=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:r.$type.toObject(r,u),fileDescriptorProtos:t}}function T(e,t,r,n){if(e instanceof a.Service)return v(e,t,r,n);if(e instanceof a.Type)return b(e,n);if(e instanceof a.Enum)return _(e,n);throw Error("Type mismatch in reflection object handling")}function S(e,t){let r={};e.resolveAll();let n=e.toDescriptor("proto3").file.map(e=>Buffer.from(o.FileDescriptorProto.encode(e).finish()));for(let[i,s]of p(e,""))r[i]=T(s,i,t,n);return r}function w(e,t){t=t||{};let r=a.Root.fromDescriptor(e);return r.resolveAll(),S(r,t)}function E(e,t){return S((0,l.loadProtosWithOptionsSync)(e,t),t)}function C(e,t){t=t||{};let r=a.Root.fromJSON(e);return r.resolveAll(),S(r,t)}n=function(e,t){return(0,l.loadProtosWithOptions)(e,t).then(e=>S(e,t))},t.J_=E,t.im=C,n=function(e,t){return w(o.FileDescriptorSet.decode(e),t)},n=function(e,t){return w(o.FileDescriptorSet.fromObject(e),t)},(0,l.addCommonProtos)()},8720:(e,t,r)=>{"use strict";/**
 * @license
 * Copyright 2018 gRPC authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */Object.defineProperty(t,"__esModule",{value:!0}),t.addCommonProtos=t.loadProtosWithOptionsSync=t.loadProtosWithOptions=void 0;let n=r(7147),i=r(1017),s=r(1101);function a(e,t){let r=e.resolvePath;e.resolvePath=(e,s)=>{if(i.isAbsolute(s))return s;for(let e of t){let t=i.join(e,s);try{return n.accessSync(t,n.constants.R_OK),t}catch(e){continue}}return process.emitWarning(`${s} not found in any of the include paths ${t}`),r(e,s)}}async function o(e,t){let r=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));a(r,t.includeDirs)}let n=await r.load(e,t);return n.resolveAll(),n}function l(e,t){let r=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))throw Error("The includeDirs option must be an array");a(r,t.includeDirs)}let n=r.loadSync(e,t);return n.resolveAll(),n}function u(){let e=r(6541),t=r(9987),n=r(7674),i=r(3795);s.common("api",e.nested.google.nested.protobuf.nested),s.common("descriptor",t.nested.google.nested.protobuf.nested),s.common("source_context",n.nested.google.nested.protobuf.nested),s.common("type",i.nested.google.nested.protobuf.nested)}t.loadProtosWithOptions=o,t.loadProtosWithOptionsSync=l,t.addCommonProtos=u},1417:e=>{"use strict";function t(e,t){for(var r=Array(arguments.length-1),n=0,i=2,s=!0;i<arguments.length;)r[n++]=arguments[i++];return new Promise(function(i,a){r[n]=function(e){if(s){if(s=!1,e)a(e);else{for(var t=Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}}};try{e.apply(t||null,r)}catch(e){s&&(s=!1,a(e))}})}e.exports=t},5386:(e,t)=>{"use strict";var r=t;r.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var n=Array(64),i=Array(123),s=0;s<64;)i[n[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;r.encode=function(e,t,r){for(var i,s=null,a=[],o=0,l=0;t<r;){var u=e[t++];switch(l){case 0:a[o++]=n[u>>2],i=(3&u)<<4,l=1;break;case 1:a[o++]=n[i|u>>4],i=(15&u)<<2,l=2;break;case 2:a[o++]=n[i|u>>6],a[o++]=n[63&u],l=0}o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,a)),o=0)}return(l&&(a[o++]=n[i],a[o++]=61,1===l&&(a[o++]=61)),s)?(o&&s.push(String.fromCharCode.apply(String,a.slice(0,o))),s.join("")):String.fromCharCode.apply(String,a.slice(0,o))};var a="invalid encoding";r.decode=function(e,t,r){for(var n,s=r,o=0,l=0;l<e.length;){var u=e.charCodeAt(l++);if(61===u&&o>1)break;if(void 0===(u=i[u]))throw Error(a);switch(o){case 0:n=u,o=1;break;case 1:t[r++]=n<<2|(48&u)>>4,n=u,o=2;break;case 2:t[r++]=(15&n)<<4|(60&u)>>2,n=u,o=3;break;case 3:t[r++]=(3&n)<<6|u,o=0}}if(1===o)throw Error(a);return r-s},r.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},696:e=>{"use strict";function t(e,r){"string"==typeof e&&(r=e,e=void 0);var n=[];function i(e){if("string"!=typeof e){var r=s();if(t.verbose&&console.log("codegen: "+r),r="return "+r,e){for(var a=Object.keys(e),o=Array(a.length+1),l=Array(a.length),u=0;u<a.length;)o[u]=a[u],l[u]=e[a[u++]];return o[u]=r,Function.apply(null,o).apply(null,l)}return Function(r)()}for(var c=Array(arguments.length-1),d=0;d<c.length;)c[d]=arguments[++d];if(d=0,e=e.replace(/%([%dfijs])/g,function(e,t){var r=c[d++];switch(t){case"d":case"f":return String(Number(r));case"i":return String(Math.floor(r));case"j":return JSON.stringify(r);case"s":return String(r)}return"%"}),d!==c.length)throw Error("parameter count mismatch");return n.push(e),i}function s(t){return"function "+(t||r||"")+"("+(e&&e.join(",")||"")+"){\n  "+n.join("\n  ")+"\n}"}return i.toString=s,i}e.exports=t,t.verbose=!1},3478:e=>{"use strict";function t(){this._listeners={}}e.exports=t,t.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},t.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},t.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}},7828:(e,t,r)=>{"use strict";e.exports=s;var n=r(1417),i=r(1374)("fs");function s(e,t,r){return("function"==typeof t?(r=t,t={}):t||(t={}),r)?!t.xhr&&i&&i.readFile?i.readFile(e,function(n,i){return n&&"undefined"!=typeof XMLHttpRequest?s.xhr(e,t,r):n?r(n):r(null,t.binary?i:i.toString("utf8"))}):s.xhr(e,t,r):n(s,this,e,t)}s.xhr=function(e,t,r){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState){if(0!==n.status&&200!==n.status)return r(Error("status "+n.status));if(t.binary){var e=n.response;if(!e){e=[];for(var i=0;i<n.responseText.length;++i)e.push(255&n.responseText.charCodeAt(i))}return r(null,"undefined"!=typeof Uint8Array?new Uint8Array(e):e)}return r(null,n.responseText)}},t.binary&&("overrideMimeType"in n&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.responseType="arraybuffer"),n.open("GET",e),n.send()}},5256:e=>{"use strict";function t(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function s(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function o(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:s,e.writeFloatBE=n?s:i,e.readFloatLE=n?a:o,e.readFloatBE=n?o:a}():function(){function t(e,t,r,n){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,r,n);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var s=Math.floor(Math.log(t)/Math.LN2),a=8388607&Math.round(t*Math.pow(2,-s)*8388608);e((i<<31|s+127<<23|a)>>>0,r,n)}}function a(e,t,r){var n=e(t,r),i=(n>>31)*2+1,s=n>>>23&255,a=8388607&n;return 255===s?a?NaN:1/0*i:0===s?1401298464324817e-60*i*a:i*Math.pow(2,s-150)*(a+8388608)}e.writeFloatLE=t.bind(null,r),e.writeFloatBE=t.bind(null,n),e.readFloatLE=a.bind(null,i),e.readFloatBE=a.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function s(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function o(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:s,e.writeDoubleBE=n?s:i,e.readDoubleLE=n?a:o,e.readDoubleBE=n?o:a}():function(){function t(e,t,r,n,i,s){var a,o=n<0?1:0;if(o&&(n=-n),0===n)e(0,i,s+t),e(1/n>0?0:2147483648,i,s+r);else if(isNaN(n))e(0,i,s+t),e(2146959360,i,s+r);else if(n>17976931348623157e292)e(0,i,s+t),e((o<<31|2146435072)>>>0,i,s+r);else if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,i,s+t),e((o<<31|a/4294967296)>>>0,i,s+r);else{var l=Math.floor(Math.log(n)/Math.LN2);1024===l&&(l=1023),e(4503599627370496*(a=n*Math.pow(2,-l))>>>0,i,s+t),e((o<<31|l+1023<<20|1048576*a&1048575)>>>0,i,s+r)}}function a(e,t,r,n,i){var s=e(n,i+t),a=e(n,i+r),o=(a>>31)*2+1,l=a>>>20&2047,u=4294967296*(1048575&a)+s;return 2047===l?u?NaN:1/0*o:0===l?5e-324*o*u:o*Math.pow(2,l-1075)*(u+4503599627370496)}e.writeDoubleLE=t.bind(null,r,0,4),e.writeDoubleBE=t.bind(null,n,4,0),e.readDoubleLE=a.bind(null,i,0,4),e.readDoubleBE=a.bind(null,s,4,0)}(),e}function r(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function n(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function i(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=t(t)},1374:module=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},2727:(e,t)=>{"use strict";var r=t,n=r.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},i=r.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),r=n(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)".."===t[s]?s>0&&".."!==t[s-1]?t.splice(--s,2):r?t.splice(s,1):++s:"."===t[s]?t.splice(s,1):++s;return i+t.join("/")};r.resolve=function(e,t,r){return(r||(t=i(t)),n(t))?t:(r||(e=i(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?i(e+"/"+t):t)}},6733:e=>{"use strict";function t(e,t,r){var n=r||8192,i=n>>>1,s=null,a=n;return function(r){if(r<1||r>i)return e(r);a+r>n&&(s=e(n),a=0);var o=t.call(s,a,a+=r);return 7&a&&(a=(7|a)+1),o}}e.exports=t},3670:(e,t)=>{"use strict";var r=t;r.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:(64512&r)==55296&&(64512&e.charCodeAt(n+1))==56320?(++n,t+=4):t+=3;return t},r.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,s=[],a=0;t<r;)(n=e[t++])<128?s[a++]=n:n>191&&n<224?s[a++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[a++]=55296+(n>>10),s[a++]=56320+(1023&n)):s[a++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))},r.write=function(e,t,r){for(var n,i,s=r,a=0;a<e.length;++a)(n=e.charCodeAt(a))<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:((64512&n)==55296&&(64512&(i=e.charCodeAt(a+1)))==56320?(n=65536+((1023&n)<<10)+(1023&i),++a,t[r++]=n>>18|240,t[r++]=n>>12&63|128):t[r++]=n>>12|224,t[r++]=n>>6&63|128),t[r++]=63&n|128);return r-s}},9739:e=>{var t=1/0,r="[object Symbol]",n=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,i=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,s="\ud800-\udfff",a="\\u0300-\\u036f\\ufe20-\\ufe23",o="\\u20d0-\\u20f0",l="\\u2700-\\u27bf",u="a-z\\xdf-\\xf6\\xf8-\\xff",c="A-Z\\xc0-\\xd6\\xd8-\\xde",d="\\ufe0e\\ufe0f",h="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",p="['’]",f="["+s+"]",m="["+h+"]",g="["+a+o+"]",y="\\d+",v="["+l+"]",b="["+u+"]",_="[^"+s+h+y+l+u+c+"]",T="\ud83c[\udffb-\udfff]",S="[^"+s+"]",w="(?:\ud83c[\udde6-\uddff]){2}",E="[\ud800-\udbff][\udc00-\udfff]",C="["+c+"]",I="\\u200d",x="(?:"+b+"|"+_+")",k="(?:"+C+"|"+_+")",N="(?:"+p+"(?:d|ll|m|re|s|t|ve))?",R="(?:"+p+"(?:D|LL|M|RE|S|T|VE))?",A="(?:"+g+"|"+T+")?",O="["+d+"]?",D="(?:"+I+"(?:"+[S,w,E].join("|")+")"+O+A+")*",P=O+A+D,L="(?:"+[v,w,E].join("|")+")"+P,M="(?:"+[S+g+"?",g,w,E,f].join("|")+")",F=RegExp(p,"g"),j=RegExp(g,"g"),B=RegExp(T+"(?="+T+")|"+M+P,"g"),U=RegExp([C+"?"+b+"+"+N+"(?="+[m,C,"$"].join("|")+")",k+"+"+R+"(?="+[m,C+x,"$"].join("|")+")",C+"?"+x+"+"+N,C+"+"+R,y,L].join("|"),"g"),V=RegExp("["+I+s+a+o+d+"]"),z=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,q={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"ss"},$="object"==typeof global&&global&&global.Object===Object&&global,G="object"==typeof self&&self&&self.Object===Object&&self,W=$||G||Function("return this")();function K(e,t,r,n){var i=-1,s=e?e.length:0;for(n&&s&&(r=e[++i]);++i<s;)r=t(r,e[i],i,e);return r}function H(e){return e.split("")}function Q(e){return e.match(n)||[]}var Y=function(e){return function(t){return null==e?void 0:e[t]}}(q);function Z(e){return V.test(e)}function J(e){return z.test(e)}function X(e){return Z(e)?ee(e):H(e)}function ee(e){return e.match(B)||[]}function et(e){return e.match(U)||[]}var er=Object.prototype.toString,en=W.Symbol,ei=en?en.prototype:void 0,es=ei?ei.toString:void 0;function ea(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var s=Array(i);++n<i;)s[n]=e[n+t];return s}function eo(e){if("string"==typeof e)return e;if(ed(e))return es?es.call(e):"";var r=e+"";return"0"==r&&1/e==-t?"-0":r}function el(e,t,r){var n=e.length;return r=void 0===r?n:r,!t&&r>=n?e:ea(e,t,r)}function eu(e){return function(t){var r=Z(t=eh(t))?X(t):void 0,n=r?r[0]:t.charAt(0),i=r?el(r,1).join(""):t.slice(1);return n[e]()+i}}function ec(e){return!!e&&"object"==typeof e}function ed(e){return"symbol"==typeof e||ec(e)&&er.call(e)==r}function eh(e){return null==e?"":eo(e)}var ep=function(e){return function(t){return K(ey(em(t).replace(F,"")),e,"")}}(function(e,t,r){return t=t.toLowerCase(),e+(r?ef(t):t)});function ef(e){return eg(eh(e).toLowerCase())}function em(e){return(e=eh(e))&&e.replace(i,Y).replace(j,"")}var eg=eu("toUpperCase");function ey(e,t,r){return(e=eh(e),void 0===(t=r?void 0:t))?J(e)?et(e):Q(e):e.match(t)||[]}e.exports=ep},2607:(e,t,r)=>{"use strict";var n=r(1101);e.exports=t=n.descriptor=n.Root.fromJSON(r(9987)).lookup(".google.protobuf");var i=n.Namespace,s=n.Root,a=n.Enum,o=n.Type,l=n.Field,u=n.MapField,c=n.OneOf,d=n.Service,h=n.Method;function p(e,r,n){var u=t.FileDescriptorProto.create({name:e.filename||(e.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});R(n,u),e instanceof s||(u.package=e.fullName.substring(1));for(var c,h=0;h<e.nestedArray.length;++h)(c=e._nestedArray[h])instanceof o?u.messageType.push(c.toDescriptor(n)):c instanceof a?u.enumType.push(c.toDescriptor()):c instanceof l?u.extension.push(c.toDescriptor(n)):c instanceof d?u.service.push(c.toDescriptor()):c instanceof i&&p(c,r,n);u.options=I(e.options,t.FileOptions),u.messageType.length+u.enumType.length+u.extension.length+u.service.length&&r.push(u)}s.fromDescriptor=function(e){"number"==typeof e.length&&(e=t.FileDescriptorSet.decode(e));var r=new s;if(e.file)for(var n,i,u,c=0;c<e.file.length;++c){i=r,(n=e.file[c]).package&&n.package.length&&(i=r.define(n.package));var h=N(n);if(n.name&&n.name.length&&r.files.push(i.filename=n.name),n.messageType)for(u=0;u<n.messageType.length;++u)i.add(o.fromDescriptor(n.messageType[u],h));if(n.enumType)for(u=0;u<n.enumType.length;++u)i.add(a.fromDescriptor(n.enumType[u],h));if(n.extension)for(u=0;u<n.extension.length;++u)i.add(l.fromDescriptor(n.extension[u],h));if(n.service)for(u=0;u<n.service.length;++u)i.add(d.fromDescriptor(n.service[u],h));var p=E(n.options,t.FileOptions);if(p){var f=Object.keys(p);for(u=0;u<f.length;++u)i.setOption(f[u],p[f[u]])}}return r.resolveAll()},s.prototype.toDescriptor=function(e){var r=t.FileDescriptorSet.create();return p(this,r.file,e),r};var f=0;o.fromDescriptor=function(e,r,n){"number"==typeof e.length&&(e=t.DescriptorProto.decode(e));var i,s=new o(e.name.length?e.name:"Type"+f++,E(e.options,t.MessageOptions));if(n||(s._edition=r),e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)s.add(c.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var u=l.fromDescriptor(e.field[i],r,!0);s.add(u),e.field[i].hasOwnProperty("oneofIndex")&&s.oneofsArray[e.field[i].oneofIndex].add(u)}if(e.extension)for(i=0;i<e.extension.length;++i)s.add(l.fromDescriptor(e.extension[i],r,!0));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)s.add(o.fromDescriptor(e.nestedType[i],r,!0)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&s.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)s.add(a.fromDescriptor(e.enumType[i],r,!0));if(e.extensionRange&&e.extensionRange.length)for(i=0,s.extensions=[];i<e.extensionRange.length;++i)s.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(s.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)s.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)s.reserved.push(e.reservedName[i])}return s},o.prototype.toDescriptor=function(e){var r,n,i=t.DescriptorProto.create({name:this.name});for(n=0;n<this.fieldsArray.length;++n)if(i.field.push(r=this._fieldsArray[n].toDescriptor(e)),this._fieldsArray[n]instanceof u){var s=S(this._fieldsArray[n].keyType,this._fieldsArray[n].resolvedKeyType,!1),c=S(this._fieldsArray[n].type,this._fieldsArray[n].resolvedType,!1),d=11===c||14===c?this._fieldsArray[n].resolvedType&&x(this.parent,this._fieldsArray[n].resolvedType)||this._fieldsArray[n].type:void 0;i.nestedType.push(t.DescriptorProto.create({name:r.typeName,field:[t.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),t.FieldDescriptorProto.create({name:"value",number:2,label:1,type:c,typeName:d})],options:t.MessageOptions.create({mapEntry:!0})}))}for(n=0;n<this.oneofsArray.length;++n)i.oneofDecl.push(this._oneofsArray[n].toDescriptor());for(n=0;n<this.nestedArray.length;++n)this._nestedArray[n]instanceof l?i.field.push(this._nestedArray[n].toDescriptor(e)):this._nestedArray[n]instanceof o?i.nestedType.push(this._nestedArray[n].toDescriptor(e)):this._nestedArray[n]instanceof a&&i.enumType.push(this._nestedArray[n].toDescriptor());if(this.extensions)for(n=0;n<this.extensions.length;++n)i.extensionRange.push(t.DescriptorProto.ExtensionRange.create({start:this.extensions[n][0],end:this.extensions[n][1]}));if(this.reserved)for(n=0;n<this.reserved.length;++n)"string"==typeof this.reserved[n]?i.reservedName.push(this.reserved[n]):i.reservedRange.push(t.DescriptorProto.ReservedRange.create({start:this.reserved[n][0],end:this.reserved[n][1]}));return i.options=I(this.options,t.MessageOptions),i};var m=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;l.fromDescriptor=function(e,r,n){if("number"==typeof e.length&&(e=t.DescriptorProto.decode(e)),"number"!=typeof e.number)throw Error("missing field id");switch(i=e.typeName&&e.typeName.length?e.typeName:_(e.type),e.label){case 1:s=void 0;break;case 2:s="required";break;case 3:s="repeated";break;default:throw Error("illegal label: "+e.label)}var i,s,a=e.extendee;void 0!==e.extendee&&(a=a.length?a:void 0);var o=new l(e.name.length?e.name:"field"+e.number,e.number,i,s,a);if(n||(o._edition=r),o.options=E(e.options,t.FieldOptions),e.proto3_optional&&(o.options.proto3_optional=!0),e.defaultValue&&e.defaultValue.length){var u=e.defaultValue;switch(u){case"true":case"TRUE":u=!0;break;case"false":case"FALSE":u=!1;break;default:m.exec(u)&&(u=parseInt(u))}o.setOption("default",u)}return T(e.type)&&("proto3"===r?e.options&&!e.options.packed&&o.setOption("packed",!1):(!r||"proto2"===r)&&e.options&&e.options.packed&&o.setOption("packed",!0)),o},l.prototype.toDescriptor=function(e){var r=t.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)r.type=11,r.typeName=n.util.ucFirst(this.name),r.label=3;else{switch(r.type=S(this.type,this.resolve().resolvedType,this.delimited)){case 10:case 11:case 14:r.typeName=this.resolvedType?x(this.parent,this.resolvedType):this.type}"repeated"===this.rule?r.label=3:this.required&&"proto2"===e?r.label=2:r.label=1}if(r.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(r.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(r.options=I(this.options,t.FieldOptions),null!=this.options.default&&(r.defaultValue=String(this.options.default)),this.options.proto3_optional&&(r.proto3_optional=!0)),"proto3"===e?this.packed||((r.options||(r.options=t.FieldOptions.create())).packed=!1):(!e||"proto2"===e)&&this.packed&&((r.options||(r.options=t.FieldOptions.create())).packed=!0),r};var g=0;a.fromDescriptor=function(e,r,n){"number"==typeof e.length&&(e=t.EnumDescriptorProto.decode(e));var i={};if(e.value)for(var s=0;s<e.value.length;++s){var o=e.value[s].name,l=e.value[s].number||0;i[o&&o.length?o:"NAME"+l]=l}var u=new a(e.name&&e.name.length?e.name:"Enum"+g++,i,E(e.options,t.EnumOptions));return n||(u._edition=r),u},a.prototype.toDescriptor=function(){for(var e=[],r=0,n=Object.keys(this.values);r<n.length;++r)e.push(t.EnumValueDescriptorProto.create({name:n[r],number:this.values[n[r]]}));return t.EnumDescriptorProto.create({name:this.name,value:e,options:I(this.options,t.EnumOptions)})};var y=0;c.fromDescriptor=function(e){return"number"==typeof e.length&&(e=t.OneofDescriptorProto.decode(e)),new c(e.name&&e.name.length?e.name:"oneof"+y++)},c.prototype.toDescriptor=function(){return t.OneofDescriptorProto.create({name:this.name})};var v=0;d.fromDescriptor=function(e,r,n){"number"==typeof e.length&&(e=t.ServiceDescriptorProto.decode(e));var i=new d(e.name&&e.name.length?e.name:"Service"+v++,E(e.options,t.ServiceOptions));if(n||(i._edition=r),e.method)for(var s=0;s<e.method.length;++s)i.add(h.fromDescriptor(e.method[s]));return i},d.prototype.toDescriptor=function(){for(var e=[],r=0;r<this.methodsArray.length;++r)e.push(this._methodsArray[r].toDescriptor());return t.ServiceDescriptorProto.create({name:this.name,method:e,options:I(this.options,t.ServiceOptions)})};var b=0;function _(e){switch(e){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+e)}function T(e){switch(e){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function S(e,t,r){switch(e){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(t instanceof a)return 14;if(t instanceof o)return r?10:11;throw Error("illegal type: "+e)}function w(e,t){for(var r,n,i={},s=0;s<t.fieldsArray.length;++s)if("uninterpretedOption"!==(n=(r=t._fieldsArray[s]).name)&&Object.prototype.hasOwnProperty.call(e,n)){var l=k(n);r.resolvedType instanceof o?i[l]=w(e[n],r.resolvedType):r.resolvedType instanceof a?i[l]=r.resolvedType.valuesById[e[n]]:i[l]=e[n]}return i}function E(e,t){if(e)return w(t.toObject(e),t)}function C(e,t){for(var r={},i=Object.keys(e),s=0;s<i.length;++s){var a=i[s],l=n.util.camelCase(a);if(Object.prototype.hasOwnProperty.call(t.fields,l)){var u=t.fields[l];u.resolvedType instanceof o?r[l]=C(e[a],u.resolvedType):r[l]=e[a],u.repeated&&!Array.isArray(r[l])&&(r[l]=[r[l]])}}return r}function I(e,t){if(e)return t.fromObject(C(e,t))}function x(e,t){var r=e.fullName.split("."),n=t.fullName.split("."),a=0,o=0,l=n.length-1;if(!(e instanceof s)&&t instanceof i)for(;a<r.length&&o<l&&r[a]===n[o];){var u=t.lookup(r[a++],!0);if(null!==u&&u!==t)break;++o}else for(;a<r.length&&o<l&&r[a]===n[o];++a,++o);return n.slice(o).join(".")}function k(e){return e.substring(0,1)+e.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}function N(e){if("editions"===e.syntax){if(e.edition===t.Edition.EDITION_2023)return"2023";throw Error("Unsupported edition "+e.edition)}return"proto3"===e.syntax?"proto3":"proto2"}function R(e,r){if(e){if("proto2"===e||"proto3"===e)r.syntax=e;else if(r.syntax="editions","2023"===e)r.edition=t.Edition.EDITION_2023;else throw Error("Unsupported edition "+e)}}h.fromDescriptor=function(e){return"number"==typeof e.length&&(e=t.MethodDescriptorProto.decode(e)),new h(e.name&&e.name.length?e.name:"Method"+b++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,E(e.options,t.MethodOptions))},h.prototype.toDescriptor=function(){return t.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:I(this.options,t.MethodOptions)})}},1101:(e,t,r)=>{"use strict";e.exports=r(8582)},3980:e=>{"use strict";e.exports=n;var t,r=/\/|\./;function n(e,t){r.test(e)||(e="google/protobuf/"+e+".proto",t={nested:{google:{nested:{protobuf:{nested:t}}}}}),n[e]=t}n("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),n("duration",{Duration:t={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),n("timestamp",{Timestamp:t}),n("empty",{Empty:{fields:{}}}),n("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),n("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),n("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),n.get=function(e){return n[e]||null}},5711:(e,t,r)=>{"use strict";var n=t,i=r(1114),s=r(4615);function a(e,t,r,n){var s=!1;if(t.resolvedType){if(t.resolvedType instanceof i){e("switch(d%s){",n);for(var a=t.resolvedType.values,o=Object.keys(a),l=0;l<o.length;++l)a[o[l]]!==t.typeDefault||s||(e("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',n,n,n),t.repeated||e("break"),s=!0),e("case%j:",o[l])("case %i:",a[o[l]])("m%s=%j",n,a[o[l]])("break");e("}")}else e('if(typeof d%s!=="object")',n)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",n,r,n)}else{var u=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",n,n);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",n,n);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",n,n);break;case"uint64":u=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",n,n,u)('else if(typeof d%s==="string")',n)("m%s=parseInt(d%s,10)",n,n)('else if(typeof d%s==="number")',n)("m%s=d%s",n,n)('else if(typeof d%s==="object")',n)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",n,n,n,u?"true":"");break;case"bytes":e('if(typeof d%s==="string")',n)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",n,n,n)("else if(d%s.length >= 0)",n)("m%s=d%s",n,n);break;case"string":e("m%s=String(d%s)",n,n);break;case"bool":e("m%s=Boolean(d%s)",n,n)}}return e}function o(e,t,r,n){if(t.resolvedType)t.resolvedType instanceof i?e("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",n,r,n,n,r,n,n):e("d%s=types[%i].toObject(m%s,o)",n,r,n);else{var s=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",n,n,n,n);break;case"uint64":s=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',n)("d%s=o.longs===String?String(m%s):m%s",n,n,n)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",n,n,n,n,s?"true":"",n);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",n,n,n,n,n);break;default:e("d%s=m%s",n,n)}}return e}n.fromObject=function(e){var t=e.fieldsArray,r=s.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var n=0;n<t.length;++n){var o=t[n].resolve(),l=s.safeProp(o.name);o.map?(r("if(d%s){",l)('if(typeof d%s!=="object")',l)("throw TypeError(%j)",o.fullName+": object expected")("m%s={}",l)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",l),a(r,o,n,l+"[ks[i]]")("}")("}")):o.repeated?(r("if(d%s){",l)("if(!Array.isArray(d%s))",l)("throw TypeError(%j)",o.fullName+": array expected")("m%s=[]",l)("for(var i=0;i<d%s.length;++i){",l),a(r,o,n,l+"[i]")("}")("}")):(o.resolvedType instanceof i||r("if(d%s!=null){",l),a(r,o,n,l),o.resolvedType instanceof i||r("}"))}return r("return m")},n.toObject=function(e){var t=e.fieldsArray.slice().sort(s.compareFieldsById);if(!t.length)return s.codegen()("return {}");for(var r=s.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),n=[],a=[],l=[],u=0;u<t.length;++u)t[u].partOf||(t[u].resolve().repeated?n:t[u].map?a:l).push(t[u]);if(n.length){for(r("if(o.arrays||o.defaults){"),u=0;u<n.length;++u)r("d%s=[]",s.safeProp(n[u].name));r("}")}if(a.length){for(r("if(o.objects||o.defaults){"),u=0;u<a.length;++u)r("d%s={}",s.safeProp(a[u].name));r("}")}if(l.length){for(r("if(o.defaults){"),u=0;u<l.length;++u){var c=l[u],d=s.safeProp(c.name);if(c.resolvedType instanceof i)r("d%s=o.enums===String?%j:%j",d,c.resolvedType.valuesById[c.typeDefault],c.typeDefault);else if(c.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",c.typeDefault.low,c.typeDefault.high,c.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",d)("}else")("d%s=o.longs===String?%j:%i",d,c.typeDefault.toString(),c.typeDefault.toNumber());else if(c.bytes){var h="["+Array.prototype.slice.call(c.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",d,String.fromCharCode.apply(String,c.typeDefault))("else{")("d%s=%s",d,h)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",d,d)("}")}else r("d%s=%j",d,c.typeDefault)}r("}")}var p=!1;for(u=0;u<t.length;++u){var c=t[u],f=e._fieldsArray.indexOf(c),d=s.safeProp(c.name);c.map?(p||(p=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",d,d)("d%s={}",d)("for(var j=0;j<ks2.length;++j){"),o(r,c,f,d+"[ks2[j]]")("}")):c.repeated?(r("if(m%s&&m%s.length){",d,d)("d%s=[]",d)("for(var j=0;j<m%s.length;++j){",d),o(r,c,f,d+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",d,c.name),o(r,c,f,d),c.partOf&&r("if(o.oneofs)")("d%s=%j",s.safeProp(c.partOf.name),c.name)),r("}")}return r("return d")}},1526:(e,t,r)=>{"use strict";e.exports=o;var n=r(1114),i=r(6160),s=r(4615);function a(e){return"missing required '"+e.name+"'"}function o(e){for(var t=s.codegen(["r","l","e"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),r=0;r<e.fieldsArray.length;++r){var o=e._fieldsArray[r].resolve(),l=o.resolvedType instanceof n?"int32":o.type,u="m"+s.safeProp(o.name);t("case %i: {",o.id),o.map?(t("if(%s===util.emptyObject)",u)("%s={}",u)("var c2 = r.uint32()+r.pos"),void 0!==i.defaults[o.keyType]?t("k=%j",i.defaults[o.keyType]):t("k=null"),void 0!==i.defaults[l]?t("value=%j",i.defaults[l]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",o.keyType)("case 2:"),void 0===i.basic[l]?t("value=types[%i].decode(r,r.uint32())",r):t("value=r.%s()",l),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),t(void 0!==i.long[o.keyType]?'%s[typeof k==="object"?util.longToHash(k):k]=value':"%s[k]=value",u)):o.repeated?(t("if(!(%s&&%s.length))",u,u)("%s=[]",u),void 0!==i.packed[l]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",u,l)("}else"),void 0===i.basic[l]?t(o.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",u,r):t("%s.push(r.%s())",u,l)):void 0===i.basic[l]?t(o.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",u,r):t("%s=r.%s()",u,l),t("break")("}")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),r=0;r<e._fieldsArray.length;++r){var c=e._fieldsArray[r];c.required&&t("if(!m.hasOwnProperty(%j))",c.name)("throw util.ProtocolError(%j,{instance:m})",a(c))}return t("return m")}},8455:(e,t,r)=>{"use strict";e.exports=o;var n=r(1114),i=r(6160),s=r(4615);function a(e,t,r,n){return t.delimited?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",r,n,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",r,n,(t.id<<3|2)>>>0)}function o(e){for(var t,r,o=s.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),l=e.fieldsArray.slice().sort(s.compareFieldsById),t=0;t<l.length;++t){var u=l[t].resolve(),c=e._fieldsArray.indexOf(u),d=u.resolvedType instanceof n?"int32":u.type,h=i.basic[d];r="m"+s.safeProp(u.name),u.map?(o("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,u.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(u.id<<3|2)>>>0,8|i.mapKey[u.keyType],u.keyType),void 0===h?o("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",c,r):o(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|h,d,r),o("}")("}")):u.repeated?(o("if(%s!=null&&%s.length){",r,r),u.packed&&void 0!==i.packed[d]?o("w.uint32(%i).fork()",(u.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",d,r)("w.ldelim()"):(o("for(var i=0;i<%s.length;++i)",r),void 0===h?a(o,u,c,r+"[i]"):o("w.uint32(%i).%s(%s[i])",(u.id<<3|h)>>>0,d,r)),o("}")):(u.optional&&o("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,u.name),void 0===h?a(o,u,c,r):o("w.uint32(%i).%s(%s)",(u.id<<3|h)>>>0,d,r))}return o("return w")}},1114:(e,t,r)=>{"use strict";e.exports=a;var n=r(3514);((a.prototype=Object.create(n.prototype)).constructor=a).className="Enum";var i=r(4943),s=r(4615);function a(e,t,r,i,s,a){if(n.call(this,e,r),t&&"object"!=typeof t)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=s||{},this.valuesOptions=a,this._valuesFeatures={},this.reserved=void 0,t)for(var o=Object.keys(t),l=0;l<o.length;++l)"number"==typeof t[o[l]]&&(this.valuesById[this.values[o[l]]=t[o[l]]]=o[l])}a.prototype._resolveFeatures=function(e){return e=this._edition||e,n.prototype._resolveFeatures.call(this,e),Object.keys(this.values).forEach(e=>{var t=Object.assign({},this._features);this._valuesFeatures[e]=Object.assign(t,this.valuesOptions&&this.valuesOptions[e]&&this.valuesOptions[e].features)}),this},a.fromJSON=function(e,t){var r=new a(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},a.prototype.add=function(e,t,r,n){if(!s.isString(e))throw TypeError("name must be a string");if(!s.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return n&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[e]=n||null),this.comments[e]=r||null,this},a.prototype.remove=function(e){if(!s.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this},a.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},a.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)}},7510:(e,t,r)=>{"use strict";e.exports=u;var n,i=r(3514);((u.prototype=Object.create(i.prototype)).constructor=u).className="Field";var s=r(1114),a=r(6160),o=r(4615),l=/^required|optional|repeated$/;function u(e,t,r,n,s,u,c){if(o.isObject(n)?(c=s,u=n,n=s=void 0):o.isObject(s)&&(c=u,u=s,s=void 0),i.call(this,e,u),!o.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!o.isString(r))throw TypeError("type must be a string");if(void 0!==n&&!l.test(n=n.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==s&&!o.isString(s))throw TypeError("extend must be a string");"proto3_optional"===n&&(n="optional"),this.rule=n&&"optional"!==n?n:void 0,this.type=r,this.id=t,this.extend=s||void 0,this.repeated="repeated"===n,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!o.Long&&void 0!==a.long[r],this.bytes="bytes"===r,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=c}u.fromJSON=function(e,t){var r=new u(e,t.id,t.type,t.rule,t.extend,t.options,t.comment);return t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},Object.defineProperty(u.prototype,"required",{get:function(){return"LEGACY_REQUIRED"===this._features.field_presence}}),Object.defineProperty(u.prototype,"optional",{get:function(){return!this.required}}),Object.defineProperty(u.prototype,"delimited",{get:function(){return this.resolvedType instanceof n&&"DELIMITED"===this._features.message_encoding}}),Object.defineProperty(u.prototype,"packed",{get:function(){return"PACKED"===this._features.repeated_field_encoding}}),Object.defineProperty(u.prototype,"hasPresence",{get:function(){return!this.repeated&&!this.map&&(this.partOf||this.declaringField||this.extensionField||"IMPLICIT"!==this._features.field_presence)}}),u.prototype.setOption=function(e,t,r){return i.prototype.setOption.call(this,e,t,r)},u.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return o.toObject(["edition",this._editionToJSON(),"rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},u.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=a.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof n?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof s&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof s||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=o.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;o.base64.test(this.typeDefault)?o.base64.decode(this.typeDefault,e=o.newBuffer(o.base64.length(this.typeDefault)),0):o.utf8.write(this.typeDefault,e=o.newBuffer(o.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=o.emptyObject:this.repeated?this.defaultValue=o.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof n&&(this.parent.ctor.prototype[this.name]=this.defaultValue),i.prototype.resolve.call(this)},u.prototype._inferLegacyProtoFeatures=function(e){if("proto2"!==e&&"proto3"!==e)return{};var t={};if("required"===this.rule&&(t.field_presence="LEGACY_REQUIRED"),this.parent&&void 0===a.defaults[this.type]){var r=this.parent.get(this.type.split(".").pop());r&&r instanceof n&&r.group&&(t.message_encoding="DELIMITED")}return!0===this.getOption("packed")?t.repeated_field_encoding="PACKED":!1===this.getOption("packed")&&(t.repeated_field_encoding="EXPANDED"),t},u.prototype._resolveFeatures=function(e){return i.prototype._resolveFeatures.call(this,this._edition||e)},u.d=function(e,t,r,n){return"function"==typeof t?t=o.decorateType(t).name:t&&"object"==typeof t&&(t=o.decorateEnum(t).name),function(i,s){o.decorateType(i.constructor).add(new u(s,e,t,r,{default:n}))}},u._configure=function(e){n=e}},4630:(e,t,r)=>{"use strict";var n=e.exports=r(8690);function i(e,t,r){return"function"==typeof t?(r=t,t=new n.Root):t||(t=new n.Root),t.load(e,r)}function s(e,t){return t||(t=new n.Root),t.loadSync(e)}n.build="light",n.load=i,n.loadSync=s,n.encoder=r(8455),n.decoder=r(1526),n.verifier=r(1506),n.converter=r(5711),n.ReflectionObject=r(3514),n.Namespace=r(4943),n.Root=r(4343),n.Enum=r(1114),n.Type=r(3839),n.Field=r(7510),n.OneOf=r(2695),n.MapField=r(9538),n.Service=r(1631),n.Method=r(6539),n.Message=r(2936),n.wrappers=r(9579),n.types=r(6160),n.util=r(4615),n.ReflectionObject._configure(n.Root),n.Namespace._configure(n.Type,n.Service,n.Enum),n.Root._configure(n.Type),n.Field._configure(n.Type)},8690:(e,t,r)=>{"use strict";var n=t;function i(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=r(8458),n.BufferWriter=r(8386),n.Reader=r(2279),n.BufferReader=r(424),n.util=r(745),n.rpc=r(4774),n.roots=r(9694),n.configure=i,i()},8582:(e,t,r)=>{"use strict";var n=e.exports=r(4630);n.build="full",n.tokenize=r(9867),n.parse=r(6614),n.common=r(3980),n.Root._configure(n.Type,n.parse,n.common)},9538:(e,t,r)=>{"use strict";e.exports=a;var n=r(7510);((a.prototype=Object.create(n.prototype)).constructor=a).className="MapField";var i=r(6160),s=r(4615);function a(e,t,r,i,a,o){if(n.call(this,e,t,i,void 0,void 0,a,o),!s.isString(r))throw TypeError("keyType must be a string");this.keyType=r,this.resolvedKeyType=null,this.map=!0}a.fromJSON=function(e,t){return new a(e,t.id,t.keyType,t.type,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},a.prototype.resolve=function(){if(this.resolved)return this;if(void 0===i.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return n.prototype.resolve.call(this)},a.d=function(e,t,r){return"function"==typeof r?r=s.decorateType(r).name:r&&"object"==typeof r&&(r=s.decorateEnum(r).name),function(n,i){s.decorateType(n.constructor).add(new a(i,e,t,r))}}},2936:(e,t,r)=>{"use strict";e.exports=i;var n=r(745);function i(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)this[t[r]]=e[t[r]]}i.create=function(e){return this.$type.create(e)},i.encode=function(e,t){return this.$type.encode(e,t)},i.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},i.decode=function(e){return this.$type.decode(e)},i.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},i.verify=function(e){return this.$type.verify(e)},i.fromObject=function(e){return this.$type.fromObject(e)},i.toObject=function(e,t){return this.$type.toObject(e,t)},i.prototype.toJSON=function(){return this.$type.toObject(this,n.toJSONOptions)}},6539:(e,t,r)=>{"use strict";e.exports=s;var n=r(3514);((s.prototype=Object.create(n.prototype)).constructor=s).className="Method";var i=r(4615);function s(e,t,r,s,a,o,l,u,c){if(i.isObject(a)?(l=a,a=o=void 0):i.isObject(o)&&(l=o,o=void 0),!(void 0===t||i.isString(t)))throw TypeError("type must be a string");if(!i.isString(r))throw TypeError("requestType must be a string");if(!i.isString(s))throw TypeError("responseType must be a string");n.call(this,e,l),this.type=t||"rpc",this.requestType=r,this.requestStream=!!a||void 0,this.responseType=s,this.responseStream=!!o||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u,this.parsedOptions=c}s.fromJSON=function(e,t){return new s(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)},s.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return i.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])},s.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),n.prototype.resolve.call(this))}},4943:(e,t,r)=>{"use strict";e.exports=d;var n,i,s,a=r(3514);((d.prototype=Object.create(a.prototype)).constructor=d).className="Namespace";var o=r(7510),l=r(4615),u=r(2695);function c(e,t){if(e&&e.length){for(var r={},n=0;n<e.length;++n)r[e[n].name]=e[n].toJSON(t);return r}}function d(e,t){a.call(this,e,t),this.nested=void 0,this._nestedArray=null,this._lookupCache={},this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0}function h(e){e._nestedArray=null,e._lookupCache={};for(var t=e;t=t.parent;)t._lookupCache={};return e}d.fromJSON=function(e,t){return new d(e,t.options).addJSON(t.nested)},d.arrayToJSON=c,d.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if("string"!=typeof e[r]&&e[r][0]<=t&&e[r][1]>t)return!0}return!1},d.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1},Object.defineProperty(d.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=l.toArray(this.nested))}}),d.prototype.toJSON=function(e){return l.toObject(["options",this.options,"nested",c(this.nestedArray,e)])},d.prototype.addJSON=function(e){var t=this;if(e)for(var r,a=Object.keys(e),l=0;l<a.length;++l)r=e[a[l]],t.add((void 0!==r.fields?n.fromJSON:void 0!==r.values?s.fromJSON:void 0!==r.methods?i.fromJSON:void 0!==r.id?o.fromJSON:d.fromJSON)(a[l],r));return this},d.prototype.get=function(e){return this.nested&&this.nested[e]||null},d.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof s)return this.nested[e].values;throw Error("no such enum: "+e)},d.prototype.add=function(e){if(!(e instanceof o&&void 0!==e.extend||e instanceof n||e instanceof u||e instanceof s||e instanceof i||e instanceof d))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t){if(t instanceof d&&e instanceof d&&!(t instanceof n||t instanceof i)){for(var r=t.nestedArray,a=0;a<r.length;++a)e.add(r[a]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}}else this.nested={};this.nested[e.name]=e,this instanceof n||this instanceof i||this instanceof s||this instanceof o||e._edition||(e._edition=e._defaultEdition),this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0;for(var l=this;l=l.parent;)l._needsRecursiveFeatureResolution=!0,l._needsRecursiveResolve=!0;return e.onAdd(this),h(this)},d.prototype.remove=function(e){if(!(e instanceof a))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),h(this)},d.prototype.define=function(e,t){if(l.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var r=this;e.length>0;){var n=e.shift();if(r.nested&&r.nested[n]){if(!((r=r.nested[n])instanceof d))throw Error("path conflicts with non-namespace objects")}else r.add(r=new d(n))}return t&&r.addJSON(t),r},d.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;this._resolveFeaturesRecursive(this._edition);var e=this.nestedArray,t=0;for(this.resolve();t<e.length;)e[t]instanceof d?e[t++].resolveAll():e[t++].resolve();return this._needsRecursiveResolve=!1,this},d.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(this._needsRecursiveFeatureResolution=!1,e=this._edition||e,a.prototype._resolveFeaturesRecursive.call(this,e),this.nestedArray.forEach(t=>{t._resolveFeaturesRecursive(e)})),this},d.prototype.lookup=function(e,t,r){if("boolean"==typeof t?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),l.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;var n=e.join(".");if(""===e[0])return this.root.lookup(e.slice(1),t);var i=this.root._fullyQualifiedObjects&&this.root._fullyQualifiedObjects["."+n];if(i&&(!t||t.indexOf(i.constructor)>-1)||(i=this._lookupImpl(e,n))&&(!t||t.indexOf(i.constructor)>-1))return i;if(r)return null;for(var s=this;s.parent;){if((i=s.parent._lookupImpl(e,n))&&(!t||t.indexOf(i.constructor)>-1))return i;s=s.parent}return null},d.prototype._lookupImpl=function(e,t){if(Object.prototype.hasOwnProperty.call(this._lookupCache,t))return this._lookupCache[t];var r=this.get(e[0]),n=null;if(r)1===e.length?n=r:r instanceof d&&(e=e.slice(1),n=r._lookupImpl(e,e.join(".")));else for(var i=0;i<this.nestedArray.length;++i)this._nestedArray[i]instanceof d&&(r=this._nestedArray[i]._lookupImpl(e,t))&&(n=r);return this._lookupCache[t]=n,n},d.prototype.lookupType=function(e){var t=this.lookup(e,[n]);if(!t)throw Error("no such type: "+e);return t},d.prototype.lookupEnum=function(e){var t=this.lookup(e,[s]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},d.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[n,s]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},d.prototype.lookupService=function(e){var t=this.lookup(e,[i]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},d._configure=function(e,t,r){n=e,i=t,s=r}},3514:(e,t,r)=>{"use strict";e.exports=u,u.className="ReflectionObject";let n=r(2695);var i,s=r(4615),a={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},o={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},l={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function u(e,t){if(!s.isString(e))throw TypeError("name must be a string");if(t&&!s.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this._edition=null,this._defaultEdition="proto2",this._features={},this._featuresResolved=!1,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(u.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),u.prototype.toJSON=function(){throw Error()},u.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof i&&t._handleAdd(this)},u.prototype.onRemove=function(e){var t=e.root;t instanceof i&&t._handleRemove(this),this.parent=null,this.resolved=!1},u.prototype.resolve=function(){return this.resolved||this.root instanceof i&&(this.resolved=!0),this},u.prototype._resolveFeaturesRecursive=function(e){return this._resolveFeatures(this._edition||e)},u.prototype._resolveFeatures=function(e){if(!this._featuresResolved){var t={};if(!e)throw Error("Unknown edition for "+this.fullName);var r=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(e));if(this._edition){if("proto2"===e)t=Object.assign({},o);else if("proto3"===e)t=Object.assign({},l);else if("2023"===e)t=Object.assign({},a);else throw Error("Unknown edition: "+e);this._features=Object.assign(t,r||{}),this._featuresResolved=!0;return}if(this.partOf instanceof n){var i=Object.assign({},this.partOf._features);this._features=Object.assign(i,r||{})}else if(this.declaringField);else if(this.parent){var s=Object.assign({},this.parent._features);this._features=Object.assign(s,r||{})}else throw Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features),this._featuresResolved=!0}},u.prototype._inferLegacyProtoFeatures=function(){return{}},u.prototype.getOption=function(e){if(this.options)return this.options[e]},u.prototype.setOption=function(e,t,r){return this.options||(this.options={}),/^features\./.test(e)?s.setProperty(this.options,e,t,r):r&&void 0!==this.options[e]||(this.getOption(e)!==t&&(this.resolved=!1),this.options[e]=t),this},u.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var n=this.parsedOptions;if(r){var i=n.find(function(t){return Object.prototype.hasOwnProperty.call(t,e)});if(i){var a=i[e];s.setProperty(a,r,t)}else(i={})[e]=s.setProperty({},r,t),n.push(i)}else{var o={};o[e]=t,n.push(o)}return this},u.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),n=0;n<r.length;++n)this.setOption(r[n],e[r[n]],t);return this},u.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},u.prototype._editionToJSON=function(){if(this._edition&&"proto3"!==this._edition)return this._edition},u._configure=function(e){i=e}},2695:(e,t,r)=>{"use strict";e.exports=a;var n=r(3514);((a.prototype=Object.create(n.prototype)).constructor=a).className="OneOf";var i=r(7510),s=r(4615);function a(e,t,r,i){if(Array.isArray(t)||(r=t,t=void 0),n.call(this,e,r),!(void 0===t||Array.isArray(t)))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=i}function o(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}a.fromJSON=function(e,t){return new a(e,t.oneof,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},a.prototype.add=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,o(this),this},a.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},a.prototype.onAdd=function(e){n.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}o(this)},a.prototype.onRemove=function(e){for(var t,r=0;r<this.fieldsArray.length;++r)(t=this.fieldsArray[r]).parent&&t.parent.remove(t);n.prototype.onRemove.call(this,e)},Object.defineProperty(a.prototype,"isProto3Optional",{get:function(){if(null==this.fieldsArray||1!==this.fieldsArray.length)return!1;var e=this.fieldsArray[0];return null!=e.options&&!0===e.options.proto3_optional}}),a.d=function(){for(var e=Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,r){s.decorateType(t.constructor).add(new a(r,e)),Object.defineProperty(t,r,{get:s.oneOfGetter(e),set:s.oneOfSetter(e)})}}},6614:(e,t,r)=>{"use strict";e.exports=E,E.filename=null,E.defaults={keepCase:!1};var n=r(9867),i=r(4343),s=r(3839),a=r(7510),o=r(9538),l=r(2695),u=r(1114),c=r(1631),d=r(6539),h=r(3514),p=r(6160),f=r(4615),m=/^[1-9][0-9]*$/,g=/^-?[1-9][0-9]*$/,y=/^0[x][0-9a-fA-F]+$/,v=/^-?0[x][0-9a-fA-F]+$/,b=/^0[0-7]+$/,_=/^-?0[0-7]+$/,T=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,S=/^[a-zA-Z_][a-zA-Z_0-9]*$/,w=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function E(e,t,r){t instanceof i||(r=t,t=new i),r||(r=E.defaults);var C,I,x,k,N=r.preferTrailingComment||!1,R=n(e,r.alternateCommentMode||!1),A=R.next,O=R.push,D=R.peek,P=R.skip,L=R.cmnt,M=!0,F="proto2",j=t,B=[],U={},V=r.keepCase?function(e){return e}:f.camelCase;function z(){B.forEach(e=>{e._edition=F,Object.keys(U).forEach(t=>{void 0===e.getOption(t)&&e.setOption(t,U[t],!0)})})}function q(e,t,r){var n=E.filename;return r||(E.filename=null),Error("illegal "+(t||"token")+" '"+e+"' ("+(n?n+", ":"")+"line "+R.line+")")}function $(){var e,t=[];do{if('"'!==(e=A())&&"'"!==e)throw q(e);t.push(A()),P(e),e=D()}while('"'===e||"'"===e);return t.join("")}function G(e){var t=A();switch(t){case"'":case'"':return O(t),$();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return K(t,!0)}catch(r){if(e&&w.test(t))return t;throw q(t,"value")}}function W(e,t){do if(t&&('"'===(r=D())||"'"===r)){var r,n,i=$();if(e.push(i),F>=2023)throw q(i,"id")}else try{e.push([n=H(A()),P("to",!0)?H(A()):n])}catch(n){if(t&&w.test(r)&&F>=2023)e.push(r);else throw n}while(P(",",!0));var s={options:void 0};s.setOption=function(e,t){void 0===this.options&&(this.options={}),this.options[e]=t},ee(s,function(e){if("option"===e)el(s,e),P(";");else throw q(e)},function(){eh(s)})}function K(e,t){var r=1;switch("-"===e.charAt(0)&&(r=-1,e=e.substring(1)),e){case"inf":case"INF":case"Inf":return 1/0*r;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(m.test(e))return r*parseInt(e,10);if(y.test(e))return r*parseInt(e,16);if(b.test(e))return r*parseInt(e,8);if(T.test(e))return r*parseFloat(e);throw q(e,"number",t)}function H(e,t){switch(e){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!t&&"-"===e.charAt(0))throw q(e,"id");if(g.test(e))return parseInt(e,10);if(v.test(e))return parseInt(e,16);if(_.test(e))return parseInt(e,8);throw q(e,"id")}function Q(){if(void 0!==I)throw q("package");if(I=A(),!w.test(I))throw q(I,"name");j=j.define(I),P(";")}function Y(){var e,t=D();switch(t){case"weak":e=k||(k=[]),A();break;case"public":A();default:e=x||(x=[])}t=$(),P(";"),e.push(t)}function Z(){if(P("="),(F=$())<2023)throw q(F,"syntax");P(";")}function J(){if(P("="),!["2023"].includes(F=$()))throw q(F,"edition");P(";")}function X(e,t){switch(t){case"option":return el(e,t),P(";"),!0;case"message":return et(e,t),!0;case"enum":return ea(e,t),!0;case"service":return ep(e,t),!0;case"extend":return em(e,t),!0}return!1}function ee(e,t,r){var n,i=R.line;if(e&&("string"!=typeof e.comment&&(e.comment=L()),e.filename=E.filename),P("{",!0)){for(;"}"!==(n=A());)t(n);P(";",!0)}else r&&r(),P(";"),e&&("string"!=typeof e.comment||N)&&(e.comment=L(i)||e.comment)}function et(e,t){if(!S.test(t=A()))throw q(t,"type name");var r=new s(t);ee(r,function(e){if(!X(r,e))switch(e){case"map":ei(r,e);break;case"required":if("proto2"!==F)throw q(e);case"repeated":er(r,e);break;case"optional":if("proto3"===F)er(r,"proto3_optional");else if("proto2"!==F)throw q(e);else er(r,"optional");break;case"oneof":es(r,e);break;case"extensions":W(r.extensions||(r.extensions=[]));break;case"reserved":W(r.reserved||(r.reserved=[]),!0);break;default:if("proto2"===F||!w.test(e))throw q(e);O(e),er(r,"optional")}}),e.add(r),e===j&&B.push(r)}function er(e,t,r){var n=A();if("group"===n){en(e,t);return}for(;n.endsWith(".")||D().startsWith(".");)n+=A();if(!w.test(n))throw q(n,"type");var i=A();if(!S.test(i))throw q(i,"name");i=V(i),P("=");var s=new a(i,H(A()),n,t,r);if(ee(s,function(e){if("option"===e)el(s,e),P(";");else throw q(e)},function(){eh(s)}),"proto3_optional"===t){var o=new l("_"+i);s.setOption("proto3_optional",!0),o.add(s),e.add(o)}else e.add(s);e===j&&B.push(s)}function en(e,t){if(F>=2023)throw q("group");var r=A();if(!S.test(r))throw q(r,"name");var n=f.lcFirst(r);r===n&&(r=f.ucFirst(r)),P("=");var i=H(A()),o=new s(r);o.group=!0;var l=new a(n,i,r,t);l.filename=E.filename,ee(o,function(e){switch(e){case"option":el(o,e),P(";");break;case"required":case"repeated":er(o,e);break;case"optional":"proto3"===F?er(o,"proto3_optional"):er(o,"optional");break;case"message":et(o,e);break;case"enum":ea(o,e);break;case"reserved":W(o.reserved||(o.reserved=[]),!0);break;default:throw q(e)}}),e.add(o).add(l)}function ei(e){P("<");var t=A();if(void 0===p.mapKey[t])throw q(t,"type");P(",");var r=A();if(!w.test(r))throw q(r,"type");P(">");var n=A();if(!S.test(n))throw q(n,"name");P("=");var i=new o(V(n),H(A()),t,r);ee(i,function(e){if("option"===e)el(i,e),P(";");else throw q(e)},function(){eh(i)}),e.add(i)}function es(e,t){if(!S.test(t=A()))throw q(t,"name");var r=new l(V(t));ee(r,function(e){"option"===e?(el(r,e),P(";")):(O(e),er(r,"optional"))}),e.add(r)}function ea(e,t){if(!S.test(t=A()))throw q(t,"name");var r=new u(t);ee(r,function(e){switch(e){case"option":el(r,e),P(";");break;case"reserved":W(r.reserved||(r.reserved=[]),!0),void 0===r.reserved&&(r.reserved=[]);break;default:eo(r,e)}}),e.add(r),e===j&&B.push(r)}function eo(e,t){if(!S.test(t))throw q(t,"name");P("=");var r=H(A(),!0),n={options:void 0};n.getOption=function(e){return this.options[e]},n.setOption=function(e,t){h.prototype.setOption.call(n,e,t)},n.setParsedOption=function(){},ee(n,function(e){if("option"===e)el(n,e),P(";");else throw q(e)},function(){eh(n)}),e.add(t,r,n.comment,n.parsedOptions||n.options)}function el(e,t){var r,n,i=!0;for("option"===t&&(t=A());"="!==t;){if("("===t){var s=A();P(")"),t="("+s+")"}if(i){if(i=!1,t.includes(".")&&!t.includes("(")){var a=t.split(".");r=a[0]+".",t=a[1];continue}r=t}else n=n?n+=t:t;t=A()}var o=eu(e,n?r.concat(n):r);n=n&&"."===n[0]?n.slice(1):n,ed(e,r=r&&"."===r[r.length-1]?r.slice(0,-1):r,o,n)}function eu(e,t){if(P("{",!0)){for(var r={};!P("}",!0);){if(!S.test(C=A()))throw q(C,"name");if(null===C)throw q(C,"end of input");var n,i,s=C;if(P(":",!0),"{"===D())n=eu(e,t+"."+C);else if("["===D()){if(n=[],P("[",!0)){do i=G(!0),n.push(i);while(P(",",!0));P("]"),void 0!==i&&ec(e,t+"."+C,i)}}else n=G(!0),ec(e,t+"."+C,n);var a=r[s];a&&(n=[].concat(a).concat(n)),r[s]=n,P(",",!0),P(";",!0)}return r}var o=G(!0);return ec(e,t,o),o}function ec(e,t,r){if(j===e&&/^features\./.test(t)){U[t]=r;return}e.setOption&&e.setOption(t,r)}function ed(e,t,r,n){e.setParsedOption&&e.setParsedOption(t,r,n)}function eh(e){if(P("[",!0)){do el(e,"option");while(P(",",!0));P("]")}return e}function ep(e,t){if(!S.test(t=A()))throw q(t,"service name");var r=new c(t);ee(r,function(e){if(!X(r,e)){if("rpc"===e)ef(r,e);else throw q(e)}}),e.add(r),e===j&&B.push(r)}function ef(e,t){var r=L(),n=t;if(!S.test(t=A()))throw q(t,"name");var i,s,a,o,l=t;if(P("("),P("stream",!0)&&(s=!0),!w.test(t=A())||(i=t,P(")"),P("returns"),P("("),P("stream",!0)&&(o=!0),!w.test(t=A())))throw q(t);a=t,P(")");var u=new d(l,n,i,a,s,o);u.comment=r,ee(u,function(e){if("option"===e)el(u,e),P(";");else throw q(e)}),e.add(u)}function em(e,t){if(!w.test(t=A()))throw q(t,"reference");var r=t;ee(null,function(t){switch(t){case"required":case"repeated":er(e,t,r);break;case"optional":"proto3"===F?er(e,"proto3_optional",r):er(e,"optional",r);break;default:if("proto2"===F||!w.test(t))throw q(t);O(t),er(e,"optional",r)}})}for(;null!==(C=A());)switch(C){case"package":if(!M)throw q(C);Q();break;case"import":if(!M)throw q(C);Y();break;case"syntax":if(!M)throw q(C);Z();break;case"edition":if(!M)throw q(C);J();break;case"option":el(j,C),P(";",!0);break;default:if(X(j,C)){M=!1;continue}throw q(C)}return z(),E.filename=null,{package:I,imports:x,weakImports:k,root:t}}},2279:(e,t,r)=>{"use strict";e.exports=l;var n,i=r(745),s=i.LongBits,a=i.utf8;function o(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}var u="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new l(e);throw Error("illegal buffer")},c=function(){return i.Buffer?function(e){return(l.create=function(e){return i.Buffer.isBuffer(e)?new n(e):u(e)})(e)}:u};function d(){var e=new s(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw o(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw o(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function h(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw o(this,8);return new s(h(this.buf,this.pos+=4),h(this.buf,this.pos+=4))}l.create=c(),l.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,l.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,o(this,10);return e}}(),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw o(this,4);return h(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw o(this,4);return 0|h(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw o(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw o(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw o(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var n=i.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)},l.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},l.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw o(this,e);this.pos+=e}else do if(this.pos>=this.len)throw o(this);while(128&this.buf[this.pos++]);return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},l._configure=function(e){n=e,l.create=c(),n._configure();var t=i.Long?"toLong":"toNumber";i.merge(l.prototype,{int64:function(){return d.call(this)[t](!1)},uint64:function(){return d.call(this)[t](!0)},sint64:function(){return d.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}},424:(e,t,r)=>{"use strict";e.exports=s;var n=r(2279);(s.prototype=Object.create(n.prototype)).constructor=s;var i=r(745);function s(e){n.call(this,e)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},4343:(e,t,r)=>{"use strict";e.exports=d;var n,i,s,a=r(4943);((d.prototype=Object.create(a.prototype)).constructor=d).className="Root";var o=r(7510),l=r(1114),u=r(2695),c=r(4615);function d(e){a.call(this,"",e),this.deferred=[],this.files=[],this._edition="proto2",this._fullyQualifiedObjects={}}function h(){}d.fromJSON=function(e,t){return t||(t=new d),e.options&&t.setOptions(e.options),t.addJSON(e.nested).resolveAll()},d.prototype.resolvePath=c.path.resolve,d.prototype.fetch=c.fetch,d.prototype.load=function e(t,r,n){"function"==typeof r&&(n=r,r=void 0);var a=this;if(!n)return c.asPromise(e,a,t,r);var o=n===h;function l(e,t){if(n){if(o)throw e;t&&t.resolveAll();var r=n;n=null,r(e,t)}}function u(e){var t=e.lastIndexOf("google/protobuf/");if(t>-1){var r=e.substring(t);if(r in s)return r}return null}function d(e,t){try{if(c.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),c.isString(t)){i.filename=e;var n,s=i(t,a,r),d=0;if(s.imports)for(;d<s.imports.length;++d)(n=u(s.imports[d])||a.resolvePath(e,s.imports[d]))&&p(n);if(s.weakImports)for(d=0;d<s.weakImports.length;++d)(n=u(s.weakImports[d])||a.resolvePath(e,s.weakImports[d]))&&p(n,!0)}else a.setOptions(t.options).addJSON(t.nested)}catch(e){l(e)}o||f||l(null,a)}function p(e,t){if(e=u(e)||e,!(a.files.indexOf(e)>-1)){if(a.files.push(e),e in s){o?d(e,s[e]):(++f,setTimeout(function(){--f,d(e,s[e])}));return}if(o){var r;try{r=c.fs.readFileSync(e).toString("utf8")}catch(e){t||l(e);return}d(e,r)}else++f,a.fetch(e,function(r,i){if(--f,n){if(r){t?f||l(null,a):l(r);return}d(e,i)}})}}var f=0;c.isString(t)&&(t=[t]);for(var m,g=0;g<t.length;++g)(m=a.resolvePath("",t[g]))&&p(m);return o?a.resolveAll():f||l(null,a),a},d.prototype.loadSync=function(e,t){if(!c.isNode)throw Error("not supported");return this.load(e,t,h)},d.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return a.prototype.resolveAll.call(this)};var p=/^[A-Z]/;function f(e,t){var r=t.parent.lookup(t.extend);if(r){var n=new o(t.fullName,t.id,t.type,t.rule,void 0,t.options);return!!r.get(n.name)||(n.declaringField=t,t.extensionField=n,r.add(n),!0)}return!1}d.prototype._handleAdd=function(e){if(e instanceof o)void 0===e.extend||e.extensionField||f(this,e)||this.deferred.push(e);else if(e instanceof l)p.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof u)){if(e instanceof n)for(var t=0;t<this.deferred.length;)f(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);p.test(e.name)&&(e.parent[e.name]=e)}(e instanceof n||e instanceof l||e instanceof o)&&(this._fullyQualifiedObjects[e.fullName]=e)},d.prototype._handleRemove=function(e){if(e instanceof o){if(void 0!==e.extend){if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}}else if(e instanceof l)p.test(e.name)&&delete e.parent[e.name];else if(e instanceof a){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);p.test(e.name)&&delete e.parent[e.name]}delete this._fullyQualifiedObjects[e.fullName]},d._configure=function(e,t,r){n=e,i=t,s=r}},9694:e=>{"use strict";e.exports={}},4774:(e,t,r)=>{"use strict";t.Service=r(3829)},3829:(e,t,r)=>{"use strict";e.exports=i;var n=r(745);function i(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!r}(i.prototype=Object.create(n.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,r,i,s,a){if(!s)throw TypeError("request must be specified");var o=this;if(!a)return n.asPromise(e,o,t,r,i,s);if(!o.rpcImpl){setTimeout(function(){a(Error("already ended"))},0);return}try{return o.rpcImpl(t,r[o.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(e,r){if(e)return o.emit("error",e,t),a(e);if(null===r){o.end(!0);return}if(!(r instanceof i))try{r=i[o.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return o.emit("error",e,t),a(e)}return o.emit("data",r,t),a(null,r)})}catch(e){o.emit("error",e,t),setTimeout(function(){a(e)},0);return}},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},1631:(e,t,r)=>{"use strict";e.exports=o;var n=r(4943);((o.prototype=Object.create(n.prototype)).constructor=o).className="Service";var i=r(6539),s=r(4615),a=r(4774);function o(e,t){n.call(this,e,t),this.methods={},this._methodsArray=null}function l(e){return e._methodsArray=null,e}o.fromJSON=function(e,t){var r=new o(e,t.options);if(t.methods)for(var n=Object.keys(t.methods),s=0;s<n.length;++s)r.add(i.fromJSON(n[s],t.methods[n[s]]));return t.nested&&r.addJSON(t.nested),t.edition&&(r._edition=t.edition),r.comment=t.comment,r._defaultEdition="proto3",r},o.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&!!e.keepComments;return s.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"methods",n.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},Object.defineProperty(o.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=s.toArray(this.methods))}}),o.prototype.get=function(e){return this.methods[e]||n.prototype.get.call(this,e)},o.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;n.prototype.resolve.call(this);for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return this},o.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(e=this._edition||e,n.prototype._resolveFeaturesRecursive.call(this,e),this.methodsArray.forEach(t=>{t._resolveFeaturesRecursive(e)})),this},o.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof i?(this.methods[e.name]=e,e.parent=this,l(this)):n.prototype.add.call(this,e)},o.prototype.remove=function(e){if(e instanceof i){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,l(this)}return n.prototype.remove.call(this,e)},o.prototype.create=function(e,t,r){for(var n,i=new a.Service(e,t,r),o=0;o<this.methodsArray.length;++o){var l=s.lcFirst((n=this._methodsArray[o]).resolve().name).replace(/[^$\w_]/g,"");i[l]=s.codegen(["r","c"],s.isReserved(l)?l+"_":l)("return this.rpcCall(m,q,s,r,c)")({m:n,q:n.resolvedRequestType.ctor,s:n.resolvedResponseType.ctor})}return i}},9867:e=>{"use strict";e.exports=d;var t=/[\s{}=;:[\],'"()<>]/g,r=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,n=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,i=/^ *[*/]+ */,s=/^\s*\*?\/*/,a=/\n/g,o=/\s/,l=/\\(.?)/g,u={0:"\0",r:"\r",n:"\n",t:"	"};function c(e){return e.replace(l,function(e,t){switch(t){case"\\":case"":return t;default:return u[t]||""}})}function d(e,l){e=e.toString();var u=0,d=e.length,h=1,p=0,f={},m=[],g=null;function y(e){return Error("illegal "+e+" (line "+h+")")}function v(){var t="'"===g?n:r;t.lastIndex=u-1;var i=t.exec(e);if(!i)throw y("string");return u=t.lastIndex,E(g),g=null,c(i[1])}function b(t){return e.charAt(t)}function _(t,r,n){var o,u,c={type:e.charAt(t++),lineEmpty:!1,leading:n},d=t-(o=l?2:3);do if(--d<0||"\n"===(u=e.charAt(d))){c.lineEmpty=!0;break}while(" "===u||"	"===u);for(var m=e.substring(t,r).split(a),g=0;g<m.length;++g)m[g]=m[g].replace(l?s:i,"").trim();c.text=m.join("\n").trim(),f[h]=c,p=h}function T(t){var r=S(t),n=e.substring(t,r);return/^\s*\/\//.test(n)}function S(e){for(var t=e;t<d&&"\n"!==b(t);)t++;return t}function w(){if(m.length>0)return m.shift();if(g)return v();var r,n,i,s,a,c=0===u;do{if(u===d)return null;for(r=!1;o.test(i=b(u));)if("\n"===i&&(c=!0,++h),++u===d)return null;if("/"===b(u)){if(++u===d)throw y("comment");if("/"===b(u)){if(l){if(s=u,a=!1,T(u-1)){a=!0;do if((u=S(u))===d||(u++,!c))break;while(T(u))}else u=Math.min(d,S(u)+1);a&&(_(s,u,c),c=!0),h++,r=!0}else{for(a="/"===b(s=u+1);"\n"!==b(++u);)if(u===d)return null;++u,a&&(_(s,u-1,c),c=!0),++h,r=!0}}else{if("*"!==(i=b(u)))return"/";s=u+1,a=l||"*"===b(s);do{if("\n"===i&&++h,++u===d)throw y("comment");n=i,i=b(u)}while("*"!==n||"/"!==i);++u,a&&(_(s,u-2,c),c=!0),r=!0}}}while(r);var p=u;if(t.lastIndex=0,!t.test(b(p++)))for(;p<d&&!t.test(b(p));)++p;var f=e.substring(u,u=p);return('"'===f||"'"===f)&&(g=f),f}function E(e){m.push(e)}function C(){if(!m.length){var e=w();if(null===e)return null;E(e)}return m[0]}function I(e,t){var r=C();if(r===e)return w(),!0;if(!t)throw y("token '"+r+"', '"+e+"' expected");return!1}function x(e){var t,r=null;return void 0===e?(t=f[h-1],delete f[h-1],t&&(l||"*"===t.type||t.lineEmpty)&&(r=t.leading?t.text:null)):(p<e&&C(),t=f[e],delete f[e],t&&!t.lineEmpty&&(l||"/"===t.type)&&(r=t.leading?null:t.text)),r}return Object.defineProperty({next:w,peek:C,push:E,skip:I,cmnt:x},"line",{get:function(){return h}})}d.unescape=c},3839:(e,t,r)=>{"use strict";e.exports=v;var n=r(4943);((v.prototype=Object.create(n.prototype)).constructor=v).className="Type";var i=r(1114),s=r(2695),a=r(7510),o=r(9538),l=r(1631),u=r(2936),c=r(2279),d=r(8458),h=r(4615),p=r(8455),f=r(1526),m=r(1506),g=r(5711),y=r(9579);function v(e,t){n.call(this,e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function b(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(v.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var r=this.fields[e[t]],n=r.id;if(this._fieldsById[n])throw Error("duplicate id "+n+" in "+this);this._fieldsById[n]=r}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=h.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=h.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=v.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof u||((e.prototype=new u).constructor=e,h.merge(e.prototype,t)),e.$type=e.prototype.$type=this,h.merge(e,u,!0),this._ctor=e;for(var r=0;r<this.fieldsArray.length;++r)this._fieldsArray[r].resolve();var n={};for(r=0;r<this.oneofsArray.length;++r)n[this._oneofsArray[r].resolve().name]={get:h.oneOfGetter(this._oneofsArray[r].oneof),set:h.oneOfSetter(this._oneofsArray[r].oneof)};r&&Object.defineProperties(e.prototype,n)}}}),v.generateConstructor=function(e){for(var t,r=h.codegen(["p"],e.name),n=0;n<e.fieldsArray.length;++n)(t=e._fieldsArray[n]).map?r("this%s={}",h.safeProp(t.name)):t.repeated&&r("this%s=[]",h.safeProp(t.name));return r("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},v.fromJSON=function(e,t){var r=new v(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var u=Object.keys(t.fields),c=0;c<u.length;++c)r.add((void 0!==t.fields[u[c]].keyType?o.fromJSON:a.fromJSON)(u[c],t.fields[u[c]]));if(t.oneofs)for(u=Object.keys(t.oneofs),c=0;c<u.length;++c)r.add(s.fromJSON(u[c],t.oneofs[u[c]]));if(t.nested)for(u=Object.keys(t.nested),c=0;c<u.length;++c){var d=t.nested[u[c]];r.add((void 0!==d.id?a.fromJSON:void 0!==d.fields?v.fromJSON:void 0!==d.values?i.fromJSON:void 0!==d.methods?l.fromJSON:n.fromJSON)(u[c],d))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},v.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&!!e.keepComments;return h.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"oneofs",n.arrayToJSON(this.oneofsArray,e),"fields",n.arrayToJSON(this.fieldsArray.filter(function(e){return!e.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},v.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;n.prototype.resolveAll.call(this);var e=this.oneofsArray;for(r=0;r<e.length;)e[r++].resolve();for(var t=this.fieldsArray,r=0;r<t.length;)t[r++].resolve();return this},v.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(e=this._edition||e,n.prototype._resolveFeaturesRecursive.call(this,e),this.oneofsArray.forEach(t=>{t._resolveFeatures(e)}),this.fieldsArray.forEach(t=>{t._resolveFeatures(e)})),this},v.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},v.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof a&&void 0===e.extend){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),b(this)}return e instanceof s?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),b(this)):n.prototype.add.call(this,e)},v.prototype.remove=function(e){if(e instanceof a&&void 0===e.extend){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),b(this)}if(e instanceof s){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),b(this)}return n.prototype.remove.call(this,e)},v.prototype.isReservedId=function(e){return n.isReservedId(this.reserved,e)},v.prototype.isReservedName=function(e){return n.isReservedName(this.reserved,e)},v.prototype.create=function(e){return new this.ctor(e)},v.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=p(this)({Writer:d,types:t,util:h}),this.decode=f(this)({Reader:c,types:t,util:h}),this.verify=m(this)({types:t,util:h}),this.fromObject=g.fromObject(this)({types:t,util:h}),this.toObject=g.toObject(this)({types:t,util:h});var n=y[e];if(n){var i=Object.create(this);i.fromObject=this.fromObject,this.fromObject=n.fromObject.bind(i),i.toObject=this.toObject,this.toObject=n.toObject.bind(i)}return this},v.prototype.encode=function(e,t){return this.setup().encode(e,t)},v.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},v.prototype.decode=function(e,t){return this.setup().decode(e,t)},v.prototype.decodeDelimited=function(e){return e instanceof c||(e=c.create(e)),this.decode(e,e.uint32())},v.prototype.verify=function(e){return this.setup().verify(e)},v.prototype.fromObject=function(e){return this.setup().fromObject(e)},v.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},v.d=function(e){return function(t){h.decorateType(t,e)}}},6160:(e,t,r)=>{"use strict";var n=t,i=r(4615),s=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function a(e,t){var r=0,n={};for(t|=0;r<e.length;)n[s[r+t]]=e[r++];return n}n.basic=a([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),n.defaults=a([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),n.long=a([0,0,0,1,1],7),n.mapKey=a([0,0,0,5,5,0,0,0,1,1,0,2],2),n.packed=a([1,5,0,0,0,5,5,0,0,0,1,1,0])},4615:(e,t,r)=>{"use strict";var n,i,s=e.exports=r(745),a=r(9694);s.codegen=r(696),s.fetch=r(7828),s.path=r(2727),s.fs=s.inquire("fs"),s.toArray=function(e){if(e){for(var t=Object.keys(e),r=Array(t.length),n=0;n<t.length;)r[n]=e[t[n++]];return r}return[]},s.toObject=function(e){for(var t={},r=0;r<e.length;){var n=e[r++],i=e[r++];void 0!==i&&(t[n]=i)}return t};var o=/\\/g,l=/"/g;s.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},s.safeProp=function(e){return!/^[$\w_]+$/.test(e)||s.isReserved(e)?'["'+e.replace(o,"\\\\").replace(l,'\\"')+'"]':"."+e},s.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var u=/_([a-z])/g;s.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(u,function(e,t){return t.toUpperCase()})},s.compareFieldsById=function(e,t){return e.id-t.id},s.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(s.decorateRoot.remove(e.$type),e.$type.name=t,s.decorateRoot.add(e.$type)),e.$type;n||(n=r(3839));var i=new n(t||e.name);return s.decorateRoot.add(i),i.ctor=e,Object.defineProperty(e,"$type",{value:i,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:i,enumerable:!1}),i};var c=0;s.decorateEnum=function(e){if(e.$type)return e.$type;i||(i=r(1114));var t=new i("Enum"+c++,e);return s.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t},s.setProperty=function(e,t,r,n){function i(e,t,r){var s=t.shift();if("__proto__"===s||"prototype"===s)return e;if(t.length>0)e[s]=i(e[s]||{},t,r);else{var a=e[s];if(a&&n)return e;a&&(r=[].concat(a).concat(r)),e[s]=r}return e}if("object"!=typeof e)throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return i(e,t=t.split("."),r)},Object.defineProperty(s,"decorateRoot",{get:function(){return a.decorated||(a.decorated=new(r(4343)))}})},3674:(e,t,r)=>{"use strict";e.exports=i;var n=r(745);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var a=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return s;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new i(r,n)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(n.isString(e)){if(!n.Long)return i.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):s},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var o=String.prototype.charCodeAt;i.fromHash=function(e){return e===a?s:new i((o.call(e,0)|o.call(e,1)<<8|o.call(e,2)<<16|o.call(e,3)<<24)>>>0,(o.call(e,4)|o.call(e,5)<<8|o.call(e,6)<<16|o.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},745:function(e,t,r){"use strict";var n=t;function i(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function s(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),r&&i(this,r)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}n.asPromise=r(1417),n.base64=r(5386),n.EventEmitter=r(3478),n.float=r(5256),n.inquire=r(1374),n.utf8=r(3670),n.pool=r(6733),n.LongBits=r(3674),n.isNode=!!("undefined"!=typeof global&&global&&global.process&&global.process.versions&&global.process.versions.node),n.global=n.isNode&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!!(null!=r&&e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)},n.merge=i,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=s,n.ProtocolError=s("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;if(!e){n._Buffer_from=n._Buffer_allocUnsafe=null;return}n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}}},1506:(e,t,r)=>{"use strict";e.exports=l;var n=r(1114),i=r(4615);function s(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function a(e,t,r,i){if(t.resolvedType){if(t.resolvedType instanceof n){e("switch(%s){",i)("default:")("return%j",s(t,"enum value"));for(var a=Object.keys(t.resolvedType.values),o=0;o<a.length;++o)e("case %i:",t.resolvedType.values[a[o]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",r,i)("if(e)")("return%j+e",t.name+".")("}")}else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",i)("return%j",s(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",s(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',i)("return%j",s(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',i)("return%j",s(t,"boolean"));break;case"string":e("if(!util.isString(%s))",i)("return%j",s(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",s(t,"buffer"))}return e}function o(e,t,r){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",r)("return%j",s(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",r)("return%j",s(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",r)("return%j",s(t,"boolean key"))}return e}function l(e){var t=i.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),r=e.oneofsArray,n={};r.length&&t("var p={}");for(var l=0;l<e.fieldsArray.length;++l){var u=e._fieldsArray[l].resolve(),c="m"+i.safeProp(u.name);if(u.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",c,u.name),u.map)t("if(!util.isObject(%s))",c)("return%j",s(u,"object"))("var k=Object.keys(%s)",c)("for(var i=0;i<k.length;++i){"),o(t,u,"k[i]"),a(t,u,l,c+"[k[i]]")("}");else if(u.repeated)t("if(!Array.isArray(%s))",c)("return%j",s(u,"array"))("for(var i=0;i<%s.length;++i){",c),a(t,u,l,c+"[i]")("}");else{if(u.partOf){var d=i.safeProp(u.partOf.name);1===n[u.partOf.name]&&t("if(p%s===1)",d)("return%j",u.partOf.name+": multiple values"),n[u.partOf.name]=1,t("p%s=1",d)}a(t,u,l,c)}u.optional&&t("}")}return t("return null")}},9579:(e,t,r)=>{"use strict";var n=t,i=r(2936);n[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=e["@type"].substring(e["@type"].lastIndexOf("/")+1),r=this.lookup(t);if(r){var n="."===e["@type"].charAt(0)?e["@type"].slice(1):e["@type"];return -1===n.indexOf("/")&&(n="/"+n),this.create({type_url:n,value:r.encode(r.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){var r="type.googleapis.com/",n="",s="";if(t&&t.json&&e.type_url&&e.value){s=e.type_url.substring(e.type_url.lastIndexOf("/")+1),n=e.type_url.substring(0,e.type_url.lastIndexOf("/")+1);var a=this.lookup(s);a&&(e=a.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof i){var o=e.$type.toObject(e,t),l="."===e.$type.fullName[0]?e.$type.fullName.slice(1):e.$type.fullName;return""===n&&(n=r),s=n+l,o["@type"]=s,o}return this.toObject(e,t)}}},8458:(e,t,r)=>{"use strict";e.exports=d;var n,i=r(745),s=i.LongBits,a=i.base64,o=i.utf8;function l(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function u(){}function c(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function d(){this.len=0,this.head=new l(u,0,0),this.tail=this.head,this.states=null}var h=function(){return i.Buffer?function(){return(d.create=function(){return new n})()}:function(){return new d}};function p(e,t,r){t[r]=255&e}function f(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e}function m(e,t){this.len=e,this.next=void 0,this.val=t}function g(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function y(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}d.create=h(),d.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(d.alloc=i.pool(d.alloc,i.Array.prototype.subarray)),d.prototype._push=function(e,t,r){return this.tail=this.tail.next=new l(e,t,r),this.len+=t,this},m.prototype=Object.create(l.prototype),m.prototype.fn=f,d.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new m((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},d.prototype.int32=function(e){return e<0?this._push(g,10,s.fromNumber(e)):this.uint32(e)},d.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},d.prototype.uint64=function(e){var t=s.from(e);return this._push(g,t.length(),t)},d.prototype.int64=d.prototype.uint64,d.prototype.sint64=function(e){var t=s.from(e).zzEncode();return this._push(g,t.length(),t)},d.prototype.bool=function(e){return this._push(p,1,e?1:0)},d.prototype.fixed32=function(e){return this._push(y,4,e>>>0)},d.prototype.sfixed32=d.prototype.fixed32,d.prototype.fixed64=function(e){var t=s.from(e);return this._push(y,4,t.lo)._push(y,4,t.hi)},d.prototype.sfixed64=d.prototype.fixed64,d.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},d.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var v=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};d.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(i.isString(e)){var r=d.alloc(t=a.length(e));a.decode(e,r,0),e=r}return this.uint32(t)._push(v,t,e)},d.prototype.string=function(e){var t=o.length(e);return t?this.uint32(t)._push(o.write,t,e):this._push(p,1,0)},d.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new l(u,0,0),this.len=0,this},d.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(u,0,0),this.len=0),this},d.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},d.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},d._configure=function(e){n=e,d.create=h(),n._configure()}},8386:(e,t,r)=>{"use strict";e.exports=s;var n=r(8458);(s.prototype=Object.create(n.prototype)).constructor=s;var i=r(745);function s(){n.call(this)}function a(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},s.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(a,t,e),this},s._configure()},1357:(e,t,r)=>{"use strict";let n,i,s;r.r(t),r.d(t,{default:()=>CT});var a,o,l,u,c,d,h,p,f,m,g,y=r(326),v=r(434),b=r(7577),_=e=>"checkbox"===e.type,T=e=>e instanceof Date,S=e=>null==e;let w=e=>"object"==typeof e;var E=e=>!S(e)&&!Array.isArray(e)&&w(e)&&!T(e),C=e=>E(e)&&e.target?_(e.target)?e.target.checked:e.target.value:e,I=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,x=(e,t)=>e.has(I(t)),k=e=>{let t=e.constructor&&e.constructor.prototype;return E(t)&&t.hasOwnProperty("isPrototypeOf")},N="undefined"!=typeof window&&void 0!==window.HTMLElement&&"undefined"!=typeof document;function R(e){let t;let r=Array.isArray(e),n="undefined"!=typeof FileList&&e instanceof FileList;if(e instanceof Date)t=new Date(e);else if(!(!(N&&(e instanceof Blob||n))&&(r||E(e))))return e;else if(t=r?[]:Object.create(Object.getPrototypeOf(e)),r||k(e))for(let r in e)e.hasOwnProperty(r)&&(t[r]=R(e[r]));else t=e;return t}var A=e=>/^\w*$/.test(e),O=e=>void 0===e,D=e=>Array.isArray(e)?e.filter(Boolean):[],P=e=>D(e.replace(/["|']|\]/g,"").split(/\.|\[/)),L=(e,t,r)=>{if(!t||!E(e))return r;let n=(A(t)?[t]:P(t)).reduce((e,t)=>S(e)?e:e[t],e);return O(n)||n===e?O(e[t])?r:e[t]:n},M=e=>"boolean"==typeof e,F=(e,t,r)=>{let n=-1,i=A(t)?[t]:P(t),s=i.length,a=s-1;for(;++n<s;){let t=i[n],s=r;if(n!==a){let r=e[t];s=E(r)||Array.isArray(r)?r:isNaN(+i[n+1])?{}:[]}if("__proto__"===t||"constructor"===t||"prototype"===t)return;e[t]=s,e=e[t]}};let j={BLUR:"blur",FOCUS_OUT:"focusout"},B={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},U={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},V=b.createContext(null);V.displayName="HookFormContext";let z=()=>b.useContext(V);var q=(e,t,r,n=!0)=>{let i={defaultValues:t._defaultValues};for(let s in e)Object.defineProperty(i,s,{get:()=>{let i=s;return t._proxyFormState[i]!==B.all&&(t._proxyFormState[i]=!n||B.all),r&&(r[i]=!0),e[i]}});return i};let $="undefined"!=typeof window?b.useLayoutEffect:b.useEffect;var G=e=>"string"==typeof e,W=(e,t,r,n,i)=>G(e)?(n&&t.watch.add(e),L(r,e,i)):Array.isArray(e)?e.map(e=>(n&&t.watch.add(e),L(r,e))):(n&&(t.watchAll=!0),r),K=e=>S(e)||!w(e);function H(e,t,r=new WeakSet){if(K(e)||K(t))return e===t;if(T(e)&&T(t))return e.getTime()===t.getTime();let n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;if(r.has(e)||r.has(t))return!0;for(let s of(r.add(e),r.add(t),n)){let n=e[s];if(!i.includes(s))return!1;if("ref"!==s){let e=t[s];if(T(n)&&T(e)||E(n)&&E(e)||Array.isArray(n)&&Array.isArray(e)?!H(n,e,r):n!==e)return!1}}return!0}var Q=(e,t,r,n,i)=>t?{...r[e],types:{...r[e]&&r[e].types?r[e].types:{},[n]:i||!0}}:{},Y=e=>Array.isArray(e)?e:[e],Z=()=>{let e=[];return{get observers(){return e},next:t=>{for(let r of e)r.next&&r.next(t)},subscribe:t=>(e.push(t),{unsubscribe:()=>{e=e.filter(e=>e!==t)}}),unsubscribe:()=>{e=[]}}},J=e=>E(e)&&!Object.keys(e).length,X=e=>"file"===e.type,ee=e=>"function"==typeof e,et=e=>{if(!N)return!1;let t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},er=e=>"select-multiple"===e.type,en=e=>"radio"===e.type,ei=e=>en(e)||_(e),es=e=>et(e)&&e.isConnected;function ea(e,t){let r=t.slice(0,-1).length,n=0;for(;n<r;)e=O(e)?n++:e[t[n++]];return e}function eo(e){for(let t in e)if(e.hasOwnProperty(t)&&!O(e[t]))return!1;return!0}function el(e,t){let r=Array.isArray(t)?t:A(t)?[t]:P(t),n=1===r.length?e:ea(e,r),i=r.length-1,s=r[i];return n&&delete n[s],0!==i&&(E(n)&&J(n)||Array.isArray(n)&&eo(n))&&el(e,r.slice(0,-1)),e}var eu=e=>{for(let t in e)if(ee(e[t]))return!0;return!1};function ec(e,t={}){let r=Array.isArray(e);if(E(e)||r)for(let r in e)Array.isArray(e[r])||E(e[r])&&!eu(e[r])?(t[r]=Array.isArray(e[r])?[]:{},ec(e[r],t[r])):S(e[r])||(t[r]=!0);return t}function ed(e,t,r){let n=Array.isArray(e);if(E(e)||n)for(let n in e)Array.isArray(e[n])||E(e[n])&&!eu(e[n])?O(t)||K(r[n])?r[n]=Array.isArray(e[n])?ec(e[n],[]):{...ec(e[n])}:ed(e[n],S(t)?{}:t[n],r[n]):r[n]=!H(e[n],t[n]);return r}var eh=(e,t)=>ed(e,t,ec(t));let ep={value:!1,isValid:!1},ef={value:!0,isValid:!0};var em=e=>{if(Array.isArray(e)){if(e.length>1){let t=e.filter(e=>e&&e.checked&&!e.disabled).map(e=>e.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!O(e[0].attributes.value)?O(e[0].value)||""===e[0].value?ef:{value:e[0].value,isValid:!0}:ef:ep}return ep},eg=(e,{valueAsNumber:t,valueAsDate:r,setValueAs:n})=>O(e)?e:t?""===e?NaN:e?+e:e:r&&G(e)?new Date(e):n?n(e):e;let ey={isValid:!1,value:null};var ev=e=>Array.isArray(e)?e.reduce((e,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:e,ey):ey;function eb(e){let t=e.ref;return X(t)?t.files:en(t)?ev(e.refs).value:er(t)?[...t.selectedOptions].map(({value:e})=>e):_(t)?em(e.refs).value:eg(O(t.value)?e.ref.value:t.value,e)}var e_=(e,t,r,n)=>{let i={};for(let r of e){let e=L(t,r);e&&F(i,r,e._f)}return{criteriaMode:r,names:[...e],fields:i,shouldUseNativeValidation:n}},eT=e=>e instanceof RegExp,eS=e=>O(e)?e:eT(e)?e.source:E(e)?eT(e.value)?e.value.source:e.value:e,ew=e=>({isOnSubmit:!e||e===B.onSubmit,isOnBlur:e===B.onBlur,isOnChange:e===B.onChange,isOnAll:e===B.all,isOnTouch:e===B.onTouched});let eE="AsyncFunction";var eC=e=>!!e&&!!e.validate&&!!(ee(e.validate)&&e.validate.constructor.name===eE||E(e.validate)&&Object.values(e.validate).find(e=>e.constructor.name===eE)),eI=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate),ex=(e,t,r)=>!r&&(t.watchAll||t.watch.has(e)||[...t.watch].some(t=>e.startsWith(t)&&/^\.\w+/.test(e.slice(t.length))));let ek=(e,t,r,n)=>{for(let i of r||Object.keys(e)){let r=L(e,i);if(r){let{_f:e,...s}=r;if(e){if(e.refs&&e.refs[0]&&t(e.refs[0],i)&&!n||e.ref&&t(e.ref,e.name)&&!n)return!0;if(ek(s,t))break}else if(E(s)&&ek(s,t))break}}};function eN(e,t,r){let n=L(e,r);if(n||A(r))return{error:n,name:r};let i=r.split(".");for(;i.length;){let n=i.join("."),s=L(t,n),a=L(e,n);if(s&&!Array.isArray(s)&&r!==n)break;if(a&&a.type)return{name:n,error:a};if(a&&a.root&&a.root.type)return{name:`${n}.root`,error:a.root};i.pop()}return{name:r}}var eR=(e,t,r,n)=>{r(e);let{name:i,...s}=e;return J(s)||Object.keys(s).length>=Object.keys(t).length||Object.keys(s).find(e=>t[e]===(!n||B.all))},eA=(e,t,r)=>!e||!t||e===t||Y(e).some(e=>e&&(r?e===t:e.startsWith(t)||t.startsWith(e))),eO=(e,t,r,n,i)=>!i.isOnAll&&(!r&&i.isOnTouch?!(t||e):(r?n.isOnBlur:i.isOnBlur)?!e:(r?!n.isOnChange:!i.isOnChange)||e),eD=(e,t)=>!D(L(e,t)).length&&el(e,t),eP=(e,t,r)=>{let n=Y(L(e,r));return F(n,"root",t[r]),F(e,r,n),e},eL=e=>G(e);function eM(e,t,r="validate"){if(eL(e)||Array.isArray(e)&&e.every(eL)||M(e)&&!e)return{type:r,message:eL(e)?e:"",ref:t}}var eF=e=>E(e)&&!eT(e)?e:{value:e,message:""},ej=async(e,t,r,n,i,s)=>{let{ref:a,refs:o,required:l,maxLength:u,minLength:c,min:d,max:h,pattern:p,validate:f,name:m,valueAsNumber:g,mount:y}=e._f,v=L(r,m);if(!y||t.has(m))return{};let b=o?o[0]:a,T=e=>{i&&b.reportValidity&&(b.setCustomValidity(M(e)?"":e||""),b.reportValidity())},w={},C=en(a),I=_(a),x=C||I,k=(g||X(a))&&O(a.value)&&O(v)||et(a)&&""===a.value||""===v||Array.isArray(v)&&!v.length,N=Q.bind(null,m,n,w),R=(e,t,r,n=U.maxLength,i=U.minLength)=>{let s=e?t:r;w[m]={type:e?n:i,message:s,ref:a,...N(e?n:i,s)}};if(s?!Array.isArray(v)||!v.length:l&&(!x&&(k||S(v))||M(v)&&!v||I&&!em(o).isValid||C&&!ev(o).isValid)){let{value:e,message:t}=eL(l)?{value:!!l,message:l}:eF(l);if(e&&(w[m]={type:U.required,message:t,ref:b,...N(U.required,t)},!n))return T(t),w}if(!k&&(!S(d)||!S(h))){let e,t;let r=eF(h),i=eF(d);if(S(v)||isNaN(v)){let n=a.valueAsDate||new Date(v),s=e=>new Date(new Date().toDateString()+" "+e),o="time"==a.type,l="week"==a.type;G(r.value)&&v&&(e=o?s(v)>s(r.value):l?v>r.value:n>new Date(r.value)),G(i.value)&&v&&(t=o?s(v)<s(i.value):l?v<i.value:n<new Date(i.value))}else{let n=a.valueAsNumber||(v?+v:v);S(r.value)||(e=n>r.value),S(i.value)||(t=n<i.value)}if((e||t)&&(R(!!e,r.message,i.message,U.max,U.min),!n))return T(w[m].message),w}if((u||c)&&!k&&(G(v)||s&&Array.isArray(v))){let e=eF(u),t=eF(c),r=!S(e.value)&&v.length>+e.value,i=!S(t.value)&&v.length<+t.value;if((r||i)&&(R(r,e.message,t.message),!n))return T(w[m].message),w}if(p&&!k&&G(v)){let{value:e,message:t}=eF(p);if(eT(e)&&!v.match(e)&&(w[m]={type:U.pattern,message:t,ref:a,...N(U.pattern,t)},!n))return T(t),w}if(f){if(ee(f)){let e=eM(await f(v,r),b);if(e&&(w[m]={...e,...N(U.validate,e.message)},!n))return T(e.message),w}else if(E(f)){let e={};for(let t in f){if(!J(e)&&!n)break;let i=eM(await f[t](v,r),b,t);i&&(e={...i,...N(t,i.message)},T(i.message),n&&(w[m]=e))}if(!J(e)&&(w[m]={ref:b,...e},!n))return w}}return T(!0),w};let eB={mode:B.onSubmit,reValidateMode:B.onChange,shouldFocusError:!0};function eU(e={}){let t,r={...eB,...e},n={submitCount:0,isDirty:!1,isReady:!1,isLoading:ee(r.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:r.errors||{},disabled:r.disabled||!1},i={},s=(E(r.defaultValues)||E(r.values))&&R(r.defaultValues||r.values)||{},a=r.shouldUnregister?{}:R(s),o={action:!1,mount:!1,watch:!1},l={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},u=0,c={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},d={...c},h={array:Z(),state:Z()},p=r.criteriaMode===B.all,f=e=>t=>{clearTimeout(u),u=setTimeout(e,t)},m=async e=>{if(!r.disabled&&(c.isValid||d.isValid||e)){let e=r.resolver?J((await k()).errors):await P(i,!0);e!==n.isValid&&h.state.next({isValid:e})}},g=(e,t)=>{!r.disabled&&(c.isValidating||c.validatingFields||d.isValidating||d.validatingFields)&&((e||Array.from(l.mount)).forEach(e=>{e&&(t?F(n.validatingFields,e,t):el(n.validatingFields,e))}),h.state.next({validatingFields:n.validatingFields,isValidating:!J(n.validatingFields)}))},y=(e,t=[],l,u,p=!0,f=!0)=>{if(u&&l&&!r.disabled){if(o.action=!0,f&&Array.isArray(L(i,e))){let t=l(L(i,e),u.argA,u.argB);p&&F(i,e,t)}if(f&&Array.isArray(L(n.errors,e))){let t=l(L(n.errors,e),u.argA,u.argB);p&&F(n.errors,e,t),eD(n.errors,e)}if((c.touchedFields||d.touchedFields)&&f&&Array.isArray(L(n.touchedFields,e))){let t=l(L(n.touchedFields,e),u.argA,u.argB);p&&F(n.touchedFields,e,t)}(c.dirtyFields||d.dirtyFields)&&(n.dirtyFields=eh(s,a)),h.state.next({name:e,isDirty:V(e,t),dirtyFields:n.dirtyFields,errors:n.errors,isValid:n.isValid})}else F(a,e,t)},v=(e,t)=>{F(n.errors,e,t),h.state.next({errors:n.errors})},b=(e,t,r,n)=>{let l=L(i,e);if(l){let i=L(a,e,O(r)?L(s,e):r);O(i)||n&&n.defaultChecked||t?F(a,e,t?i:eb(l._f)):q(e,i),o.mount&&m()}},w=(e,t,i,a,o)=>{let l=!1,u=!1,p={name:e};if(!r.disabled){if(!i||a){(c.isDirty||d.isDirty)&&(u=n.isDirty,n.isDirty=p.isDirty=V(),l=u!==p.isDirty);let r=H(L(s,e),t);u=!!L(n.dirtyFields,e),r?el(n.dirtyFields,e):F(n.dirtyFields,e,!0),p.dirtyFields=n.dirtyFields,l=l||(c.dirtyFields||d.dirtyFields)&&!r!==u}if(i){let t=L(n.touchedFields,e);t||(F(n.touchedFields,e,i),p.touchedFields=n.touchedFields,l=l||(c.touchedFields||d.touchedFields)&&t!==i)}l&&o&&h.state.next(p)}return l?p:{}},I=(e,i,s,a)=>{let o=L(n.errors,e),l=(c.isValid||d.isValid)&&M(i)&&n.isValid!==i;if(r.delayError&&s?(t=f(()=>v(e,s)))(r.delayError):(clearTimeout(u),t=null,s?F(n.errors,e,s):el(n.errors,e)),(s?!H(o,s):o)||!J(a)||l){let t={...a,...l&&M(i)?{isValid:i}:{},errors:n.errors,name:e};n={...n,...t},h.state.next(t)}},k=async e=>{g(e,!0);let t=await r.resolver(a,r.context,e_(e||l.mount,i,r.criteriaMode,r.shouldUseNativeValidation));return g(e),t},A=async e=>{let{errors:t}=await k(e);if(e)for(let r of e){let e=L(t,r);e?F(n.errors,r,e):el(n.errors,r)}else n.errors=t;return t},P=async(e,t,i={valid:!0})=>{for(let s in e){let o=e[s];if(o){let{_f:e,...u}=o;if(e){let u=l.array.has(e.name),d=o._f&&eC(o._f);d&&c.validatingFields&&g([s],!0);let h=await ej(o,l.disabled,a,p,r.shouldUseNativeValidation&&!t,u);if(d&&c.validatingFields&&g([s]),h[e.name]&&(i.valid=!1,t))break;t||(L(h,e.name)?u?eP(n.errors,h,e.name):F(n.errors,e.name,h[e.name]):el(n.errors,e.name))}J(u)||await P(u,t,i)}}return i.valid},U=()=>{for(let e of l.unMount){let t=L(i,e);t&&(t._f.refs?t._f.refs.every(e=>!es(e)):!es(t._f.ref))&&ey(e)}l.unMount=new Set},V=(e,t)=>!r.disabled&&(e&&t&&F(a,e,t),!H(eo(),s)),z=(e,t,r)=>W(e,l,{...o.mount?a:O(t)?s:G(e)?{[e]:t}:t},r,t),q=(e,t,r={})=>{let n=L(i,e),s=t;if(n){let r=n._f;r&&(r.disabled||F(a,e,eg(t,r)),s=et(r.ref)&&S(t)?"":t,er(r.ref)?[...r.ref.options].forEach(e=>e.selected=s.includes(e.value)):r.refs?_(r.ref)?r.refs.forEach(e=>{e.defaultChecked&&e.disabled||(Array.isArray(s)?e.checked=!!s.find(t=>t===e.value):e.checked=s===e.value||!!s)}):r.refs.forEach(e=>e.checked=e.value===s):X(r.ref)?r.ref.value="":(r.ref.value=s,r.ref.type||h.state.next({name:e,values:R(a)})))}(r.shouldDirty||r.shouldTouch)&&w(e,s,r.shouldTouch,r.shouldDirty,!0),r.shouldValidate&&ea(e)},$=(e,t,r)=>{for(let n in t){if(!t.hasOwnProperty(n))return;let s=t[n],a=e+"."+n,o=L(i,a);(l.array.has(e)||E(s)||o&&!o._f)&&!T(s)?$(a,s,r):q(a,s,r)}},K=(e,t,r={})=>{let u=L(i,e),p=l.array.has(e),f=R(t);F(a,e,f),p?(h.array.next({name:e,values:R(a)}),(c.isDirty||c.dirtyFields||d.isDirty||d.dirtyFields)&&r.shouldDirty&&h.state.next({name:e,dirtyFields:eh(s,a),isDirty:V(e,f)})):!u||u._f||S(f)?q(e,f,r):$(e,f,r),ex(e,l)&&h.state.next({...n,name:e}),h.state.next({name:o.mount?e:void 0,values:R(a)})},Q=async e=>{o.mount=!0;let s=e.target,u=s.name,f=!0,y=L(i,u),v=e=>{f=Number.isNaN(e)||T(e)&&isNaN(e.getTime())||H(e,L(a,u,e))},b=ew(r.mode),_=ew(r.reValidateMode);if(y){let o,T;let S=s.type?eb(y._f):C(e),E=e.type===j.BLUR||e.type===j.FOCUS_OUT,x=!eI(y._f)&&!r.resolver&&!L(n.errors,u)&&!y._f.deps||eO(E,L(n.touchedFields,u),n.isSubmitted,_,b),N=ex(u,l,E);F(a,u,S),E?s&&s.readOnly||(y._f.onBlur&&y._f.onBlur(e),t&&t(0)):y._f.onChange&&y._f.onChange(e);let A=w(u,S,E),O=!J(A)||N;if(E||h.state.next({name:u,type:e.type,values:R(a)}),x)return(c.isValid||d.isValid)&&("onBlur"===r.mode?E&&m():E||m()),O&&h.state.next({name:u,...N?{}:A});if(!E&&N&&h.state.next({...n}),r.resolver){let{errors:e}=await k([u]);if(v(S),f){let t=eN(n.errors,i,u),r=eN(e,i,t.name||u);o=r.error,u=r.name,T=J(e)}}else g([u],!0),o=(await ej(y,l.disabled,a,p,r.shouldUseNativeValidation))[u],g([u]),v(S),f&&(o?T=!1:(c.isValid||d.isValid)&&(T=await P(i,!0)));f&&(y._f.deps&&ea(y._f.deps),I(u,T,o,A))}},en=(e,t)=>{if(L(n.errors,t)&&e.focus)return e.focus(),1},ea=async(e,t={})=>{let s,a;let o=Y(e);if(r.resolver){let t=await A(O(e)?e:o);s=J(t),a=e?!o.some(e=>L(t,e)):s}else e?((a=(await Promise.all(o.map(async e=>{let t=L(i,e);return await P(t&&t._f?{[e]:t}:t)}))).every(Boolean))||n.isValid)&&m():a=s=await P(i);return h.state.next({...!G(e)||(c.isValid||d.isValid)&&s!==n.isValid?{}:{name:e},...r.resolver||!e?{isValid:s}:{},errors:n.errors}),t.shouldFocus&&!a&&ek(i,en,e?o:l.mount),a},eo=e=>{let t={...o.mount?a:s};return O(e)?t:G(e)?L(t,e):e.map(e=>L(t,e))},eu=(e,t)=>({invalid:!!L((t||n).errors,e),isDirty:!!L((t||n).dirtyFields,e),error:L((t||n).errors,e),isValidating:!!L(n.validatingFields,e),isTouched:!!L((t||n).touchedFields,e)}),ec=e=>{e&&Y(e).forEach(e=>el(n.errors,e)),h.state.next({errors:e?n.errors:{}})},ed=(e,t,r)=>{let s=(L(i,e,{_f:{}})._f||{}).ref,{ref:a,message:o,type:l,...u}=L(n.errors,e)||{};F(n.errors,e,{...u,...t,ref:s}),h.state.next({name:e,errors:n.errors,isValid:!1}),r&&r.shouldFocus&&s&&s.focus&&s.focus()},ep=(e,t)=>ee(e)?h.state.subscribe({next:r=>"values"in r&&e(z(void 0,t),r)}):z(e,t,!0),ef=e=>h.state.subscribe({next:t=>{eA(e.name,t.name,e.exact)&&eR(t,e.formState||c,ez,e.reRenderRoot)&&e.callback({values:{...a},...n,...t,defaultValues:s})}}).unsubscribe,em=e=>(o.mount=!0,d={...d,...e.formState},ef({...e,formState:d})),ey=(e,t={})=>{for(let o of e?Y(e):l.mount)l.mount.delete(o),l.array.delete(o),t.keepValue||(el(i,o),el(a,o)),t.keepError||el(n.errors,o),t.keepDirty||el(n.dirtyFields,o),t.keepTouched||el(n.touchedFields,o),t.keepIsValidating||el(n.validatingFields,o),r.shouldUnregister||t.keepDefaultValue||el(s,o);h.state.next({values:R(a)}),h.state.next({...n,...t.keepDirty?{isDirty:V()}:{}}),t.keepIsValid||m()},ev=({disabled:e,name:t})=>{(M(e)&&o.mount||e||l.disabled.has(t))&&(e?l.disabled.add(t):l.disabled.delete(t))},eT=(e,t={})=>{let n=L(i,e),a=M(t.disabled)||M(r.disabled);return F(i,e,{...n||{},_f:{...n&&n._f?n._f:{ref:{name:e}},name:e,mount:!0,...t}}),l.mount.add(e),n?ev({disabled:M(t.disabled)?t.disabled:r.disabled,name:e}):b(e,!0,t.value),{...a?{disabled:t.disabled||r.disabled}:{},...r.progressive?{required:!!t.required,min:eS(t.min),max:eS(t.max),minLength:eS(t.minLength),maxLength:eS(t.maxLength),pattern:eS(t.pattern)}:{},name:e,onChange:Q,onBlur:Q,ref:a=>{if(a){eT(e,t),n=L(i,e);let r=O(a.value)&&a.querySelectorAll&&a.querySelectorAll("input,select,textarea")[0]||a,o=ei(r),l=n._f.refs||[];(o?l.find(e=>e===r):r===n._f.ref)||(F(i,e,{_f:{...n._f,...o?{refs:[...l.filter(es),r,...Array.isArray(L(s,e))?[{}]:[]],ref:{type:r.type,name:e}}:{ref:r}}}),b(e,!1,void 0,r))}else(n=L(i,e,{}))._f&&(n._f.mount=!1),(r.shouldUnregister||t.shouldUnregister)&&!(x(l.array,e)&&o.action)&&l.unMount.add(e)}}},eE=()=>r.shouldFocusError&&ek(i,en,l.mount),eL=(e,t)=>async s=>{let o;s&&(s.preventDefault&&s.preventDefault(),s.persist&&s.persist());let u=R(a);if(h.state.next({isSubmitting:!0}),r.resolver){let{errors:e,values:t}=await k();n.errors=e,u=R(t)}else await P(i);if(l.disabled.size)for(let e of l.disabled)el(u,e);if(el(n.errors,"root"),J(n.errors)){h.state.next({errors:{}});try{await e(u,s)}catch(e){o=e}}else t&&await t({...n.errors},s),eE(),setTimeout(eE);if(h.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:J(n.errors)&&!o,submitCount:n.submitCount+1,errors:n.errors}),o)throw o},eM=(e,t={})=>{L(i,e)&&(O(t.defaultValue)?K(e,R(L(s,e))):(K(e,t.defaultValue),F(s,e,R(t.defaultValue))),t.keepTouched||el(n.touchedFields,e),t.keepDirty||(el(n.dirtyFields,e),n.isDirty=t.defaultValue?V(e,R(L(s,e))):V()),!t.keepError&&(el(n.errors,e),c.isValid&&m()),h.state.next({...n}))},eF=(e,t={})=>{let u=e?R(e):s,d=R(u),p=J(e),f=p?s:d;if(t.keepDefaultValues||(s=u),!t.keepValues){if(t.keepDirtyValues)for(let e of Array.from(new Set([...l.mount,...Object.keys(eh(s,a))])))L(n.dirtyFields,e)?F(f,e,L(a,e)):K(e,L(f,e));else{if(N&&O(e))for(let e of l.mount){let t=L(i,e);if(t&&t._f){let e=Array.isArray(t._f.refs)?t._f.refs[0]:t._f.ref;if(et(e)){let t=e.closest("form");if(t){t.reset();break}}}}if(t.keepFieldsRef)for(let e of l.mount)K(e,L(f,e));else i={}}a=r.shouldUnregister?t.keepDefaultValues?R(s):{}:R(f),h.array.next({values:{...f}}),h.state.next({values:{...f}})}l={mount:t.keepDirtyValues?l.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},o.mount=!c.isValid||!!t.keepIsValid||!!t.keepDirtyValues,o.watch=!!r.shouldUnregister,h.state.next({submitCount:t.keepSubmitCount?n.submitCount:0,isDirty:!p&&(t.keepDirty?n.isDirty:!!(t.keepDefaultValues&&!H(e,s))),isSubmitted:!!t.keepIsSubmitted&&n.isSubmitted,dirtyFields:p?{}:t.keepDirtyValues?t.keepDefaultValues&&a?eh(s,a):n.dirtyFields:t.keepDefaultValues&&e?eh(s,e):t.keepDirty?n.dirtyFields:{},touchedFields:t.keepTouched?n.touchedFields:{},errors:t.keepErrors?n.errors:{},isSubmitSuccessful:!!t.keepIsSubmitSuccessful&&n.isSubmitSuccessful,isSubmitting:!1,defaultValues:s})},eU=(e,t)=>eF(ee(e)?e(a):e,t),eV=(e,t={})=>{let r=L(i,e),n=r&&r._f;if(n){let e=n.refs?n.refs[0]:n.ref;e.focus&&(e.focus(),t.shouldSelect&&ee(e.select)&&e.select())}},ez=e=>{n={...n,...e}},eq={control:{register:eT,unregister:ey,getFieldState:eu,handleSubmit:eL,setError:ed,_subscribe:ef,_runSchema:k,_focusError:eE,_getWatch:z,_getDirty:V,_setValid:m,_setFieldArray:y,_setDisabledField:ev,_setErrors:e=>{n.errors=e,h.state.next({errors:n.errors,isValid:!1})},_getFieldArray:e=>D(L(o.mount?a:s,e,r.shouldUnregister?L(s,e,[]):[])),_reset:eF,_resetDefaultValues:()=>ee(r.defaultValues)&&r.defaultValues().then(e=>{eU(e,r.resetOptions),h.state.next({isLoading:!1})}),_removeUnmounted:U,_disableForm:e=>{M(e)&&(h.state.next({disabled:e}),ek(i,(t,r)=>{let n=L(i,r);n&&(t.disabled=n._f.disabled||e,Array.isArray(n._f.refs)&&n._f.refs.forEach(t=>{t.disabled=n._f.disabled||e}))},0,!1))},_subjects:h,_proxyFormState:c,get _fields(){return i},get _formValues(){return a},get _state(){return o},set _state(value){o=value},get _defaultValues(){return s},get _names(){return l},set _names(value){l=value},get _formState(){return n},get _options(){return r},set _options(value){r={...r,...value}}},subscribe:em,trigger:ea,register:eT,handleSubmit:eL,watch:ep,setValue:K,getValues:eo,reset:eU,resetField:eM,clearErrors:ec,unregister:ey,setError:ed,setFocus:eV,getFieldState:eu};return{...eq,formControl:eq}}var eV=()=>{if("undefined"!=typeof crypto&&crypto.randomUUID)return crypto.randomUUID();let e="undefined"==typeof performance?Date.now():1e3*performance.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let r=(16*Math.random()+e)%16|0;return("x"==t?r:3&r|8).toString(16)})},ez=(e,t,r={})=>r.shouldFocus||O(r.shouldFocus)?r.focusName||`${e}.${O(r.focusIndex)?t:r.focusIndex}.`:"",eq=(e,t)=>[...e,...Y(t)],e$=e=>Array.isArray(e)?e.map(()=>void 0):void 0;function eG(e,t,r){return[...e.slice(0,t),...Y(r),...e.slice(t)]}var eW=(e,t,r)=>Array.isArray(e)?(O(e[r])&&(e[r]=void 0),e.splice(r,0,e.splice(t,1)[0]),e):[],eK=(e,t)=>[...Y(t),...Y(e)];function eH(e,t){let r=0,n=[...e];for(let e of t)n.splice(e-r,1),r++;return D(n).length?n:[]}var eQ=(e,t)=>O(t)?[]:eH(e,Y(t).sort((e,t)=>e-t)),eY=(e,t,r)=>{[e[t],e[r]]=[e[r],e[t]]},eZ=(e,t,r)=>(e[t]=r,e);function eJ(e){let t=z(),{control:r=t.control,name:n,keyName:i="id",shouldUnregister:s,rules:a}=e,[o,l]=b.useState(r._getFieldArray(n)),u=b.useRef(r._getFieldArray(n).map(eV)),c=b.useRef(o),d=b.useRef(!1);c.current=o,r._names.array.add(n),b.useMemo(()=>a&&r.register(n,a),[r,a,n]),$(()=>r._subjects.array.subscribe({next:({values:e,name:t})=>{if(t===n||!t){let t=L(e,n);Array.isArray(t)&&(l(t),u.current=t.map(eV))}}}).unsubscribe,[r,n]);let h=b.useCallback(e=>{d.current=!0,r._setFieldArray(n,e)},[r,n]),p=(e,t)=>{let i=Y(R(e)),s=eq(r._getFieldArray(n),i);r._names.focus=ez(n,s.length-1,t),u.current=eq(u.current,i.map(eV)),h(s),l(s),r._setFieldArray(n,s,eq,{argA:e$(e)})},f=(e,t)=>{let i=Y(R(e)),s=eK(r._getFieldArray(n),i);r._names.focus=ez(n,0,t),u.current=eK(u.current,i.map(eV)),h(s),l(s),r._setFieldArray(n,s,eK,{argA:e$(e)})},m=e=>{let t=eQ(r._getFieldArray(n),e);u.current=eQ(u.current,e),h(t),l(t),Array.isArray(L(r._fields,n))||F(r._fields,n,void 0),r._setFieldArray(n,t,eQ,{argA:e})},g=(e,t,i)=>{let s=Y(R(t)),a=eG(r._getFieldArray(n),e,s);r._names.focus=ez(n,e,i),u.current=eG(u.current,e,s.map(eV)),h(a),l(a),r._setFieldArray(n,a,eG,{argA:e,argB:e$(t)})},y=(e,t)=>{let i=r._getFieldArray(n);eY(i,e,t),eY(u.current,e,t),h(i),l(i),r._setFieldArray(n,i,eY,{argA:e,argB:t},!1)},v=(e,t)=>{let i=r._getFieldArray(n);eW(i,e,t),eW(u.current,e,t),h(i),l(i),r._setFieldArray(n,i,eW,{argA:e,argB:t},!1)},_=(e,t)=>{let i=R(t),s=eZ(r._getFieldArray(n),e,i);u.current=[...s].map((t,r)=>t&&r!==e?u.current[r]:eV()),h(s),l([...s]),r._setFieldArray(n,s,eZ,{argA:e,argB:i},!0,!1)},T=e=>{let t=Y(R(e));u.current=t.map(eV),h([...t]),l([...t]),r._setFieldArray(n,[...t],e=>e,{},!0,!1)};return b.useEffect(()=>{if(r._state.action=!1,ex(n,r._names)&&r._subjects.state.next({...r._formState}),d.current&&(!ew(r._options.mode).isOnSubmit||r._formState.isSubmitted)&&!ew(r._options.reValidateMode).isOnSubmit){if(r._options.resolver)r._runSchema([n]).then(e=>{let t=L(e.errors,n),i=L(r._formState.errors,n);(i?!t&&i.type||t&&(i.type!==t.type||i.message!==t.message):t&&t.type)&&(t?F(r._formState.errors,n,t):el(r._formState.errors,n),r._subjects.state.next({errors:r._formState.errors}))});else{let e=L(r._fields,n);e&&e._f&&!(ew(r._options.reValidateMode).isOnSubmit&&ew(r._options.mode).isOnSubmit)&&ej(e,r._names.disabled,r._formValues,r._options.criteriaMode===B.all,r._options.shouldUseNativeValidation,!0).then(e=>!J(e)&&r._subjects.state.next({errors:eP(r._formState.errors,e,n)}))}}r._subjects.state.next({name:n,values:R(r._formValues)}),r._names.focus&&ek(r._fields,(e,t)=>{if(r._names.focus&&t.startsWith(r._names.focus)&&e.focus)return e.focus(),1}),r._names.focus="",r._setValid(),d.current=!1},[o,n,r]),b.useEffect(()=>(L(r._formValues,n)||r._setFieldArray(n),()=>{let e=(e,t)=>{let n=L(r._fields,e);n&&n._f&&(n._f.mount=t)};r._options.shouldUnregister||s?r.unregister(n):e(n,!1)}),[n,r,i,s]),{swap:b.useCallback(y,[h,n,r]),move:b.useCallback(v,[h,n,r]),prepend:b.useCallback(f,[h,n,r]),append:b.useCallback(p,[h,n,r]),remove:b.useCallback(m,[h,n,r]),insert:b.useCallback(g,[h,n,r]),update:b.useCallback(_,[h,n,r]),replace:b.useCallback(T,[h,n,r]),fields:b.useMemo(()=>o.map((e,t)=>({...e,[i]:u.current[t]||eV()})),[o,i])}}function eX(e={}){let t=b.useRef(void 0),r=b.useRef(void 0),[n,i]=b.useState({isDirty:!1,isValidating:!1,isLoading:ee(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,isReady:!1,defaultValues:ee(e.defaultValues)?void 0:e.defaultValues});if(!t.current){if(e.formControl)t.current={...e.formControl,formState:n},e.defaultValues&&!ee(e.defaultValues)&&e.formControl.reset(e.defaultValues,e.resetOptions);else{let{formControl:r,...i}=eU(e);t.current={...i,formState:n}}}let s=t.current.control;return s._options=e,$(()=>{let e=s._subscribe({formState:s._proxyFormState,callback:()=>i({...s._formState}),reRenderRoot:!0});return i(e=>({...e,isReady:!0})),s._formState.isReady=!0,e},[s]),b.useEffect(()=>s._disableForm(e.disabled),[s,e.disabled]),b.useEffect(()=>{e.mode&&(s._options.mode=e.mode),e.reValidateMode&&(s._options.reValidateMode=e.reValidateMode)},[s,e.mode,e.reValidateMode]),b.useEffect(()=>{e.errors&&(s._setErrors(e.errors),s._focusError())},[s,e.errors]),b.useEffect(()=>{e.shouldUnregister&&s._subjects.state.next({values:s._getWatch()})},[s,e.shouldUnregister]),b.useEffect(()=>{if(s._proxyFormState.isDirty){let e=s._getDirty();e!==n.isDirty&&s._subjects.state.next({isDirty:e})}},[s,n.isDirty]),b.useEffect(()=>{e.values&&!H(e.values,r.current)?(s._reset(e.values,{keepFieldsRef:!0,...s._options.resetOptions}),r.current=e.values,i(e=>({...e}))):s._resetDefaultValues()},[s,e.values]),b.useEffect(()=>{s._state.mount||(s._setValid(),s._state.mount=!0),s._state.watch&&(s._state.watch=!1,s._subjects.state.next({...s._formState})),s._removeUnmounted()}),t.current.formState=q(n,s),t.current}let e0=(e,t,r)=>{if(e&&"reportValidity"in e){let n=L(r,t);e.setCustomValidity(n&&n.message||""),e.reportValidity()}},e1=(e,t)=>{for(let r in t.fields){let n=t.fields[r];n&&n.ref&&"reportValidity"in n.ref?e0(n.ref,r,e):n.refs&&n.refs.forEach(t=>e0(t,r,e))}},e2=(e,t)=>{t.shouldUseNativeValidation&&e1(e,t);let r={};for(let n in e){let i=L(t.fields,n),s=Object.assign(e[n]||{},{ref:i&&i.ref});if(e4(t.names||Object.keys(e),n)){let e=Object.assign({},L(r,n));F(e,"root",s),F(r,n,e)}else F(r,n,s)}return r},e4=(e,t)=>e.some(e=>e.startsWith(t+"."));var e3=function(e,t){for(var r={};e.length;){var n=e[0],i=n.code,s=n.message,a=n.path.join(".");if(!r[a]){if("unionErrors"in n){var o=n.unionErrors[0].errors[0];r[a]={message:o.message,type:o.code}}else r[a]={message:s,type:i}}if("unionErrors"in n&&n.unionErrors.forEach(function(t){return t.errors.forEach(function(t){return e.push(t)})}),t){var l=r[a].types,u=l&&l[n.code];r[a]=Q(a,t,r,i,u?[].concat(u,n.message):n.message)}e.shift()}return r},e6=function(e,t,r){return void 0===r&&(r={}),function(n,i,s){try{return Promise.resolve(function(i,a){try{var o=Promise.resolve(e["sync"===r.mode?"parse":"parseAsync"](n,t)).then(function(e){return s.shouldUseNativeValidation&&e1({},s),{errors:{},values:r.raw?n:e}})}catch(e){return a(e)}return o&&o.then?o.then(void 0,a):o}(0,function(e){if(function(e){return Array.isArray(null==e?void 0:e.errors)}(e))return{values:{},errors:e2(e3(e.errors,!s.shouldUseNativeValidation&&"all"===s.criteriaMode),s)};throw e}))}catch(e){return Promise.reject(e)}}};(function(e){function t(e){}function r(e){throw Error()}function n(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)}e.assertEqual=e=>{},e.assertIs=t,e.assertNever=r,e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),n={};for(let e of r)n[e]=t[e];return e.objectValues(n)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=n,e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t})(a||(a={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(o||(o={}));let e5=a.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),e9=e=>{switch(typeof e){case"undefined":return e5.undefined;case"string":return e5.string;case"number":return Number.isNaN(e)?e5.nan:e5.number;case"boolean":return e5.boolean;case"function":return e5.function;case"bigint":return e5.bigint;case"symbol":return e5.symbol;case"object":if(Array.isArray(e))return e5.array;if(null===e)return e5.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return e5.promise;if("undefined"!=typeof Map&&e instanceof Map)return e5.map;if("undefined"!=typeof Set&&e instanceof Set)return e5.set;if("undefined"!=typeof Date&&e instanceof Date)return e5.date;return e5.object;default:return e5.unknown}},e7=a.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class e8 extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},n=e=>{for(let i of e.issues)if("invalid_union"===i.code)i.unionErrors.map(n);else if("invalid_return_type"===i.code)n(i.returnTypeError);else if("invalid_arguments"===i.code)n(i.argumentsError);else if(0===i.path.length)r._errors.push(t(i));else{let e=r,n=0;for(;n<i.path.length;){let r=i.path[n];n===i.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(i))):e[r]=e[r]||{_errors:[]},e=e[r],n++}}};return n(this),r}static assert(e){if(!(e instanceof e8))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,a.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let n of this.issues)if(n.path.length>0){let r=n.path[0];t[r]=t[r]||[],t[r].push(e(n))}else r.push(e(n));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}e8.create=e=>new e8(e);let te=(e,t)=>{let r;switch(e.code){case e7.invalid_type:r=e.received===e5.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case e7.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,a.jsonStringifyReplacer)}`;break;case e7.unrecognized_keys:r=`Unrecognized key(s) in object: ${a.joinValues(e.keys,", ")}`;break;case e7.invalid_union:r="Invalid input";break;case e7.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${a.joinValues(e.options)}`;break;case e7.invalid_enum_value:r=`Invalid enum value. Expected ${a.joinValues(e.options)}, received '${e.received}'`;break;case e7.invalid_arguments:r="Invalid function arguments";break;case e7.invalid_return_type:r="Invalid function return type";break;case e7.invalid_date:r="Invalid date";break;case e7.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:a.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case e7.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case e7.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case e7.custom:r="Invalid input";break;case e7.invalid_intersection_types:r="Intersection results could not be merged";break;case e7.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case e7.not_finite:r="Number must be finite";break;default:r=t.defaultError,a.assertNever(e)}return{message:r}},tt=te;function tr(){return tt}!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:e?.message}(l||(l={}));let tn=e=>{let{data:t,path:r,errorMaps:n,issueData:i}=e,s=[...r,...i.path||[]],a={...i,path:s};if(void 0!==i.message)return{...i,path:s,message:i.message};let o="";for(let e of n.filter(e=>!!e).slice().reverse())o=e(a,{data:t,defaultError:o}).message;return{...i,path:s,message:o}};function ti(e,t){let r=tr(),n=tn({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===te?void 0:te].filter(e=>!!e)});e.common.issues.push(n)}class ts{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let n of t){if("aborted"===n.status)return ta;"dirty"===n.status&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,n=await e.value;r.push({key:t,value:n})}return ts.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let n of t){let{key:t,value:i}=n;if("aborted"===t.status||"aborted"===i.status)return ta;"dirty"===t.status&&e.dirty(),"dirty"===i.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==i.value||n.alwaysSet)&&(r[t.value]=i.value)}return{status:e.value,value:r}}}let ta=Object.freeze({status:"aborted"}),to=e=>({status:"dirty",value:e}),tl=e=>({status:"valid",value:e}),tu=e=>"aborted"===e.status,tc=e=>"dirty"===e.status,td=e=>"valid"===e.status,th=e=>"undefined"!=typeof Promise&&e instanceof Promise;class tp{constructor(e,t,r,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=n}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let tf=(e,t)=>{if(td(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new e8(e.common.issues);return this._error=t,this._error}}};function tm(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:n,description:i}=e;if(t&&(r||n))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:i}:{errorMap:(t,i)=>{let{message:s}=e;return"invalid_enum_value"===t.code?{message:s??i.defaultError}:void 0===i.data?{message:s??n??i.defaultError}:"invalid_type"!==t.code?{message:i.defaultError}:{message:s??r??i.defaultError}},description:i}}class tg{get description(){return this._def.description}_getType(e){return e9(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:e9(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ts,ctx:{common:e.parent.common,data:e.data,parsedType:e9(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(th(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){let r={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:e9(e)},n=this._parseSync({data:e,path:r.path,parent:r});return tf(r,n)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:e9(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:t});return td(r)?{value:r.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>td(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:e9(e)},n=this._parse({data:e,path:r.path,parent:r});return tf(r,await (th(n)?n:Promise.resolve(n)))}refine(e,t){let r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,n)=>{let i=e(t),s=()=>n.addIssue({code:e7.custom,...r(t)});return"undefined"!=typeof Promise&&i instanceof Promise?i.then(e=>!!e||(s(),!1)):!!i||(s(),!1)})}refinement(e,t){return this._refinement((r,n)=>!!e(r)||(n.addIssue("function"==typeof t?t(r,n):t),!1))}_refinement(e){return new rl({schema:this,typeName:u.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return ru.create(this,this._def)}nullable(){return rc.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return tX.create(this)}promise(){return ro.create(this,this._def)}or(e){return t2.create([this,e],this._def)}and(e){return t5.create(this,e,this._def)}transform(e){return new rl({...tm(this._def),schema:this,typeName:u.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t="function"==typeof e?e:()=>e;return new rd({...tm(this._def),innerType:this,defaultValue:t,typeName:u.ZodDefault})}brand(){return new rf({typeName:u.ZodBranded,type:this,...tm(this._def)})}catch(e){let t="function"==typeof e?e:()=>e;return new rh({...tm(this._def),innerType:this,catchValue:t,typeName:u.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return rm.create(this,e)}readonly(){return rg.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let ty=/^c[^\s-]{8,}$/i,tv=/^[0-9a-z]+$/,tb=/^[0-9A-HJKMNP-TV-Z]{26}$/i,t_=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,tT=/^[a-z0-9_-]{21}$/i,tS=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,tw=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,tE=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,tC="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",tI=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,tx=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,tk=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,tN=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,tR=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,tA=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,tO="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",tD=RegExp(`^${tO}$`);function tP(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function tL(e){return RegExp(`^${tP(e)}$`)}function tM(e){let t=`${tO}T${tP(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}function tF(e,t){return!!(("v4"===t||!t)&&tI.test(e)||("v6"===t||!t)&&tk.test(e))}function tj(e,t){if(!tS.test(e))return!1;try{let[r]=e.split(".");if(!r)return!1;let n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));if("object"!=typeof i||null===i||"typ"in i&&i?.typ!=="JWT"||!i.alg||t&&i.alg!==t)return!1;return!0}catch{return!1}}function tB(e,t){return!!(("v4"===t||!t)&&tx.test(e)||("v6"===t||!t)&&tN.test(e))}class tU extends tg{_parse(e){let t;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==e5.string){let t=this._getOrReturnCtx(e);return ti(t,{code:e7.invalid_type,expected:e5.string,received:t.parsedType}),ta}let r=new ts;for(let i of this._def.checks)if("min"===i.kind)e.data.length<i.value&&(ti(t=this._getOrReturnCtx(e,t),{code:e7.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if("max"===i.kind)e.data.length>i.value&&(ti(t=this._getOrReturnCtx(e,t),{code:e7.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if("length"===i.kind){let n=e.data.length>i.value,s=e.data.length<i.value;(n||s)&&(t=this._getOrReturnCtx(e,t),n?ti(t,{code:e7.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):s&&ti(t,{code:e7.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if("email"===i.kind)tE.test(e.data)||(ti(t=this._getOrReturnCtx(e,t),{validation:"email",code:e7.invalid_string,message:i.message}),r.dirty());else if("emoji"===i.kind)n||(n=RegExp(tC,"u")),n.test(e.data)||(ti(t=this._getOrReturnCtx(e,t),{validation:"emoji",code:e7.invalid_string,message:i.message}),r.dirty());else if("uuid"===i.kind)t_.test(e.data)||(ti(t=this._getOrReturnCtx(e,t),{validation:"uuid",code:e7.invalid_string,message:i.message}),r.dirty());else if("nanoid"===i.kind)tT.test(e.data)||(ti(t=this._getOrReturnCtx(e,t),{validation:"nanoid",code:e7.invalid_string,message:i.message}),r.dirty());else if("cuid"===i.kind)ty.test(e.data)||(ti(t=this._getOrReturnCtx(e,t),{validation:"cuid",code:e7.invalid_string,message:i.message}),r.dirty());else if("cuid2"===i.kind)tv.test(e.data)||(ti(t=this._getOrReturnCtx(e,t),{validation:"cuid2",code:e7.invalid_string,message:i.message}),r.dirty());else if("ulid"===i.kind)tb.test(e.data)||(ti(t=this._getOrReturnCtx(e,t),{validation:"ulid",code:e7.invalid_string,message:i.message}),r.dirty());else if("url"===i.kind)try{new URL(e.data)}catch{ti(t=this._getOrReturnCtx(e,t),{validation:"url",code:e7.invalid_string,message:i.message}),r.dirty()}else"regex"===i.kind?(i.regex.lastIndex=0,i.regex.test(e.data)||(ti(t=this._getOrReturnCtx(e,t),{validation:"regex",code:e7.invalid_string,message:i.message}),r.dirty())):"trim"===i.kind?e.data=e.data.trim():"includes"===i.kind?e.data.includes(i.value,i.position)||(ti(t=this._getOrReturnCtx(e,t),{code:e7.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):"toLowerCase"===i.kind?e.data=e.data.toLowerCase():"toUpperCase"===i.kind?e.data=e.data.toUpperCase():"startsWith"===i.kind?e.data.startsWith(i.value)||(ti(t=this._getOrReturnCtx(e,t),{code:e7.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):"endsWith"===i.kind?e.data.endsWith(i.value)||(ti(t=this._getOrReturnCtx(e,t),{code:e7.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):"datetime"===i.kind?tM(i).test(e.data)||(ti(t=this._getOrReturnCtx(e,t),{code:e7.invalid_string,validation:"datetime",message:i.message}),r.dirty()):"date"===i.kind?tD.test(e.data)||(ti(t=this._getOrReturnCtx(e,t),{code:e7.invalid_string,validation:"date",message:i.message}),r.dirty()):"time"===i.kind?tL(i).test(e.data)||(ti(t=this._getOrReturnCtx(e,t),{code:e7.invalid_string,validation:"time",message:i.message}),r.dirty()):"duration"===i.kind?tw.test(e.data)||(ti(t=this._getOrReturnCtx(e,t),{validation:"duration",code:e7.invalid_string,message:i.message}),r.dirty()):"ip"===i.kind?tF(e.data,i.version)||(ti(t=this._getOrReturnCtx(e,t),{validation:"ip",code:e7.invalid_string,message:i.message}),r.dirty()):"jwt"===i.kind?tj(e.data,i.alg)||(ti(t=this._getOrReturnCtx(e,t),{validation:"jwt",code:e7.invalid_string,message:i.message}),r.dirty()):"cidr"===i.kind?tB(e.data,i.version)||(ti(t=this._getOrReturnCtx(e,t),{validation:"cidr",code:e7.invalid_string,message:i.message}),r.dirty()):"base64"===i.kind?tR.test(e.data)||(ti(t=this._getOrReturnCtx(e,t),{validation:"base64",code:e7.invalid_string,message:i.message}),r.dirty()):"base64url"===i.kind?tA.test(e.data)||(ti(t=this._getOrReturnCtx(e,t),{validation:"base64url",code:e7.invalid_string,message:i.message}),r.dirty()):a.assertNever(i);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:e7.invalid_string,...l.errToObj(r)})}_addCheck(e){return new tU({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...l.errToObj(e)})}url(e){return this._addCheck({kind:"url",...l.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...l.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...l.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...l.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...l.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...l.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...l.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...l.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...l.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...l.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...l.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...l.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...l.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...l.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...l.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...l.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...l.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...l.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...l.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...l.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...l.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...l.errToObj(t)})}nonempty(e){return this.min(1,l.errToObj(e))}trim(){return new tU({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new tU({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new tU({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function tV(e,t){let r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,i=r>n?r:n;return Number.parseInt(e.toFixed(i).replace(".",""))%Number.parseInt(t.toFixed(i).replace(".",""))/10**i}tU.create=e=>new tU({checks:[],typeName:u.ZodString,coerce:e?.coerce??!1,...tm(e)});class tz extends tg{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==e5.number){let t=this._getOrReturnCtx(e);return ti(t,{code:e7.invalid_type,expected:e5.number,received:t.parsedType}),ta}let r=new ts;for(let n of this._def.checks)"int"===n.kind?a.isInteger(e.data)||(ti(t=this._getOrReturnCtx(e,t),{code:e7.invalid_type,expected:"integer",received:"float",message:n.message}),r.dirty()):"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(ti(t=this._getOrReturnCtx(e,t),{code:e7.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(ti(t=this._getOrReturnCtx(e,t),{code:e7.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),r.dirty()):"multipleOf"===n.kind?0!==tV(e.data,n.value)&&(ti(t=this._getOrReturnCtx(e,t),{code:e7.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):"finite"===n.kind?Number.isFinite(e.data)||(ti(t=this._getOrReturnCtx(e,t),{code:e7.not_finite,message:n.message}),r.dirty()):a.assertNever(n);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,l.toString(t))}gt(e,t){return this.setLimit("min",e,!1,l.toString(t))}lte(e,t){return this.setLimit("max",e,!0,l.toString(t))}lt(e,t){return this.setLimit("max",e,!1,l.toString(t))}setLimit(e,t,r,n){return new tz({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:l.toString(n)}]})}_addCheck(e){return new tz({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:l.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:l.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:l.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:l.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:l.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:l.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:l.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:l.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:l.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&a.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}tz.create=e=>new tz({checks:[],typeName:u.ZodNumber,coerce:e?.coerce||!1,...tm(e)});class tq extends tg{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==e5.bigint)return this._getInvalidInput(e);let r=new ts;for(let n of this._def.checks)"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(ti(t=this._getOrReturnCtx(e,t),{code:e7.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(ti(t=this._getOrReturnCtx(e,t),{code:e7.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"multipleOf"===n.kind?e.data%n.value!==BigInt(0)&&(ti(t=this._getOrReturnCtx(e,t),{code:e7.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):a.assertNever(n);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return ti(t,{code:e7.invalid_type,expected:e5.bigint,received:t.parsedType}),ta}gte(e,t){return this.setLimit("min",e,!0,l.toString(t))}gt(e,t){return this.setLimit("min",e,!1,l.toString(t))}lte(e,t){return this.setLimit("max",e,!0,l.toString(t))}lt(e,t){return this.setLimit("max",e,!1,l.toString(t))}setLimit(e,t,r,n){return new tq({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:l.toString(n)}]})}_addCheck(e){return new tq({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:l.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:l.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:l.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:l.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:l.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}tq.create=e=>new tq({checks:[],typeName:u.ZodBigInt,coerce:e?.coerce??!1,...tm(e)});class t$ extends tg{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==e5.boolean){let t=this._getOrReturnCtx(e);return ti(t,{code:e7.invalid_type,expected:e5.boolean,received:t.parsedType}),ta}return tl(e.data)}}t$.create=e=>new t$({typeName:u.ZodBoolean,coerce:e?.coerce||!1,...tm(e)});class tG extends tg{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==e5.date){let t=this._getOrReturnCtx(e);return ti(t,{code:e7.invalid_type,expected:e5.date,received:t.parsedType}),ta}if(Number.isNaN(e.data.getTime()))return ti(this._getOrReturnCtx(e),{code:e7.invalid_date}),ta;let r=new ts;for(let n of this._def.checks)"min"===n.kind?e.data.getTime()<n.value&&(ti(t=this._getOrReturnCtx(e,t),{code:e7.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),r.dirty()):"max"===n.kind?e.data.getTime()>n.value&&(ti(t=this._getOrReturnCtx(e,t),{code:e7.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),r.dirty()):a.assertNever(n);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new tG({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:l.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:l.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}tG.create=e=>new tG({checks:[],coerce:e?.coerce||!1,typeName:u.ZodDate,...tm(e)});class tW extends tg{_parse(e){if(this._getType(e)!==e5.symbol){let t=this._getOrReturnCtx(e);return ti(t,{code:e7.invalid_type,expected:e5.symbol,received:t.parsedType}),ta}return tl(e.data)}}tW.create=e=>new tW({typeName:u.ZodSymbol,...tm(e)});class tK extends tg{_parse(e){if(this._getType(e)!==e5.undefined){let t=this._getOrReturnCtx(e);return ti(t,{code:e7.invalid_type,expected:e5.undefined,received:t.parsedType}),ta}return tl(e.data)}}tK.create=e=>new tK({typeName:u.ZodUndefined,...tm(e)});class tH extends tg{_parse(e){if(this._getType(e)!==e5.null){let t=this._getOrReturnCtx(e);return ti(t,{code:e7.invalid_type,expected:e5.null,received:t.parsedType}),ta}return tl(e.data)}}tH.create=e=>new tH({typeName:u.ZodNull,...tm(e)});class tQ extends tg{constructor(){super(...arguments),this._any=!0}_parse(e){return tl(e.data)}}tQ.create=e=>new tQ({typeName:u.ZodAny,...tm(e)});class tY extends tg{constructor(){super(...arguments),this._unknown=!0}_parse(e){return tl(e.data)}}tY.create=e=>new tY({typeName:u.ZodUnknown,...tm(e)});class tZ extends tg{_parse(e){let t=this._getOrReturnCtx(e);return ti(t,{code:e7.invalid_type,expected:e5.never,received:t.parsedType}),ta}}tZ.create=e=>new tZ({typeName:u.ZodNever,...tm(e)});class tJ extends tg{_parse(e){if(this._getType(e)!==e5.undefined){let t=this._getOrReturnCtx(e);return ti(t,{code:e7.invalid_type,expected:e5.void,received:t.parsedType}),ta}return tl(e.data)}}tJ.create=e=>new tJ({typeName:u.ZodVoid,...tm(e)});class tX extends tg{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),n=this._def;if(t.parsedType!==e5.array)return ti(t,{code:e7.invalid_type,expected:e5.array,received:t.parsedType}),ta;if(null!==n.exactLength){let e=t.data.length>n.exactLength.value,i=t.data.length<n.exactLength.value;(e||i)&&(ti(t,{code:e?e7.too_big:e7.too_small,minimum:i?n.exactLength.value:void 0,maximum:e?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(null!==n.minLength&&t.data.length<n.minLength.value&&(ti(t,{code:e7.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dirty()),null!==n.maxLength&&t.data.length>n.maxLength.value&&(ti(t,{code:e7.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>n.type._parseAsync(new tp(t,e,t.path,r)))).then(e=>ts.mergeArray(r,e));let i=[...t.data].map((e,r)=>n.type._parseSync(new tp(t,e,t.path,r)));return ts.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new tX({...this._def,minLength:{value:e,message:l.toString(t)}})}max(e,t){return new tX({...this._def,maxLength:{value:e,message:l.toString(t)}})}length(e,t){return new tX({...this._def,exactLength:{value:e,message:l.toString(t)}})}nonempty(e){return this.min(1,e)}}function t0(e){if(e instanceof t1){let t={};for(let r in e.shape){let n=e.shape[r];t[r]=ru.create(t0(n))}return new t1({...e._def,shape:()=>t})}return e instanceof tX?new tX({...e._def,type:t0(e.element)}):e instanceof ru?ru.create(t0(e.unwrap())):e instanceof rc?rc.create(t0(e.unwrap())):e instanceof t9?t9.create(e.items.map(e=>t0(e))):e}tX.create=(e,t)=>new tX({type:e,minLength:null,maxLength:null,exactLength:null,typeName:u.ZodArray,...tm(t)});class t1 extends tg{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=a.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==e5.object){let t=this._getOrReturnCtx(e);return ti(t,{code:e7.invalid_type,expected:e5.object,received:t.parsedType}),ta}let{status:t,ctx:r}=this._processInputParams(e),{shape:n,keys:i}=this._getCached(),s=[];if(!(this._def.catchall instanceof tZ&&"strip"===this._def.unknownKeys))for(let e in r.data)i.includes(e)||s.push(e);let a=[];for(let e of i){let t=n[e],i=r.data[e];a.push({key:{status:"valid",value:e},value:t._parse(new tp(r,i,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof tZ){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of s)a.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)s.length>0&&(ti(r,{code:e7.unrecognized_keys,keys:s}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of s){let n=r.data[t];a.push({key:{status:"valid",value:t},value:e._parse(new tp(r,n,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of a){let r=await t.key,n=await t.value;e.push({key:r,value:n,alwaysSet:t.alwaysSet})}return e}).then(e=>ts.mergeObjectSync(t,e)):ts.mergeObjectSync(t,a)}get shape(){return this._def.shape()}strict(e){return l.errToObj,new t1({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{let n=this._def.errorMap?.(t,r).message??r.defaultError;return"unrecognized_keys"===t.code?{message:l.errToObj(e).message??n}:{message:n}}}:{}})}strip(){return new t1({...this._def,unknownKeys:"strip"})}passthrough(){return new t1({...this._def,unknownKeys:"passthrough"})}extend(e){return new t1({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t1({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:u.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new t1({...this._def,catchall:e})}pick(e){let t={};for(let r of a.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new t1({...this._def,shape:()=>t})}omit(e){let t={};for(let r of a.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new t1({...this._def,shape:()=>t})}deepPartial(){return t0(this)}partial(e){let t={};for(let r of a.objectKeys(this.shape)){let n=this.shape[r];e&&!e[r]?t[r]=n:t[r]=n.optional()}return new t1({...this._def,shape:()=>t})}required(e){let t={};for(let r of a.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof ru;)e=e._def.innerType;t[r]=e}return new t1({...this._def,shape:()=>t})}keyof(){return ri(a.objectKeys(this.shape))}}t1.create=(e,t)=>new t1({shape:()=>e,unknownKeys:"strip",catchall:tZ.create(),typeName:u.ZodObject,...tm(t)}),t1.strictCreate=(e,t)=>new t1({shape:()=>e,unknownKeys:"strict",catchall:tZ.create(),typeName:u.ZodObject,...tm(t)}),t1.lazycreate=(e,t)=>new t1({shape:e,unknownKeys:"strip",catchall:tZ.create(),typeName:u.ZodObject,...tm(t)});class t2 extends tg{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;function n(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new e8(e.ctx.common.issues));return ti(t,{code:e7.invalid_union,unionErrors:r}),ta}if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(n);{let e;let n=[];for(let i of r){let r={...t,common:{...t.common,issues:[]},parent:null},s=i._parseSync({data:t.data,path:t.path,parent:r});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:r}),r.common.issues.length&&n.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let i=n.map(e=>new e8(e));return ti(t,{code:e7.invalid_union,unionErrors:i}),ta}}get options(){return this._def.options}}t2.create=(e,t)=>new t2({options:e,typeName:u.ZodUnion,...tm(t)});let t4=e=>{if(e instanceof rr)return t4(e.schema);if(e instanceof rl)return t4(e.innerType());if(e instanceof rn)return[e.value];if(e instanceof rs)return e.options;if(e instanceof ra)return a.objectValues(e.enum);if(e instanceof rd)return t4(e._def.innerType);if(e instanceof tK)return[void 0];else if(e instanceof tH)return[null];else if(e instanceof ru)return[void 0,...t4(e.unwrap())];else if(e instanceof rc)return[null,...t4(e.unwrap())];else if(e instanceof rf)return t4(e.unwrap());else if(e instanceof rg)return t4(e.unwrap());else if(e instanceof rh)return t4(e._def.innerType);else return[]};class t3 extends tg{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==e5.object)return ti(t,{code:e7.invalid_type,expected:e5.object,received:t.parsedType}),ta;let r=this.discriminator,n=t.data[r],i=this.optionsMap.get(n);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(ti(t,{code:e7.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),ta)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let n=new Map;for(let r of t){let t=t4(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let i of t){if(n.has(i))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(i)}`);n.set(i,r)}}return new t3({typeName:u.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...tm(r)})}}function t6(e,t){let r=e9(e),n=e9(t);if(e===t)return{valid:!0,data:e};if(r===e5.object&&n===e5.object){let r=a.objectKeys(t),n=a.objectKeys(e).filter(e=>-1!==r.indexOf(e)),i={...e,...t};for(let r of n){let n=t6(e[r],t[r]);if(!n.valid)return{valid:!1};i[r]=n.data}return{valid:!0,data:i}}if(r===e5.array&&n===e5.array){if(e.length!==t.length)return{valid:!1};let r=[];for(let n=0;n<e.length;n++){let i=t6(e[n],t[n]);if(!i.valid)return{valid:!1};r.push(i.data)}return{valid:!0,data:r}}return r===e5.date&&n===e5.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class t5 extends tg{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),n=(e,n)=>{if(tu(e)||tu(n))return ta;let i=t6(e.value,n.value);return i.valid?((tc(e)||tc(n))&&t.dirty(),{status:t.value,value:i.data}):(ti(r,{code:e7.invalid_intersection_types}),ta)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>n(e,t)):n(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}t5.create=(e,t,r)=>new t5({left:e,right:t,typeName:u.ZodIntersection,...tm(r)});class t9 extends tg{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==e5.array)return ti(r,{code:e7.invalid_type,expected:e5.array,received:r.parsedType}),ta;if(r.data.length<this._def.items.length)return ti(r,{code:e7.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ta;!this._def.rest&&r.data.length>this._def.items.length&&(ti(r,{code:e7.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let n=[...r.data].map((e,t)=>{let n=this._def.items[t]||this._def.rest;return n?n._parse(new tp(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(n).then(e=>ts.mergeArray(t,e)):ts.mergeArray(t,n)}get items(){return this._def.items}rest(e){return new t9({...this._def,rest:e})}}t9.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new t9({items:e,typeName:u.ZodTuple,rest:null,...tm(t)})};class t7 extends tg{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==e5.object)return ti(r,{code:e7.invalid_type,expected:e5.object,received:r.parsedType}),ta;let n=[],i=this._def.keyType,s=this._def.valueType;for(let e in r.data)n.push({key:i._parse(new tp(r,e,r.path,e)),value:s._parse(new tp(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?ts.mergeObjectAsync(t,n):ts.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,r){return new t7(t instanceof tg?{keyType:e,valueType:t,typeName:u.ZodRecord,...tm(r)}:{keyType:tU.create(),valueType:e,typeName:u.ZodRecord,...tm(t)})}}class t8 extends tg{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==e5.map)return ti(r,{code:e7.invalid_type,expected:e5.map,received:r.parsedType}),ta;let n=this._def.keyType,i=this._def.valueType,s=[...r.data.entries()].map(([e,t],s)=>({key:n._parse(new tp(r,e,r.path,[s,"key"])),value:i._parse(new tp(r,t,r.path,[s,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of s){let n=await r.key,i=await r.value;if("aborted"===n.status||"aborted"===i.status)return ta;("dirty"===n.status||"dirty"===i.status)&&t.dirty(),e.set(n.value,i.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of s){let n=r.key,i=r.value;if("aborted"===n.status||"aborted"===i.status)return ta;("dirty"===n.status||"dirty"===i.status)&&t.dirty(),e.set(n.value,i.value)}return{status:t.value,value:e}}}}t8.create=(e,t,r)=>new t8({valueType:t,keyType:e,typeName:u.ZodMap,...tm(r)});class re extends tg{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==e5.set)return ti(r,{code:e7.invalid_type,expected:e5.set,received:r.parsedType}),ta;let n=this._def;null!==n.minSize&&r.data.size<n.minSize.value&&(ti(r,{code:e7.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),null!==n.maxSize&&r.data.size>n.maxSize.value&&(ti(r,{code:e7.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());let i=this._def.valueType;function s(e){let r=new Set;for(let n of e){if("aborted"===n.status)return ta;"dirty"===n.status&&t.dirty(),r.add(n.value)}return{status:t.value,value:r}}let a=[...r.data.values()].map((e,t)=>i._parse(new tp(r,e,r.path,t)));return r.common.async?Promise.all(a).then(e=>s(e)):s(a)}min(e,t){return new re({...this._def,minSize:{value:e,message:l.toString(t)}})}max(e,t){return new re({...this._def,maxSize:{value:e,message:l.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}re.create=(e,t)=>new re({valueType:e,minSize:null,maxSize:null,typeName:u.ZodSet,...tm(t)});class rt extends tg{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==e5.function)return ti(t,{code:e7.invalid_type,expected:e5.function,received:t.parsedType}),ta;function r(e,r){return tn({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,tr(),te].filter(e=>!!e),issueData:{code:e7.invalid_arguments,argumentsError:r}})}function n(e,r){return tn({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,tr(),te].filter(e=>!!e),issueData:{code:e7.invalid_return_type,returnTypeError:r}})}let i={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof ro){let e=this;return tl(async function(...t){let a=new e8([]),o=await e._def.args.parseAsync(t,i).catch(e=>{throw a.addIssue(r(t,e)),a}),l=await Reflect.apply(s,this,o);return await e._def.returns._def.type.parseAsync(l,i).catch(e=>{throw a.addIssue(n(l,e)),a})})}{let e=this;return tl(function(...t){let a=e._def.args.safeParse(t,i);if(!a.success)throw new e8([r(t,a.error)]);let o=Reflect.apply(s,this,a.data),l=e._def.returns.safeParse(o,i);if(!l.success)throw new e8([n(o,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new rt({...this._def,args:t9.create(e).rest(tY.create())})}returns(e){return new rt({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new rt({args:e||t9.create([]).rest(tY.create()),returns:t||tY.create(),typeName:u.ZodFunction,...tm(r)})}}class rr extends tg{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}rr.create=(e,t)=>new rr({getter:e,typeName:u.ZodLazy,...tm(t)});class rn extends tg{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return ti(t,{received:t.data,code:e7.invalid_literal,expected:this._def.value}),ta}return{status:"valid",value:e.data}}get value(){return this._def.value}}function ri(e,t){return new rs({values:e,typeName:u.ZodEnum,...tm(t)})}rn.create=(e,t)=>new rn({value:e,typeName:u.ZodLiteral,...tm(t)});class rs extends tg{_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return ti(t,{expected:a.joinValues(r),received:t.parsedType,code:e7.invalid_type}),ta}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return ti(t,{received:t.data,code:e7.invalid_enum_value,options:r}),ta}return tl(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return rs.create(e,{...this._def,...t})}exclude(e,t=this._def){return rs.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}rs.create=ri;class ra extends tg{_parse(e){let t=a.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==e5.string&&r.parsedType!==e5.number){let e=a.objectValues(t);return ti(r,{expected:a.joinValues(e),received:r.parsedType,code:e7.invalid_type}),ta}if(this._cache||(this._cache=new Set(a.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let e=a.objectValues(t);return ti(r,{received:r.data,code:e7.invalid_enum_value,options:e}),ta}return tl(e.data)}get enum(){return this._def.values}}ra.create=(e,t)=>new ra({values:e,typeName:u.ZodNativeEnum,...tm(t)});class ro extends tg{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==e5.promise&&!1===t.common.async?(ti(t,{code:e7.invalid_type,expected:e5.promise,received:t.parsedType}),ta):tl((t.parsedType===e5.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}ro.create=(e,t)=>new ro({type:e,typeName:u.ZodPromise,...tm(t)});class rl extends tg{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===u.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),n=this._def.effect||null,i={addIssue:e=>{ti(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),"preprocess"===n.type){let e=n.transform(r.data,i);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return ta;let n=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===n.status?ta:"dirty"===n.status||"dirty"===t.value?to(n.value):n});{if("aborted"===t.value)return ta;let n=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===n.status?ta:"dirty"===n.status||"dirty"===t.value?to(n.value):n}}if("refinement"===n.type){let e=e=>{let t=n.refinement(e,i);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?ta:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let n=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===n.status?ta:("dirty"===n.status&&t.dirty(),e(n.value),{status:t.value,value:n.value})}}if("transform"===n.type){if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>td(e)?Promise.resolve(n.transform(e.value,i)).then(e=>({status:t.value,value:e})):ta);{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!td(e))return ta;let s=n.transform(e.value,i);if(s instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}}a.assertNever(n)}}rl.create=(e,t,r)=>new rl({schema:e,typeName:u.ZodEffects,effect:t,...tm(r)}),rl.createWithPreprocess=(e,t,r)=>new rl({schema:t,effect:{type:"preprocess",transform:e},typeName:u.ZodEffects,...tm(r)});class ru extends tg{_parse(e){return this._getType(e)===e5.undefined?tl(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ru.create=(e,t)=>new ru({innerType:e,typeName:u.ZodOptional,...tm(t)});class rc extends tg{_parse(e){return this._getType(e)===e5.null?tl(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}rc.create=(e,t)=>new rc({innerType:e,typeName:u.ZodNullable,...tm(t)});class rd extends tg{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===e5.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}rd.create=(e,t)=>new rd({innerType:e,typeName:u.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...tm(t)});class rh extends tg{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return th(n)?n.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new e8(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===n.status?n.value:this._def.catchValue({get error(){return new e8(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}rh.create=(e,t)=>new rh({innerType:e,typeName:u.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...tm(t)});class rp extends tg{_parse(e){if(this._getType(e)!==e5.nan){let t=this._getOrReturnCtx(e);return ti(t,{code:e7.invalid_type,expected:e5.nan,received:t.parsedType}),ta}return{status:"valid",value:e.data}}}rp.create=e=>new rp({typeName:u.ZodNaN,...tm(e)}),Symbol("zod_brand");class rf extends tg{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class rm extends tg{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?ta:"dirty"===e.status?(t.dirty(),to(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?ta:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new rm({in:e,out:t,typeName:u.ZodPipeline})}}class rg extends tg{_parse(e){let t=this._def.innerType._parse(e),r=e=>(td(e)&&(e.value=Object.freeze(e.value)),e);return th(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}rg.create=(e,t)=>new rg({innerType:e,typeName:u.ZodReadonly,...tm(t)}),t1.lazycreate,function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(u||(u={}));let ry=tU.create,rv=tz.create;rp.create,tq.create;let rb=t$.create;tG.create,tW.create,tK.create,tH.create,tQ.create,tY.create,tZ.create,tJ.create;let r_=tX.create,rT=t1.create;t1.strictCreate,t2.create,t3.create,t5.create,t9.create,t7.create,t8.create,re.create,rt.create,rr.create,rn.create,rs.create,ra.create,ro.create,rl.create,ru.create,rc.create,rl.createWithPreprocess,rm.create;let rS=rv().finite().min(0,"Valor inv\xe1lido"),rw=rT({id:ry().min(1),name:ry().min(1,"Nome obrigat\xf3rio"),addressLine:ry().min(1,"Endere\xe7o obrigat\xf3rio"),approxAssets:rv().int().min(0),lat:rv().optional(),lng:rv().optional()}),rE=rT({id:ry().min(1),city:ry().min(1,"Cidade obrigat\xf3ria"),arrivalTransportNote:ry().optional(),intercityCost:rS.optional(),hotelName:ry().optional(),hotelNightly:rS,localTransportPerDay:rS,stores:r_(rw).min(1,"Inclua pelo menos uma loja")}),rC=rT({breakfast:rS,lunch:rS,dinner:rS,water:rS}),rI=rT({technicianName:ry().min(1,"Nome \xe9 obrigat\xf3rio"),originCity:ry().min(1,"Cidade de origem \xe9 obrigat\xf3ria"),startDateISO:ry().min(1,"Data de in\xedcio \xe9 obrigat\xf3ria"),assetsPerDay:rv().int().positive("Produtividade deve ser positiva"),technicianDailyRate:rS,perDiem:rC,workWeekends:rb().default(!1)}),rx=rT({global:rI,itinerary:r_(rE).min(1,"Inclua pelo menos uma cidade"),returnTransportCost:rS.optional()});function rk({label:e,value:t,onChange:r,placeholder:n="0,00",className:i=""}){let s=(0,b.useMemo)(()=>{let e="number"==typeof t&&isFinite(t)?t:0;return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e)},[t]),a=e=>{let t=e.target.value,n=parseFloat(t.replace(/[^\d,]/g,"").replace(",","."));!isNaN(n)&&isFinite(n)?r(n):(""===t||"R$ "===t)&&r(0)};return(0,y.jsxs)("div",{className:`space-y-2 ${i}`,children:[e&&y.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:e}),(0,y.jsxs)("div",{className:"relative",children:[y.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:y.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})})}),y.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 text-gray-900 placeholder-gray-400",value:s,onChange:a,placeholder:n,onFocus:e=>e.target.select()})]})]})}function rN({initial:e,onSubmit:t}){let[r,n]=(0,b.useState)(e?"Planejamento Existente":""),[i,s]=(0,b.useState)(!e),a=eX({resolver:e6(rx),defaultValues:e||{global:{technicianName:"",originCity:"",startDateISO:"2025-01-01",assetsPerDay:150,technicianDailyRate:0,perDiem:{breakfast:0,lunch:0,dinner:0,water:0},workWeekends:!1},itinerary:[],returnTransportCost:0}}),{fields:o,append:l,remove:u}=eJ({control:a.control,name:"itinerary"}),c=e=>{if(!r.trim()){s(!0);return}t(e,r.trim())},d=()=>{l({id:crypto.randomUUID(),city:"",arrivalTransportNote:"",intercityCost:0,hotelName:"",hotelNightly:0,localTransportPerDay:0,stores:[]})},h=e=>{u(e)};return(0,y.jsxs)("form",{onSubmit:a.handleSubmit(c),className:"space-y-8",children:[i&&(0,y.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden",children:[y.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 px-8 py-6",children:(0,y.jsxs)("div",{className:"flex items-center space-x-3",children:[y.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center",children:y.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),y.jsx("h2",{className:"text-2xl font-bold text-white",children:"T\xedtulo do Planejamento"})]})}),y.jsx("div",{className:"p-8",children:y.jsx("div",{className:"space-y-4",children:(0,y.jsxs)("div",{children:[y.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Nome do Planejamento"}),y.jsx("input",{type:"text",value:r,onChange:e=>n(e.target.value),placeholder:"Ex: Invent\xe1rio Regi\xe3o Sul - Janeiro 2025",className:"block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200",required:!0}),y.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"D\xea um nome descritivo para facilitar a identifica\xe7\xe3o futura"})]})})})]}),(0,y.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden",children:[y.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 px-8 py-6",children:(0,y.jsxs)("div",{className:"flex items-center space-x-3",children:[y.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center",children:(0,y.jsxs)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),y.jsx("h2",{className:"text-2xl font-bold text-white",children:"Par\xe2metros Globais"})]})}),(0,y.jsxs)("div",{className:"p-8 space-y-6",children:[(0,y.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Nome do T\xe9cnico"}),y.jsx("input",{...a.register("global.technicianName"),className:"block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",placeholder:"Nome completo do t\xe9cnico"}),a.formState.errors.global?.technicianName&&y.jsx("p",{className:"text-red-500 text-sm",children:a.formState.errors.global.technicianName.message})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Cidade de Origem"}),y.jsx("input",{...a.register("global.originCity"),className:"block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",placeholder:"Ex: Fortaleza, CE"}),a.formState.errors.global?.originCity&&y.jsx("p",{className:"text-red-500 text-sm",children:a.formState.errors.global.originCity.message})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Data de In\xedcio"}),y.jsx("input",{type:"date",...a.register("global.startDateISO"),className:"block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"}),a.formState.errors.global?.startDateISO&&y.jsx("p",{className:"text-red-500 text-sm",children:a.formState.errors.global.startDateISO.message})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Produtividade (bens/dia)"}),y.jsx("input",{type:"number",...a.register("global.assetsPerDay",{valueAsNumber:!0}),className:"block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",placeholder:"150",min:"1"}),a.formState.errors.global?.assetsPerDay&&y.jsx("p",{className:"text-red-500 text-sm",children:a.formState.errors.global.assetsPerDay.message})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx(rk,{label:"Di\xe1ria do T\xe9cnico",value:a.watch("global.technicianDailyRate"),onChange:e=>a.setValue("global.technicianDailyRate",e),placeholder:"0,00"}),a.formState.errors.global?.technicianDailyRate&&y.jsx("p",{className:"text-red-500 text-sm",children:a.formState.errors.global.technicianDailyRate.message})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Finais de Semana"}),(0,y.jsxs)("div",{className:"flex items-center space-x-3 pt-3",children:[(0,y.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[y.jsx("input",{type:"checkbox",className:"sr-only peer",...a.register("global.workWeekends")}),y.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]}),y.jsx("span",{className:"text-sm text-gray-600",children:a.watch("global.workWeekends")?"Trabalhar finais de semana":"Respeitar finais de semana"})]})]})]}),(0,y.jsxs)("div",{className:"border-t border-gray-200 pt-6",children:[(0,y.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[y.jsx("svg",{className:"w-5 h-5 text-green-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})}),"Per Diem (Alimenta\xe7\xe3o e Hidrata\xe7\xe3o)"]}),(0,y.jsxs)("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4",children:[y.jsx(rk,{label:"Caf\xe9 da Manh\xe3",value:a.watch("global.perDiem.breakfast"),onChange:e=>a.setValue("global.perDiem.breakfast",e),placeholder:"0,00"}),y.jsx(rk,{label:"Almo\xe7o",value:a.watch("global.perDiem.lunch"),onChange:e=>a.setValue("global.perDiem.lunch",e),placeholder:"0,00"}),y.jsx(rk,{label:"Jantar",value:a.watch("global.perDiem.dinner"),onChange:e=>a.setValue("global.perDiem.dinner",e),placeholder:"0,00"}),y.jsx(rk,{label:"\xc1gua",value:a.watch("global.perDiem.water"),onChange:e=>a.setValue("global.perDiem.water",e),placeholder:"0,00"})]})]})]})]}),(0,y.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden",children:[y.jsx("div",{className:"bg-gradient-to-r from-green-600 to-emerald-600 px-8 py-6",children:(0,y.jsxs)("div",{className:"flex items-center justify-between",children:[(0,y.jsxs)("div",{className:"flex items-center space-x-3",children:[y.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center",children:y.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-1.447-.894L15 4m0 13V4m0 0L9 7"})})}),y.jsx("h2",{className:"text-2xl font-bold text-white",children:"Itiner\xe1rio"})]}),(0,y.jsxs)("button",{type:"button",onClick:d,className:"bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2",children:[y.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),y.jsx("span",{children:"Adicionar Cidade"})]})]})}),(0,y.jsxs)("div",{className:"p-8 space-y-6",children:[o.map((e,t)=>(0,y.jsxs)("div",{className:"border border-gray-200 rounded-xl p-6 bg-gray-50",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,y.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 flex items-center",children:[(0,y.jsxs)("svg",{className:"w-5 h-5 text-green-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Cidade ",t+1]}),y.jsx("button",{type:"button",onClick:()=>h(t),className:"text-red-500 hover:text-red-700 transition-colors duration-200",children:y.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),(0,y.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Nome da Cidade"}),y.jsx("input",{...a.register(`itinerary.${t}.city`),className:"block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200",placeholder:"Ex: Campinas, SP"})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Nome do Hotel"}),y.jsx("input",{...a.register(`itinerary.${t}.hotelName`),className:"block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200",placeholder:"Nome do hotel"})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Di\xe1ria do Hotel"}),y.jsx(rk,{value:a.watch(`itinerary.${t}.hotelNightly`),onChange:e=>a.setValue(`itinerary.${t}.hotelNightly`,e),placeholder:"0,00"})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Transporte Local (dia)"}),y.jsx(rk,{value:a.watch(`itinerary.${t}.localTransportPerDay`),onChange:e=>a.setValue(`itinerary.${t}.localTransportPerDay`,e),placeholder:"0,00"})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Custo Intermunicipal"}),y.jsx(rk,{value:a.watch(`itinerary.${t}.intercityCost`)||0,onChange:e=>a.setValue(`itinerary.${t}.intercityCost`,e),placeholder:"0,00"})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx("label",{className:"block text-sm font-semibold text-gray-700",children:"Nota de Transporte"}),y.jsx("input",{...a.register(`itinerary.${t}.arrivalTransportNote`),className:"block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200",placeholder:"Voo, \xf4nibus, etc."})]})]}),y.jsx(rR,{cityIndex:t,form:a})]},e.id)),0===o.length&&(0,y.jsxs)("div",{className:"text-center py-12",children:[y.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,y.jsxs)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),y.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Nenhuma Cidade Adicionada"}),(0,y.jsxs)("p",{className:"text-gray-600 mb-4",children:["Clique em ",'"',"Adicionar Cidade",'"'," para come\xe7ar a definir seu itiner\xe1rio."]}),(0,y.jsxs)("button",{type:"button",onClick:d,className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1",children:[y.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Adicionar Primeira Cidade"]})]})]})]}),(0,y.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden",children:[y.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 px-8 py-6",children:(0,y.jsxs)("div",{className:"flex items-center space-x-3",children:[y.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center",children:y.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-1.447-.894L15 4m0 13V4m0 0L9 7"})})}),y.jsx("h2",{className:"text-2xl font-bold text-white",children:"Custo de Retorno"})]})}),y.jsx("div",{className:"p-8",children:(0,y.jsxs)("div",{className:"max-w-md",children:[y.jsx(rk,{label:"Custo de Retorno \xe0 Cidade de Origem",value:a.watch("returnTransportCost")??0,onChange:e=>a.setValue("returnTransportCost",e),placeholder:"0,00"}),y.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Custo estimado para retornar do \xfaltimo destino \xe0 cidade de origem"})]})})]}),y.jsx("div",{className:"flex justify-center",children:(0,y.jsxs)("button",{type:"submit",className:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white px-12 py-4 rounded-2xl text-xl font-semibold transition-all duration-200 shadow-2xl hover:shadow-3xl transform hover:-translate-y-2 flex items-center space-x-3",children:[y.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),y.jsx("span",{children:"Salvar Planejamento"})]})})]})}function rR({cityIndex:e,form:t}){let r=t.watch(`itinerary.${e}.stores`),n=()=>{let r=t.getValues(`itinerary.${e}.stores`);t.setValue(`itinerary.${e}.stores`,[...r,{id:crypto.randomUUID(),name:"",addressLine:"",approxAssets:0}])},i=r=>{let n=t.getValues(`itinerary.${e}.stores`).filter((e,t)=>t!==r);t.setValue(`itinerary.${e}.stores`,n)};return(0,y.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,y.jsxs)("h4",{className:"text-lg font-semibold text-gray-800 flex items-center",children:[y.jsx("svg",{className:"w-5 h-5 text-green-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),"Unidades"]}),(0,y.jsxs)("button",{type:"button",className:"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2",onClick:n,children:[y.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),y.jsx("span",{children:"Adicionar Unidade"})]})]}),r&&r.length>0?y.jsx("div",{className:"space-y-4",children:r.map((r,n)=>(0,y.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,y.jsxs)("h5",{className:"font-medium text-gray-800",children:["Unidade ",n+1]}),y.jsx("button",{type:"button",onClick:()=>i(n),className:"text-red-500 hover:text-red-700 transition-colors duration-200",children:y.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),(0,y.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Nome da Unidade"}),y.jsx("input",{...t.register(`itinerary.${e}.stores.${n}.name`),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200",placeholder:"Nome da unidade"})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Endere\xe7o"}),y.jsx("input",{...t.register(`itinerary.${e}.stores.${n}.addressLine`),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200",placeholder:"Endere\xe7o completo"})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Bens Estimados"}),y.jsx("input",{type:"number",...t.register(`itinerary.${e}.stores.${n}.approxAssets`,{valueAsNumber:!0}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200",placeholder:"0",min:"0"})]}),(0,y.jsxs)("div",{className:"space-y-2",children:[y.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Coordenadas (opcional)"}),(0,y.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[y.jsx("input",{type:"number",step:"any",...t.register(`itinerary.${e}.stores.${n}.lat`,{valueAsNumber:!0}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200",placeholder:"Latitude"}),y.jsx("input",{type:"number",step:"any",...t.register(`itinerary.${e}.stores.${n}.lng`,{valueAsNumber:!0}),className:"block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200",placeholder:"Longitude"})]})]})]})]},r.id))}):(0,y.jsxs)("div",{className:"text-center py-8",children:[y.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3",children:y.jsx("svg",{className:"w-6 h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),y.jsx("p",{className:"text-gray-500 text-sm mb-3",children:"Nenhuma unidade adicionada nesta cidade"}),y.jsx("button",{type:"button",onClick:n,className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200",children:"Adicionar Primeira Unidade"})]})]})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rA={NODE_CLIENT:!1,SDK_VERSION:"${JSCORE_VERSION}"},rO=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},rD=function(e){let t=[],r=0,n=0;for(;r<e.length;){let i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{let s=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},rP={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,c=(3&i)<<4|a>>4,d=(15&a)<<2|l>>6,h=63&l;o||(h=64,s||(d=64)),n.push(r[u],r[c],r[d],r[h])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(rO(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):rD(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let i=r[e.charAt(t++)],s=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new rL;let l=i<<2|s>>4;if(n.push(l),64!==a){let e=s<<4&240|a>>2;if(n.push(e),64!==o){let e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class rL extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let rM=function(e){let t=rO(e);return rP.encodeByteArray(t,!0)},rF=function(e){return rM(e).replace(/\./g,"")},rj=function(e){try{return rP.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rB(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rU=()=>rB().__FIREBASE_DEFAULTS__,rV=()=>{if("undefined"==typeof process||void 0===process.env)return;let e=process.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},rz=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&rj(e[1]);return t&&JSON.parse(t)},rq=()=>{try{return rU()||rV()||rz()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},r$=e=>{var t,r;return null===(r=null===(t=rq())||void 0===t?void 0:t.emulatorHosts)||void 0===r?void 0:r[e]},rG=e=>{let t=r$(e);if(!t)return;let r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),n]:[t.substring(0,r),n]},rW=()=>{var e;return null===(e=rq())||void 0===e?void 0:e.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rK{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rH(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let r={alg:"none",type:"JWT"},n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e),o="";return[rF(JSON.stringify(r)),rF(JSON.stringify(a)),o].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rQ(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function rY(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(rQ())}function rZ(){var e;let t=null===(e=rq())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function rJ(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function rX(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function r0(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function r1(){return!rZ()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function r2(){try{return"object"==typeof indexedDB}catch(e){return!1}}function r4(){return new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let r3="FirebaseError";class r6 extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=r3,Object.setPrototypeOf(this,r6.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,r5.prototype.create)}}class r5{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},n=`${this.service}/${e}`,i=this.errors[e],s=i?r9(i,r):"Error",a=`${this.serviceName}: ${s} (${n}).`;return new r6(n,a,r)}}function r9(e,t){return e.replace(r7,(e,r)=>{let n=t[r];return null!=n?String(n):`<${r}?>`})}let r7=/\{\$([^}]+)}/g;function r8(e,t){if(e===t)return!0;let r=Object.keys(e),n=Object.keys(t);for(let i of r){if(!n.includes(i))return!1;let r=e[i],s=t[i];if(ne(r)&&ne(s)){if(!r8(r,s))return!1}else if(r!==s)return!1}for(let e of n)if(!r.includes(e))return!1;return!0}function ne(e){return null!==e&&"object"==typeof e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nt(e){let t=[];for(let[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function nr(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[r,n]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(n)}}),t}function nn(e){let t=e.indexOf("?");if(!t)return"";let r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}function ni(e,t){let r=new ns(e,t);return r.subscribe.bind(r)}class ns{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw Error("Missing Observer.");void 0===(n=na(e,["next","error","complete"])?e:{next:e,error:t,complete:r}).next&&(n.next=no),void 0===n.error&&(n.error=no),void 0===n.complete&&(n.complete=no);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function na(e,t){if("object"!=typeof e||null===e)return!1;for(let r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}function no(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nl(e){return e&&e._delegate?e._delegate:e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */rA.NODE_CLIENT=!0;class nu{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nc="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nd{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new rK;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(e){if(n)return null;throw e}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(np(e))try{this.getOrInitializeService({instanceIdentifier:nc})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=nc){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=nc){return this.instances.has(e)}getOptions(e=nc){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){var r;let n=this.normalizeInstanceIdentifier(t),i=null!==(r=this.onInitCallbacks.get(n))&&void 0!==r?r:new Set;i.add(e),this.onInitCallbacks.set(n,i);let s=this.instances.get(n);return s&&e(s,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let n of r)try{n(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:nh(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch(e){}return r||null}normalizeInstanceIdentifier(e=nc){return this.component?this.component.multipleInstances?e:nc:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function nh(e){return e===nc?void 0:e}function np(e){return"EAGER"===e.instantiationMode}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nf{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new nd(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nm=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(c||(c={}));let ng={debug:c.DEBUG,verbose:c.VERBOSE,info:c.INFO,warn:c.WARN,error:c.ERROR,silent:c.SILENT},ny=c.INFO,nv={[c.DEBUG]:"log",[c.VERBOSE]:"log",[c.INFO]:"info",[c.WARN]:"warn",[c.ERROR]:"error"},nb=(e,t,...r)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),i=nv[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class n_{constructor(e){this.name=e,this._logLevel=ny,this._logHandler=nb,this._userLogHandler=null,nm.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in c))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ng[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,c.DEBUG,...e),this._logHandler(this,c.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,c.VERBOSE,...e),this._logHandler(this,c.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,c.INFO,...e),this._logHandler(this,c.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,c.WARN,...e),this._logHandler(this,c.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,c.ERROR,...e),this._logHandler(this,c.ERROR,...e)}}let nT=(e,t)=>t.some(t=>e instanceof t);function nS(){return i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function nw(){return s||(s=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let nE=new WeakMap,nC=new WeakMap,nI=new WeakMap,nx=new WeakMap,nk=new WeakMap;function nN(e){let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(nL(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&nE.set(t,e)}).catch(()=>{}),nk.set(t,e),t}function nR(e){if(nC.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});nC.set(e,t)}let nA={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return nC.get(e);if("objectStoreNames"===t)return e.objectStoreNames||nI.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return nL(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function nO(e){nA=e(nA)}function nD(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?nw().includes(e)?function(...t){return e.apply(nM(this),t),nL(nE.get(this))}:function(...t){return nL(e.apply(nM(this),t))}:function(t,...r){let n=e.call(nM(this),t,...r);return nI.set(n,t.sort?t.sort():[t]),nL(n)}}function nP(e){return"function"==typeof e?nD(e):(e instanceof IDBTransaction&&nR(e),nT(e,nS()))?new Proxy(e,nA):e}function nL(e){if(e instanceof IDBRequest)return nN(e);if(nx.has(e))return nx.get(e);let t=nP(e);return t!==e&&(nx.set(e,t),nk.set(t,e)),t}let nM=e=>nk.get(e);function nF(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(e,t),o=nL(a);return n&&a.addEventListener("upgradeneeded",e=>{n(nL(a.result),e.oldVersion,e.newVersion,nL(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}let nj=["get","getKey","getAll","getAllKeys","count"],nB=["put","add","delete","clear"],nU=new Map;function nV(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(nU.get(t))return nU.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=nB.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||nj.includes(r)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&s.done]))[0]};return nU.set(t,s),s}nO(e=>({...e,get:(t,r,n)=>nV(t,r)||e.get(t,r,n),has:(t,r)=>!!nV(t,r)||e.has(t,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nz{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!nq(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}function nq(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}let n$="@firebase/app",nG="0.10.13",nW=new n_("@firebase/app"),nK="10.14.1",nH="[DEFAULT]",nQ={[n$]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/vertexai-preview":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},nY=new Map,nZ=new Map,nJ=new Map;function nX(e,t){try{e.container.addComponent(t)}catch(r){nW.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function n0(e){let t=e.name;if(nJ.has(t))return nW.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(nJ.set(t,e),nY.values()))nX(r,e);for(let t of nZ.values())nX(t,e);return!0}function n1(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function n2(e){return void 0!==e.settings}let n4=new r5("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n3{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new nu("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw n4.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let n6=nK;function n5(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let n=Object.assign({name:nH,automaticDataCollectionEnabled:!1},t),i=n.name;if("string"!=typeof i||!i)throw n4.create("bad-app-name",{appName:String(i)});if(r||(r=rW()),!r)throw n4.create("no-options");let s=nY.get(i);if(s){if(r8(r,s.options)&&r8(n,s.config))return s;throw n4.create("duplicate-app",{appName:i})}let a=new nf(i);for(let e of nJ.values())a.addComponent(e);let o=new n3(r,n,a);return nY.set(i,o),o}function n9(e=nH){let t=nY.get(e);if(!t&&e===nH&&rW())return n5();if(!t)throw n4.create("no-app",{appName:e});return t}function n7(e,t,r){var n;let i=null!==(n=nQ[e])&&void 0!==n?n:e;r&&(i+=`-${r}`);let s=i.match(/\s|\//),a=t.match(/\s|\//);if(s||a){let e=[`Unable to register library "${i}" with version "${t}":`];s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),nW.warn(e.join(" "));return}n0(new nu(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let n8="firebase-heartbeat-database",ie=1,it="firebase-heartbeat-store",ir=null;function ii(){return ir||(ir=nF(n8,ie,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(it)}catch(e){console.warn(e)}}}).catch(e=>{throw n4.create("idb-open",{originalErrorMessage:e.message})})),ir}async function is(e){try{let t=(await ii()).transaction(it),r=await t.objectStore(it).get(io(e));return await t.done,r}catch(e){if(e instanceof r6)nW.warn(e.message);else{let t=n4.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});nW.warn(t.message)}}}async function ia(e,t){try{let r=(await ii()).transaction(it,"readwrite"),n=r.objectStore(it);await n.put(t,io(e)),await r.done}catch(e){if(e instanceof r6)nW.warn(e.message);else{let t=n4.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});nW.warn(t.message)}}}function io(e){return`${e.name}!${e.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let il=1024,iu=2592e6;class ic{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new ip(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{let r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=id();if((null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(e=>e.date===n))return;return this._heartbeatsCache.heartbeats.push({date:n,agent:r}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{let t=new Date(e.date).valueOf();return Date.now()-t<=iu}),this._storage.overwrite(this._heartbeatsCache)}catch(e){nW.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=id(),{heartbeatsToSend:r,unsentEntries:n}=ih(this._heartbeatsCache.heartbeats),i=rF(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return nW.warn(e),""}}}function id(){return new Date().toISOString().substring(0,10)}function ih(e,t=il){let r=[],n=e.slice();for(let i of e){let e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),im(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),im(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}class ip{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!r2()&&r4().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await is(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let r=await this.read();return ia(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let r=await this.read();return ia(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}}}function im(e){return rF(JSON.stringify({version:2,heartbeats:e})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(e){n0(new nu("platform-logger",e=>new nz(e),"PRIVATE")),n0(new nu("heartbeat",e=>new ic(e),"PRIVATE")),n7(n$,nG,""),n7(n$,nG,"esm2017"),n7("fire-js","")})(0);function ig(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)0>t.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}Object.create;Object.create,"function"==typeof SuppressedError&&SuppressedError;let iy=require("undici");function iv(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}let ib=iv,i_=new r5("auth","Firebase",iv()),iT=new n_("@firebase/auth");function iS(e,...t){iT.logLevel<=c.WARN&&iT.warn(`Auth (${n6}): ${e}`,...t)}function iw(e,...t){iT.logLevel<=c.ERROR&&iT.error(`Auth (${n6}): ${e}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iE(e,...t){throw ik(e,...t)}function iC(e,...t){return ik(e,...t)}function iI(e,t,r){return new r5("auth","Firebase",Object.assign(Object.assign({},ib()),{[t]:r})).create(t,{appName:e.name})}function ix(e){return iI(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ik(e,...t){if("string"!=typeof e){let r=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)}return i_.create(e,...t)}function iN(e,t,...r){if(!e)throw ik(t,...r)}function iR(e){let t="INTERNAL ASSERTION FAILED: "+e;throw iw(t),Error(t)}function iA(e,t){e||iR(t)}function iO(){return"http:"===iD()||"https:"===iD()}function iD(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iP(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(iO()||rX()||"connection"in navigator))||navigator.onLine}function iL(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iM{constructor(e,t){this.shortDelay=e,this.longDelay=t,iA(t>e,"Short delay should be less than long delay!"),this.isMobile=rY()||r0()}get(){return iP()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iF(e,t){iA(e.emulator,"Emulator should always be set here");let{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ij{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void iR("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void iR("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void iR("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iB={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},iU=new iM(3e4,6e4);function iV(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function iz(e,t,r,n,i={}){return iq(e,i,async()=>{let i={},s={};n&&("GET"===t?s=n:i={body:JSON.stringify(n)});let a=nt(Object.assign({key:e.config.apiKey},s)).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);let l=Object.assign({method:t,headers:o},i);return rJ()||(l.referrerPolicy="no-referrer"),ij.fetch()(iG(e,e.config.apiHost,r,a),l)})}async function iq(e,t,r){e._canInitEmulator=!1;let n=Object.assign(Object.assign({},iB),t);try{let t=new iK(e),i=await Promise.race([r(),t.promise]);t.clearNetworkTimeout();let s=await i.json();if("needConfirmation"in s)throw iH(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{let[t,r]=(i.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw iH(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw iH(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw iH(e,"user-disabled",s);let a=n[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(r)throw iI(e,a,r);iE(e,a)}}catch(t){if(t instanceof r6)throw t;iE(e,"network-request-failed",{message:String(t)})}}async function i$(e,t,r,n,i={}){let s=await iz(e,t,r,n,i);return"mfaPendingCredential"in s&&iE(e,"multi-factor-auth-required",{_serverResponse:s}),s}function iG(e,t,r,n){let i=`${t}${r}?${n}`;return e.config.emulator?iF(e.config,i):`${e.config.apiScheme}://${i}`}function iW(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class iK{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(iC(this.auth,"network-request-failed")),iU.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function iH(e,t,r){let n={appName:e.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);let i=iC(e,t,n);return i.customData._tokenResponse=r,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iQ(e){return void 0!==e&&void 0!==e.enterprise}class iY{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return iW(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iZ(e,t){return iz(e,"GET","/v2/recaptchaConfig",iV(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iJ(e,t){return iz(e,"POST","/v1/accounts:delete",t)}async function iX(e,t){return iz(e,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i0(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function i1(e,t=!1){let r=nl(e),n=await r.getIdToken(t),i=i4(n);iN(i&&i.exp&&i.auth_time&&i.iat,r.auth,"internal-error");let s="object"==typeof i.firebase?i.firebase:void 0,a=null==s?void 0:s.sign_in_provider;return{claims:i,token:n,authTime:i0(i2(i.auth_time)),issuedAtTime:i0(i2(i.iat)),expirationTime:i0(i2(i.exp)),signInProvider:a||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}function i2(e){return 1e3*Number(e)}function i4(e){let[t,r,n]=e.split(".");if(void 0===t||void 0===r||void 0===n)return iw("JWT malformed, contained fewer than 3 sections"),null;try{let e=rj(r);if(!e)return iw("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return iw("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function i3(e){let t=i4(e);return iN(t,"internal-error"),iN(void 0!==t.exp,"internal-error"),iN(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function i6(e,t,r=!1){if(r)return t;try{return await t}catch(t){throw t instanceof r6&&i5(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}function i5({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i9{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(!e)return this.errorBackoff=3e4,Math.max(0,(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(null==e?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i7{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=i0(this.lastLoginAt),this.creationTime=i0(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function i8(e){var t;let r=e.auth,n=await e.getIdToken(),i=await i6(e,iX(r,{idToken:n}));iN(null==i?void 0:i.users.length,r,"internal-error");let s=i.users[0];e._notifyReloadListener(s);let a=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?sr(s.providerUserInfo):[],o=st(e.providerData,a),l=e.isAnonymous,u=!(e.email&&s.passwordHash)&&!(null==o?void 0:o.length),c=!!l&&u;Object.assign(e,{uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new i7(s.createdAt,s.lastLoginAt),isAnonymous:c})}async function se(e){let t=nl(e);await i8(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function st(e,t){return[...e.filter(e=>!t.some(t=>t.providerId===e.providerId)),...t]}function sr(e){return e.map(e=>{var{providerId:t}=e,r=ig(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sn(e,t){let r=await iq(e,{},async()=>{let r=nt({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:i}=e.config,s=iG(e,n,"/v1/token",`key=${i}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",ij.fetch()(s,{method:"POST",headers:a,body:r})});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function si(e,t){return iz(e,"POST","/v2/accounts:revokeToken",iV(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ss{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){iN(e.idToken,"internal-error"),iN(void 0!==e.idToken,"internal-error"),iN(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):i3(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){iN(0!==e.length,"internal-error");let t=i3(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(iN(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:r,refreshToken:n,expiresIn:i}=await sn(e,t);this.updateTokensAndExpiration(r,n,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){let{refreshToken:r,accessToken:n,expirationTime:i}=t,s=new ss;return r&&(iN("string"==typeof r,"internal-error",{appName:e}),s.refreshToken=r),n&&(iN("string"==typeof n,"internal-error",{appName:e}),s.accessToken=n),i&&(iN("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ss,this.toJSON())}_performRefresh(){return iR("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sa(e,t){iN("string"==typeof e||void 0===e,"internal-error",{appName:t})}class so{constructor(e){var{uid:t,auth:r,stsTokenManager:n}=e,i=ig(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new i9(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new i7(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){let t=await i6(this,this.stsTokenManager.getToken(this.auth,e));return iN(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return i1(this,e)}reload(){return se(this)}_assign(e){this!==e&&(iN(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new so(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){iN(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await i8(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(n2(this.auth.app))return Promise.reject(ix(this.auth));let e=await this.getIdToken();return await i6(this,iJ(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,n,i,s,a,o,l,u;let c=null!==(r=t.displayName)&&void 0!==r?r:void 0,d=null!==(n=t.email)&&void 0!==n?n:void 0,h=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,p=null!==(s=t.photoURL)&&void 0!==s?s:void 0,f=null!==(a=t.tenantId)&&void 0!==a?a:void 0,m=null!==(o=t._redirectEventId)&&void 0!==o?o:void 0,g=null!==(l=t.createdAt)&&void 0!==l?l:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:b,isAnonymous:_,providerData:T,stsTokenManager:S}=t;iN(v&&S,e,"internal-error");let w=ss.fromJSON(this.name,S);iN("string"==typeof v,e,"internal-error"),sa(c,e.name),sa(d,e.name),iN("boolean"==typeof b,e,"internal-error"),iN("boolean"==typeof _,e,"internal-error"),sa(h,e.name),sa(p,e.name),sa(f,e.name),sa(m,e.name),sa(g,e.name),sa(y,e.name);let E=new so({uid:v,auth:e,email:d,emailVerified:b,displayName:c,isAnonymous:_,photoURL:p,phoneNumber:h,tenantId:f,stsTokenManager:w,createdAt:g,lastLoginAt:y});return T&&Array.isArray(T)&&(E.providerData=T.map(e=>Object.assign({},e))),m&&(E._redirectEventId=m),E}static async _fromIdTokenResponse(e,t,r=!1){let n=new ss;n.updateFromServerResponse(t);let i=new so({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:r});return await i8(i),i}static async _fromGetAccountInfoResponse(e,t,r){let n=t.users[0];iN(void 0!==n.localId,"internal-error");let i=void 0!==n.providerUserInfo?sr(n.providerUserInfo):[],s=!(n.email&&n.passwordHash)&&!(null==i?void 0:i.length),a=new ss;a.updateFromIdToken(r);let o=new so({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:s});return Object.assign(o,{uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:i,metadata:new i7(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!(null==i?void 0:i.length)}),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sl=new Map;function su(e){iA(e instanceof Function,"Expected a class definition");let t=sl.get(e);return t?iA(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,sl.set(e,t)),t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sc{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}sc.type="NONE";let sd=sc;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sh(e,t,r){return`firebase:${e}:${t}:${r}`}class sp{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:n,name:i}=this.auth;this.fullUserKey=sh(this.userKey,n.apiKey,i),this.fullPersistenceKey=sh("persistence",n.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);return e?so._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new sp(su(sd),e,r);let n=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=n[0]||su(sd),s=sh(r,e.config.apiKey,e.name),a=null;for(let r of t)try{let t=await r._get(s);if(t){let n=so._fromJSON(e,t);r!==i&&(a=n),i=r;break}}catch(e){}let o=n.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&o.length&&(i=o[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new sp(i,e,r)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sf(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(sv(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";{if(t.includes("edge/"))return"Edge";if(sm(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(s_(t))return"Blackberry";if(sT(t))return"Webos";if(sg(t))return"Safari";if((t.includes("chrome/")||sy(t))&&!t.includes("edge/"))return"Chrome";if(sb(t))return"Android";let r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(r);if((null==n?void 0:n.length)===2)return n[1]}return"Other"}function sm(e=rQ()){return/firefox\//i.test(e)}function sg(e=rQ()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function sy(e=rQ()){return/crios\//i.test(e)}function sv(e=rQ()){return/iemobile/i.test(e)}function sb(e=rQ()){return/android/i.test(e)}function s_(e=rQ()){return/blackberry/i.test(e)}function sT(e=rQ()){return/webos/i.test(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sS(e,t=[]){let r;switch(e){case"Browser":r=sf(rQ());break;case"Worker":r=`${sf(rQ())}-${e}`;break;default:r=e}let n=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${n6}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sw{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=t=>new Promise((r,n)=>{try{let n=e(t);r(n)}catch(e){n(e)}});r.onAbort=t,this.queue.push(r);let n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sE(e,t={}){return iz(e,"GET","/v2/passwordPolicy",iV(e,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sC=6;class sI{constructor(e){var t,r,n,i;let s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:sC,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(n=null===(r=e.allowedNonAlphanumericCharacters)||void 0===r?void 0:r.join(""))&&void 0!==n?n:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,n,i,s,a;let o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null===(t=o.meetsMinPasswordLength)||void 0===t||t),o.isValid&&(o.isValid=null===(r=o.meetsMaxPasswordLength)||void 0===r||r),o.isValid&&(o.isValid=null===(n=o.containsLowercaseLetter)||void 0===n||n),o.isValid&&(o.isValid=null===(i=o.containsUppercaseLetter)||void 0===i||i),o.isValid&&(o.isValid=null===(s=o.containsNumericCharacter)||void 0===s||s),o.isValid&&(o.isValid=null===(a=o.containsNonAlphanumericCharacter)||void 0===a||a),o}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)r=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,n,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sx{constructor(e,t,r,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new sN(this),this.idTokenSubscription=new sN(this),this.beforeStateQueue=new sw(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=i_,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=su(t)),this._initializationPromise=this.queue(async()=>{var r,n;if(!this._deleted&&(this.persistenceManager=await sp.create(this,e),!this._deleted)){if(null===(r=this._popupRedirectResolver)||void 0===r?void 0:r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(n=this.currentUser)||void 0===n?void 0:n.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await iX(this,{idToken:e}),r=await so._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(n2(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let r=await this.assertedPersistence.getCurrentUser(),n=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let r=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==n?void 0:n._redirectEventId,a=await this.tryRedirectSignIn(e);(!r||r===s)&&(null==a?void 0:a.user)&&(n=a.user,i=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(n)}catch(e){n=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return(iN(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId)?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await i8(e)}catch(e){if((null==e?void 0:e.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=iL()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(n2(this.app))return Promise.reject(ix(this));let t=e?nl(e):null;return t&&iN(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&iN(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return n2(this.app)?Promise.reject(ix(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return n2(this.app)?Promise.reject(ix(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(su(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new sI(await sE(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new r5("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await si(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){let r=await this.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&su(e)||this._popupRedirectResolver;iN(t,this,"argument-error"),this.redirectPersistenceManager=await sp.create(this,[su(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return(this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e)?this._currentUser:(null===(r=this.redirectUser)||void 0===r?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,n){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),s=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(iN(a,this,"internal-error"),a.then(()=>{s||i(this.currentUser)}),"function"==typeof t){let i=e.addObserver(t,r,n);return()=>{s=!0,i()}}{let r=e.addObserver(t);return()=>{s=!0,r()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return iN(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=sS(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=await (null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);let n=await this._getAppCheckToken();return n&&(t["X-Firebase-AppCheck"]=n),t}async _getAppCheckToken(){var e;let t=await (null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&iS(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function sk(e){return nl(e)}class sN{constructor(e){this.auth=e,this.observer=null,this.addObserver=ni(e=>this.observer=e)}get next(){return iN(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sR={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function sA(e){return sR.loadJS(e)}function sO(){return sR.recaptchaEnterpriseScript}let sD="recaptcha-enterprise",sP="NO_RECAPTCHA";class sL{constructor(e){this.type=sD,this.auth=sk(e)}async verify(e="verify",t=!1){async function r(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,r)=>{iZ(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(n=>{if(void 0===n.recaptchaKey)r(Error("recaptcha Enterprise site key undefined"));else{let r=new iY(n);return null==e.tenantId?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,t(r.siteKey)}}).catch(e=>{r(e)})})}function n(t,r,n){let i=window.grecaptcha;iQ(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{r(e)}).catch(()=>{r(sP)})}):n(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((e,i)=>{r(this.auth).then(r=>{if(!t&&iQ(window.grecaptcha))n(r,e,i);else{if("undefined"==typeof window){i(Error("RecaptchaVerifier is only supported in browser"));return}let t=sO();0!==t.length&&(t+=r),sA(t).then(()=>{n(r,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function sM(e,t,r,n=!1){let i;let s=new sL(e);try{i=await s.verify(r)}catch(e){i=await s.verify(r,!0)}let a=Object.assign({},t);return n?Object.assign(a,{captchaResp:i}):Object.assign(a,{captchaResponse:i}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function sF(e,t,r,n){var i;if(null===(i=e._getRecaptchaConfig())||void 0===i||!i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return n(e,t).catch(async i=>{if("auth/missing-recaptcha-token"!==i.code)return Promise.reject(i);{console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let i=await sM(e,t,r,"getOobCode"===r);return n(e,i)}});{let i=await sM(e,t,r,"getOobCode"===r);return n(e,i)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sj(e,t){let r=n1(e,"auth");if(r.isInitialized()){let e=r.getImmediate();if(r8(r.getOptions(),null!=t?t:{}))return e;iE(e,"already-initialized")}return r.initialize({options:t})}function sB(e,t){let r=(null==t?void 0:t.persistence)||[],n=(Array.isArray(r)?r:[r]).map(su);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(n,null==t?void 0:t.popupRedirectResolver)}function sU(e,t,r){let n=sk(e);iN(n._canInitEmulator,n,"emulator-config-failed"),iN(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");let i=!!(null==r?void 0:r.disableWarnings),s=sV(t),{host:a,port:o}=sz(t),l=null===o?"":`:${o}`;n.config.emulator={url:`${s}//${a}${l}/`},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||s$()}function sV(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function sz(e){let t=sV(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};let n=r[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){let e=i[1];return{host:e,port:sq(n.substr(e.length+1))}}{let[e,t]=n.split(":");return{host:e,port:sq(t)}}}function sq(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}function s$(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sG{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return iR("not implemented")}_getIdTokenResponse(e){return iR("not implemented")}_linkToIdToken(e,t){return iR("not implemented")}_getReauthenticationResolver(e){return iR("not implemented")}}async function sW(e,t){return iz(e,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sK(e,t){return i$(e,"POST","/v1/accounts:signInWithPassword",iV(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sH(e,t){return i$(e,"POST","/v1/accounts:signInWithEmailLink",iV(e,t))}async function sQ(e,t){return i$(e,"POST","/v1/accounts:signInWithEmailLink",iV(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sY extends sG{constructor(e,t,r,n=null){super("password",r),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new sY(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new sY(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return sF(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",sK);case"emailLink":return sH(e,{email:this._email,oobCode:this._password});default:iE(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return sF(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",sW);case"emailLink":return sQ(e,{idToken:t,email:this._email,oobCode:this._password});default:iE(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sZ(e,t){return i$(e,"POST","/v1/accounts:signInWithIdp",iV(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sJ="http://localhost";class sX extends sG{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new sX(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):iE("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e,{providerId:r,signInMethod:n}=t,i=ig(t,["providerId","signInMethod"]);if(!r||!n)return null;let s=new sX(r,n);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return sZ(e,this.buildRequest())}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,sZ(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,sZ(e,t)}buildRequest(){let e={requestUri:sJ,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=nt(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function s0(e,t){return i$(e,"POST","/v1/accounts:signInWithPhoneNumber",iV(e,t))}async function s1(e,t){let r=await i$(e,"POST","/v1/accounts:signInWithPhoneNumber",iV(e,t));if(r.temporaryProof)throw iH(e,"account-exists-with-different-credential",r);return r}let s2={USER_NOT_FOUND:"user-not-found"};async function s4(e,t){return i$(e,"POST","/v1/accounts:signInWithPhoneNumber",iV(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),s2)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s3 extends sG{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new s3({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new s3({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return s0(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return s1(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return s4(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:n}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:n}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}=e;return r||t||n||i?new s3({verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}):null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s6(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function s5(e){let t=nr(nn(e)).link,r=t?nr(nn(t)).deep_link_id:null,n=nr(nn(e)).deep_link_id;return(n?nr(nn(n)).link:null)||n||r||t||e}class s9{constructor(e){var t,r,n,i,s,a;let o=nr(nn(e)),l=null!==(t=o.apiKey)&&void 0!==t?t:null,u=null!==(r=o.oobCode)&&void 0!==r?r:null,c=s6(null!==(n=o.mode)&&void 0!==n?n:null);iN(l&&u&&c,"argument-error"),this.apiKey=l,this.operation=c,this.code=u,this.continueUrl=null!==(i=o.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=o.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(a=o.tenantId)&&void 0!==a?a:null}static parseLink(e){let t=s5(e);try{return new s9(t)}catch(e){return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s7{constructor(){this.providerId=s7.PROVIDER_ID}static credential(e,t){return sY._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let r=s9.parseLink(t);return iN(r,"argument-error"),sY._fromEmailAndCode(e,r.code,r.tenantId)}}s7.PROVIDER_ID="password",s7.EMAIL_PASSWORD_SIGN_IN_METHOD="password",s7.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s8{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ae extends s8{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class at extends null{static credentialFromJSON(e){let t="string"==typeof e?JSON.parse(e):e;return iN("providerId"in t&&"signInMethod"in t,"argument-error"),sX._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return iN(e.idToken||e.accessToken,"argument-error"),sX._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return at.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return at.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:n,pendingToken:i,nonce:s,providerId:a}=e;if(!r&&!n&&!t&&!i||!a)return null;try{return new at(a)._credential({idToken:t,accessToken:r,nonce:s,pendingToken:i})}catch(e){return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ar extends ae{constructor(){super("facebook.com")}static credential(e){return sX._fromParams({providerId:ar.PROVIDER_ID,signInMethod:ar.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ar.credentialFromTaggedObject(e)}static credentialFromError(e){return ar.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ar.credential(e.oauthAccessToken)}catch(e){return null}}}ar.FACEBOOK_SIGN_IN_METHOD="facebook.com",ar.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an extends ae{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return sX._fromParams({providerId:an.PROVIDER_ID,signInMethod:an.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return an.credentialFromTaggedObject(e)}static credentialFromError(e){return an.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return an.credential(t,r)}catch(e){return null}}}an.GOOGLE_SIGN_IN_METHOD="google.com",an.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai extends ae{constructor(){super("github.com")}static credential(e){return sX._fromParams({providerId:ai.PROVIDER_ID,signInMethod:ai.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ai.credentialFromTaggedObject(e)}static credentialFromError(e){return ai.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ai.credential(e.oauthAccessToken)}catch(e){return null}}}ai.GITHUB_SIGN_IN_METHOD="github.com",ai.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let as="http://localhost";class aa extends sG{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return sZ(e,this.buildRequest())}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,sZ(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,sZ(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){let{providerId:t,signInMethod:r,pendingToken:n}="string"==typeof e?JSON.parse(e):e;return t&&r&&n&&t===r?new aa(t,n):null}static _create(e,t){return new aa(e,t)}buildRequest(){return{requestUri:as,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ao="saml.";class al extends s8{constructor(e){iN(e.startsWith(ao),"argument-error"),super(e)}static credentialFromResult(e){return al.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return al.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){let t=aa.fromJSON(e);return iN(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return aa._create(r,t)}catch(e){return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class au extends ae{constructor(){super("twitter.com")}static credential(e,t){return sX._fromParams({providerId:au.PROVIDER_ID,signInMethod:au.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return au.credentialFromTaggedObject(e)}static credentialFromError(e){return au.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return au.credential(t,r)}catch(e){return null}}}au.TWITTER_SIGN_IN_METHOD="twitter.com",au.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ac{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,n=!1){return new ac({user:await so._fromIdTokenResponse(e,r,n),providerId:ad(r),_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){return await e._updateTokensIfNecessary(r,!0),new ac({user:e,providerId:ad(r),_tokenResponse:r,operationType:t})}}function ad(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ah extends r6{constructor(e,t,r,n){var i;super(t.code,t.message),this.operationType=r,this.user=n,Object.setPrototypeOf(this,ah.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,n){return new ah(e,t,r,n)}}function ap(e,t,r,n){return("reauthenticate"===t?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(r=>{if("auth/multi-factor-auth-required"===r.code)throw ah._fromErrorAndOperation(e,r,t,n);throw r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class af{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?am._fromServerResponse(e,t):"totpInfo"in t?ag._fromServerResponse(e,t):iE(e,"internal-error")}}class am extends af{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new am(t)}}class ag extends af{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new ag(t)}}class ay{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class av extends ay{constructor(e,t,r,n){super(e,t,r),this.username=n}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ab{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new ab("enroll",e,t)}static _fromMfaPendingCredential(e){return new ab("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return ab._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(r=e.multiFactorSession)||void 0===r?void 0:r.idToken)return ab._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a_{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){let r=sk(e),n=t.customData._serverResponse,i=(n.mfaInfo||[]).map(e=>af._fromServerResponse(r,e));iN(n.mfaPendingCredential,r,"internal-error");let s=ab._fromMfaPendingCredential(n.mfaPendingCredential);return new a_(s,i,async e=>{let i=await e._process(r,s);delete n.mfaInfo,delete n.mfaPendingCredential;let a=Object.assign(Object.assign({},n),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":let o=await ac._fromIdTokenResponse(r,t.operationType,a);return await r._updateCurrentUser(o.user),o;case"reauthenticate":return iN(t.user,r,"internal-error"),ac._forOperation(t.user,t.operationType,a);default:iE(r,"internal-error")}})}async resolveSignIn(e){let t=e;return this.signInResolver(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aT(e,t){return iz(e,"POST","/v2/accounts/mfaEnrollment:start",iV(e,t))}function aS(e,t){return iz(e,"POST","/v2/accounts/mfaEnrollment:finalize",iV(e,t))}function aw(e,t){return iz(e,"POST","/v2/accounts/mfaEnrollment:withdraw",iV(e,t))}class aE{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>af._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new aE(e)}async getSession(){return ab._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){let r=e,n=await this.getSession(),i=await i6(this.user,r._process(this.user.auth,n,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){let t="string"==typeof e?e:e.uid,r=await this.user.getIdToken();try{let e=await i6(this.user,aw(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(e){throw e}}}new WeakMap;var aC="@firebase/auth",aI="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ax{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){iN(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ak(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function aN(e){n0(new nu("auth",(t,{options:r})=>{let n=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),s=t.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=n.options;iN(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});let l=new sx(n,i,s,{apiKey:a,authDomain:o,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:sS(e)});return sB(l,r),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),n0(new nu("auth-internal",e=>new ax(sk(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),n7(aC,aI,ak(e)),n7(aC,aI,"esm2017")}function aR(e=n9()){let t=n1(e,"auth");if(t.isInitialized())return t.getImmediate();let r=sj(e),n=r$("auth");return n&&sU(r,`http://${n}`),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aA(e,t){return iz(e,"POST","/v2/accounts/mfaSignIn:finalize",iV(e,t))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ij.initialize(iy.fetch,iy.Headers,iy.Response),aN("Node"),iC("operation-not-supported-in-this-environment"),sx.prototype.setPersistence=async()=>{};class aO{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return iR("unexpected MultiFactorSessionType")}}}class aD{static assertionForEnrollment(e,t){return aP._fromSecret(e,t)}static assertionForSignIn(e,t){return aP._fromEnrollmentId(e,t)}static async generateSecret(e){var t;let r=e;iN(void 0!==(null===(t=r.user)||void 0===t?void 0:t.auth),"internal-error");let n=await aT(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return aL._fromStartTotpMfaEnrollmentResponse(n,r.user.auth)}}aD.FACTOR_ID="totp";class aP extends aO{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new aP(t,void 0,e)}static _fromEnrollmentId(e,t){return new aP(t,e)}async _finalizeEnroll(e,t,r){return iN(void 0!==this.secret,e,"argument-error"),aS(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){iN(void 0!==this.enrollmentId&&void 0!==this.otp,e,"argument-error");let r={verificationCode:this.otp};return aA(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class aL{constructor(e,t,r,n,i,s,a){this.sessionInfo=s,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=n,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new aL(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let n=!1;return(aM(e)||aM(t))&&(n=!0),n&&(aM(e)&&(e=(null===(r=this.auth.currentUser)||void 0===r?void 0:r.email)||"unknownuser"),aM(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function aM(e){return void 0===e||(null==e?void 0:e.length)===0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */n7("firebase","10.14.1","app");var aF=r(3837);let aj=require("crypto");var aB="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},aU={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function t(e,t,r){r||(r=0);var n=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;16>i;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];var s=e.g[3],a=t+(s^r&(i^s))+n[0]+3614090360&4294967295;a=s+(i^(t=r+(a<<7&4294967295|a>>>25))&(r^i))+n[1]+3905402710&4294967295,a=i+(r^(s=t+(a<<12&4294967295|a>>>20))&(t^r))+n[2]+606105819&4294967295,a=r+(t^(i=s+(a<<17&4294967295|a>>>15))&(s^t))+n[3]+3250441966&4294967295,a=t+(s^(r=i+(a<<22&4294967295|a>>>10))&(i^s))+n[4]+4118548399&4294967295,a=s+(i^(t=r+(a<<7&4294967295|a>>>25))&(r^i))+n[5]+1200080426&4294967295,a=i+(r^(s=t+(a<<12&4294967295|a>>>20))&(t^r))+n[6]+2821735955&4294967295,a=r+(t^(i=s+(a<<17&4294967295|a>>>15))&(s^t))+n[7]+4249261313&4294967295,a=t+(s^(r=i+(a<<22&4294967295|a>>>10))&(i^s))+n[8]+1770035416&4294967295,a=s+(i^(t=r+(a<<7&4294967295|a>>>25))&(r^i))+n[9]+2336552879&4294967295,a=i+(r^(s=t+(a<<12&4294967295|a>>>20))&(t^r))+n[10]+4294925233&4294967295,a=r+(t^(i=s+(a<<17&4294967295|a>>>15))&(s^t))+n[11]+2304563134&4294967295,a=t+(s^(r=i+(a<<22&4294967295|a>>>10))&(i^s))+n[12]+1804603682&4294967295,a=s+(i^(t=r+(a<<7&4294967295|a>>>25))&(r^i))+n[13]+4254626195&4294967295,a=i+(r^(s=t+(a<<12&4294967295|a>>>20))&(t^r))+n[14]+2792965006&4294967295,a=r+(t^(i=s+(a<<17&4294967295|a>>>15))&(s^t))+n[15]+1236535329&4294967295,r=i+(a<<22&4294967295|a>>>10),a=t+(i^s&(r^i))+n[1]+4129170786&4294967295,t=r+(a<<5&4294967295|a>>>27),a=s+(r^i&(t^r))+n[6]+3225465664&4294967295,s=t+(a<<9&4294967295|a>>>23),a=i+(t^r&(s^t))+n[11]+643717713&4294967295,i=s+(a<<14&4294967295|a>>>18),a=r+(s^t&(i^s))+n[0]+3921069994&4294967295,r=i+(a<<20&4294967295|a>>>12),a=t+(i^s&(r^i))+n[5]+3593408605&4294967295,t=r+(a<<5&4294967295|a>>>27),a=s+(r^i&(t^r))+n[10]+38016083&4294967295,s=t+(a<<9&4294967295|a>>>23),a=i+(t^r&(s^t))+n[15]+3634488961&4294967295,i=s+(a<<14&4294967295|a>>>18),a=r+(s^t&(i^s))+n[4]+3889429448&4294967295,r=i+(a<<20&4294967295|a>>>12),a=t+(i^s&(r^i))+n[9]+568446438&4294967295,t=r+(a<<5&4294967295|a>>>27),a=s+(r^i&(t^r))+n[14]+3275163606&4294967295,s=t+(a<<9&4294967295|a>>>23),a=i+(t^r&(s^t))+n[3]+4107603335&4294967295,i=s+(a<<14&4294967295|a>>>18),a=r+(s^t&(i^s))+n[8]+1163531501&4294967295,r=i+(a<<20&4294967295|a>>>12),a=t+(i^s&(r^i))+n[13]+2850285829&4294967295,t=r+(a<<5&4294967295|a>>>27),a=s+(r^i&(t^r))+n[2]+4243563512&4294967295,s=t+(a<<9&4294967295|a>>>23),a=i+(t^r&(s^t))+n[7]+1735328473&4294967295,i=s+(a<<14&4294967295|a>>>18),a=r+(s^t&(i^s))+n[12]+2368359562&4294967295,a=t+((r=i+(a<<20&4294967295|a>>>12))^i^s)+n[5]+4294588738&4294967295,a=s+((t=r+(a<<4&4294967295|a>>>28))^r^i)+n[8]+2272392833&4294967295,a=i+((s=t+(a<<11&4294967295|a>>>21))^t^r)+n[11]+1839030562&4294967295,a=r+((i=s+(a<<16&4294967295|a>>>16))^s^t)+n[14]+4259657740&4294967295,a=t+((r=i+(a<<23&4294967295|a>>>9))^i^s)+n[1]+2763975236&4294967295,a=s+((t=r+(a<<4&4294967295|a>>>28))^r^i)+n[4]+1272893353&4294967295,a=i+((s=t+(a<<11&4294967295|a>>>21))^t^r)+n[7]+4139469664&4294967295,a=r+((i=s+(a<<16&4294967295|a>>>16))^s^t)+n[10]+3200236656&4294967295,a=t+((r=i+(a<<23&4294967295|a>>>9))^i^s)+n[13]+681279174&4294967295,a=s+((t=r+(a<<4&4294967295|a>>>28))^r^i)+n[0]+3936430074&4294967295,a=i+((s=t+(a<<11&4294967295|a>>>21))^t^r)+n[3]+3572445317&4294967295,a=r+((i=s+(a<<16&4294967295|a>>>16))^s^t)+n[6]+76029189&4294967295,a=t+((r=i+(a<<23&4294967295|a>>>9))^i^s)+n[9]+3654602809&4294967295,a=s+((t=r+(a<<4&4294967295|a>>>28))^r^i)+n[12]+3873151461&4294967295,a=i+((s=t+(a<<11&4294967295|a>>>21))^t^r)+n[15]+530742520&4294967295,a=r+((i=s+(a<<16&4294967295|a>>>16))^s^t)+n[2]+3299628645&4294967295,r=i+(a<<23&4294967295|a>>>9),a=t+(i^(r|~s))+n[0]+4096336452&4294967295,t=r+(a<<6&4294967295|a>>>26),a=s+(r^(t|~i))+n[7]+1126891415&4294967295,s=t+(a<<10&4294967295|a>>>22),a=i+(t^(s|~r))+n[14]+2878612391&4294967295,i=s+(a<<15&4294967295|a>>>17),a=r+(s^(i|~t))+n[5]+4237533241&4294967295,r=i+(a<<21&4294967295|a>>>11),a=t+(i^(r|~s))+n[12]+1700485571&4294967295,t=r+(a<<6&4294967295|a>>>26),a=s+(r^(t|~i))+n[3]+2399980690&4294967295,s=t+(a<<10&4294967295|a>>>22),a=i+(t^(s|~r))+n[10]+4293915773&4294967295,i=s+(a<<15&4294967295|a>>>17),a=r+(s^(i|~t))+n[1]+2240044497&4294967295,r=i+(a<<21&4294967295|a>>>11),a=t+(i^(r|~s))+n[8]+1873313359&4294967295,t=r+(a<<6&4294967295|a>>>26),a=s+(r^(t|~i))+n[15]+4264355552&4294967295,s=t+(a<<10&4294967295|a>>>22),a=i+(t^(s|~r))+n[6]+2734768916&4294967295,i=s+(a<<15&4294967295|a>>>17),a=r+(s^(i|~t))+n[13]+1309151649&4294967295,r=i+(a<<21&4294967295|a>>>11),a=t+(i^(r|~s))+n[4]+4149444226&4294967295,t=r+(a<<6&4294967295|a>>>26),a=s+(r^(t|~i))+n[11]+3174756917&4294967295,s=t+(a<<10&4294967295|a>>>22),a=i+(t^(s|~r))+n[2]+718787259&4294967295,i=s+(a<<15&4294967295|a>>>17),a=r+(s^(i|~t))+n[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function r(e,t){var r=s;return Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=t(e)}function n(e,t){this.h=t;for(var r=[],n=!0,i=e.length-1;0<=i;i--){var s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}(function(e,t){function r(){}r.prototype=t.prototype,e.D=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.C=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}})(e,function(){this.blockSize=-1}),e.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},e.prototype.u=function(e,r){void 0===r&&(r=e.length);for(var n=r-this.blockSize,i=this.B,s=this.h,a=0;a<r;){if(0==s)for(;a<=n;)t(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<r;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){t(this,i),s=0;break}}else for(;a<r;)if(i[s++]=e[a++],s==this.blockSize){t(this,i),s=0;break}}this.h=s,this.o+=r},e.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var r=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&r,r/=256;for(this.u(e),e=Array(16),t=r=0;4>t;++t)for(var n=0;32>n;n+=8)e[r++]=this.g[t]>>>n&255;return e};var i,s={};function a(e){return -128<=e&&128>e?r(e,function(e){return new n([0|e],0>e?-1:0)}):new n([0|e],0>e?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return u;if(0>e)return g(o(-e));for(var t=[],r=1,i=0;e>=r;i++)t[i]=e/r|0,r*=4294967296;return new n(t,0)}function l(e,t){if(0==e.length)throw Error("number format error: empty string");if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if("-"==e.charAt(0))return g(l(e.substring(1),t));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=o(Math.pow(t,8)),n=u,i=0;i<e.length;i+=8){var s=Math.min(8,e.length-i),a=parseInt(e.substring(i,i+s),t);8>s?(s=o(Math.pow(t,s)),n=n.j(s).add(o(a))):n=(n=n.j(r)).add(o(a))}return n}var u=a(0),c=a(1),p=a(16777216);function f(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function m(e){return -1==e.h}function g(e){for(var t=e.g.length,r=[],i=0;i<t;i++)r[i]=~e.g[i];return new n(r,~e.h).add(c)}function y(e,t){return e.add(g(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function b(e,t){this.g=e,this.h=t}function _(e,t){if(f(t))throw Error("division by zero");if(f(e))return new b(u,u);if(m(e))return t=_(g(e),t),new b(g(t.g),g(t.h));if(m(t))return t=_(e,g(t)),new b(g(t.g),t.h);if(30<e.g.length){if(m(e)||m(t))throw Error("slowDivide_ only works with positive integers.");for(var r=c,n=t;0>=n.l(e);)r=T(r),n=T(n);var i=S(r,1),s=S(n,1);for(n=S(n,2),r=S(r,2);!f(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=S(n,1),r=S(r,1)}return t=y(e,i.j(t)),new b(i,t)}for(i=u;0<=e.l(t);){for(n=48>=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))?1:Math.pow(2,n-48),a=(s=o(r)).j(t);m(a)||0<a.l(e);)r-=n,a=(s=o(r)).j(t);f(s)&&(s=c),i=i.add(s),e=y(e,a)}return new b(i,e)}function T(e){for(var t=e.g.length+1,r=[],i=0;i<t;i++)r[i]=e.i(i)<<1|e.i(i-1)>>>31;return new n(r,e.h)}function S(e,t){var r=t>>5;t%=32;for(var i=e.g.length-r,s=[],a=0;a<i;a++)s[a]=0<t?e.i(a+r)>>>t|e.i(a+r+1)<<32-t:e.i(a+r);return new n(s,e.h)}(i=n.prototype).m=function(){if(m(this))return-g(this).m();for(var e=0,t=1,r=0;r<this.g.length;r++){var n=this.i(r);e+=(0<=n?n:4294967296+n)*t,t*=4294967296}return e},i.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(f(this))return"0";if(m(this))return"-"+g(this).toString(e);for(var t=o(Math.pow(e,6)),r=this,n="";;){var i=_(r,t).g,s=((0<(r=y(r,i.j(t))).g.length?r.g[0]:r.h)>>>0).toString(e);if(f(r=i))return s+n;for(;6>s.length;)s="0"+s;n=s+n}},i.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},i.l=function(e){return m(e=y(this,e))?-1:f(e)?0:1},i.abs=function(){return m(this)?g(this):this},i.add=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],i=0,s=0;s<=t;s++){var a=i+(65535&this.i(s))+(65535&e.i(s)),o=(a>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);i=o>>>16,a&=65535,o&=65535,r[s]=o<<16|a}return new n(r,-2147483648&r[r.length-1]?-1:0)},i.j=function(e){if(f(this)||f(e))return u;if(m(this))return m(e)?g(this).j(g(e)):g(g(this).j(e));if(m(e))return g(this.j(g(e)));if(0>this.l(p)&&0>e.l(p))return o(this.m()*e.m());for(var t=this.g.length+e.g.length,r=[],i=0;i<2*t;i++)r[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<e.g.length;s++){var a=this.i(i)>>>16,l=65535&this.i(i),c=e.i(s)>>>16,d=65535&e.i(s);r[2*i+2*s]+=l*d,v(r,2*i+2*s),r[2*i+2*s+1]+=a*d,v(r,2*i+2*s+1),r[2*i+2*s+1]+=l*c,v(r,2*i+2*s+1),r[2*i+2*s+2]+=a*c,v(r,2*i+2*s+2)}for(i=0;i<t;i++)r[i]=r[2*i+1]<<16|r[2*i];for(i=t;i<2*t;i++)r[i]=0;return new n(r,0)},i.A=function(e){return _(this,e).h},i.and=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],i=0;i<t;i++)r[i]=this.i(i)&e.i(i);return new n(r,this.h&e.h)},i.or=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],i=0;i<t;i++)r[i]=this.i(i)|e.i(i);return new n(r,this.h|e.h)},i.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],i=0;i<t;i++)r[i]=this.i(i)^e.i(i);return new n(r,this.h^e.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,h=aU.Md5=e,n.prototype.add=n.prototype.add,n.prototype.multiply=n.prototype.j,n.prototype.modulo=n.prototype.A,n.prototype.compare=n.prototype.l,n.prototype.toNumber=n.prototype.m,n.prototype.toString=n.prototype.toString,n.prototype.getBits=n.prototype.i,n.fromNumber=o,n.fromString=l,d=aU.Integer=n}).apply(void 0!==aB?aB:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var aV=r(1968),az=r(3716);let aq="@firebase/firestore",a$="4.7.3";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aG{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}aG.UNAUTHENTICATED=new aG(null),aG.GOOGLE_CREDENTIALS=new aG("google-credentials-uid"),aG.FIRST_PARTY=new aG("first-party-uid"),aG.MOCK_USER=new aG("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let aW="10.14.0";function aK(e){aW=e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aH(e){return(0,aF.inspect)(e,{depth:100})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let aQ=new n_("@firebase/firestore");function aY(){return aQ.logLevel}function aZ(e,...t){if(aQ.logLevel<=c.DEBUG){let r=t.map(a0);aQ.debug(`Firestore (${aW}): ${e}`,...r)}}function aJ(e,...t){if(aQ.logLevel<=c.ERROR){let r=t.map(a0);aQ.error(`Firestore (${aW}): ${e}`,...r)}}function aX(e,...t){if(aQ.logLevel<=c.WARN){let r=t.map(a0);aQ.warn(`Firestore (${aW}): ${e}`,...r)}}function a0(e){if("string"==typeof e)return e;try{return aH(e)}catch(t){return e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a1(e="Unexpected state"){let t=`FIRESTORE (${aW}) INTERNAL ASSERTION FAILED: `+e;throw aJ(t),Error(t)}function a2(e,t){e||a1()}function a4(e,t){return e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let a3={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class a6 extends r6{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a5{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a9{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class a7{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(aG.UNAUTHENTICATED))}shutdown(){}}class a8{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class oe{constructor(e){this.authProvider=e,this.currentUser=aG.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){a2(void 0===this.tokenListener);let r=this.tokenCounter,n=e=>this.tokenCounter!==r?(r=this.tokenCounter,t(e)):Promise.resolve(),i=new a5;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),i.resolve(),i=new a5,e.enqueueRetryable(()=>n(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{aZ("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),s())};this.authProvider.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.authProvider.getImmediate({optional:!0});e?a(e):(aZ("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new a5)}},0),s()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(t).then(t=>this.tokenCounter!==e?(aZ("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(a2("string"==typeof t.accessToken),new a9(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return a2(null===e||"string"==typeof e),new aG(e)}}class ot{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=aG.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class or{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new ot(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(aG.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class on{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class oi{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){a2(void 0===this.tokenListener);let r=e=>{null!=e.error&&aZ("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.latestAppCheckToken;return this.latestAppCheckToken=e.token,aZ("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.tokenListener=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{aZ("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.appCheckProvider.getImmediate({optional:!0});e?n(e):aZ("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(e).then(e=>e?(a2("string"==typeof e.token),this.latestAppCheckToken=e.token,new on(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}}function os(e){if(!e)return new a7;switch(e.type){case"firstParty":return new or(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new a6(a3.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oa(e){return(0,aj.randomBytes)(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oo{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",n=20;for(;r.length<n;){let i=oa(40);for(let s=0;s<i.length;++s)r.length<n&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}}function ol(e,t){return e<t?-1:e>t?1:0}function ou(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}function oc(e){return e+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let od=-62135596800,oh=1e6;class op{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new a6(a3.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<od||e>=253402300800)throw new a6(a3.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return op.fromMillis(Date.now())}static fromDate(e){return op.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*oh);return new op(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/oh}_compareTo(e){return this.seconds===e.seconds?ol(this.nanoseconds,e.nanoseconds):ol(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds-od).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class of{constructor(e){this.timestamp=e}static fromTimestamp(e){return new of(e)}static min(){return new of(new op(0,0))}static max(){return new of(new op(253402300799,1e9-1))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let om="__name__";class og{constructor(e,t,r){void 0===t?t=0:t>e.length&&a1(),void 0===r?r=e.length-t:r>e.length-t&&a1(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===og.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof og?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=e.get(n),i=t.get(n);if(r<i)return -1;if(r>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class oy extends og{construct(e,t,r){return new oy(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new a6(a3.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new oy(t)}static emptyPath(){return new oy([])}}let ov=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ob extends og{construct(e,t,r){return new ob(e,t,r)}static isValidIdentifier(e){return ov.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ob.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===om}static keyField(){return new ob([om])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new a6(a3.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new a6(a3.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[n+1];if(!("\\"===t||"."===t||"`"===t))throw new a6(a3.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new a6(a3.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ob(t)}static emptyPath(){return new ob([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o_{constructor(e){this.path=e}static fromPath(e){return new o_(oy.fromString(e))}static fromName(e){return new o_(oy.fromString(e).popFirst(5))}static empty(){return new o_(oy.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===oy.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return oy.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new o_(new oy(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oT=-1,oS=0;class ow{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function oE(e){return e.fields.find(e=>2===e.kind)}function oC(e){return e.fields.filter(e=>2!==e.kind)}function oI(e){let t=oC(e);return 0===t.length?0:t[t.length-1].kind}function ox(e,t){let r=ol(e.collectionGroup,t.collectionGroup);if(0!==r)return r;for(let n=0;n<Math.min(e.fields.length,t.fields.length);++n)if(0!==(r=oR(e.fields[n],t.fields[n])))return r;return ol(e.fields.length,t.fields.length)}function ok(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}ow.UNKNOWN_ID=-1;class oN{constructor(e,t){this.fieldPath=e,this.kind=t}}function oR(e,t){let r=ob.comparator(e.fieldPath,t.fieldPath);return 0!==r?r:ol(e.kind,t.kind)}class oA{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new oA(oS,oP.min())}}function oO(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new oP(of.fromTimestamp(1e9===n?new op(r+1,0):new op(r,n)),o_.empty(),t)}function oD(e){return new oP(e.readTime,e.key,oT)}class oP{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new oP(of.min(),o_.empty(),oT)}static max(){return new oP(of.max(),o_.empty(),oT)}}function oL(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=o_.comparator(e.documentKey,t.documentKey))?r:ol(e.largestBatchId,t.largestBatchId)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oM="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class oF{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oj(e){if(e.code===a3.FAILED_PRECONDITION&&e.message===oM)aZ("LocalStore","Unexpectedly lost primary lease");else throw e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oB{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return(this.callbackAttached&&a1(),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new oB((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();if(t instanceof oB)return t;return oB.resolve(t)}catch(e){return oB.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):oB.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):oB.reject(t)}static resolve(e){return new oB((t,r)=>{t(e)})}static reject(e){return new oB((t,r)=>{r(e)})}static waitFor(e){return new oB((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=oB.resolve(!1);for(let r of e)t=t.next(e=>e?oB.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new oB((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new oB((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oU="SimpleDb",oV=3;class oz{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new a5,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new oW(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=t=>{let r=oZ(t.target.error);this.completionDeferred.reject(new oW(e,r))}}static open(e,t,r,n){try{return new oz(t,e.transaction(n,r))}catch(e){throw new oW(t,e)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(aZ(oU,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new oH(this.transaction.objectStore(e))}}class oq{constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,12.2===oq.getIOSVersion(rQ())&&aJ("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return aZ(oU,"Removing database:",e),oQ(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!r2())return!1;if(oq.isMockPersistence())return!0;let e=rQ(),t=oq.getIOSVersion(e),r=0<t&&t<10,n=o$(e),i=0<n&&n<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0)&&!r&&!i}static isMockPersistence(){var e;return"undefined"!=typeof process&&(null===(e=process.env)||void 0===e?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}async ensureDb(e){return this.db||(aZ(oU,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new oW(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new a6(a3.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new a6(a3.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new oW(e,n))},n.onupgradeneeded=e=>{aZ(oU,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.schemaConverter.createOrUpgrade(t,n.transaction,e.oldVersion,this.version).next(()=>{aZ(oU,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=e=>this.versionchangelistener(e)),this.db}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,n){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.ensureDb(e);let t=oz.open(this.db,e,i?"readonly":"readwrite",r),s=n(t).next(e=>(t.maybeCommit(),e)).catch(e=>(t.abort(e),oB.reject(e))).toPromise();return s.catch(()=>{}),await t.completionPromise,s}catch(r){let e=r,t="FirebaseError"!==e.name&&s<oV;if(aZ(oU,"Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}function o$(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class oG{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return oQ(this.dbCursor.delete())}}class oW extends a6{constructor(e,t){super(a3.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function oK(e){return"IndexedDbTransactionError"===e.name}class oH{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(aZ(oU,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(aZ(oU,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),oQ(r)}add(e){return aZ(oU,"ADD",this.store.name,e,e),oQ(this.store.add(e))}get(e){return oQ(this.store.get(e)).next(t=>(void 0===t&&(t=null),aZ(oU,"GET",this.store.name,e,t),t))}delete(e){return aZ(oU,"DELETE",this.store.name,e),oQ(this.store.delete(e))}count(){return aZ(oU,"COUNT",this.store.name),oQ(this.store.count())}loadAll(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new oB((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.iterateCursor(e,(e,r)=>{t.push(r)}).next(()=>t)}}loadFirst(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new oB((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}deleteAll(e,t){aZ(oU,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let n=this.cursor(r);return this.iterateCursor(n,(e,t,r)=>r.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.iterateCursor(n,t)}iterateSerial(e){let t=this.cursor({});return new oB((r,n)=>{t.onerror=e=>{n(oZ(e.target.error))},t.onsuccess=t=>{let n=t.target.result;if(!n){r();return}e(n.primaryKey,n.value).next(e=>{e?n.continue():r()})}})}iterateCursor(e,t){let r=[];return new oB((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i){n();return}let s=new oG(i),a=t(i.primaryKey,i.value,s);if(a instanceof oB){let e=a.catch(e=>(s.done(),oB.reject(e)));r.push(e)}s.isDone?n():null===s.skipToKey?i.continue():i.continue(s.skipToKey)}}).next(()=>oB.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),!e.index)return this.store.openCursor(e.range,t);{let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}}}function oQ(e){return new oB((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(oZ(e.target.error))}})}let oY=!1;function oZ(e){let t=oq.getIOSVersion(rQ());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new a6("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return oY||(oY=!0,setTimeout(()=>{throw e},0)),e}}return e}let oJ="IndexBackfiller",oX=15e3,o0=6e4,o1=50;class o2{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(oX)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule(e){aZ(oJ,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.backfiller.backfill();aZ(oJ,`Documents written: ${e}`)}catch(e){oK(e)?aZ(oJ,"Ignoring IndexedDB error during index backfill: ",e):await oj(e)}await this.schedule(o0)})}}class o4{constructor(e,t){this.localStore=e,this.persistence=t}async backfill(e=o1){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))}writeIndexEntries(e,t){let r=new Set,n=t,i=!0;return oB.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(!(null===t||r.has(t)))return aZ(oJ,`Processing collection: ${t}`),this.writeEntriesForCollectionGroup(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.getNewOffset(n,r)).next(r=>(aZ(oJ,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=oD(t);oL(n,r)>0&&(r=n)}),new oP(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o3{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.setPreviousValue(e),this.writeNewSequenceNumber=e=>t.writeSequenceNumber(e))}setPreviousValue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(e),e}}o3.INVALID=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let o6="\x01",o5="\x01",o9="\x10",o7="\x11";function o8(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t=lt(t)),t=le(e.get(r),t);return lt(t)}function le(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+=o6+o9;break;case o6:r+=o6+o7;break;default:r+=n}}return r}function lt(e){return e+o6+o5}function lr(e){let t=e.length;if(a2(t>=2),2===t)return a2(e.charAt(0)===o6&&e.charAt(1)===o5),oy.emptyPath();let r=t-2,n=[],i="";for(let s=0;s<t;){let t=e.indexOf(o6,s);switch((t<0||t>r)&&a1(),e.charAt(t+1)){case o5:let a;let o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),n.push(a);break;case o9:i+=e.substring(s,t)+"\0";break;case o7:i+=e.substring(s,t+1);break;default:a1()}s=t+2}return new oy(n)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ln="remoteDocuments",li="owner",ls="owner",la="mutationQueues",lo="userId",ll="mutations",lu="batchId",lc="userMutationsIndex",ld=["userId","batchId"];function lh(e){return[e]}function lp(e,t){return[e,o8(t)]}function lf(e,t,r){return[e,o8(t),r]}let lm={},lg="documentMutations",ly="remoteDocumentsV14",lv=["prefixPath","collectionGroup","readTime","documentId"],lb="documentKeyIndex",l_=["prefixPath","collectionGroup","documentId"],lT="collectionGroupIndex",lS=["collectionGroup","readTime","prefixPath","documentId"],lw="remoteDocumentGlobal",lE="remoteDocumentGlobalKey",lC="targets",lI="targetId",lx="queryTargetsIndex",lk=["canonicalId","targetId"],lN="targetDocuments",lR=["targetId","path"],lA="documentTargetsIndex",lO=["path","targetId"],lD="targetGlobalKey",lP="targetGlobal",lL="collectionParents",lM=["collectionId","parent"],lF="clientMetadata",lj="clientId",lB="bundles",lU="bundleId",lV="namedQueries",lz="name",lq="indexConfiguration",l$="indexId",lG="collectionGroupIndex",lW="collectionGroup",lK="indexState",lH=["indexId","uid"],lQ="sequenceNumberIndex",lY=["uid","sequenceNumber"],lZ="indexEntries",lJ=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],lX="documentKeyIndex",l0=["indexId","uid","orderedDocumentKey"],l1="documentOverlays",l2=["userId","collectionPath","documentId"],l4="collectionPathOverlayIndex",l3=["userId","collectionPath","largestBatchId"],l6="collectionGroupOverlayIndex",l5=["userId","collectionGroup","largestBatchId"],l9="globals",l7="name",l8=[la,ll,lg,ln,lC,li,lP,lN,lF,lw,lL,lB,lV],ue=[...l8,l1],ut=[la,ll,lg,ly,lC,li,lP,lN,lF,lw,lL,lB,lV,l1],ur=ut,un=[...ur,lq,lK,lZ],ui=un,us=[...un,l9];function ua(e){return 17===e?us:16===e?ui:15===e?un:14===e?ur:13===e?ut:12===e?ue:11===e?l8:void a1()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uo extends oF{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}}function ul(e,t){let r=a4(e);return oq.getStore(r.simpleDbTransaction,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uu(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function uc(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function ud(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uh{constructor(e,t){this.comparator=e,this.root=t||uf.EMPTY}insert(e,t){return new uh(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,uf.BLACK,null,null))}remove(e){return new uh(this.comparator,this.root.remove(e,this.comparator).copy(null,null,uf.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new up(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new up(this.root,e,this.comparator,!1)}getReverseIterator(){return new up(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new up(this.root,e,this.comparator,!0)}}class up{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else if(0===i){this.nodeStack.push(e);break}else this.nodeStack.push(e),e=this.isReverse?e.right:e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class uf{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:uf.RED,this.left=null!=n?n:uf.EMPTY,this.right=null!=i?i:uf.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new uf(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return uf.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r;let n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return uf.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,uf.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,uf.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw a1();let e=this.left.check();if(e===this.right.check())return e+(this.isRed()?0:1);throw a1()}}uf.EMPTY=null,uf.RED=!0,uf.BLACK=!1;class um{constructor(){this.size=0}get key(){throw a1()}get value(){throw a1()}get color(){throw a1()}get left(){throw a1()}get right(){throw a1()}copy(e,t,r,n,i){return this}insert(e,t,r){return new uf(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}uf.EMPTY=new um;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ug{constructor(e){this.comparator=e,this.data=new uh(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new uy(this.data.getIterator())}getIteratorFrom(e){return new uy(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof ug)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new ug(this.comparator);return t.data=e,t}}class uy{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function uv(e,t,r,n,i){let s=e.getIterator(),a=t.getIterator(),o=ub(s),l=ub(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=ub(a)):t?(i(o),o=ub(s)):(o=ub(s),l=ub(a))}}function ub(e){return e.hasNext()?e.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u_{constructor(e){this.fields=e,e.sort(ob.comparator)}static empty(){return new u_([])}unionWith(e){let t=new ug(ob.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new u_(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ou(this.fields,e.fields,(e,t)=>e.isEqual(t))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uT(e){return Buffer.from(e,"base64").toString("binary")}function uS(e){return Buffer.from(e,"binary").toString("base64")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uw{constructor(e){this.binaryString=e}static fromBase64String(e){return new uw(uT(e))}static fromUint8Array(e){return new uw(uE(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return uS(this.binaryString)}toUint8Array(){return uC(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ol(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}function uE(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}function uC(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}uw.EMPTY_BYTE_STRING=new uw("");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uI=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ux(e){if(a2(!!e),"string"==typeof e){let t=0,r=uI.exec(e);if(a2(!!r),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:uk(e.seconds),nanos:uk(e.nanos)}}function uk(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function uN(e){return"string"==typeof e?uw.fromBase64String(e):uw.fromUint8Array(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uR="server_timestamp",uA="__type__",uO="__previous_value__",uD="__local_write_time__";function uP(e){var t,r;return(null===(r=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[uA])||void 0===r?void 0:r.stringValue)===uR}function uL(e,t){let r={fields:{[uA]:{stringValue:uR},[uD]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&uP(t)&&(t=uM(t)),t&&(r.fields[uO]=t),{mapValue:r}}function uM(e){let t=e.mapValue.fields[uO];return uP(t)?uM(t):t}function uF(e){let t=ux(e.mapValue.fields[uD].timestampValue);return new op(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uj{constructor(e,t,r,n,i,s,a,o,l){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l}}let uB="(default)";class uU{constructor(e,t){this.projectId=e,this.database=t||uB}static empty(){return new uU("","")}get isDefaultDatabase(){return this.database===uB}isEqual(e){return e instanceof uU&&e.projectId===this.projectId&&e.database===this.database}}function uV(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new a6(a3.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new uU(e.options.projectId,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uz=-1;function uq(e){return null==e}function u$(e){return 0===e&&1/e==-1/0}function uG(e){return"number"==typeof e&&Number.isInteger(e)&&!u$(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uW="__type__",uK="__max__",uH={mapValue:{fields:{__type__:{stringValue:uK}}}},uQ="__vector__",uY="value",uZ={nullValue:"NULL_VALUE"};function uJ(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?uP(e)?4:cI(e)?9007199254740991:cE(e)?10:11:a1()}function uX(e,t){if(e===t)return!0;let r=uJ(e);if(r!==uJ(t))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return uF(e).isEqual(uF(t));case 3:return u0(e,t);case 5:return e.stringValue===t.stringValue;case 6:return u2(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return u1(e,t);case 2:return u4(e,t);case 9:return ou(e.arrayValue.values||[],t.arrayValue.values||[],uX);case 10:case 11:return u3(e,t);default:return a1()}}function u0(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=ux(e.timestampValue),n=ux(t.timestampValue);return r.seconds===n.seconds&&r.nanos===n.nanos}function u1(e,t){return uk(e.geoPointValue.latitude)===uk(t.geoPointValue.latitude)&&uk(e.geoPointValue.longitude)===uk(t.geoPointValue.longitude)}function u2(e,t){return uN(e.bytesValue).isEqual(uN(t.bytesValue))}function u4(e,t){if("integerValue"in e&&"integerValue"in t)return uk(e.integerValue)===uk(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=uk(e.doubleValue),n=uk(t.doubleValue);return r===n?u$(r)===u$(n):isNaN(r)&&isNaN(n)}return!1}function u3(e,t){let r=e.mapValue.fields||{},n=t.mapValue.fields||{};if(uu(r)!==uu(n))return!1;for(let e in r)if(r.hasOwnProperty(e)&&(void 0===n[e]||!uX(r[e],n[e])))return!1;return!0}function u6(e,t){return void 0!==(e.values||[]).find(e=>uX(e,t))}function u5(e,t){if(e===t)return 0;let r=uJ(e),n=uJ(t);if(r!==n)return ol(r,n);switch(r){case 0:case 9007199254740991:return 0;case 1:return ol(e.booleanValue,t.booleanValue);case 2:return u9(e,t);case 3:return u7(e.timestampValue,t.timestampValue);case 4:return u7(uF(e),uF(t));case 5:return ol(e.stringValue,t.stringValue);case 6:return ct(e.bytesValue,t.bytesValue);case 7:return u8(e.referenceValue,t.referenceValue);case 8:return ce(e.geoPointValue,t.geoPointValue);case 9:return cr(e.arrayValue,t.arrayValue);case 10:return cn(e.mapValue,t.mapValue);case 11:return ci(e.mapValue,t.mapValue);default:throw a1()}}function u9(e,t){let r=uk(e.integerValue||e.doubleValue),n=uk(t.integerValue||t.doubleValue);return r<n?-1:r>n?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1}function u7(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return ol(e,t);let r=ux(e),n=ux(t),i=ol(r.seconds,n.seconds);return 0!==i?i:ol(r.nanos,n.nanos)}function u8(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=ol(r[e],n[e]);if(0!==t)return t}return ol(r.length,n.length)}function ce(e,t){let r=ol(uk(e.latitude),uk(t.latitude));return 0!==r?r:ol(uk(e.longitude),uk(t.longitude))}function ct(e,t){let r=uN(e),n=uN(t);return r.compareTo(n)}function cr(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=u5(r[e],n[e]);if(t)return t}return ol(r.length,n.length)}function cn(e,t){var r,n,i,s;let a=e.fields||{},o=t.fields||{},l=null===(r=a[uY])||void 0===r?void 0:r.arrayValue,u=null===(n=o[uY])||void 0===n?void 0:n.arrayValue,c=ol((null===(i=null==l?void 0:l.values)||void 0===i?void 0:i.length)||0,(null===(s=null==u?void 0:u.values)||void 0===s?void 0:s.length)||0);return 0!==c?c:cr(l,u)}function ci(e,t){if(e===uH.mapValue&&t===uH.mapValue)return 0;if(e===uH.mapValue)return 1;if(t===uH.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){let t=ol(n[e],s[e]);if(0!==t)return t;let a=u5(r[n[e]],i[s[e]]);if(0!==a)return a}return ol(n.length,s.length)}function cs(e){return ca(e)}function ca(e){if("nullValue"in e)return"null";if("booleanValue"in e)return""+e.booleanValue;if("integerValue"in e)return""+e.integerValue;if("doubleValue"in e)return""+e.doubleValue;if("timestampValue"in e)return cl(e.timestampValue);if("stringValue"in e)return e.stringValue;if("bytesValue"in e)return co(e.bytesValue);else if("referenceValue"in e)return cc(e.referenceValue);else if("geoPointValue"in e)return cu(e.geoPointValue);else if("arrayValue"in e)return ch(e.arrayValue);else if("mapValue"in e)return cd(e.mapValue);else return a1()}function co(e){return uN(e).toBase64()}function cl(e){let t=ux(e);return`time(${t.seconds},${t.nanos})`}function cu(e){return`geo(${e.latitude},${e.longitude})`}function cc(e){return o_.fromName(e).toString()}function cd(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${ca(e.fields[i])}`;return r+"}"}function ch(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=ca(n);return t+"]"}function cp(e){switch(uJ(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=uM(e);return t?16+cp(t):16;case 5:return 2*e.stringValue.length;case 6:return uN(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return cm(e.arrayValue);case 10:case 11:return cf(e.mapValue);default:throw a1()}}function cf(e){let t=0;return uc(e.fields,(e,r)=>{t+=e.length+cp(r)}),t}function cm(e){return(e.values||[]).reduce((e,t)=>e+cp(t),0)}function cg(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function cy(e){return!!e&&"integerValue"in e}function cv(e){return!!e&&"doubleValue"in e}function cb(e){return cy(e)||cv(e)}function c_(e){return!!e&&"arrayValue"in e}function cT(e){return!!e&&"nullValue"in e}function cS(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function cw(e){return!!e&&"mapValue"in e}function cE(e){var t,r;return(null===(r=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[uW])||void 0===r?void 0:r.stringValue)===uQ}function cC(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return uc(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=cC(r)),t}{if(!e.arrayValue)return Object.assign({},e);let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=cC(e.arrayValue.values[r]);return t}}function cI(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===uK}let cx={mapValue:{fields:{[uW]:{stringValue:uQ},[uY]:{arrayValue:{}}}}};function ck(e){if("nullValue"in e)return uZ;if("booleanValue"in e)return{booleanValue:!1};if("integerValue"in e||"doubleValue"in e)return{doubleValue:NaN};if("timestampValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in e)return{stringValue:""};if("bytesValue"in e)return{bytesValue:""};if("referenceValue"in e)return cg(uU.empty(),o_.empty());else if("geoPointValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in e)return{arrayValue:{}};else if(!("mapValue"in e))return a1();else return cE(e)?cx:{mapValue:{}}}function cN(e){if("nullValue"in e)return{booleanValue:!1};if("booleanValue"in e)return{doubleValue:NaN};if("integerValue"in e||"doubleValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in e)return{stringValue:""};if("stringValue"in e)return{bytesValue:""};if("bytesValue"in e)return cg(uU.empty(),o_.empty());if("referenceValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in e)return{arrayValue:{}};else if("arrayValue"in e)return cx;else if(!("mapValue"in e))return a1();else return cE(e)?{mapValue:{}}:uH}function cR(e,t){let r=u5(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function cA(e,t){let r=u5(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cO{constructor(e){this.value=e}static empty(){return new cO({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!cw(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=cC(t)}setAll(e){let t=ob.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=cC(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());cw(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return uX(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];cw(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(uc(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new cO(cC(this.value))}}function cD(e){let t=[];return uc(e.fields,(e,r)=>{let n=new ob([e]);if(cw(r)){let e=cD(r.mapValue).fields;if(0===e.length)t.push(n);else for(let r of e)t.push(n.child(r))}else t.push(n)}),new u_(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cP{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new cP(e,0,of.min(),of.min(),of.min(),cO.empty(),0)}static newFoundDocument(e,t,r,n){return new cP(e,1,t,of.min(),r,n,0)}static newNoDocument(e,t){return new cP(e,2,t,of.min(),of.min(),cO.empty(),0)}static newUnknownDocument(e,t){return new cP(e,3,t,of.min(),of.min(),cO.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(of.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=cO.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=cO.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=of.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof cP&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new cP(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function cL(e,t,r){let n=t.data.field(e),i=r.data.field(e);return null!==n&&null!==i?u5(n,i):a1()}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cM{constructor(e,t){this.position=e,this.inclusive=t}}function cF(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(n=s.field.isKeyField()?o_.comparator(o_.fromName(a.referenceValue),r.key):u5(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function cj(e,t,r){let n=cF(e,t,r);return e.inclusive?n>=0:n>0}function cB(e,t,r){let n=cF(e,t,r);return e.inclusive?n<=0:n<0}function cU(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!uX(e.position[r],t.position[r]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cV{constructor(e,t="asc"){this.field=e,this.dir=t}}function cz(e){return e.field.canonicalString()+e.dir}function cq(e){return`${e.field.canonicalString()} (${e.dir})`}function c$(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cG{}class cW extends cG{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new c5(e,t,r):"array-contains"===t?new de(e,r):"in"===t?new dt(e,r):"not-in"===t?new dr(e,r):"array-contains-any"===t?new dn(e,r):new cW(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new c9(e,r):new c7(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(u5(t,this.value)):null!==t&&uJ(this.value)===uJ(t)&&this.matchesComparison(u5(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return a1()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class cK extends cG{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new cK(e,t)}matches(e){return cH(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}}function cH(e){return"and"===e.op}function cQ(e){return"or"===e.op}function cY(e){return cZ(e)&&cH(e)}function cZ(e){for(let t of e.filters)if(t instanceof cK)return!1;return!0}function cJ(e){if(e instanceof cW)return e.field.canonicalString()+e.op.toString()+cs(e.value);if(cY(e))return e.filters.map(e=>cJ(e)).join(",");{let t=e.filters.map(e=>cJ(e)).join(",");return`${e.op}(${t})`}}function cX(e,t){return e instanceof cW?c0(e,t):e instanceof cK?c1(e,t):void a1()}function c0(e,t){return t instanceof cW&&e.op===t.op&&e.field.isEqual(t.field)&&uX(e.value,t.value)}function c1(e,t){return t instanceof cK&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,r,n)=>e&&cX(r,t.filters[n]),!0)}function c2(e,t){let r=e.filters.concat(t);return cK.create(r,e.op)}function c4(e){return e instanceof cW?c6(e):e instanceof cK?c3(e):"Filter"}function c3(e){return e.op.toString()+" {"+e.getFilters().map(c4).join(" ,")+"}"}function c6(e){return`${e.field.canonicalString()} ${e.op} ${cs(e.value)}`}class c5 extends cW{constructor(e,t,r){super(e,t,r),this.key=o_.fromName(r.referenceValue)}matches(e){let t=o_.comparator(e.key,this.key);return this.matchesComparison(t)}}class c9 extends cW{constructor(e,t){super(e,"in",t),this.keys=c8("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class c7 extends cW{constructor(e,t){super(e,"not-in",t),this.keys=c8("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function c8(e,t){var r;return((null===(r=t.arrayValue)||void 0===r?void 0:r.values)||[]).map(e=>o_.fromName(e.referenceValue))}class de extends cW{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return c_(t)&&u6(t.arrayValue,this.value)}}class dt extends cW{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&u6(this.value.arrayValue,t)}}class dr extends cW{constructor(e,t){super(e,"not-in",t)}matches(e){if(u6(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&!u6(this.value.arrayValue,t)}}class dn extends cW{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!!c_(t)&&!!t.arrayValue.values&&t.arrayValue.values.some(e=>u6(this.value.arrayValue,e))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class di{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.memoizedCanonicalId=null}}function ds(e,t=null,r=[],n=[],i=null,s=null,a=null){return new di(e,t,r,n,i,s,a)}function da(e){let t=a4(e);if(null===t.memoizedCanonicalId){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:"+t.filters.map(e=>cJ(e)).join(",")+"|ob:"+t.orderBy.map(e=>cz(e)).join(","),uq(t.limit)||(e+="|l:"+t.limit),t.startAt&&(e+="|lb:"+(t.startAt.inclusive?"b:":"a:")+t.startAt.position.map(e=>cs(e)).join(",")),t.endAt&&(e+="|ub:"+(t.endAt.inclusive?"a:":"b:")+t.endAt.position.map(e=>cs(e)).join(",")),t.memoizedCanonicalId=e}return t.memoizedCanonicalId}function dl(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>c4(e)).join(", ")}]`),uq(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>cq(e)).join(", ")}]`),e.startAt&&(t+=", startAt: "+(e.startAt.inclusive?"b:":"a:")+e.startAt.position.map(e=>cs(e)).join(",")),e.endAt&&(t+=", endAt: "+(e.endAt.inclusive?"a:":"b:")+e.endAt.position.map(e=>cs(e)).join(",")),`Target(${t})`}function du(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++)if(!c$(e.orderBy[r],t.orderBy[r]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!cX(e.filters[r],t.filters[r]))return!1;return!!(e.collectionGroup===t.collectionGroup&&e.path.isEqual(t.path)&&cU(e.startAt,t.startAt))&&cU(e.endAt,t.endAt)}function dc(e){return o_.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function dd(e,t){return e.filters.filter(e=>e instanceof cW&&e.field.isEqual(t))}function dh(e,t){let r=oE(t);if(void 0===r)return null;for(let t of dd(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}function dp(e,t){let r=new Map;for(let n of oC(t))for(let t of dd(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}function df(e,t){let r=[],n=!0;for(let i of oC(t)){let t=0===i.kind?dg(e,i.fieldPath,e.startAt):dy(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new cM(r,n)}function dm(e,t){let r=[],n=!0;for(let i of oC(t)){let t=0===i.kind?dy(e,i.fieldPath,e.endAt):dg(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new cM(r,n)}function dg(e,t,r){let n=uZ,i=!0;for(let r of dd(e,t)){let e=uZ,t=!0;switch(r.op){case"<":case"<=":e=ck(r.value);break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=uZ}0>cR({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];0>cR({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function dy(e,t,r){let n=uH,i=!0;for(let r of dd(e,t)){let e=uH,t=!0;switch(r.op){case">=":case">":e=cN(r.value),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=uH}cA({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];cA({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function dv(e){let t=new ug(ob.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+(r?1:0)}function db(e){return null!==e.limit}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d_{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}}function dT(e,t,r,n,i,s,a,o){return new d_(e,t,r,n,i,s,a,o)}function dS(e){return new d_(e)}function dw(e,t){return new d_(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function dE(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function dC(e){let t=new ug(ob.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}function dI(e){return o_.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function dx(e){return null!==e.collectionGroup}function dk(e){let t=a4(e);if(null===t.memoizedNormalizedOrderBy){t.memoizedNormalizedOrderBy=[];let e=new Set;for(let r of t.explicitOrderBy)t.memoizedNormalizedOrderBy.push(r),e.add(r.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";dC(t).forEach(n=>{e.has(n.canonicalString())||n.isKeyField()||t.memoizedNormalizedOrderBy.push(new cV(n,r))}),e.has(ob.keyField().canonicalString())||t.memoizedNormalizedOrderBy.push(new cV(ob.keyField(),r))}return t.memoizedNormalizedOrderBy}function dN(e){let t=a4(e);return t.memoizedTarget||(t.memoizedTarget=dA(t,dk(e))),t.memoizedTarget}function dR(e){let t=a4(e);return t.memoizedAggregateTarget||(t.memoizedAggregateTarget=dA(t,e.explicitOrderBy)),t.memoizedAggregateTarget}function dA(e,t){if("F"===e.limitType)return ds(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new cV(e.field,t)});let r=e.endAt?new cM(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new cM(e.startAt.position,e.startAt.inclusive):null;return ds(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function dO(e,t){let r=e.filters.concat([t]);return new d_(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function dD(e,t){let r=e.explicitOrderBy.concat([t]);return new d_(e.path,e.collectionGroup,r,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function dP(e,t,r){return new d_(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function dL(e,t){return new d_(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}function dM(e,t){return new d_(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}function dF(e,t){return du(dN(e),dN(t))&&e.limitType===t.limitType}function dj(e){return`${da(dN(e))}|lt:${e.limitType}`}function dB(e){return`Query(target=${dl(dN(e))}; limitType=${e.limitType})`}function dU(e,t){return t.isFoundDocument()&&dV(e,t)&&dz(e,t)&&dq(e,t)&&d$(e,t)}function dV(e,t){let r=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(r):o_.isDocumentKey(e.path)?e.path.isEqual(r):e.path.isImmediateParentOf(r)}function dz(e,t){for(let r of dk(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}function dq(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}function d$(e,t){return(!e.startAt||!!cB(e.startAt,dk(e),t))&&(!e.endAt||!!cj(e.endAt,dk(e),t))}function dG(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function dW(e){return(t,r)=>{let n=!1;for(let i of dk(e)){let e=dK(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}function dK(e,t,r){let n=e.field.isKeyField()?o_.comparator(t.key,r.key):cL(e.field,t,r);switch(e.dir){case"asc":return n;case"desc":return -1*n;default:return a1()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dH{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n){this.inner[r]=[[e,t]],this.innerSize++;return}for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e)){n[r]=[e,t];return}n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){uc(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return ud(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dQ=new uh(o_.comparator);function dY(){return dQ}let dZ=new uh(o_.comparator);function dJ(...e){let t=dZ;for(let r of e)t=t.insert(r.key,r);return t}function dX(){return d4()}function d0(e){let t=dZ;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function d1(){return d4()}function d2(){return d4()}function d4(){return new dH(e=>e.toString(),(e,t)=>e.isEqual(t))}let d3=new uh(o_.comparator);function d6(){return d3}let d5=new ug(o_.comparator);function d9(...e){let t=d5;for(let r of e)t=t.add(r);return t}let d7=new ug(ol);function d8(){return d7}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function he(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:u$(t)?"-0":t}}function ht(e){return{integerValue:""+e}}function hr(e,t){return uG(t)?ht(t):he(e,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hn{constructor(){this._=void 0}}function hi(e,t,r){return e instanceof hl?uL(r,t):e instanceof hu?hc(e,t):e instanceof hd?hh(e,t):hf(e,t)}function hs(e,t,r){return e instanceof hu?hc(e,t):e instanceof hd?hh(e,t):r}function ha(e,t){return e instanceof hp?cb(t)?t:{integerValue:0}:null}function ho(e,t){return e instanceof hu&&t instanceof hu||e instanceof hd&&t instanceof hd?ou(e.elements,t.elements,uX):e instanceof hp&&t instanceof hp?uX(e.operand,t.operand):e instanceof hl&&t instanceof hl}class hl extends hn{}class hu extends hn{constructor(e){super(),this.elements=e}}function hc(e,t){let r=hg(t);for(let t of e.elements)r.some(e=>uX(e,t))||r.push(t);return{arrayValue:{values:r}}}class hd extends hn{constructor(e){super(),this.elements=e}}function hh(e,t){let r=hg(t);for(let t of e.elements)r=r.filter(e=>!uX(e,t));return{arrayValue:{values:r}}}class hp extends hn{constructor(e,t){super(),this.serializer=e,this.operand=t}}function hf(e,t){let r=ha(e,t),n=hm(r)+hm(e.operand);return cy(r)&&cy(e.operand)?ht(n):he(e.serializer,n)}function hm(e){return uk(e.integerValue||e.doubleValue)}function hg(e){return c_(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hy{constructor(e,t){this.field=e,this.transform=t}}function hv(e,t){return e.field.isEqual(t.field)&&ho(e.transform,t.transform)}function hb(e,t){return void 0===e&&void 0===t||!!e&&!!t&&ou(e,t,(e,t)=>hv(e,t))}class h_{constructor(e,t){this.version=e,this.transformResults=t}}class hT{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new hT}static exists(e){return new hT(void 0,e)}static updateTime(e){return new hT(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function hS(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class hw{}function hE(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new hj(e.key,hT.none()):new hN(e.key,e.data,hT.none());{let r=e.data,n=cO.empty(),i=new ug(ob.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new hO(e.key,n,new u_(i.toArray()),hT.none())}}function hC(e,t,r){e instanceof hN?hR(e,t,r):e instanceof hO?hD(e,t,r):hB(e,t,r)}function hI(e,t,r,n){return e instanceof hN?hA(e,t,r,n):e instanceof hO?hP(e,t,r,n):hU(e,t,r)}function hx(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=ha(n.transform,e||null);null!=i&&(null===r&&(r=cO.empty()),r.set(n.field,i))}return r||null}function hk(e,t){return!!(e.type===t.type&&e.key.isEqual(t.key)&&e.precondition.isEqual(t.precondition)&&hb(e.fieldTransforms,t.fieldTransforms))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class hN extends hw{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}function hR(e,t,r){let n=e.value.clone(),i=hM(e.fieldTransforms,t,r.transformResults);n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()}function hA(e,t,r,n){if(!hS(e.precondition,t))return r;let i=e.value.clone(),s=hF(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}class hO extends hw{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function hD(e,t,r){if(!hS(e.precondition,t)){t.convertToUnknownDocument(r.version);return}let n=hM(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(hL(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}function hP(e,t,r,n){if(!hS(e.precondition,t))return r;let i=hF(e.fieldTransforms,n,t),s=t.data;return(s.setAll(hL(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}function hL(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function hM(e,t,r){let n=new Map;a2(e.length===r.length);for(let i=0;i<r.length;i++){let s=e[i],a=s.transform,o=t.data.field(s.field);n.set(s.field,hs(a,o,r[i]))}return n}function hF(e,t,r){let n=new Map;for(let i of e){let e=i.transform,s=r.data.field(i.field);n.set(i.field,hi(e,s,t))}return n}class hj extends hw{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}function hB(e,t,r){t.convertToNoDocument(r.version).setHasCommittedMutations()}function hU(e,t,r){return hS(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}class hV extends hw{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hz{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&hC(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=hI(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=hI(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=d2();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=hE(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(of.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),d9())}isEqual(e){return this.batchId===e.batchId&&ou(this.mutations,e.mutations,(e,t)=>hk(e,t))&&ou(this.baseMutations,e.baseMutations,(e,t)=>hk(e,t))}}class hq{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){a2(e.mutations.length===r.length);let n=d6(),i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new hq(e,t,r,n)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h${constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hG{constructor(e,t){this.count=e,this.unchangedNames=t}}function hW(e){switch(e){case a3.OK:return a1();case a3.CANCELLED:case a3.UNKNOWN:case a3.DEADLINE_EXCEEDED:case a3.RESOURCE_EXHAUSTED:case a3.INTERNAL:case a3.UNAVAILABLE:case a3.UNAUTHENTICATED:return!1;case a3.INVALID_ARGUMENT:case a3.NOT_FOUND:case a3.ALREADY_EXISTS:case a3.PERMISSION_DENIED:case a3.FAILED_PRECONDITION:case a3.ABORTED:case a3.OUT_OF_RANGE:case a3.UNIMPLEMENTED:case a3.DATA_LOSS:return!0;default:return a1()}}function hK(e){return hW(e)&&e!==a3.ABORTED}function hH(e){if(void 0===e)return aJ("GRPC error has no .code"),a3.UNKNOWN;switch(e){case p.OK:return a3.OK;case p.CANCELLED:return a3.CANCELLED;case p.UNKNOWN:return a3.UNKNOWN;case p.DEADLINE_EXCEEDED:return a3.DEADLINE_EXCEEDED;case p.RESOURCE_EXHAUSTED:return a3.RESOURCE_EXHAUSTED;case p.INTERNAL:return a3.INTERNAL;case p.UNAVAILABLE:return a3.UNAVAILABLE;case p.UNAUTHENTICATED:return a3.UNAUTHENTICATED;case p.INVALID_ARGUMENT:return a3.INVALID_ARGUMENT;case p.NOT_FOUND:return a3.NOT_FOUND;case p.ALREADY_EXISTS:return a3.ALREADY_EXISTS;case p.PERMISSION_DENIED:return a3.PERMISSION_DENIED;case p.FAILED_PRECONDITION:return a3.FAILED_PRECONDITION;case p.ABORTED:return a3.ABORTED;case p.OUT_OF_RANGE:return a3.OUT_OF_RANGE;case p.UNIMPLEMENTED:return a3.UNIMPLEMENTED;case p.DATA_LOSS:return a3.DATA_LOSS;default:return a1()}}!function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS"}(p||(p={}));/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hQ extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hY=null;function hZ(e){if(hY)throw Error("a TestingHooksSpi instance is already set");hY=e}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hJ(){return new aF.TextEncoder}function hX(){return new TextDecoder("utf-8")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let h0=new d([4294967295,4294967295],0);function h1(e){let t=hJ().encode(e),r=new h;return r.update(t),new Uint8Array(r.digest())}function h2(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new d([r,n],0),new d([i,s],0)]}class h4{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new h3(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new h3(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new h3(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=8*e.length-t,this.bitCountInInteger=d.fromNumber(this.bitCount)}getBitIndex(e,t,r){let n=e.add(t.multiply(d.fromNumber(r)));return 1===n.compare(h0)&&(n=new d([n.getBits(0),n.getBits(1)],0)),n.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(0===this.bitCount)return!1;let[t,r]=h2(h1(e));for(let e=0;e<this.hashCount;e++){let n=this.getBitIndex(t,r,e);if(!this.isBitSet(n))return!1}return!0}static create(e,t,r){let n=e%8==0?0:8-e%8,i=new h4(new Uint8Array(Math.ceil(e/8)),n,t);return r.forEach(e=>i.insert(e)),i}insert(e){if(0===this.bitCount)return;let[t,r]=h2(h1(e));for(let e=0;e<this.hashCount;e++){let n=this.getBitIndex(t,r,e);this.setBit(n)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class h3 extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h6{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,h5.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new h6(of.min(),n,new uh(ol),dY(),d9())}}class h5{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new h5(r,t,d9(),d9(),d9())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h9{constructor(e,t,r,n){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=n}}class h7{constructor(e,t){this.targetId=e,this.existenceFilter=t}}class h8{constructor(e,t,r=uw.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class pe{constructor(){this.pendingResponses=0,this.documentChanges=pi(),this._resumeToken=uw.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=d9(),t=d9(),r=d9();return this.documentChanges.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:a1()}}),new h5(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=pi()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,a2(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}}let pt="WatchChangeAggregator";class pr{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=dY(),this.pendingDocumentTargetMapping=pn(),this.pendingTargetResets=new uh(ol)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:a1()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((e,r)=>{this.isActiveTarget(r)&&t(r)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,n=this.targetDataForActiveTarget(t);if(n){let i=n.target;if(dc(i)){if(0===r){let e=new o_(i.path);this.removeDocumentFromTarget(t,e,cP.newNoDocument(e,of.min()))}else a2(1===r)}else{let n=this.getCurrentDocumentCountForTarget(t);if(n!==r){let r=this.parseBloomFilter(e),i=r?this.applyBloomFilter(r,e,n):1;if(0!==i){this.resetTarget(t);let e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,e)}null==hY||hY.notifyOnExistenceFilterMismatch(ps(n,e.existenceFilter,this.metadataProvider.getDatabaseId(),r,i))}}}}parseBloomFilter(e){let t,r;let n=e.existenceFilter.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=uN(i).toUint8Array()}catch(e){if(e instanceof hQ)return aX("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new h4(t,s,a)}catch(e){return e instanceof h3?aX("BloomFilter error: ",e):aX("Applying bloom filter failed: ",e),null}return 0===r.bitCount?null:r}applyBloomFilter(e,t,r){return t.existenceFilter.count===r-this.filterRemovedDocuments(e,t.targetId)?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.metadataProvider.getDatabaseId(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;!e.mightContain(s)&&(this.removeDocumentFromTarget(t,r,null),n++)}),n}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((r,n)=>{let i=this.targetDataForActiveTarget(n);if(i){if(r.current&&dc(i.target)){let t=new o_(i.target.path);null!==this.pendingDocumentUpdates.get(t)||this.targetContainsDocument(n,t)||this.removeDocumentFromTarget(n,t,cP.newNoDocument(t,e))}r.hasPendingChanges&&(t.set(n,r.toTargetChange()),r.clearPendingChanges())}});let r=d9();this.pendingDocumentTargetMapping.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.targetDataForActiveTarget(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.pendingDocumentUpdates.forEach((t,r)=>r.setReadTime(e));let n=new h6(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=dY(),this.pendingDocumentTargetMapping=pn(),this.pendingTargetResets=new uh(ol),n}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let n=this.ensureTargetState(e);this.targetContainsDocument(e,t)?n.addDocumentChange(t,1):n.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let t=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new pe,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new ug(ol),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=null!==this.targetDataForActiveTarget(e);return t||aZ(pt,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new pe),this.metadataProvider.getRemoteKeysForTarget(e).forEach(t=>{this.removeDocumentFromTarget(e,t,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}}function pn(){return new uh(o_.comparator)}function pi(){return new uh(o_.comparator)}function ps(e,t,r,n,i){var s,a,o,l,u,c;let d={localCacheCount:e,existenceFilterCount:t.count,databaseId:r.database,projectId:r.projectId},h=t.unchangedNames;return h&&(d.bloomFilter={applied:0===i,hashCount:null!==(s=null==h?void 0:h.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(l=null===(o=null===(a=null==h?void 0:h.bits)||void 0===a?void 0:a.bitmap)||void 0===o?void 0:o.length)&&void 0!==l?l:0,padding:null!==(c=null===(u=null==h?void 0:h.bits)||void 0===u?void 0:u.padding)&&void 0!==c?c:0,mightContain:e=>{var t;return null!==(t=null==n?void 0:n.mightContain(e))&&void 0!==t&&t}}),d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pa=(()=>{let e={};return e.asc="ASCENDING",e.desc="DESCENDING",e})(),po=(()=>{let e={};return e["<"]="LESS_THAN",e["<="]="LESS_THAN_OR_EQUAL",e[">"]="GREATER_THAN",e[">="]="GREATER_THAN_OR_EQUAL",e["=="]="EQUAL",e["!="]="NOT_EQUAL",e["array-contains"]="ARRAY_CONTAINS",e.in="IN",e["not-in"]="NOT_IN",e["array-contains-any"]="ARRAY_CONTAINS_ANY",e})(),pl=(()=>{let e={};return e.and="AND",e.or="OR",e})();class pu{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function pc(e){return new a6(void 0===e.code?a3.UNKNOWN:hH(e.code),e.message||"")}function pd(e,t){return e.useProto3Json||uq(t)?t:{value:t}}function ph(e){let t;return uq(t="object"==typeof e?e.value:e)?null:t}function pp(e,t){if(!e.useProto3Json)return{seconds:""+t.seconds,nanos:t.nanoseconds};{let e=new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),r=("000000000"+t.nanoseconds).slice(-9);return`${e}.${r}Z`}}function pf(e){let t=ux(e);return new op(t.seconds,t.nanos)}function pm(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function pg(e,t){return e.useProto3Json?(a2(void 0===t||"string"==typeof t),uw.fromBase64String(t||"")):(a2(void 0===t||t instanceof Buffer||t instanceof Uint8Array),uw.fromUint8Array(t||new Uint8Array))}function py(e,t){return pp(e,t.toTimestamp())}function pv(e){return a2(!!e),of.fromTimestamp(pf(e))}function pb(e,t){return p_(e,t).canonicalString()}function p_(e,t){let r=px(e).child("documents");return void 0===t?r:r.child(t)}function pT(e){let t=oy.fromString(e);return a2(fv(t)),t}function pS(e,t){return pb(e.databaseId,t.path)}function pw(e,t){let r=pT(t);if(r.get(1)!==e.databaseId.projectId)throw new a6(a3.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new a6(a3.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new o_(pk(r))}function pE(e,t){return pb(e.databaseId,t)}function pC(e){let t=pT(e);return 4===t.length?oy.emptyPath():pk(t)}function pI(e){return new oy(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function px(e){return new oy(["projects",e.projectId,"databases",e.database])}function pk(e){return a2(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function pN(e,t,r){return{name:pS(e,t),fields:r.value.mapValue.fields}}function pR(e,t){return{name:pS(e,t.key),fields:t.data.value.mapValue.fields,updateTime:pp(e,t.version.toTimestamp()),createTime:pp(e,t.createTime.toTimestamp())}}function pA(e,t,r){let n=pw(e,t.name),i=pv(t.updateTime),s=t.createTime?pv(t.createTime):of.min(),a=new cO({mapValue:{fields:t.fields}}),o=cP.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}function pO(e,t){a2(!!t.found),t.found.name,t.found.updateTime;let r=pw(e,t.found.name),n=pv(t.found.updateTime),i=t.found.createTime?pv(t.found.createTime):of.min(),s=new cO({mapValue:{fields:t.found.fields}});return cP.newFoundDocument(r,n,i,s)}function pD(e,t){a2(!!t.missing),a2(!!t.readTime);let r=pw(e,t.missing),n=pv(t.readTime);return cP.newNoDocument(r,n)}function pP(e,t){return"found"in t?pO(e,t):"missing"in t?pD(e,t):a1()}function pL(e,t){let r;if("targetChange"in t){t.targetChange;let n=pM(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=pg(e,t.targetChange.resumeToken),a=t.targetChange.cause;r=new h8(n,i,s,a&&pc(a)||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=pw(e,n.document.name),s=pv(n.document.updateTime),a=n.document.createTime?pv(n.document.createTime):of.min(),o=new cO({mapValue:{fields:n.document.fields}}),l=cP.newFoundDocument(i,s,a,o);r=new h9(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=pw(e,n.document),s=n.readTime?pv(n.readTime):of.min(),a=cP.newNoDocument(i,s);r=new h9([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=pw(e,n.document);r=new h9([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return a1();t.filter;let e=t.filter;e.targetId;let{count:n=0,unchangedNames:i}=e,s=new hG(n,i);r=new h7(e.targetId,s)}return r}function pM(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:a1()}function pF(e){if(!("targetChange"in e))return of.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length||!t.readTime?of.min():pv(t.readTime)}function pj(e,t){let r;if(t instanceof hN)r={update:pN(e,t.key,t.value)};else if(t instanceof hj)r={delete:pS(e,t.key)};else if(t instanceof hO)r={update:pN(e,t.key,t.data),updateMask:fg(t.fieldMask)};else{if(!(t instanceof hV))return a1();r={verify:pS(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(t=>p$(e,t))),t.precondition.isNone||(r.currentDocument=pU(e,t.precondition)),r}function pB(e,t){let r=t.currentDocument?pV(t.currentDocument):hT.none(),n=t.updateTransforms?t.updateTransforms.map(t=>pG(e,t)):[];if(t.update){t.update.name;let i=pw(e,t.update.name),s=new cO({mapValue:{fields:t.update.fields}});return t.updateMask?new hO(i,s,fy(t.updateMask),r,n):new hN(i,s,r,n)}return t.delete?new hj(pw(e,t.delete),r):t.verify?new hV(pw(e,t.verify),r):a1()}function pU(e,t){return void 0!==t.updateTime?{updateTime:py(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:a1()}function pV(e){return void 0!==e.updateTime?hT.updateTime(pv(e.updateTime)):void 0!==e.exists?hT.exists(e.exists):hT.none()}function pz(e,t){let r=e.updateTime?pv(e.updateTime):pv(t);return r.isEqual(of.min())&&(r=pv(t)),new h_(r,e.transformResults||[])}function pq(e,t){return e&&e.length>0?(a2(void 0!==t),e.map(e=>pz(e,t))):[]}function p$(e,t){let r=t.transform;if(r instanceof hl)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof hu)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof hd)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof hp)return{fieldPath:t.field.canonicalString(),increment:r.operand};throw a1()}function pG(e,t){let r=null;return"setToServerValue"in t?(a2("REQUEST_TIME"===t.setToServerValue),r=new hl):"appendMissingElements"in t?r=new hu(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new hd(t.removeAllFromArray.values||[]):"increment"in t?r=new hp(e,t.increment):a1(),new hy(ob.fromServerFormat(t.fieldPath),r)}function pW(e,t){return{documents:[pE(e,t.path)]}}function pK(e){return a2(1===e.documents.length),dN(dS(pC(e.documents[0])))}function pH(e,t){let r;let n={structuredQuery:{}},i=t.path;null!==t.collectionGroup?(r=i,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=i.popLast(),n.structuredQuery.from=[{collectionId:i.lastSegment()}]),n.parent=pE(e,r);let s=p1(t.filters);s&&(n.structuredQuery.where=s);let a=p3(t.orderBy);a&&(n.structuredQuery.orderBy=a);let o=pd(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=p5(t.startAt)),t.endAt&&(n.structuredQuery.endAt=p9(t.endAt)),{queryTarget:n,parent:r}}function pQ(e,t,r,n){let{queryTarget:i,parent:s}=pH(e,t),a={},o=[],l=0;return r.forEach(e=>{let t=n?e.alias:`aggregate_${l++}`;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:fa(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:fa(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},aliasMap:a,parent:s}}function pY(e){let t=pC(e.parent),r=e.structuredQuery,n=r.from?r.from.length:0,i=null;if(n>0){a2(1===n);let e=r.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];r.where&&(s=p2(r.where));let a=[];r.orderBy&&(a=p6(r.orderBy));let o=null;r.limit&&(o=ph(r.limit));let l=null;r.startAt&&(l=p7(r.startAt));let u=null;return r.endAt&&(u=p8(r.endAt)),dT(t,i,a,s,o,"F",l,u)}function pZ(e){return dN(pY(e))}function pJ(e,t){let r=pX(t.purpose);return null==r?null:{"goog-listen-tags":r}}function pX(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return a1()}}function p0(e,t){let r;let n=t.target;if((r=dc(n)?{documents:pW(e,n)}:{query:pH(e,n).queryTarget}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=pm(e,t.resumeToken);let n=pd(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(of.min())>0){r.readTime=pp(e,t.snapshotVersion.toTimestamp());let n=pd(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}function p1(e){if(0!==e.length)return fc(cK.create(e,"and"))}function p2(e){let t=p4(e);return t instanceof cK&&cY(t)?t.getFilters():[t]}function p4(e){return void 0!==e.unaryFilter?fp(e):void 0!==e.fieldFilter?ff(e):void 0!==e.compositeFilter?fm(e):a1()}function p3(e){if(0!==e.length)return e.map(e=>fl(e))}function p6(e){return e.map(e=>fu(e))}function p5(e){return{before:e.inclusive,values:e.position}}function p9(e){return{before:!e.inclusive,values:e.position}}function p7(e){let t=!!e.before;return new cM(e.values||[],t)}function p8(e){let t=!e.before;return new cM(e.values||[],t)}function fe(e){return pa[e]}function ft(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function fr(e){return po[e]}function fn(e){return pl[e]}function fi(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return a1()}}function fs(e){switch(e){case"AND":return"and";case"OR":return"or";default:return a1()}}function fa(e){return{fieldPath:e.canonicalString()}}function fo(e){return ob.fromServerFormat(e.fieldPath)}function fl(e){return{field:fa(e.field),direction:fe(e.dir)}}function fu(e){return new cV(fo(e.field),ft(e.direction))}function fc(e){return e instanceof cW?fh(e):e instanceof cK?fd(e):a1()}function fd(e){let t=e.getFilters().map(e=>fc(e));return 1===t.length?t[0]:{compositeFilter:{op:fn(e.op),filters:t}}}function fh(e){if("=="===e.op){if(cS(e.value))return{unaryFilter:{field:fa(e.field),op:"IS_NAN"}};if(cT(e.value))return{unaryFilter:{field:fa(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(cS(e.value))return{unaryFilter:{field:fa(e.field),op:"IS_NOT_NAN"}};if(cT(e.value))return{unaryFilter:{field:fa(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:fa(e.field),op:fr(e.op),value:e.value}}}function fp(e){switch(e.unaryFilter.op){case"IS_NAN":let t=fo(e.unaryFilter.field);return cW.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=fo(e.unaryFilter.field);return cW.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=fo(e.unaryFilter.field);return cW.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=fo(e.unaryFilter.field);return cW.create(i,"!=",{nullValue:"NULL_VALUE"});default:return a1()}}function ff(e){return cW.create(fo(e.fieldFilter.field),fi(e.fieldFilter.op),e.fieldFilter.value)}function fm(e){return cK.create(e.compositeFilter.filters.map(e=>p4(e)),fs(e.compositeFilter.op))}function fg(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function fy(e){return new u_((e.fieldPaths||[]).map(e=>ob.fromServerFormat(e)))}function fv(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fb{constructor(e,t,r,n,i=of.min(),s=of.min(),a=uw.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new fb(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new fb(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new fb(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new fb(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f_{constructor(e){this.remoteSerializer=e}}function fT(e,t){let r;if(t.document)r=pA(e.remoteSerializer,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=o_.fromSegments(t.noDocument.path),n=fI(t.noDocument.readTime);r=cP.newNoDocument(e,n),t.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!t.unknownDocument)return a1();let e=o_.fromSegments(t.unknownDocument.path),n=fI(t.unknownDocument.version);r=cP.newUnknownDocument(e,n)}return t.readTime&&r.setReadTime(fE(t.readTime)),r}function fS(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:fw(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=pR(e.remoteSerializer,t);else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:fC(t.version)};else{if(!t.isUnknownDocument())return a1();n.unknownDocument={path:r.path.toArray(),version:fC(t.version)}}return n}function fw(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function fE(e){let t=new op(e[0],e[1]);return of.fromTimestamp(t)}function fC(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function fI(e){let t=new op(e.seconds,e.nanoseconds);return of.fromTimestamp(t)}function fx(e,t,r){let n=r.baseMutations.map(t=>pj(e.remoteSerializer,t)),i=r.mutations.map(t=>pj(e.remoteSerializer,t));return{userId:t,batchId:r.batchId,localWriteTimeMs:r.localWriteTime.toMillis(),baseMutations:n,mutations:i}}function fk(e,t){let r=(t.baseMutations||[]).map(t=>pB(e.remoteSerializer,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){let n=t.mutations[e+1];r.updateTransforms=n.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}let n=t.mutations.map(t=>pB(e.remoteSerializer,t)),i=op.fromMillis(t.localWriteTimeMs);return new hz(t.batchId,i,r,n)}function fN(e){let t;let r=fI(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?fI(e.lastLimboFreeSnapshotVersion):of.min();return new fb(t=fA(e.query)?pK(e.query):pZ(e.query),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,n,uw.fromBase64String(e.resumeToken))}function fR(e,t){let r;let n=fC(t.snapshotVersion),i=fC(t.lastLimboFreeSnapshotVersion);r=dc(t.target)?pW(e.remoteSerializer,t.target):pH(e.remoteSerializer,t.target).queryTarget;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:da(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function fA(e){return void 0!==e.documents}function fO(e){return{id:e.bundleId,createTime:fI(e.createTime),version:e.version}}function fD(e){return{bundleId:e.id,createTime:fC(pv(e.createTime)),version:e.version}}function fP(e){return{name:e.name,query:fM(e.bundledQuery),readTime:fI(e.readTime)}}function fL(e){return{name:e.name,readTime:fC(pv(e.readTime)),bundledQuery:e.bundledQuery}}function fM(e){let t=pY({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?dP(t,t.limit,"L"):t}function fF(e){return{name:e.name,query:fM(e.bundledQuery),readTime:pv(e.readTime)}}function fj(e){return{id:e.id,version:e.version,createTime:pv(e.createTime)}}function fB(e,t){return new h$(t.largestBatchId,pB(e.remoteSerializer,t.overlayMutation))}function fU(e,t,r){let[n,i,s]=fV(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:pj(e.remoteSerializer,r.mutation)}}function fV(e,t){let r=t.path.lastSegment();return[e,o8(t.path.popLast()),r]}function fz(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function fq(e,t){let r=t?new oA(t.sequenceNumber,new oP(fI(t.readTime),new o_(lr(t.documentKey)),t.largestBatchId)):oA.empty(),n=e.fields.map(([e,t])=>new oN(ob.fromServerFormat(e),t));return new ow(e.indexId,e.collectionGroup,n,r)}function f$(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:fC(n.readTime),documentKey:o8(n.documentKey.path),largestBatchId:n.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fG{getBundleMetadata(e,t){return fW(e).get(t).next(e=>{if(e)return fO(e)})}saveBundleMetadata(e,t){return fW(e).put(fD(t))}getNamedQuery(e,t){return fK(e).get(t).next(e=>{if(e)return fP(e)})}saveNamedQuery(e,t){return fK(e).put(fL(t))}}function fW(e){return ul(e,lB)}function fK(e){return ul(e,lV)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fH{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){return new fH(e,t.uid||"")}getOverlay(e,t){return fQ(e).get(fV(this.userId,t)).next(e=>e?fB(this.serializer,e):null)}getOverlays(e,t){let r=d1();return oB.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,i)=>{let s=new h$(t,i);n.push(this.saveOverlay(e,s))}),oB.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(o8(e.getCollectionPath())));let i=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(fQ(e).deleteAll(l4,n))}),oB.waitFor(i)}getOverlaysForCollection(e,t,r){let n=d1(),i=o8(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return fQ(e).loadAll(l4,s).next(e=>{for(let t of e){let e=fB(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i;let s=d1(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return fQ(e).iterate({index:l6,range:a},(e,t,r)=>{let a=fB(this.serializer,t);s.size()<n||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>s)}saveOverlay(e,t){return fQ(e).put(fU(this.serializer,this.userId,t))}}function fQ(e){return ul(e,l1)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fY{globalsStore(e){return ul(e,l9)}getSessionToken(e){return this.globalsStore(e).get("sessionToken").next(e=>{let t=null==e?void 0:e.value;return t?uw.fromUint8Array(t):uw.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.globalsStore(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fZ=5,fJ=10,fX=13,f0=15,f1=20,f2=25,f4=30,f3=37,f6=45,f5=50,f9=53,f7=55,f8=60,me=2;class mt{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,fZ);else if("booleanValue"in e)this.writeValueTypeLabel(t,fJ),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,f0),t.writeNumber(uk(e.integerValue));else if("doubleValue"in e){let r=uk(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,fX):(this.writeValueTypeLabel(t,f0),u$(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,f1),"string"==typeof r&&(r=ux(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,f4),t.writeBytes(uN(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,f6),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?cI(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):cE(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):a1()}writeIndexString(e,t){this.writeValueTypeLabel(t,f2),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};for(let e of(this.writeValueTypeLabel(t,f7),Object.keys(r)))this.writeIndexString(e,t),this.writeIndexValueAux(r[e],t)}writeIndexVector(e,t){var r,n;let i=e.fields||{};this.writeValueTypeLabel(t,f9);let s=uY,a=(null===(n=null===(r=i[s].arrayValue)||void 0===r?void 0:r.values)||void 0===n?void 0:n.length)||0;this.writeValueTypeLabel(t,f0),t.writeNumber(uk(a)),this.writeIndexString(s,t),this.writeIndexValueAux(i[s],t)}writeIndexArray(e,t){let r=e.values||[];for(let e of(this.writeValueTypeLabel(t,f5),r))this.writeIndexValueAux(e,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,f3),o_.fromName(e).path.forEach(e=>{this.writeValueTypeLabel(t,f8),this.writeUnlabeledIndexString(e,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(me)}}mt.INSTANCE=new mt;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mr="\uD800",mn="\uDBFF",mi=0,ms=255,ma=1,mo=255,ml=255,mu=0,mc=64,md=8,mh=1024;function mp(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}function mf(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function mm(e){let t=0;for(let r=0;r<8;++r){let n=mf(255&e[r]);if(t+=n,8!==n)break}return t}function mg(e){return Math.ceil((mc-mm(e))/md)}class my{constructor(){this.buffer=new Uint8Array(mh),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteAscending(e);else if(e<2048)this.writeByteAscending(960|e>>>6),this.writeByteAscending(128|63&e);else if(t<mr||mn<t)this.writeByteAscending(480|e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e);else{let e=t.codePointAt(0);this.writeByteAscending(240|e>>>18),this.writeByteAscending(128|63&e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteDescending(e);else if(e<2048)this.writeByteDescending(960|e>>>6),this.writeByteDescending(128|63&e);else if(t<mr||mn<t)this.writeByteDescending(480|e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e);else{let e=t.codePointAt(0);this.writeByteDescending(240|e>>>18),this.writeByteDescending(128|63&e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=mg(t);this.ensureAvailable(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}writeNumberDescending(e){let t=this.toOrderedBits(e),r=mg(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}writeInfinityAscending(){this.writeEscapedByteAscending(mo),this.writeEscapedByteAscending(ml)}writeInfinityDescending(){this.writeEscapedByteDescending(mo),this.writeEscapedByteDescending(ml)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=mp(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let e=1;e<t.length;++e)t[e]^=r?255:0;return t}writeByteAscending(e){let t=255&e;t===mi?(this.writeEscapedByteAscending(mi),this.writeEscapedByteAscending(ms)):t===mo?(this.writeEscapedByteAscending(mo),this.writeEscapedByteAscending(mu)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=255&e;t===mi?(this.writeEscapedByteDescending(mi),this.writeEscapedByteDescending(ms)):t===mo?(this.writeEscapedByteDescending(mo),this.writeEscapedByteDescending(mu)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(mi),this.writeEscapedByteAscending(ma)}writeSeparatorDescending(){this.writeEscapedByteDescending(mi),this.writeEscapedByteDescending(ma)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class mv{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}}class mb{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}}class m_{constructor(){this.orderedCode=new my,this.ascending=new mv(this.orderedCode),this.descending=new mb(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return 0===e?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mT{constructor(e,t,r,n){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=n}successor(){let e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new mT(this.indexId,this.documentKey,this.arrayValue,r)}}function mS(e,t){let r=e.indexId-t.indexId;return 0!==r||0!==(r=mw(e.arrayValue,t.arrayValue))||0!==(r=mw(e.directionalValue,t.directionalValue))?r:o_.comparator(e.documentKey,t.documentKey)}function mw(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mE{constructor(e){for(let t of(this.inequalityFilters=new ug((e,t)=>ob.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[],e.filters)){let e=t;e.isInequality()?this.inequalityFilters=this.inequalityFilters.add(e):this.equalityFilters.push(e)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(a2(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=oE(e);if(void 0!==t&&!this.hasMatchingEqualityFilter(t))return!1;let r=oC(e),n=new Set,i=0,s=0;for(;i<r.length;++i)if(this.hasMatchingEqualityFilter(r[i]))n=n.add(r[i].fieldPath.canonicalString());else break;if(i===r.length)return!0;if(this.inequalityFilters.size>0){let e=this.inequalityFilters.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[i];if(!this.matchesFilter(e,t)||!this.matchesOrderBy(this.orderBys[s++],t))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[s++],e))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new ug(ob.comparator),t=[];for(let r of this.equalityFilters)if(!r.field.isKeyField()){if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new oN(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new oN(r.field,0))}}for(let r of this.orderBys)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new oN(r.field,"asc"===r.dir?0:1)));return new ow(ow.UNKNOWN_ID,this.collectionId,t,oA.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}matchesOrderBy(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mC(e){var t,r;if(a2(e instanceof cW||e instanceof cK),e instanceof cW){if(!(e instanceof dt))return e;{let n=(null===(r=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===r?void 0:r.map(t=>cW.create(e.field,"==",t)))||[];return cK.create(n,"or")}}let n=e.filters.map(e=>mC(e));return cK.create(n,e.op)}function mI(e){if(0===e.getFilters().length)return[];let t=mA(mC(e));return(a2(mN(t)),mx(t)||mk(t))?[t]:t.getFilters()}function mx(e){return e instanceof cW}function mk(e){return e instanceof cK&&cY(e)}function mN(e){return mx(e)||mk(e)||mR(e)}function mR(e){if(e instanceof cK&&cQ(e)){for(let t of e.getFilters())if(!mx(t)&&!mk(t))return!1;return!0}return!1}function mA(e){if(a2(e instanceof cW||e instanceof cK),e instanceof cW)return e;if(1===e.filters.length)return mA(e.filters[0]);let t=e.filters.map(e=>mA(e)),r=cK.create(t,e.op);return mN(r=mM(r))?r:(a2(r instanceof cK),a2(cH(r)),a2(r.filters.length>1),r.filters.reduce((e,t)=>mO(e,t)))}function mO(e,t){let r;return a2(e instanceof cW||e instanceof cK),a2(t instanceof cW||t instanceof cK),mM(r=e instanceof cW?t instanceof cW?mD(e,t):mL(e,t):t instanceof cW?mL(t,e):mP(e,t))}function mD(e,t){return cK.create([e,t],"and")}function mP(e,t){if(a2(e.filters.length>0&&t.filters.length>0),cH(e)&&cH(t))return c2(e,t.getFilters());let r=cQ(e)?e:t,n=cQ(e)?t:e,i=r.filters.map(e=>mO(e,n));return cK.create(i,"or")}function mL(e,t){if(cH(t))return c2(t,e.getFilters());{let r=t.filters.map(t=>mO(e,t));return cK.create(r,"or")}}function mM(e){if(a2(e instanceof cW||e instanceof cK),e instanceof cW)return e;let t=e.getFilters();if(1===t.length)return mM(t[0]);if(cZ(e))return e;let r=t.map(e=>mM(e)),n=[];return(r.forEach(t=>{t instanceof cW?n.push(t):t instanceof cK&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length)?n[0]:cK.create(n,e.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mF{constructor(){this.collectionParentIndex=new mj}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),oB.resolve()}getCollectionParents(e,t){return oB.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return oB.resolve()}deleteFieldIndex(e,t){return oB.resolve()}deleteAllFieldIndexes(e){return oB.resolve()}createTargetIndexes(e,t){return oB.resolve()}getDocumentsMatchingTarget(e,t){return oB.resolve(null)}getIndexType(e,t){return oB.resolve(0)}getFieldIndexes(e,t){return oB.resolve([])}getNextCollectionGroupToUpdate(e){return oB.resolve(null)}getMinOffset(e,t){return oB.resolve(oP.min())}getMinOffsetFromCollectionGroup(e,t){return oB.resolve(oP.min())}updateCollectionGroup(e,t,r){return oB.resolve()}updateIndexEntries(e,t){return oB.resolve()}}class mj{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new ug(oy.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new ug(oy.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mB="IndexedDbIndexManager",mU=new Uint8Array(0);class mV{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new mj,this.targetToDnfSubTargets=new dH(e=>da(e),(e,t)=>du(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let i={collectionId:r,parent:o8(n)};return mz(e).put(i)}return oB.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[oc(t),""],!1,!0);return mz(e).loadAll(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(lr(n.parent))}return r})}addFieldIndex(e,t){let r=m$(e),n=fz(t);delete n.indexId;let i=r.add(n);if(!t.indexState)return i.next();{let r=mG(e);return i.next(e=>{r.put(f$(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}}deleteFieldIndex(e,t){let r=m$(e),n=mG(e),i=mq(e);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=m$(e),r=mq(e),n=mG(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>n.deleteAll())}createTargetIndexes(e,t){return oB.forEach(this.getSubTargets(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new mE(t).buildTargetIndex();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=mq(e),n=!0,i=new Map;return oB.forEach(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(!n)return oB.resolve(null);{let e=d9(),n=[];return oB.forEach(i,(i,s)=>{aZ(mB,`Using index ${ok(i)} to execute ${da(t)}`);let a=dh(s,i),o=dp(s,i),l=df(s,i),u=dm(s,i),c=this.encodeBound(i,s,l),d=this.encodeBound(i,s,u),h=this.encodeValues(i,s,o),p=this.generateIndexRanges(i.indexId,a,c,l.inclusive,d,u.inclusive,h);return oB.forEach(p,i=>r.loadFirst(i,t.limit).next(t=>{t.forEach(t=>{let r=o_.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(t=0===e.filters.length?[e]:mI(cK.create(e.filters,"and")).map(t=>ds(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t)),t}generateIndexRanges(e,t,r,n,i,s,a){let o=(null!=t?t.length:1)*Math.max(r.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let c=0;c<o;++c){let o=t?this.encodeSingleElement(t[c/l]):mU,d=this.generateLowerBound(e,o,r[c%l],n),h=this.generateUpperBound(e,o,i[c%l],s),p=a.map(t=>this.generateLowerBound(e,o,t,!0));u.push(...this.createRange(d,h,p))}return u}generateLowerBound(e,t,r,n){let i=new mT(e,o_.empty(),t,r);return n?i:i.successor()}generateUpperBound(e,t,r,n){let i=new mT(e,o_.empty(),t,r);return n?i.successor():i}getFieldIndex(e,t){let r=new mE(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.servedByIndex(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.getSubTargets(t);return oB.forEach(n,t=>this.getFieldIndex(e,t).next(e=>{e?0!==r&&e.fields.length<dv(t)&&(r=1):r=0})).next(()=>db(t)&&n.length>1&&2===r?1:r)}encodeDirectionalElements(e,t){let r=new m_;for(let n of oC(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let i=r.forKind(n.kind);mt.INSTANCE.writeIndexValue(e,i)}return r.encodedBytes()}encodeSingleElement(e){let t=new m_;return mt.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new m_;return mt.INSTANCE.writeIndexValue(cg(this.databaseId,t),r.forKind(oI(e))),r.encodedBytes()}encodeValues(e,t,r){if(null===r)return[];let n=[];n.push(new m_);let i=0;for(let s of oC(e)){let e=r[i++];for(let r of n)if(this.isInFilter(t,s.fieldPath)&&c_(e))n=this.expandIndexValues(n,s,e);else{let t=r.forKind(s.kind);mt.INSTANCE.writeIndexValue(e,t)}}return this.getEncodedBytes(n)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let n=[...e],i=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new m_;n.seed(r.encodedBytes()),mt.INSTANCE.writeIndexValue(e,n.forKind(t.kind)),i.push(n)}return i}isInFilter(e,t){return!!e.filters.find(e=>e instanceof cW&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=m$(e),n=mG(e);return(t?r.loadAll(lG,IDBKeyRange.bound(t,t)):r.loadAll()).next(e=>{let t=[];return oB.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{t.push(fq(e,r))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:ol(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=m$(e),i=mG(e);return this.getNextSequenceNumber(e).next(e=>n.loadAll(lG,IDBKeyRange.bound(t,t)).next(t=>oB.forEach(t,t=>i.put(f$(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return oB.forEach(t,(t,n)=>{let i=r.get(t.collectionGroup);return(i?oB.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),oB.forEach(i,r=>this.getExistingIndexEntries(e,t,r).next(t=>{let i=this.computeIndexEntries(n,r);return t.isEqual(i)?oB.resolve():this.updateEntries(e,n,r,t,i)}))))})}addIndexEntry(e,t,r,n){return mq(e).put({indexId:n.indexId,uid:this.uid,arrayValue:n.arrayValue,directionalValue:n.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(r,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,r,n){return mq(e).delete([n.indexId,this.uid,n.arrayValue,n.directionalValue,this.encodeDirectionalKey(r,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,r){let n=mq(e),i=new ug(mS);return n.iterate({index:lX,range:IDBKeyRange.only([r.indexId,this.uid,this.encodeDirectionalKey(r,t)])},(e,n)=>{i=i.add(new mT(r.indexId,t,n.arrayValue,n.directionalValue))}).next(()=>i)}computeIndexEntries(e,t){let r=new ug(mS),n=this.encodeDirectionalElements(t,e);if(null==n)return r;let i=oE(t);if(null!=i){let s=e.data.field(i.fieldPath);if(c_(s))for(let i of s.arrayValue.values||[])r=r.add(new mT(t.indexId,e.key,this.encodeSingleElement(i),n))}else r=r.add(new mT(t.indexId,e.key,mU,n));return r}updateEntries(e,t,r,n,i){aZ(mB,"Updating index entries for document '%s'",t.key);let s=[];return uv(n,i,mS,n=>{s.push(this.addIndexEntry(e,t,r,n))},n=>{s.push(this.deleteIndexEntry(e,t,r,n))}),oB.waitFor(s)}getNextSequenceNumber(e){let t=1;return mG(e).iterate({index:lQ,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>mS(e,t)).filter((e,t,r)=>!t||0!==mS(e,r[t-1]));let n=[];for(let i of(n.push(e),r)){let r=mS(i,e),s=mS(i,t);if(0===r)n[0]=e.successor();else if(r>0&&s<0)n.push(i),n.push(i.successor());else if(s>0)break}n.push(t);let i=[];for(let e=0;e<n.length;e+=2){if(this.isRangeMatchable(n[e],n[e+1]))return[];let t=[n[e].indexId,this.uid,n[e].arrayValue,n[e].directionalValue,mU,[]],r=[n[e+1].indexId,this.uid,n[e+1].arrayValue,n[e+1].directionalValue,mU,[]];i.push(IDBKeyRange.bound(t,r))}return i}isRangeMatchable(e,t){return mS(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(mW)}getMinOffset(e,t){return oB.mapArray(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>e||a1())).next(mW)}}function mz(e){return ul(e,lL)}function mq(e){return ul(e,lZ)}function m$(e){return ul(e,lq)}function mG(e){return ul(e,lK)}function mW(e){a2(0!==e.length);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let i=e[n].indexState.offset;0>oL(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new oP(t.readTime,t.documentKey,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mK(e,t,r){let n=e.store(ll),i=e.store(lg),s=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.iterate({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{a2(1===o)}));let u=[];for(let e of r.mutations){let n=lf(t,e.key.path,r.batchId);s.push(i.delete(n)),u.push(e.key)}return oB.waitFor(s).next(()=>u)}function mH(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else if(e.noDocument)t=e.noDocument;else throw a1();return JSON.stringify(t).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mQ{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.documentKeysByBatchId={}}static forUser(e,t,r,n){return a2(""!==e.uid),new mQ(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return mJ(e).iterate({index:lc,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let i=mX(e),s=mJ(e);return s.add({}).next(a=>{a2("number"==typeof a);let o=new hz(a,t,r,n),l=fx(this.serializer,this.userId,o),u=[],c=new ug((e,t)=>ol(e.canonicalString(),t.canonicalString()));for(let e of n){let t=lf(this.userId,e.key.path,a);c=c.add(e.key.path.popLast()),u.push(s.put(l)),u.push(i.put(t,lm))}return c.forEach(t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=o.keys()}),oB.waitFor(u).next(()=>o)})}lookupMutationBatch(e,t){return mJ(e).get(t).next(e=>e?(a2(e.userId===this.userId),fk(this.serializer,e)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?oB.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(e=>{if(!e)return null;{let r=e.keys();return this.documentKeysByBatchId[t]=r,r}})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return mJ(e).iterate({index:lc,range:n},(e,t,n)=>{t.userId===this.userId&&(a2(t.batchId>=r),i=fk(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=uz;return mJ(e).iterate({index:lc,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,uz],[this.userId,Number.POSITIVE_INFINITY]);return mJ(e).loadAll(lc,t).next(e=>e.map(e=>fk(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=lp(this.userId,t.path),n=IDBKeyRange.lowerBound(r),i=[];return mX(e).iterate({range:n},(r,n,s)=>{let[a,o,l]=r,u=lr(o);if(a!==this.userId||!t.path.isEqual(u)){s.done();return}return mJ(e).get(l).next(e=>{if(!e)throw a1();a2(e.userId===this.userId),i.push(fk(this.serializer,e))})}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ug(ol),n=[];return t.forEach(t=>{let i=lp(this.userId,t.path),s=IDBKeyRange.lowerBound(i),a=mX(e).iterate({range:s},(e,n,i)=>{let[s,a,o]=e,l=lr(a);if(s!==this.userId||!t.path.isEqual(l)){i.done();return}r=r.add(o)});n.push(a)}),oB.waitFor(n).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=lp(this.userId,r),s=IDBKeyRange.lowerBound(i),a=new ug(ol);return mX(e).iterate({range:s},(e,t,i)=>{let[s,o,l]=e,u=lr(o);if(s!==this.userId||!r.isPrefixOf(u)){i.done();return}u.length===n&&(a=a.add(l))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],n=[];return t.forEach(t=>{n.push(mJ(e).get(t).next(e=>{if(null===e)throw a1();a2(e.userId===this.userId),r.push(fk(this.serializer,e))}))}),oB.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return mK(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),oB.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return oB.resolve();let r=IDBKeyRange.lowerBound(lh(this.userId)),n=[];return mX(e).iterate({range:r},(e,t,r)=>{if(e[0]!==this.userId){r.done();return}{let t=lr(e[1]);n.push(t)}}).next(()=>{a2(0===n.length)})})}containsKey(e,t){return mY(e,this.userId,t)}getMutationQueueMetadata(e){return m0(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:uz,lastStreamToken:""})}}function mY(e,t,r){let n=lp(t,r.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return mX(e).iterate({range:s,keysOnly:!0},(e,r,n)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),n.done()}).next(()=>a)}function mZ(e,t){let r=!1;return m0(e).iterateSerial(n=>mY(e,n,t).next(e=>(e&&(r=!0),oB.resolve(!e)))).next(()=>r)}function mJ(e){return ul(e,ll)}function mX(e){return ul(e,lg)}function m0(e){return ul(e,la)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let m1=2;class m2{constructor(e){this.lastId=e}next(){return this.lastId+=m1,this.lastId}static forTargetCache(){return new m2(2-m1)}static forSyncEngine(){return new m2(1-m1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m4{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new m2(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(e=>of.fromTimestamp(new op(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.saveMetadata(e,n)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>m3(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(t=>(a2(t.targetCount>0),t.targetCount-=1,this.saveMetadata(e,t)))}removeTargets(e,t,r){let n=0,i=[];return m3(e).iterate((s,a)=>{let o=fN(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,i.push(this.removeTargetData(e,o)))}).next(()=>oB.waitFor(i)).next(()=>n)}forEachTarget(e,t){return m3(e).iterate((e,r)=>{t(fN(r))})}retrieveMetadata(e){return m6(e).get(lD).next(e=>(a2(null!==e),e))}saveMetadata(e,t){return m6(e).put(lD,t)}saveTargetData(e,t){return m3(e).put(fR(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(e=>e.targetCount)}getTargetData(e,t){let r=da(t),n=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),i=null;return m3(e).iterate({range:n,index:lx},(e,r,n)=>{let s=fN(r);du(t,s.target)&&(i=s,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){let n=[],i=m5(e);return t.forEach(t=>{let s=o8(t.path);n.push(i.put({targetId:r,path:s})),n.push(this.referenceDelegate.addReference(e,r,t))}),oB.waitFor(n)}removeMatchingKeys(e,t,r){let n=m5(e);return oB.forEach(t,t=>{let i=o8(t.path);return oB.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=m5(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=m5(e),i=d9();return n.iterate({range:r,keysOnly:!0},(e,t,r)=>{let n=new o_(lr(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=o8(t.path),n=IDBKeyRange.bound([r],[oc(r)],!1,!0),i=0;return m5(e).iterate({index:lA,keysOnly:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}getTargetDataForTarget(e,t){return m3(e).get(t).next(e=>e?fN(e):null)}}function m3(e){return ul(e,lC)}function m6(e){return ul(e,lP)}function m5(e){return ul(e,lN)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let m9={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},m7=-1,m8=41943040;class ge{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new ge(e,ge.DEFAULT_COLLECTION_PERCENTILE,ge.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}ge.DEFAULT_COLLECTION_PERCENTILE=10,ge.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ge.DEFAULT=new ge(m8,ge.DEFAULT_COLLECTION_PERCENTILE,ge.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ge.DISABLED=new ge(m7,0,0);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gt="LruGarbageCollector",gr=1048576,gn=6e4,gi=3e5;function gs([e,t],[r,n]){let i=ol(e,r);return 0===i?ol(t,n):i}class ga{constructor(e){this.maxElements=e,this.buffer=new ug(gs),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>gs(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class go{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==m7&&this.scheduleGC(gn)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(e){aZ(gt,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){oK(e)?aZ(gt,"Ignoring IndexedDB error during garbage collection: ",e):await oj(e)}await this.scheduleGC(gi)})}}class gl{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return oB.resolve(o3.INVALID);let r=new ga(t);return this.delegate.forEachTarget(e,e=>r.addElement(e.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,e=>r.addElement(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===m7?(aZ("LruGarbageCollector","Garbage collection skipped; disabled"),oB.resolve(m9)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(aZ("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),m9):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,n,i,s,a,o,l;let u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(aZ("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,s=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,a=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(l=Date.now(),aY()<=c.DEBUG&&aZ("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${n} in ${a-s}ms
	Removed ${i} targets in ${o-a}ms
	Removed ${e} documents in ${l-o}ms
Total Duration: ${l-u}ms`),oB.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}function gu(e,t){return new gl(e,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gc{constructor(e,t){this.db=e,this.garbageCollector=gu(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(e,r)=>t(r))}addReference(e,t,r){return gp(e,r)}removeReference(e,t,r){return gp(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return gp(e,t)}isPinned(e,t){return mZ(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.forEachOrphanedDocument(e,(s,a)=>{if(a<=t){let t=this.isPinned(e,s).next(t=>{if(!t)return i++,r.getEntry(e,s).next(()=>(r.removeEntry(s,of.min()),m5(e).delete(gd(s))))});n.push(t)}}).next(()=>oB.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return gp(e,t)}forEachOrphanedDocument(e,t){let r;let n=m5(e),i=o3.INVALID;return n.iterate({index:lA},([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==o3.INVALID&&t(new o_(lr(r)),i),i=a,r=s):i=o3.INVALID}).next(()=>{i!==o3.INVALID&&t(new o_(lr(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function gd(e){return[0,o8(e.path)]}function gh(e,t){return{targetId:0,path:o8(e.path),sequenceNumber:t}}function gp(e,t){return m5(e).put(gh(t,e.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gf{constructor(){this.changes=new dH(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,cP.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?oB.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gm{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return gb(e).put(r)}removeEntry(e,t,r){return gb(e).delete(gT(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=cP.newInvalidDocument(t);return gb(e).iterate({index:lb,range:IDBKeyRange.only(g_(t))},(e,n)=>{r=this.maybeDecodeDocument(t,n)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:cP.newInvalidDocument(t)};return gb(e).iterate({index:lb,range:IDBKeyRange.only(g_(t))},(e,n)=>{r={document:this.maybeDecodeDocument(t,n),size:mH(n)}}).next(()=>r)}getEntries(e,t){let r=dY();return this.forEachDbEntry(e,t,(e,t)=>{let n=this.maybeDecodeDocument(e,t);r=r.insert(e,n)}).next(()=>r)}getSizedEntries(e,t){let r=dY(),n=new uh(o_.comparator);return this.forEachDbEntry(e,t,(e,t)=>{let i=this.maybeDecodeDocument(e,t);r=r.insert(e,i),n=n.insert(e,mH(t))}).next(()=>({documents:r,sizeMap:n}))}forEachDbEntry(e,t,r){if(t.isEmpty())return oB.resolve();let n=new ug(gw);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(g_(n.first()),g_(n.last())),s=n.getIterator(),a=s.getNext();return gb(e).iterate({index:lb,range:i},(e,t,n)=>{let i=o_.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>gw(a,i);)r(a,null),a=s.getNext();a&&a.isEqual(i)&&(r(a,t),a=s.hasNext()?s.getNext():null),a?n.skip(g_(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),fw(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return gb(e).loadAll(IDBKeyRange.bound(a,o,!0)).next(e=>{null==i||i.incrementDocumentReadCount(e.length);let r=dY();for(let i of e){let e=this.maybeDecodeDocument(o_.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(dU(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=dY(),s=gS(t,r),a=gS(t,oP.max());return gb(e).iterate({index:lT,range:IDBKeyRange.bound(s,a,!0)},(e,t,r)=>{let s=this.maybeDecodeDocument(o_.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new gy(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return gv(e).get(lE).next(e=>(a2(!!e),e))}setMetadata(e,t){return gv(e).put(lE,t)}maybeDecodeDocument(e,t){if(t){let e=fT(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(of.min())))return e}return cP.newInvalidDocument(e)}}function gg(e){return new gm(e)}class gy extends gf{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new dH(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new ug((e,t)=>ol(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.documentStates.get(i);if(t.push(this.documentCache.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=fS(this.documentCache.serializer,s);n=n.add(i.path.popLast());let l=mH(o);r+=l-a.size,t.push(this.documentCache.addEntry(e,i,o))}else if(r-=a.size,this.trackRemovals){let r=fS(this.documentCache.serializer,s.convertToNoDocument(of.min()));t.push(this.documentCache.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.documentCache.updateMetadata(e,r)),oB.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(e=>(this.documentStates.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:e,sizeMap:t})=>(t.forEach((t,r)=>{this.documentStates.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function gv(e){return ul(e,lw)}function gb(e){return ul(e,ly)}function g_(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function gT(e,t){let r=e.path.toArray();return[r.slice(0,r.length-2),r[r.length-2],fw(t),r[r.length-1]]}function gS(e,t){let r=t.documentKey.path.toArray();return[e,fw(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function gw(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=ol(r[e],n[e]))return i;return(i=ol(r.length,n.length))||(i=ol(r[r.length-2],n[n.length-2]))?i:ol(r[r.length-1],n[n.length-1])}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gE=17;/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gC{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gI{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&hI(r.mutation,e,u_.empty(),op.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,d9()).next(()=>t))}getLocalViewOfDocuments(e,t,r=d9()){let n=d1();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=dJ();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=d1();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,d9()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=dY(),s=d4(),a=dX();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof hO)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),hI(a.mutation,t,a.mutation.getFieldMask(),op.now())):s.set(t.key,u_.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var r;return a.set(e,new gC(t,null!==(r=s.get(e))&&void 0!==r?r:null))}),a))}recalculateAndSaveOverlays(e,t){let r=d4(),n=new uh((e,t)=>e-t),i=d9();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=r.get(e)||u_.empty();a=i.applyToLocalView(s,a),r.set(e,a);let o=(n.get(i.batchId)||d9()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{let s=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,u=d2();l.forEach(e=>{if(!i.has(e)){let n=hE(t.get(e),r.get(e));null!==n&&u.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return oB.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return dI(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):dx(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):oB.resolve(d1()),a=oT,o=i;return s.next(t=>oB.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t))?oB.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)})).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,d9())).next(e=>({batchId:a,changes:d0(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new o_(t)).next(e=>{let t=dJ();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=dJ();return this.indexManager.getCollectionParents(e,i).next(a=>oB.forEach(a,a=>{let o=dw(t,a.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,cP.newInvalidDocument(n)))});let r=dJ();return e.forEach((e,n)=>{let s=i.get(e);void 0!==s&&hI(s.mutation,n,u_.empty(),op.now()),dU(t,n)&&(r=r.insert(e,n))}),r})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gx{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return oB.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,fj(t)),oB.resolve()}getNamedQuery(e,t){return oB.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,fF(t)),oB.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gk{constructor(){this.overlays=new uh(o_.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return oB.resolve(this.overlays.get(t))}getOverlays(e,t){let r=d1();return oB.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.saveOverlay(e,t,n)}),oB.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.overlayByBatchId.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.overlayByBatchId.delete(r)),oB.resolve()}getOverlaysForCollection(e,t,r){let n=d1(),i=t.length+1,s=new o_(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return oB.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new uh((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=d1(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=d1(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return oB.resolve(a)}saveOverlay(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.overlayByBatchId.get(n.largestBatchId).delete(r.key);this.overlayByBatchId.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new h$(t,r));let i=this.overlayByBatchId.get(t);void 0===i&&(i=d9(),this.overlayByBatchId.set(t,i)),this.overlayByBatchId.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gN{constructor(){this.sessionToken=uw.EMPTY_BYTE_STRING}getSessionToken(e){return oB.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,oB.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(){this.refsByKey=new ug(gA.compareByKey),this.refsByTarget=new ug(gA.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new gA(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.removeRef(new gA(e,t))}removeReferences(e,t){e.forEach(e=>this.removeReference(e,t))}removeReferencesForId(e){let t=new o_(new oy([])),r=new gA(t,e),n=new gA(t,e+1),i=[];return this.refsByTarget.forEachInRange([r,n],e=>{this.removeRef(e),i.push(e.key)}),i}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new o_(new oy([])),r=new gA(t,e),n=new gA(t,e+1),i=d9();return this.refsByTarget.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new gA(e,0),r=this.refsByKey.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class gA{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return o_.comparator(e.key,t.key)||ol(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return ol(e.targetOrBatchId,t.targetOrBatchId)||o_.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gO{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new ug(gA.compareByKey)}checkEmpty(e){return oB.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new hz(i,t,r,n);for(let t of(this.mutationQueue.push(s),n))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new gA(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return oB.resolve(s)}lookupMutationBatch(e,t){return oB.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=this.indexOfBatchId(r),i=n<0?0:n;return oB.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return oB.resolve(0===this.mutationQueue.length?uz:this.nextBatchId-1)}getAllMutationBatches(e){return oB.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new gA(t,0),n=new gA(t,Number.POSITIVE_INFINITY),i=[];return this.batchesByDocumentKey.forEachInRange([r,n],e=>{let t=this.findMutationBatch(e.targetOrBatchId);i.push(t)}),oB.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ug(ol);return t.forEach(e=>{let t=new gA(e,0),n=new gA(e,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([t,n],e=>{r=r.add(e.targetOrBatchId)})}),oB.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;o_.isDocumentKey(i)||(i=i.child(""));let s=new gA(new o_(i),0),a=new ug(ol);return this.batchesByDocumentKey.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.targetOrBatchId)),!0)},s),oB.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(e=>{let r=this.findMutationBatch(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){a2(0===this.indexOfExistingBatchId(t.batchId,"removed")),this.mutationQueue.shift();let r=this.batchesByDocumentKey;return oB.forEach(t.mutations,n=>{let i=new gA(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.batchesByDocumentKey=r})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new gA(t,0),n=this.batchesByDocumentKey.firstAfterOrEqual(r);return oB.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,oB.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gD(){return new uh(o_.comparator)}class gP{constructor(e){this.sizer=e,this.docs=gD(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return oB.resolve(r?r.document.mutableCopy():cP.newInvalidDocument(t))}getEntries(e,t){let r=dY();return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():cP.newInvalidDocument(e))}),oB.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=dY(),s=t.path,a=new o_(s.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;!(e.path.length>s.length+1||0>=oL(oD(a),r))&&(n.has(a.key)||dU(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return oB.resolve(i)}getAllFromCollectionGroup(e,t,r,n){a1()}forEachDocumentKey(e,t){return oB.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new gM(this)}getSize(e){return oB.resolve(this.size)}}function gL(e){return new gP(e)}class gM extends gf{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.documentCache.addEntry(e,n)):this.documentCache.removeEntry(r)}),oB.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gF{constructor(e){this.persistence=e,this.targets=new dH(e=>da(e),du),this.lastRemoteSnapshotVersion=of.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new gR,this.targetCount=0,this.targetIdGenerator=m2.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((e,r)=>t(r)),oB.resolve()}getLastRemoteSnapshotVersion(e){return oB.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return oB.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),oB.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),oB.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new m2(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,oB.resolve()}updateTargetData(e,t){return this.saveTargetData(t),oB.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,oB.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.targets.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.targets.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),oB.waitFor(i).next(()=>n)}getTargetCount(e){return oB.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return oB.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),oB.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),oB.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),oB.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return oB.resolve(r)}containsKey(e,t){return oB.resolve(this.references.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gj="MemoryPersistence";class gB{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new o3(0),this._started=!1,this._started=!0,this.globalsCache=new gN,this.referenceDelegate=e(this),this.targetCache=new gF(this);let r=e=>this.referenceDelegate.documentSize(e);this.indexManager=new mF,this.remoteDocumentCache=gL(r),this.serializer=new f_(t),this.bundleCache=new gx(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new gk,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new gO(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){aZ(gj,"Starting transaction:",e);let n=new gU(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(n).next(e=>this.referenceDelegate.onTransactionCommitted(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}mutationQueuesContainKey(e,t){return oB.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}}class gU extends oF{constructor(e){super(),this.currentSequenceNumber=e}}class gV{constructor(e){this.persistence=e,this.localViewReferences=new gR,this._orphanedDocuments=null}static factory(e){return new gV(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw a1()}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),oB.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),oB.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),oB.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(e=>this.orphanedDocuments.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.orphanedDocuments.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return oB.forEach(this.orphanedDocuments,r=>{let n=o_.fromPath(r);return this.isReferenced(e,n).next(e=>{e||t.removeEntry(n,of.min())})}).next(()=>(this._orphanedDocuments=null,t.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(e=>{e?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return oB.or([()=>oB.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}}class gz{constructor(e,t){this.persistence=e,this.orphanedSequenceNumbers=new dH(e=>o8(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=gu(this,t)}static factory(e,t){return new gz(e,t)}onTransactionStarted(){}onTransactionCommitted(e){return oB.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachOrphanedDocumentSequenceNumber(e,t){return oB.forEach(this.orphanedSequenceNumbers,(r,n)=>this.isPinned(e,r,n).next(e=>e?oB.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.forEachDocumentKey(e,n=>this.isPinned(e,n,t).next(e=>{e||(r++,i.removeEntry(n,of.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),oB.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),oB.resolve()}removeReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),oB.resolve()}updateLimboDocument(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),oB.resolve()}documentSize(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=cp(e.data.value)),t}isPinned(e,t,r){return oB.or([()=>this.persistence.mutationQueuesContainKey(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.orphanedSequenceNumbers.get(t);return oB.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gq{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,n){let i=new oz("createOrUpgrade",t);r<1&&n>=1&&(gG(e),gW(e),gZ(e),gH(e));let s=oB.resolve();return r<3&&n>=3&&(0!==r&&(gJ(e),gZ(e)),s=s.next(()=>g0(i))),r<4&&n>=4&&(0!==r&&(s=s.next(()=>gK(e,i))),s=s.next(()=>{g1(e)})),r<5&&n>=5&&(s=s.next(()=>this.removeAcknowledgedMutations(i))),r<6&&n>=6&&(s=s.next(()=>(gY(e),this.addDocumentGlobal(i)))),r<7&&n>=7&&(s=s.next(()=>this.ensureSequenceNumbers(i))),r<8&&n>=8&&(s=s.next(()=>this.createCollectionParentIndex(e,i))),r<9&&n>=9&&(s=s.next(()=>{gX(e)})),r<10&&n>=10&&(s=s.next(()=>this.rewriteCanonicalIds(i))),r<11&&n>=11&&(s=s.next(()=>{g2(e),g4(e)})),r<12&&n>=12&&(s=s.next(()=>{g6(e)})),r<13&&n>=13&&(s=s.next(()=>gQ(e)).next(()=>this.rewriteRemoteDocumentCache(e,i)).next(()=>e.deleteObjectStore(ln))),r<14&&n>=14&&(s=s.next(()=>this.runOverlayMigration(e,i))),r<15&&n>=15&&(s=s.next(()=>g3(e))),r<16&&n>=16&&(s=s.next(()=>{t.objectStore(lK).clear()}).next(()=>{t.objectStore(lZ).clear()})),r<17&&n>=17&&(s=s.next(()=>{g5(e)})),s}addDocumentGlobal(e){let t=0;return e.store(ln).iterate((e,r)=>{t+=mH(r)}).next(()=>{let r={byteSize:t};return e.store(lw).put(lE,r)})}removeAcknowledgedMutations(e){let t=e.store(la),r=e.store(ll);return t.loadAll().next(t=>oB.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,uz],[t.userId,t.lastAcknowledgedBatchId]);return r.loadAll(lc,n).next(r=>oB.forEach(r,r=>{a2(r.userId===t.userId);let n=fk(this.serializer,r);return mK(e,t.userId,n).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(lN),r=e.store(ln);return e.store(lP).get(lD).next(e=>{let n=r=>t.put({targetId:0,path:o8(r),sequenceNumber:e.highestListenSequenceNumber}),i=[];return r.iterate((e,r)=>{let s=new oy(e),a=g$(s);i.push(t.get(a).next(e=>e?oB.resolve():n(s)))}).next(()=>oB.waitFor(i))})}createCollectionParentIndex(e,t){e.createObjectStore(lL,{keyPath:lM});let r=t.store(lL),n=new mj,i=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:o8(n)})}};return t.store(ln).iterate({keysOnly:!0},(e,t)=>i(new oy(e).popLast())).next(()=>t.store(lg).iterate({keysOnly:!0},([e,t,r],n)=>i(lr(t).popLast())))}rewriteCanonicalIds(e){let t=e.store(lC);return t.iterate((e,r)=>{let n=fN(r),i=fR(this.serializer,n);return t.put(i)})}rewriteRemoteDocumentCache(e,t){let r=t.store(ln),n=[];return r.iterate((e,r)=>{let i=t.store(ly),s=g9(r).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>oB.waitFor(n))}runOverlayMigration(e,t){let r=t.store(ll),n=gg(this.serializer),i=new gB(gV.factory,this.serializer.remoteSerializer);return r.loadAll().next(e=>{let r=new Map;return e.forEach(e=>{var t;let n=null!==(t=r.get(e.userId))&&void 0!==t?t:d9();fk(this.serializer,e).keys().forEach(e=>n=n.add(e)),r.set(e.userId,n)}),oB.forEach(r,(e,r)=>{let s=new aG(r),a=fH.forUser(this.serializer,s),o=i.getIndexManager(s);return new gI(n,mQ.forUser(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new uo(t,o3.INVALID),e).next()})})}}function g$(e){return[0,o8(e)]}function gG(e){e.createObjectStore(li)}function gW(e){e.createObjectStore(la,{keyPath:lo}),e.createObjectStore(ll,{keyPath:lu,autoIncrement:!0}).createIndex(lc,ld,{unique:!0}),e.createObjectStore(lg)}function gK(e,t){return t.store(ll).loadAll().next(r=>{e.deleteObjectStore(ll),e.createObjectStore(ll,{keyPath:lu,autoIncrement:!0}).createIndex(lc,ld,{unique:!0});let n=t.store(ll),i=r.map(e=>n.put(e));return oB.waitFor(i)})}function gH(e){e.createObjectStore(ln)}function gQ(e){let t=e.createObjectStore(ly,{keyPath:lv});t.createIndex(lb,l_),t.createIndex(lT,lS)}function gY(e){e.createObjectStore(lw)}function gZ(e){e.createObjectStore(lN,{keyPath:lR}).createIndex(lA,lO,{unique:!0}),e.createObjectStore(lC,{keyPath:lI}).createIndex(lx,lk,{unique:!0}),e.createObjectStore(lP)}function gJ(e){e.deleteObjectStore(lN),e.deleteObjectStore(lC),e.deleteObjectStore(lP)}function gX(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}function g0(e){let t=e.store(lP),r={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:of.min().toTimestamp(),targetCount:0};return t.put(lD,r)}function g1(e){e.createObjectStore(lF,{keyPath:lj})}function g2(e){e.createObjectStore(lB,{keyPath:lU})}function g4(e){e.createObjectStore(lV,{keyPath:lz})}function g3(e){e.createObjectStore(lq,{keyPath:l$,autoIncrement:!0}).createIndex(lG,lW,{unique:!1}),e.createObjectStore(lK,{keyPath:lH}).createIndex(lQ,lY,{unique:!1}),e.createObjectStore(lZ,{keyPath:lJ}).createIndex(lX,l0,{unique:!1})}function g6(e){let t=e.createObjectStore(l1,{keyPath:l2});t.createIndex(l4,l3,{unique:!1}),t.createIndex(l6,l5,{unique:!1})}function g5(e){e.createObjectStore(l9,{keyPath:l7})}function g9(e){return e.document?new o_(oy.fromString(e.document.name).popFirst(5)):e.noDocument?o_.fromSegments(e.noDocument.path):e.unknownDocument?o_.fromSegments(e.unknownDocument.path):a1()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let g7="IndexedDbPersistence",g8=18e5,ye=5e3,yt=4e3,yr="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",yn="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",yi="firestore_zombie",ys="main";class ya{constructor(e,t,r,n,i,s,a,o,l,u,c=gE){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=i,this.window=s,this.document=a,this.sequenceNumberSyncer=l,this.forceOwningTab=u,this.schemaVersion=c,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=e=>Promise.resolve(),!ya.isAvailable())throw new a6(a3.UNIMPLEMENTED,yn);this.referenceDelegate=new gc(this,n),this.dbName=t+ys,this.serializer=new f_(o),this.simpleDb=new oq(this.dbName,this.schemaVersion,new gq(this.serializer)),this.globalsCache=new fY,this.targetCache=new m4(this.referenceDelegate,this.serializer),this.remoteDocumentCache=gg(this.serializer),this.bundleCache=new fG,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===u&&aJ(g7,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new a6(a3.FAILED_PRECONDITION,yr);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new o3(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>yl(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(e=>{e||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(t=>this.isPrimary&&!t?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):!!t&&this.acquireOrExtendPrimaryLease(e).next(()=>!0))).catch(e=>{if(oK(e))return aZ(g7,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return aZ(g7,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return yo(e).get(ls).next(e=>oB.resolve(this.isLocalClient(e)))}removeClientMetadata(e){return yl(e).delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,g8)){this.lastGarbageCollectionTime=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=ul(e,lF);return t.loadAll().next(e=>{let r=this.filterActiveClients(e,g8),n=e.filter(e=>-1===r.indexOf(e));return oB.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",yt,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return!!e&&e.ownerId===this.clientId}canActAsPrimary(e){return this.forceOwningTab?oB.resolve(!0):yo(e).get(ls).next(t=>{if(null!==t&&this.isWithinAge(t.leaseTimestampMs,ye)&&!this.isClientZombied(t.ownerId)){if(this.isLocalClient(t)&&this.networkEnabled)return!0;if(!this.isLocalClient(t)){if(!t.allowTabSynchronization)throw new a6(a3.FAILED_PRECONDITION,yr);return!1}}return!!this.networkEnabled&&!!this.inForeground||yl(e).loadAll().next(e=>void 0===this.filterActiveClients(e,ye).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&aZ(g7,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[li,lF],e=>{let t=new uo(e,o3.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients(e,t){return e.filter(e=>this.isWithinAge(e.updateTimeMs,t)&&!this.isClientZombied(e.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>yl(e).loadAll().next(e=>this.filterActiveClients(e,g8).map(e=>e.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(e,t){return mQ.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new mV(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return fH.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){let n;aZ(g7,"Starting transaction:",e);let i="readonly"===t?"readonly":"readwrite",s=ua(this.schemaVersion);return this.simpleDb.runTransaction(e,i,s,i=>(n=new uo(i,this.listenSequence?this.listenSequence.next():o3.INVALID),"readwrite-primary"===t)?this.verifyPrimaryLease(n).next(e=>!!e||this.canActAsPrimary(n)).next(t=>{if(!t)throw aJ(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new a6(a3.FAILED_PRECONDITION,oM);return r(n)}).next(e=>this.acquireOrExtendPrimaryLease(n).next(()=>e)):this.verifyAllowTabSynchronization(n).next(()=>r(n))).then(e=>(n.raiseOnCommittedEvent(),e))}verifyAllowTabSynchronization(e){return yo(e).get(ls).next(e=>{if(null!==e&&this.isWithinAge(e.leaseTimestampMs,ye)&&!this.isClientZombied(e.ownerId)&&!this.isLocalClient(e)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!e.allowTabSynchronization))throw new a6(a3.FAILED_PRECONDITION,yr)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return yo(e).put(ls,t)}static isAvailable(){return oq.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=yo(e);return t.get(ls).next(e=>this.isLocalClient(e)?(aZ(g7,"Releasing primary lease."),t.delete(ls)):oB.resolve())}isWithinAge(e,t){let r=Date.now(),n=r-t,i=r;return!(e<n)&&(!(e>i)||(aJ(`Detected an update time that is in the future: ${e} > ${i}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.windowUnloadHandler=()=>{this.markClientZombied();let e=/(?:Version|Mobile)\/1[456]/;r1()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let r=(null===(t=this.webStorage)||void 0===t?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return aZ(g7,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(e){return aJ(g7,"Failed to get zombied client id.",e),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){aJ("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(e){}}zombiedClientLocalStorageKey(e){return`${yi}_${this.persistenceKey}_${e}`}}function yo(e){return ul(e,li)}function yl(e){return ul(e,lF)}function yu(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yc(e,t,r,n,i){t=[...t],(e=[...e]).sort(r),t.sort(r);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=r(e[l],t[o]);s<0?i(e[l++]):s>0?n(t[o++]):(o++,l++)}for(;o<a;)n(t[o++]);for(;l<s;)i(e[l++])}function yd(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yh="LocalStore",yp=3e8;class yf{constructor(e,t,r,n){this.persistence=e,this.queryEngine=t,this.serializer=n,this.targetDataByTarget=new uh(ol),this.targetIdByTarget=new dH(e=>da(e),du),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new gI(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}}function ym(e,t,r,n){return new yf(e,t,r,n)}async function yg(e,t){let r=a4(e);return await r.persistence.runTransaction("Handle user change","readonly",e=>{let n;return r.mutationQueue.getAllMutationBatches(e).next(i=>(n=i,r.initializeUserComponents(t),r.mutationQueue.getAllMutationBatches(e))).next(t=>{let i=[],s=[],a=d9();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return r.localDocuments.getDocuments(e,a).next(e=>({affectedDocuments:e,removedBatchIds:i,addedBatchIds:s}))})})}function yy(e,t){let r,n;let i=a4(e),s=op.now(),a=t.reduce((e,t)=>e.add(t.key),d9());return i.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=dY(),l=d9();return i.remoteDocuments.getEntries(e,a).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(e,o)).next(n=>{r=n;let a=[];for(let e of t){let t=hx(e,r.get(e.key).overlayedDocument);null!=t&&a.push(new hO(e.key,t,cD(t.value.mapValue),hT.exists(!0)))}return i.mutationQueue.addMutationBatch(e,s,a,t)}).next(t=>{n=t;let s=t.applyToLocalDocumentSet(r,l);return i.documentOverlayCache.saveOverlays(e,t.batchId,s)})}).then(()=>({batchId:n.batchId,changes:d0(r)}))}function yv(e,t){let r=a4(e);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n=t.batch.keys(),i=r.remoteDocuments.newChangeBuffer({trackRemovals:!0});return yD(r,e,t,i).next(()=>i.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,yb(t))).next(()=>r.localDocuments.getDocuments(e,n))})}function yb(e){let t=d9();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}function y_(e,t){let r=a4(e);return r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(a2(null!==t),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))})}function yT(e){let t=a4(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}function yS(e){let t=a4(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.targetCache.getLastRemoteSnapshotVersion(e))}function yw(e,t){let r=a4(e),n=t.snapshotVersion,i=r.targetDataByTarget;return r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=r.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=r.targetDataByTarget;let a=[];t.targetChanges.forEach((s,o)=>{let l=i.get(o);if(!l)return;a.push(r.targetCache.removeMatchingKeys(e,s.removedDocuments,o).next(()=>r.targetCache.addMatchingKeys(e,s.addedDocuments,o)));let u=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?u=u.withResumeToken(uw.EMPTY_BYTE_STRING,of.min()).withLastLimboFreeSnapshotVersion(of.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,n)),i=i.insert(o,u),yC(l,u,s)&&a.push(r.targetCache.updateTargetData(e,u))});let o=dY(),l=d9();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(yE(e,s,t.documentUpdates).next(e=>{o=e.changedDocuments,l=e.existenceChangedKeys})),!n.isEqual(of.min())){let t=r.targetCache.getLastRemoteSnapshotVersion(e).next(t=>r.targetCache.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return oB.waitFor(a).next(()=>s.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(r.targetDataByTarget=i,e))}function yE(e,t,r){let n=d9(),i=d9();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=dY();return r.forEach((r,s)=>{let a=e.get(r);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(r)),s.isNoDocument()&&s.version.isEqual(of.min())?(t.removeEntry(r,s.readTime),n=n.insert(r,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),n=n.insert(r,s)):aZ(yh,"Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",s.version)}),{changedDocuments:n,existenceChangedKeys:i}})}function yC(e,t,r){return!!(0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=yp)||r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size>0}async function yI(e,t){let r=a4(e);try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>oB.forEach(t,t=>oB.forEach(t.addedKeys,n=>r.persistence.referenceDelegate.addReference(e,t.targetId,n)).next(()=>oB.forEach(t.removedKeys,n=>r.persistence.referenceDelegate.removeReference(e,t.targetId,n)))))}catch(e){if(oK(e))aZ(yh,"Failed to update sequence numbers: "+e);else throw e}for(let e of t){let t=e.targetId;if(!e.fromCache){let e=r.targetDataByTarget.get(t),n=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(n);r.targetDataByTarget=r.targetDataByTarget.insert(t,i)}}}function yx(e,t){let r=a4(e);return r.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=uz),r.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function yk(e,t){let r=a4(e);return r.persistence.runTransaction("read document","readonly",e=>r.localDocuments.getDocument(e,t))}function yN(e,t){let r=a4(e);return r.persistence.runTransaction("Allocate target","readwrite",e=>{let n;return r.targetCache.getTargetData(e,t).next(i=>i?(n=i,oB.resolve(n)):r.targetCache.allocateTargetId(e).next(i=>(n=new fb(t,i,"TargetPurposeListen",e.currentSequenceNumber),r.targetCache.addTargetData(e,n).next(()=>n))))}).then(e=>{let n=r.targetDataByTarget.get(e.targetId);return(null===n||e.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(r.targetDataByTarget=r.targetDataByTarget.insert(e.targetId,e),r.targetIdByTarget.set(t,e.targetId)),e})}function yR(e,t,r){let n=a4(e),i=n.targetIdByTarget.get(r);return void 0!==i?oB.resolve(n.targetDataByTarget.get(i)):n.targetCache.getTargetData(t,r)}async function yA(e,t,r){let n=a4(e),i=n.targetDataByTarget.get(t),s=r?"readwrite":"readwrite-primary";try{r||await n.persistence.runTransaction("Release target",s,e=>n.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(oK(e))aZ(yh,`Failed to update sequence numbers for target ${t}: ${e}`);else throw e}n.targetDataByTarget=n.targetDataByTarget.remove(t),n.targetIdByTarget.delete(i.target)}function yO(e,t,r){let n=a4(e),i=of.min(),s=d9();return n.persistence.runTransaction("Execute query","readwrite",e=>yR(n,e,dN(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,n.targetCache.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>n.queryEngine.getDocumentsMatchingQuery(e,t,r?i:of.min(),r?s:d9())).next(e=>(yB(n,dG(t),e),{documents:e,remoteKeys:s})))}function yD(e,t,r,n){let i=r.batch,s=i.keys(),a=oB.resolve();return s.forEach(e=>{a=a.next(()=>n.getEntry(t,e)).next(t=>{let s=r.docVersions.get(e);a2(null!==s),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,r),t.isValidDocument()&&(t.setReadTime(r.commitVersion),n.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))}function yP(e,t){let r=a4(e),n=a4(r.mutationQueue);return r.persistence.runTransaction("Lookup mutation documents","readonly",e=>n.lookupMutationKeys(e,t).next(t=>t?r.localDocuments.getDocuments(e,t):oB.resolve(null)))}function yL(e,t){a4(a4(e,yf).mutationQueue).removeCachedMutationKeys(t)}function yM(e){return a4(a4(e,yf).persistence).getActiveClients()}function yF(e,t){let r=a4(e),n=a4(r.targetCache),i=r.targetDataByTarget.get(t);return i?Promise.resolve(i.target):r.persistence.runTransaction("Get target data","readonly",e=>n.getTargetDataForTarget(e,t).next(e=>e?e.target:null))}function yj(e,t){let r=a4(e),n=r.collectionGroupReadTime.get(t)||of.min();return r.persistence.runTransaction("Get new document changes","readonly",e=>r.remoteDocuments.getAllFromCollectionGroup(e,t,oO(n,oT),Number.MAX_SAFE_INTEGER)).then(e=>(yB(r,t,e),e))}function yB(e,t,r){let n=e.collectionGroupReadTime.get(t)||of.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.collectionGroupReadTime.set(t,n)}function yU(e){return dN(dS(oy.fromString(`__bundle__/docs/${e}`)))}async function yV(e,t,r,n){let i=a4(e),s=d9(),a=dY();for(let e of r){let r=t.toDocumentKey(e.metadata.name);e.document&&(s=s.add(r));let n=t.toMutableDocument(e);n.setReadTime(t.toSnapshotVersion(e.metadata.readTime)),a=a.insert(r,n)}let o=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=await yN(i,yU(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",e=>yE(e,o,a).next(t=>(o.apply(e),t)).next(t=>i.targetCache.removeMatchingKeysForTargetId(e,l.targetId).next(()=>i.targetCache.addMatchingKeys(e,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(e,t.changedDocuments,t.existenceChangedKeys)).next(()=>t.changedDocuments)))}function yz(e,t){let r=a4(e),n=pv(t.createTime);return r.persistence.runTransaction("hasNewerBundle","readonly",e=>r.bundleCache.getBundleMetadata(e,t.id)).then(e=>!!e&&e.createTime.compareTo(n)>=0)}function yq(e,t){let r=a4(e);return r.persistence.runTransaction("Save bundle","readwrite",e=>r.bundleCache.saveBundleMetadata(e,t))}async function y$(e,t,r=d9()){let n=await yN(e,dN(fM(t.bundledQuery))),i=a4(e);return i.persistence.runTransaction("Save named query","readwrite",e=>{let s=pv(t.readTime);if(n.snapshotVersion.compareTo(s)>=0)return i.bundleCache.saveNamedQuery(e,t);let a=n.withResumeToken(uw.EMPTY_BYTE_STRING,s);return i.targetDataByTarget=i.targetDataByTarget.insert(a.targetId,a),i.targetCache.updateTargetData(e,a).next(()=>i.targetCache.removeMatchingKeysForTargetId(e,n.targetId)).next(()=>i.targetCache.addMatchingKeys(e,r,n.targetId)).next(()=>i.bundleCache.saveNamedQuery(e,t))})}function yG(e,t){a4(e).queryEngine.indexAutoCreationEnabled=t}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yW{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yK=100;function yH(){return r1()?8:o$(rQ())>0?6:4}class yQ{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=yK,this.relativeIndexReadCostPerDocument=yH()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.performQueryUsingIndex(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.performQueryUsingRemoteKeys(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new yW;return this.executeFullCollectionScan(e,t,r).next(n=>{if(i.result=n,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,r,n.size)})}).next(()=>i.result)}createCacheIndexes(e,t,r,n){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(aY()<=c.DEBUG&&aZ("QueryEngine","SDK will not create cache indexes for query:",dB(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),oB.resolve()):(aY()<=c.DEBUG&&aZ("QueryEngine","Query:",dB(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*n)?(aY()<=c.DEBUG&&aZ("QueryEngine","The SDK decides to create cache indexes for query:",dB(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,dN(t))):oB.resolve()}performQueryUsingIndex(e,t){if(dE(t))return oB.resolve(null);let r=dN(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=dN(t=dP(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=d9(...n);return this.localDocumentsView.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let s=this.applyQuery(t,n);return this.needsRefill(t,s,i,r.readTime)?this.performQueryUsingIndex(e,dP(t,null,"F")):this.appendRemainingResults(e,s,t,r)}))})))}performQueryUsingRemoteKeys(e,t,r,n){return dE(t)||n.isEqual(of.min())?oB.resolve(null):this.localDocumentsView.getDocuments(e,r).next(i=>{let s=this.applyQuery(t,i);return this.needsRefill(t,s,r,n)?oB.resolve(null):(aY()<=c.DEBUG&&aZ("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),dB(t)),this.appendRemainingResults(e,s,t,oO(n,oT)).next(e=>e))})}applyQuery(e,t){let r=new ug(dW(e));return t.forEach((t,n)=>{dU(e,n)&&(r=r.add(n))}),r}needsRefill(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}executeFullCollectionScan(e,t,r){return aY()<=c.DEBUG&&aZ("QueryEngine","Using full collection scan to execute query:",dB(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,oP.min(),r)}appendRemainingResults(e,t,r,n){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yY="firestore_clients";function yZ(e,t){return`${yY}_${e}_${t}`}let yJ="firestore_mutations";function yX(e,t,r){let n=`${yJ}_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}let y0="firestore_targets";function y1(e,t){return`${y0}_${e}_${t}`}let y2="firestore_online_state";function y4(e){return`${y2}_${e}`}let y3="firestore_bundle_loaded_v2";function y6(e){return`${y3}_${e}`}let y5="firestore_sequence_number";function y9(e){return`${y5}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let y7="SharedClientState";class y8{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static fromWebStorageEntry(e,t,r){let n;let i=JSON.parse(r),s="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return(s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(n=new a6(i.error.code,i.error.message)),s)?new y8(e,t,i.state,n):(aJ(y7,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ve{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r;let n=JSON.parse(t),i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return(i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new a6(n.error.code,n.error.message)),i)?new ve(e,n.state,r):(aJ(y7,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class vt{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,i=d8();for(let e=0;n&&e<r.activeTargetIds.length;++e)n=uG(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new vt(e,i):(aJ(y7,`Failed to parse client data for instance '${e}': ${t}`),null)}}class vr{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new vr(t.clientId,t.onlineState):(aJ(y7,`Failed to parse online state: ${e}`),null)}}class vn{constructor(){this.activeTargetIds=d8()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class vi{constructor(e,t,r,n,i){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new uh(ol),this.started=!1,this.earlyEvents=[];let s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.localClientStorageKey=yZ(this.persistenceKey,this.localClientId),this.sequenceNumberKey=y9(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new vn),this.clientStateKeyRe=RegExp(`^${yY}_${s}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${yJ}_${s}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${y0}_${s}_(\\d+)$`),this.onlineStateKey=y4(this.persistenceKey),this.bundleLoadedKey=y6(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}async start(){for(let e of(await this.syncEngine.getActiveClients())){if(e===this.localClientId)continue;let t=this.getItem(yZ(this.persistenceKey,e));if(t){let r=vt.fromWebStorageEntry(e,t);r&&(this.activeClients=this.activeClients.insert(r.clientId,r))}}this.persistClientState();let e=this.storage.getItem(this.onlineStateKey);if(e){let t=this.fromWebStorageOnlineState(e);t&&this.handleOnlineStateEvent(t)}for(let e of this.earlyEvents)this.handleWebStorageEvent(e);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(y1(this.persistenceKey,e));if(t){let n=ve.fromWebStorageEntry(e,t);n&&(r=n.state)}}return t&&this.localClientState.addQueryTarget(e),this.persistClientState(),r}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(y1(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.removeMutationState(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return aZ(y7,"READ",e,t),t}setItem(e,t){aZ(y7,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){aZ(y7,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(aZ(y7,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){aJ("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(async()=>{if(!this.started){this.earlyEvents.push(t);return}if(null!==t.key){if(this.clientStateKeyRe.test(t.key)){if(null!=t.newValue){let e=this.fromWebStorageClientState(t.key,t.newValue);if(e)return this.handleClientStateEvent(e.clientId,e)}else{let e=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(e,null)}}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(e)return this.handleMutationBatchEvent(e)}}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(e)return this.handleQueryTargetEvent(e)}}else if(t.key===this.onlineStateKey){if(null!==t.newValue){let e=this.fromWebStorageOnlineState(t.newValue);if(e)return this.handleOnlineStateEvent(e)}}else if(t.key===this.sequenceNumberKey){let e=vs(t.newValue);e!==o3.INVALID&&this.sequenceNumberHandler(e)}else if(t.key===this.bundleLoadedKey){let e=this.fromWebStoreBundleLoadedState(t.newValue);await Promise.all(e.map(e=>this.syncEngine.synchronizeWithChangedDocuments(e)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let n=new y8(this.currentUser,e,t,r),i=yX(this.persistenceKey,this.currentUser,e);this.setItem(i,n.toWebStorageJSON())}removeMutationState(e){let t=yX(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let n=y1(this.persistenceKey,e),i=new ve(e,t,r);this.setItem(n,i.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return vt.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),n=Number(r[1]),i=void 0!==r[2]?r[2]:null;return y8.fromWebStorageEntry(new aG(i),n,t)}fromWebStorageQueryTargetMetadata(e,t){let r=Number(this.queryTargetKeyRe.exec(e)[1]);return ve.fromWebStorageEntry(r,t)}fromWebStorageOnlineState(e){return vr.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}async handleMutationBatchEvent(e){if(e.user.uid!==this.currentUser.uid){aZ(y7,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),n=this.extractActiveQueryTargets(this.activeClients),i=this.extractActiveQueryTargets(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.applyActiveTargetsChange(s,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=d8();return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}function vs(e){let t=o3.INVALID;if(null!=e)try{let r=JSON.parse(e);a2("number"==typeof r),t=r}catch(e){aJ(y7,"Failed to read sequence number from WebStorage",e)}return t}class va{constructor(){this.localState=new vn,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new vn,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vo{addCallback(e){}shutdown(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vl{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vu=null;function vc(){return 268435456+Math.round(2147483648*Math.random())}function vd(){return null===vu?vu=vc():vu++,"0x"+vu.toString(16)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vh(e){return new Promise((t,r)=>{e((e,n)=>{e?r(e):t(n)})})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vp="1.9.1",vf="GrpcConnection",vm=`gl-node/${process.versions.node} fire/${aW} grpc/${vp}`;function vg(e,t,r,n){a2(null===t||"OAuth"===t.type);let i=new aV.SF;return t&&t.headers.forEach((e,t)=>i.set(t,e)),r&&r.headers.forEach((e,t)=>i.set(t,e)),n&&i.set("X-Firebase-GMPID",n),i.set("X-Goog-Api-Client",vm),i.set("Google-Cloud-Resource-Prefix",e),i.set("x-goog-request-params",e),i}class vy{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){aZ(vf,"Creating Firestore stub.");let e=this.databaseInfo.ssl?aV.K9.createSsl():aV.K9.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,n,i){let s=vd(),a=this.ensureActiveStub(),o=vg(this.databasePath,n,i,this.databaseInfo.appId),l=Object.assign({database:this.databasePath},r);return vh(t=>(aZ(vf,`RPC '${e}' ${s} invoked with request:`,r),a[e](l,o,(r,n)=>{r?(aZ(vf,`RPC '${e}' ${s} failed with error:`,r),t(new a6(hH(r.code),r.message))):(aZ(vf,`RPC '${e}' ${s} completed with response:`,n),t(void 0,n))})))}invokeStreamingRPC(e,t,r,n,i,s){let a=vd(),o=[],l=new a5;aZ(vf,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),c=vg(this.databasePath,n,i,this.databaseInfo.appId),d=Object.assign(Object.assign({},r),{database:this.databasePath}),h=u[e](d,c),p=!1;return h.on("data",t=>{aZ(vf,`RPC ${e} ${a} received result:`,t),o.push(t),void 0!==s&&o.length===s&&(p=!0,l.resolve(o))}),h.on("end",()=>{aZ(vf,`RPC '${e}' ${a} completed.`),p||(p=!0,l.resolve(o))}),h.on("error",t=>{aZ(vf,`RPC '${e}' ${a} failed with error:`,t);let r=hH(t.code);l.reject(new a6(r,t.message))}),l.promise}openStream(e,t,r){let n=vd(),i=this.ensureActiveStub(),s=vg(this.databasePath,t,r,this.databaseInfo.appId),a=i[e](s),o=!1,l=e=>{o||(o=!0,u.callOnClose(e),a.end())},u=new vl({sendFn:t=>{if(o)aZ(vf,`RPC '${e}' stream ${n} not sending because gRPC stream is closed:`,t);else{aZ(vf,`RPC '${e}' stream ${n} sending:`,t);try{a.write(t)}catch(e){throw aJ("Failure sending:",t),aJ("Error:",e),e}}},closeFn:()=>{aZ(vf,`RPC '${e}' stream ${n} closed locally via close().`),l()}}),c=!1;return a.on("data",t=>{o||(aZ(vf,`RPC '${e}' stream ${n} received:`,t),c||(u.callOnConnected(),c=!0),u.callOnMessage(t))}),a.on("end",()=>{aZ(vf,`RPC '${e}' stream ${n} ended.`),l()}),a.on("error",t=>{o||(aX(vf,`RPC '${e}' stream ${n} error. Code:`,t.code,"Message:",t.message),l(new a6(hH(t.code),t.message)))}),aZ(vf,`Opening RPC '${e}' stream ${n} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}}let vv={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var vb={nested:vv},v_=Object.freeze({__proto__:null,nested:vv,default:vb});/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vT={longs:String,enums:String,defaults:!0,oneofs:!1};function vS(){let e=az.im(v_,vT);return aV.Rz(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vw(e){return new vy(vS(),e)}function vE(){return new vo}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vC(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function vI(){return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vx(e){return new pu(e,!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vk="ExponentialBackoff",vN=1e3,vR=1.5,vA=6e4;class vO{constructor(e,t,r=vN,n=vR,i=vA){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=n,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),n=Math.max(0,t-r);n>0&&aZ(vk,`Backing off for ${n} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,n,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vD="PersistentStream",vP=6e4,vL=1e4;class vM{constructor(e,t,r,n,i,s,a,o){this.queue=e,this.idleTimerId=r,this.healthTimerId=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new vO(e,t)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){if(this.responseCount=0,4===this.state){this.performBackoff();return}this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,vP,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(e,t){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==e?this.backoff.reset():t&&t.code===a3.RESOURCE_EXHAUSTED?(aJ(t.toString()),aJ("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===a3.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,await this.listener.onClose(t)}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.closeCount===t&&this.startStream(e,r)},t=>{e(()=>{let e=new a6(a3.UNKNOWN,"Fetching auth token failed: "+t.message);return this.handleStreamClose(e)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,vL,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(e=>{r(()=>this.handleStreamClose(e))}),this.stream.onMessage(e=>{r(()=>1==++this.responseCount?this.onFirst(e):this.onNext(e))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(e){return aZ(vD,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(aZ(vD,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class vF extends vM{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=pL(this.serializer,e),r=pF(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=pI(this.serializer),t.addTarget=p0(this.serializer,e);let r=pJ(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=pI(this.serializer),t.removeTarget=e,this.sendRequest(t)}}class vj extends vM{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return a2(!!e.streamToken),this.lastStreamToken=e.streamToken,a2(!e.writeResults||0===e.writeResults.length),this.listener.onHandshakeComplete()}onNext(e){a2(!!e.streamToken),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=pq(e.writeResults,e.commitTime),r=pv(e.commitTime);return this.listener.onMutationResult(r,t)}writeHandshake(){let e={};e.database=pI(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>pj(this.serializer,e))};this.sendRequest(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vB{}class vU extends vB{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new a6(a3.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,n){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.invokeRPC(e,p_(t,r),n,i,s)).catch(e=>{if("FirebaseError"===e.name)throw e.code===a3.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new a6(a3.UNKNOWN,e.toString())})}invokeStreamingRPC(e,t,r,n,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.invokeStreamingRPC(e,p_(t,r),n,s,a,i)).catch(e=>{if("FirebaseError"===e.name)throw e.code===a3.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new a6(a3.UNKNOWN,e.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}}function vV(e,t,r,n){return new vU(e,t,r,n)}async function vz(e,t){let r=a4(e),n={writes:t.map(e=>pj(r.serializer,e))};await r.invokeRPC("Commit",r.serializer.databaseId,oy.emptyPath(),n)}async function vq(e,t){let r=a4(e),n={documents:t.map(e=>pS(r.serializer,e))},i=await r.invokeStreamingRPC("BatchGetDocuments",r.serializer.databaseId,oy.emptyPath(),n,t.length),s=new Map;i.forEach(e=>{let t=pP(r.serializer,e);s.set(t.key.toString(),t)});let a=[];return t.forEach(e=>{let t=s.get(e.toString());a2(!!t),a.push(t)}),a}async function v$(e,t,r){var n;let i=a4(e),{request:s,aliasMap:a,parent:o}=pQ(i.serializer,dR(t),r);i.connection.shouldResourcePathBeIncludedInRequest||delete s.parent;let l=(await i.invokeStreamingRPC("RunAggregationQuery",i.serializer.databaseId,o,s,1)).filter(e=>!!e.result);a2(1===l.length);let u=null===(n=l[0].result)||void 0===n?void 0:n.aggregateFields;return Object.keys(u).reduce((e,t)=>(e[a[t]]=u[t],e),{})}function vG(e,t,r){let n=a4(e);return n.verifyInitialized(),new vj(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}function vW(e,t,r){let n=a4(e);return n.verifyInitialized(),new vF(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vK="OnlineStateTracker",vH=1,vQ=1e4;class vY{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",vQ,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${vQ/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=vH&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${vH} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===e&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(aJ(t),this.shouldWarnClientIsOffline=!1):aZ(vK,t)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vZ="RemoteStore",vJ=10;class vX{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=i,this.connectivityMonitor.addCallback(e=>{r.enqueueAndForget(async()=>{be(this)&&(aZ(vZ,"Restarting streams for network reachability change."),await b_(this))})}),this.onlineStateTracker=new vY(r,n)}}function v0(e,t,r,n,i){return new vX(e,t,r,n,i)}async function v1(e){if(be(e))for(let t of e.onNetworkStatusChange)await t(!0)}async function v2(e){for(let t of e.onNetworkStatusChange)await t(!1)}async function v4(e){let t=a4(e);aZ(vZ,"RemoteStore shutting down."),t.offlineCauses.add(5),await v2(t),t.connectivityMonitor.shutdown(),t.onlineStateTracker.set("Unknown")}function v3(e,t){let r=a4(e);!r.listenTargets.has(t.targetId)&&(r.listenTargets.set(t.targetId,t),v8(r)?v7(r):bw(r).isOpen()&&v5(r,t))}function v6(e,t){let r=a4(e),n=bw(r);r.listenTargets.delete(t),n.isOpen()&&v9(r,t),0===r.listenTargets.size&&(n.isOpen()?n.markIdle():be(r)&&r.onlineStateTracker.set("Unknown"))}function v5(e,t){if(e.watchChangeAggregator.recordPendingTargetRequest(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(of.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}bw(e).watch(t)}function v9(e,t){e.watchChangeAggregator.recordPendingTargetRequest(t),bw(e).unwatch(t)}function v7(e){e.watchChangeAggregator=new pr({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),getTargetDataForTarget:t=>e.listenTargets.get(t)||null,getDatabaseId:()=>e.datastore.serializer.databaseId}),bw(e).start(),e.onlineStateTracker.handleWatchStreamStart()}function v8(e){return be(e)&&!bw(e).isStarted()&&e.listenTargets.size>0}function be(e){return 0===a4(e).offlineCauses.size}function bt(e){e.watchChangeAggregator=void 0}async function br(e){e.onlineStateTracker.set("Online")}async function bn(e){e.listenTargets.forEach((t,r)=>{v5(e,t)})}async function bi(e,t){bt(e),v8(e)?(e.onlineStateTracker.handleWatchStreamFailure(t),v7(e)):e.onlineStateTracker.set("Unknown")}async function bs(e,t,r){if(e.onlineStateTracker.set("Online"),t instanceof h8&&2===t.state&&t.cause){try{await bu(e,t)}catch(r){aZ(vZ,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await ba(e,r)}return}if(t instanceof h9?e.watchChangeAggregator.handleDocumentChange(t):t instanceof h7?e.watchChangeAggregator.handleExistenceFilter(t):e.watchChangeAggregator.handleTargetChange(t),!r.isEqual(of.min()))try{let t=await yS(e.localStore);r.compareTo(t)>=0&&await bl(e,r)}catch(t){aZ(vZ,"Failed to raise snapshot:",t),await ba(e,t)}}async function ba(e,t,r){if(oK(t))e.offlineCauses.add(1),await v2(e),e.onlineStateTracker.set("Offline"),r||(r=()=>yS(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{aZ(vZ,"Retrying IndexedDB access"),await r(),e.offlineCauses.delete(1),await v1(e)});else throw t}function bo(e,t){return t().catch(r=>ba(e,r,t))}function bl(e,t){let r=e.watchChangeAggregator.createRemoteEvent(t);return r.targetChanges.forEach((r,n)=>{if(r.resumeToken.approximateByteSize()>0){let i=e.listenTargets.get(n);i&&e.listenTargets.set(n,i.withResumeToken(r.resumeToken,t))}}),r.targetMismatches.forEach((t,r)=>{let n=e.listenTargets.get(t);n&&(e.listenTargets.set(t,n.withResumeToken(uw.EMPTY_BYTE_STRING,n.snapshotVersion)),v9(e,t),v5(e,new fb(n.target,t,r,n.sequenceNumber)))}),e.remoteSyncer.applyRemoteEvent(r)}async function bu(e,t){let r=t.cause;for(let n of t.targetIds)e.listenTargets.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.listenTargets.delete(n),e.watchChangeAggregator.removeTarget(n))}async function bc(e){let t=a4(e),r=bE(t),n=t.writePipeline.length>0?t.writePipeline[t.writePipeline.length-1].batchId:uz;for(;bd(t);)try{let e=await yx(t.localStore,n);if(null===e){0===t.writePipeline.length&&r.markIdle();break}n=e.batchId,bh(t,e)}catch(e){await ba(t,e)}bp(t)&&bf(t)}function bd(e){return be(e)&&e.writePipeline.length<vJ}function bh(e,t){e.writePipeline.push(t);let r=bE(e);r.isOpen()&&r.handshakeComplete&&r.writeMutations(t.mutations)}function bp(e){return be(e)&&!bE(e).isStarted()&&e.writePipeline.length>0}function bf(e){bE(e).start()}async function bm(e){bE(e).writeHandshake()}async function bg(e){let t=bE(e);for(let r of e.writePipeline)t.writeMutations(r.mutations)}async function by(e,t,r){let n=e.writePipeline.shift(),i=hq.from(n,t,r);await bo(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await bc(e)}async function bv(e,t){t&&bE(e).handshakeComplete&&await bb(e,t),bp(e)&&bf(e)}async function bb(e,t){if(hK(t.code)){let r=e.writePipeline.shift();bE(e).inhibitBackoff(),await bo(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await bc(e)}}async function b_(e){let t=a4(e);t.offlineCauses.add(4),await v2(t),t.onlineStateTracker.set("Unknown"),t.offlineCauses.delete(4),await v1(t)}async function bT(e,t){let r=a4(e);r.asyncQueue.verifyOperationInProgress(),aZ(vZ,"RemoteStore received new credentials");let n=be(r);r.offlineCauses.add(3),await v2(r),n&&r.onlineStateTracker.set("Unknown"),await r.remoteSyncer.handleCredentialChange(t),r.offlineCauses.delete(3),await v1(r)}async function bS(e,t){let r=a4(e);t?(r.offlineCauses.delete(2),await v1(r)):t||(r.offlineCauses.add(2),await v2(r),r.onlineStateTracker.set("Unknown"))}function bw(e){return e.watchStream||(e.watchStream=vW(e.datastore,e.asyncQueue,{onConnected:br.bind(null,e),onOpen:bn.bind(null,e),onClose:bi.bind(null,e),onWatchChange:bs.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.watchStream.inhibitBackoff(),v8(e)?v7(e):e.onlineStateTracker.set("Unknown")):(await e.watchStream.stop(),bt(e))})),e.watchStream}function bE(e){return e.writeStream||(e.writeStream=vG(e.datastore,e.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:bm.bind(null,e),onClose:bv.bind(null,e),onHandshakeComplete:bg.bind(null,e),onMutationResult:by.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.writeStream.inhibitBackoff(),await bc(e)):(await e.writeStream.stop(),e.writePipeline.length>0&&(aZ(vZ,`Stopping write stream with ${e.writePipeline.length} pending writes`),e.writePipeline=[]))})),e.writeStream}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bC="AsyncQueue";class bI{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new a5,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let s=new bI(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new a6(a3.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function bx(e,t){if(aJ(bC,`${t}: ${e}`),oK(e))return new a6(a3.UNAVAILABLE,`${t}: ${e}`);throw e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bk{constructor(e){e?this.comparator=(t,r)=>e(t,r)||o_.comparator(t.key,r.key):this.comparator=(e,t)=>o_.comparator(e.key,t.key),this.keyedMap=dJ(),this.sortedSet=new uh(this.comparator)}static emptySet(e){return new bk(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof bk)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return(this.forEach(t=>{e.push(t.toString())}),0===e.length)?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new bk;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bN{constructor(){this.changeMap=new uh(o_.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}0!==e.type&&3===r.type?this.changeMap=this.changeMap.insert(t,e):3===e.type&&1!==r.type?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.changeMap=this.changeMap.remove(t):1===e.type&&2===r.type?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):a1()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}}class bR{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new bR(e,t,bk.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!dF(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bA{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}}function bO(){return new bD}class bD{constructor(){this.queries=bP(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){bU(this,new a6(a3.ABORTED,"Firestore shutting down"))}}function bP(){return new dH(e=>dj(e),dF)}async function bL(e,t){let r=a4(e),n=3,i=t.query,s=r.queries.get(i);s?!s.hasRemoteListeners()&&t.listensToRemoteStore()&&(n=2):(s=new bA,n=t.listensToRemoteStore()?0:1);try{switch(n){case 0:s.viewSnap=await r.onListen(i,!0);break;case 1:s.viewSnap=await r.onListen(i,!1);break;case 2:await r.onFirstRemoteStoreListen(i)}}catch(r){let e=bx(r,`Initialization of query '${dB(t.query)}' failed`);t.onError(e);return}r.queries.set(i,s),s.listeners.push(t),t.applyOnlineStateChange(r.onlineState),s.viewSnap&&t.onViewSnapshot(s.viewSnap)&&bV(r)}async function bM(e,t){let r=a4(e),n=t.query,i=3,s=r.queries.get(n);if(s){let e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),0===s.listeners.length?i=t.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&t.listensToRemoteStore()&&(i=2))}switch(i){case 0:return r.queries.delete(n),r.onUnlisten(n,!0);case 1:return r.queries.delete(n),r.onUnlisten(n,!1);case 2:return r.onLastRemoteStoreUnlisten(n);default:return}}function bF(e,t){let r=a4(e),n=!1;for(let e of t){let t=e.query,i=r.queries.get(t);if(i){for(let t of i.listeners)t.onViewSnapshot(e)&&(n=!0);i.viewSnap=e}}n&&bV(r)}function bj(e,t,r){let n=a4(e),i=n.queries.get(t);if(i)for(let e of i.listeners)e.onError(r);n.queries.delete(t)}function bB(e,t){let r=a4(e);r.onlineState=t;let n=!1;r.queries.forEach((e,r)=>{for(let e of r.listeners)e.applyOnlineStateChange(t)&&(n=!0)}),n&&bV(r)}function bU(e,t){let r=a4(e),n=r.queries;r.queries=bP(),n.forEach((e,r)=>{for(let e of r.listeners)e.onError(t)})}function bV(e){e.snapshotsInSyncListeners.forEach(e=>{e.next()})}!function(e){e.Default="default",e.Cache="cache"}(f||(f={}));class bz{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new bR(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r="Offline"!==t;return(!this.options.waitForSyncWhenOnline||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return(!!e.syncStateChanged||!!t)&&!0===this.options.includeMetadataChanges}raiseInitialEvent(e){e=bR.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==f.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bq{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=n}static fromSnapshot(e,t){let r=d9(),n=d9();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new bq(e,t.fromCache,r,n)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b${constructor(e){this.serializer=e}toDocumentKey(e){return pw(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?pA(this.serializer,e.document,!1):cP.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return pv(e)}}class bG{constructor(e,t,r){this.bundleMetadata=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=bW(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),!e.payload.documentMetadata.exists&&++t;let r=oy.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,r=new b$(this.serializer);for(let n of e)if(n.metadata.queries){let e=r.toDocumentKey(n.metadata.name);for(let r of n.metadata.queries){let n=(t.get(r)||d9()).add(e);t.set(r,n)}}return t}async complete(){let e=await yV(this.localStore,new b$(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let e of this.queries)await y$(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}}}function bW(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}function bK(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bH{constructor(e){this.key=e}}class bQ{constructor(e){this.key=e}}class bY{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=d9(),this.mutatedKeys=d9(),this.docComparator=dW(e),this.documentSet=new bk(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new bN,n=t?t.documentSet:this.documentSet,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let u=n.get(e),c=dU(this.query,t)?t:null,d=!!u&&this.mutatedKeys.has(u.key),h=!!c&&(c.hasLocalMutations||this.mutatedKeys.has(c.key)&&c.hasCommittedMutations),p=!1;u&&c?u.data.isEqual(c.data)?d!==h&&(r.track({type:3,doc:c}),p=!0):!this.shouldWaitForSyncedDocument(u,c)&&(r.track({type:2,doc:c}),p=!0,(o&&this.docComparator(c,o)>0||l&&0>this.docComparator(c,l))&&(a=!0)):!u&&c?(r.track({type:0,doc:c}),p=!0):u&&!c&&(r.track({type:1,doc:u}),p=!0,(o||l)&&(a=!0)),p&&(c?(s=s.add(c),i=h?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{documentSet:s,changeSet:r,needsRefill:a,mutatedKeys:i}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let s=e.changeSet.getChanges();s.sort((e,t)=>bZ(e.type,t.type)||this.docComparator(e.doc,t.doc)),this.applyTargetChange(r),n=null!=n&&n;let a=t&&!n?this.updateLimboDocuments():[],o=0===this.limboDocuments.size&&this.current&&!n?1:0,l=o!==this.syncState;return(this.syncState=o,0!==s.length||l)?{snapshot:new bR(this.query,e.documentSet,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),limboChanges:a}:{limboChanges:a}}applyOnlineStateChange(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new bN,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!this._syncedDocuments.has(e)&&!!this.documentSet.has(e)&&!this.documentSet.get(e).hasLocalMutations}applyTargetChange(e){e&&(e.addedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.delete(e)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=d9(),this.documentSet.forEach(e=>{this.shouldBeInLimbo(e.key)&&(this.limboDocuments=this.limboDocuments.add(e.key))});let t=[];return e.forEach(e=>{this.limboDocuments.has(e)||t.push(new bQ(e))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new bH(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=d9();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return bR.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}}function bZ(e,t){let r=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return a1()}};return r(e)-r(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bJ="SyncEngine";class bX{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class b0{constructor(e){this.key=e,this.receivedDocument=!1}}class b1{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.syncEngineListener={},this.queryViewsByQuery=new dH(e=>dj(e),dF),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new uh(o_.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new gR,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=m2.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}function b2(e,t,r,n,i,s,a){let o=new b1(e,t,r,n,i,s);return a&&(o._isPrimaryClient=!0),o}async function b4(e,t,r=!0){let n;let i=_k(e),s=i.queryViewsByQuery.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.computeInitialSnapshot()):n=await b6(i,t,r,!0),n}async function b3(e,t){let r=_k(e);await b6(r,t,!0,!1)}async function b6(e,t,r,n){let i;let s=await yN(e.localStore,dN(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(i=await b5(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&v3(e.remoteStore,s),i}async function b5(e,t,r,n,i){e.applyDocChanges=(t,r,n)=>_m(e,t,r,n);let s=await yO(e.localStore,t,!0),a=new bY(t,s.remoteKeys),o=a.computeDocChanges(s.documents),l=h5.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);_d(e,r,u.limboChanges);let c=new bX(t,r,a);return e.queryViewsByQuery.set(t,c),e.queriesByTarget.has(r)?e.queriesByTarget.get(r).push(t):e.queriesByTarget.set(r,[t]),u.snapshot}async function b9(e,t,r){let n=a4(e),i=n.queryViewsByQuery.get(t),s=n.queriesByTarget.get(i.targetId);if(s.length>1){n.queriesByTarget.set(i.targetId,s.filter(e=>!dF(e,t))),n.queryViewsByQuery.delete(t);return}n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await yA(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),r&&v6(n.remoteStore,i.targetId),_u(n,i.targetId)}).catch(oj)):(_u(n,i.targetId),await yA(n.localStore,i.targetId,!0))}async function b7(e,t){let r=a4(e),n=r.queryViewsByQuery.get(t),i=r.queriesByTarget.get(n.targetId);r.isPrimaryClient&&1===i.length&&(r.sharedClientState.removeLocalQueryTarget(n.targetId),v6(r.remoteStore,n.targetId))}async function b8(e,t,r){let n=_N(e);try{let e=await yy(n.localStore,t);n.sharedClientState.addPendingMutation(e.batchId),_o(n,e.batchId,r),await _f(n,e.changes),await bc(n.remoteStore)}catch(t){let e=bx(t,"Failed to persist write");r.reject(e)}}async function _e(e,t){let r=a4(e);try{let e=await yw(r.localStore,t);t.targetChanges.forEach((e,t)=>{let n=r.activeLimboResolutionsByTarget.get(t);n&&(a2(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?n.receivedDocument=!0:e.modifiedDocuments.size>0?a2(n.receivedDocument):e.removedDocuments.size>0&&(a2(n.receivedDocument),n.receivedDocument=!1))}),await _f(r,e,t)}catch(e){await oj(e)}}function _t(e,t,r){let n=a4(e);if(n.isPrimaryClient&&0===r||!n.isPrimaryClient&&1===r){let e=[];n.queryViewsByQuery.forEach((r,n)=>{let i=n.view.applyOnlineStateChange(t);i.snapshot&&e.push(i.snapshot)}),bB(n.eventManager,t),e.length&&n.syncEngineListener.onWatchChange(e),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function _r(e,t,r){let n=a4(e);n.sharedClientState.updateQueryState(t,"rejected",r);let i=n.activeLimboResolutionsByTarget.get(t),s=i&&i.key;if(s){let e=new uh(o_.comparator);e=e.insert(s,cP.newNoDocument(s,of.min()));let r=d9().add(s),i=new h6(of.min(),new Map,new uh(ol),e,r);await _e(n,i),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(s),n.activeLimboResolutionsByTarget.delete(t),_p(n)}else await yA(n.localStore,t,!1).then(()=>_u(n,t,r)).catch(oj)}async function _n(e,t){let r=a4(e),n=t.batch.batchId;try{let e=await yv(r.localStore,t);_l(r,n,null),_s(r,n),r.sharedClientState.updateMutationState(n,"acknowledged"),await _f(r,e)}catch(e){await oj(e)}}async function _i(e,t,r){let n=a4(e);try{let e=await y_(n.localStore,t);_l(n,t,r),_s(n,t),n.sharedClientState.updateMutationState(t,"rejected",r),await _f(n,e)}catch(e){await oj(e)}}function _s(e,t){(e.pendingWritesCallbacks.get(t)||[]).forEach(e=>{e.resolve()}),e.pendingWritesCallbacks.delete(t)}function _a(e,t){e.pendingWritesCallbacks.forEach(e=>{e.forEach(e=>{e.reject(new a6(a3.CANCELLED,t))})}),e.pendingWritesCallbacks.clear()}function _o(e,t,r){let n=e.mutationUserCallbacks[e.currentUser.toKey()];n||(n=new uh(ol)),n=n.insert(t,r),e.mutationUserCallbacks[e.currentUser.toKey()]=n}function _l(e,t,r){let n=a4(e),i=n.mutationUserCallbacks[n.currentUser.toKey()];if(i){let e=i.get(t);e&&(r?e.reject(r):e.resolve(),i=i.remove(t)),n.mutationUserCallbacks[n.currentUser.toKey()]=i}}function _u(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.queriesByTarget.get(t)))e.queryViewsByQuery.delete(n),r&&e.syncEngineListener.onWatchError(n,r);e.queriesByTarget.delete(t),e.isPrimaryClient&&e.limboDocumentRefs.removeReferencesForId(t).forEach(t=>{e.limboDocumentRefs.containsKey(t)||_c(e,t)})}function _c(e,t){e.enqueuedLimboResolutions.delete(t.path.canonicalString());let r=e.activeLimboTargetsByKey.get(t);null!==r&&(v6(e.remoteStore,r),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.remove(t),e.activeLimboResolutionsByTarget.delete(r),_p(e))}function _d(e,t,r){for(let n of r)n instanceof bH?(e.limboDocumentRefs.addReference(n.key,t),_h(e,n)):n instanceof bQ?(aZ(bJ,"Document no longer in limbo: "+n.key),e.limboDocumentRefs.removeReference(n.key,t),e.limboDocumentRefs.containsKey(n.key)||_c(e,n.key)):a1()}function _h(e,t){let r=t.key,n=r.path.canonicalString();e.activeLimboTargetsByKey.get(r)||e.enqueuedLimboResolutions.has(n)||(aZ(bJ,"New document in limbo: "+r),e.enqueuedLimboResolutions.add(n),_p(e))}function _p(e){for(;e.enqueuedLimboResolutions.size>0&&e.activeLimboTargetsByKey.size<e.maxConcurrentLimboResolutions;){let t=e.enqueuedLimboResolutions.values().next().value;e.enqueuedLimboResolutions.delete(t);let r=new o_(oy.fromString(t)),n=e.limboTargetIdGenerator.next();e.activeLimboResolutionsByTarget.set(n,new b0(r)),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.insert(r,n),v3(e.remoteStore,new fb(dN(dS(r.path)),n,"TargetPurposeLimboResolution",o3.INVALID))}}async function _f(e,t,r){let n=a4(e),i=[],s=[],a=[];n.queryViewsByQuery.isEmpty()||(n.queryViewsByQuery.forEach((e,o)=>{a.push(n.applyDocChanges(o,t,r).then(e=>{var t;if((e||r)&&n.isPrimaryClient){let i=e?!e.fromCache:null===(t=null==r?void 0:r.targetChanges.get(o.targetId))||void 0===t?void 0:t.current;n.sharedClientState.updateQueryState(o.targetId,i?"current":"not-current")}if(e){i.push(e);let t=bq.fromSnapshot(o.targetId,e);s.push(t)}}))}),await Promise.all(a),n.syncEngineListener.onWatchChange(i),await yI(n.localStore,s))}async function _m(e,t,r,n){let i=t.view.computeDocChanges(r);i.needsRefill&&(i=await yO(e.localStore,t.query,!1).then(({documents:e})=>t.view.computeDocChanges(e,i)));let s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return _d(e,t.targetId,o.limboChanges),o.snapshot}async function _g(e,t){let r=a4(e);if(!r.currentUser.isEqual(t)){aZ(bJ,"User change. New user:",t.toKey());let e=await yg(r.localStore,t);r.currentUser=t,_a(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await _f(r,e.affectedDocuments)}}function _y(e,t){let r=a4(e),n=r.activeLimboResolutionsByTarget.get(t);if(n&&n.receivedDocument)return d9().add(n.key);{let e=d9(),n=r.queriesByTarget.get(t);if(!n)return e;for(let t of n){let n=r.queryViewsByQuery.get(t);e=e.unionWith(n.view.syncedDocuments)}return e}}async function _v(e,t){let r=a4(e),n=await yO(r.localStore,t.query,!0),i=t.view.synchronizeWithPersistedState(n);return r.isPrimaryClient&&_d(r,t.targetId,i.limboChanges),i}async function _b(e,t){let r=a4(e);return yj(r.localStore,t).then(e=>_f(r,e))}async function __(e,t,r,n){let i=a4(e),s=await yP(i.localStore,t);if(null===s){aZ(bJ,"Cannot apply mutation batch with id: "+t);return}"pending"===r?await bc(i.remoteStore):"acknowledged"===r||"rejected"===r?(_l(i,t,n||null),_s(i,t),yL(i.localStore,t)):a1(),await _f(i,s)}async function _T(e,t){let r=a4(e);if(_k(r),_N(r),!0===t&&!0!==r._isPrimaryClient){let e=r.sharedClientState.getAllActiveQueryTargets(),t=await _w(r,e.toArray());for(let e of(r._isPrimaryClient=!0,await bS(r.remoteStore,!0),t))v3(r.remoteStore,e)}else if(!1===t&&!1!==r._isPrimaryClient){let e=[],t=Promise.resolve();r.queriesByTarget.forEach((n,i)=>{r.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then(()=>(_u(r,i),yA(r.localStore,i,!0))),v6(r.remoteStore,i)}),await t,await _w(r,e),_S(r),r._isPrimaryClient=!1,await bS(r.remoteStore,!1)}}function _S(e){let t=a4(e);t.activeLimboResolutionsByTarget.forEach((e,r)=>{v6(t.remoteStore,r)}),t.limboDocumentRefs.removeAllReferences(),t.activeLimboResolutionsByTarget=new Map,t.activeLimboTargetsByKey=new uh(o_.comparator)}async function _w(e,t,r){let n=a4(e),i=[],s=[];for(let e of t){let t;let r=n.queriesByTarget.get(e);if(r&&0!==r.length)for(let e of(t=await yN(n.localStore,dN(r[0])),r)){let t=n.queryViewsByQuery.get(e),r=await _v(n,t);r.snapshot&&s.push(r.snapshot)}else{let r=await yF(n.localStore,e);t=await yN(n.localStore,r),await b5(n,_E(r),e,!1,t.resumeToken)}i.push(t)}return n.syncEngineListener.onWatchChange(s),i}function _E(e){return dT(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function _C(e){return yM(a4(e).localStore)}async function _I(e,t,r,n){let i=a4(e);if(i._isPrimaryClient){aZ(bJ,"Ignoring unexpected query state notification.");return}let s=i.queriesByTarget.get(t);if(s&&s.length>0)switch(r){case"current":case"not-current":{let e=await yj(i.localStore,dG(s[0])),n=h6.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,uw.EMPTY_BYTE_STRING);await _f(i,e,n);break}case"rejected":await yA(i.localStore,t,!0),_u(i,t,n);break;default:a1()}}async function _x(e,t,r){let n=_k(e);if(n._isPrimaryClient){for(let e of t){if(n.queriesByTarget.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){aZ(bJ,"Adding an already active target "+e);continue}let t=await yF(n.localStore,e),r=await yN(n.localStore,t);await b5(n,_E(t),r.targetId,!1,r.resumeToken),v3(n.remoteStore,r)}for(let e of r)n.queriesByTarget.has(e)&&await yA(n.localStore,e,!1).then(()=>{v6(n.remoteStore,e),_u(n,e)}).catch(oj)}}function _k(e){let t=a4(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=_e.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=_y.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=_r.bind(null,t),t.syncEngineListener.onWatchChange=bF.bind(null,t.eventManager),t.syncEngineListener.onWatchError=bj.bind(null,t.eventManager),t}function _N(e){let t=a4(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=_n.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=_i.bind(null,t),t}async function _R(e,t,r){try{let n=await t.getMetadata();if(await yz(e.localStore,n))return await t.close(),r._completeWith(bK(n)),Promise.resolve(new Set);r._updateProgress(bW(n));let i=new bG(n,e.localStore,t.serializer),s=await t.nextElement();for(;s;){let e=await i.addSizedElement(s);e&&r._updateProgress(e),s=await t.nextElement()}let a=await i.complete();return await _f(e,a.changedDocs,void 0),await yq(e.localStore,n),r._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(e){return aX(bJ,`Loading bundle failed with ${e}`),r._failWith(e),Promise.resolve(new Set)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _A{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=vx(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return ym(this.persistence,new yQ,e.initialUser,this.serializer)}createPersistence(e){return new gB(gV.factory,this.serializer)}createSharedClientState(e){return new va}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}_A.provider={build:()=>new _A};class _O extends _A{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.onlineComponentProvider.initialize(this,e),await _N(this.onlineComponentProvider.syncEngine),await bc(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){return ym(this.persistence,new yQ,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new go(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new o4(t,this.persistence);return new o2(e.asyncQueue,r)}createPersistence(e){let t=yu(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?ge.withCacheSize(this.cacheSizeBytes):ge.DEFAULT;return new ya(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,vC(),vI(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new va}}class _D{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>_t(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=_g.bind(null,this.syncEngine),await bS(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return bO()}createDatastore(e){let t=vx(e.databaseInfo.databaseId),r=vw(e.databaseInfo);return vV(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return v0(this.localStore,this.datastore,e.asyncQueue,e=>_t(this.syncEngine,e,0),vE())}createSyncEngine(e,t){return b2(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await v4(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}_D.provider={build:()=>new _D};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _P=10240;function _L(e,t=_P){let r=0;return{async read(){if(r<e.byteLength){let n={value:e.slice(r,r+t),done:!1};return r+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _M(e,t,r){if(!r)throw new a6(a3.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function _F(e,t,r,n){if(!0===t&&!0===n)throw new a6(a3.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)}function _j(e){if(!o_.isDocumentKey(e))throw new a6(a3.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function _B(e){if(o_.isDocumentKey(e))throw new a6(a3.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function _U(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function _V(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{let t=_z(e);return t?`a custom ${t} object`:"an object"}}if("function"==typeof e)return"a function";return a1()}function _z(e){return e.constructor?e.constructor.name:null}function _q(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new a6(a3.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let r=_V(e);throw new a6(a3.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _$(e,t){if(!(e instanceof Uint8Array))throw new a6(a3.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${_V(e)}`);return _L(e,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _G{constructor(e){this.observer=e,this.muted=!1}next(e){!this.muted&&this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):aJ("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _W{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _K{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new a5,this.buffer=new Uint8Array,this.textDecoder=hX(),this.nextElementImpl().then(e=>{e&&e.isBundleMetadata()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(null==e?void 0:e.payload)}`))},e=>this.metadata.reject(e))}close(){return this.reader.cancel()}async getMetadata(){return this.metadata.promise}async nextElement(){return await this.getMetadata(),this.nextElementImpl()}async nextElementImpl(){let e=await this.readLength();if(null===e)return null;let t=this.textDecoder.decode(e),r=Number(t);return isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`),new _W(JSON.parse(await this.readJsonString(r)),e.length+r)}indexOfOpenBracket(){return this.buffer.findIndex(e=>123===e)}async readLength(){for(;0>this.indexOfOpenBracket()&&!await this.pullMoreDataToBuffer(););if(0===this.buffer.length)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async readJsonString(e){for(;this.buffer.length<e;)await this.pullMoreDataToBuffer()&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}raiseError(e){throw this.reader.cancel(),Error(`Invalid bundle format: ${e}`)}async pullMoreDataToBuffer(){let e=await this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}function _H(e,t){return new _K(e,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _Q{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new a6(a3.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await vq(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new hj(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let r=o_.fromPath(t);this.mutations.push(new hV(r,this.precondition(r)))}),await vz(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=of.min();else throw a1();let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new a6(a3.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return this.writtenDocs.has(e.toString())||!t?hT.none():t.isEqual(of.min())?hT.exists(!1):hT.updateTime(t)}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return hT.exists(!0);if(t.isEqual(of.min()))throw new a6(a3.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return hT.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _Y="FirestoreClient",_Z=100,_J=11,_X=20,_0=22;class _1{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=n,this.user=aG.UNAUTHENTICATED,this.clientId=oo.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{aZ(_Y,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(aZ(_Y,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:_Z}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new a5;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=bx(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function _2(e,t){e.asyncQueue.verifyOperationInProgress(),aZ(_Y,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await yg(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function _4(e,t){e.asyncQueue.verifyOperationInProgress();let r=await _6(e);aZ(_Y,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>bT(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>bT(t.remoteStore,r)),e._onlineComponents=t}function _3(e){return"FirebaseError"===e.name?e.code===a3.FAILED_PRECONDITION||e.code===a3.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||e.code===_0||e.code===_X||e.code===_J}async function _6(e){if(!e._offlineComponents){if(e._uninitializedComponentsProvider){aZ(_Y,"Using user provided OfflineComponentProvider");try{await _2(e,e._uninitializedComponentsProvider._offline)}catch(r){let t=r;if(!_3(t))throw t;aX("Error using user provided cache. Falling back to memory cache: "+t),await _2(e,new _A)}}else aZ(_Y,"Using default OfflineComponentProvider"),await _2(e,new _A)}return e._offlineComponents}async function _5(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(aZ(_Y,"Using user provided OnlineComponentProvider"),await _4(e,e._uninitializedComponentsProvider._online)):(aZ(_Y,"Using default OnlineComponentProvider"),await _4(e,new _D))),e._onlineComponents}function _9(e){return _6(e).then(e=>e.localStore)}function _7(e){return _5(e).then(e=>e.syncEngine)}function _8(e){return _5(e).then(e=>e.datastore)}async function Te(e){let t=await _5(e),r=t.eventManager;return r.onListen=b4.bind(null,t.syncEngine),r.onUnlisten=b9.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=b3.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=b7.bind(null,t.syncEngine),r}function Tt(e,t,r={}){let n=new a5;return e.asyncQueue.enqueueAndForget(async()=>Ti(await Te(e),e.asyncQueue,t,r,n)),n.promise}function Tr(e,t,r={}){let n=new a5;return e.asyncQueue.enqueueAndForget(async()=>Ts(await Te(e),e.asyncQueue,t,r,n)),n.promise}function Tn(e,t){let r=new a5;return e.asyncQueue.enqueueAndForget(async()=>b8(await _7(e),t,r)),r.promise}function Ti(e,t,r,n,i){let s=new _G({next:o=>{s.mute(),t.enqueueAndForget(()=>bM(e,a));let l=o.docs.has(r);!l&&o.fromCache?i.reject(new a6(a3.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&o.fromCache&&n&&"server"===n.source?i.reject(new a6(a3.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:e=>i.reject(e)}),a=new bz(dS(r.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return bL(e,a)}function Ts(e,t,r,n,i){let s=new _G({next:r=>{s.mute(),t.enqueueAndForget(()=>bM(e,a)),r.fromCache&&"server"===n.source?i.reject(new a6(a3.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(r)},error:e=>i.reject(e)}),a=new bz(r,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return bL(e,a)}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ta(e,t){return e.timeoutSeconds===t.timeoutSeconds}function To(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tl="ComponentProvider",Tu=new Map;function Tc(e){let t=Tu.get(e);t&&(aZ(Tl,"Removing Datastore"),Tu.delete(e),t.terminate())}function Td(e,t,r,n){return new uj(e,t,r,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling,To(n.experimentalLongPollingOptions),n.useFetchStreams)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Th="firestore.googleapis.com",Tp=!0,Tf=5,Tm=30,Tg=!0;class Ty{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new a6(a3.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Th,this.ssl=Tp}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:Tp;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=m8;else{if(e.cacheSizeBytes!==m7&&e.cacheSizeBytes<gr)throw new a6(a3.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${gr}`);this.cacheSizeBytes=e.cacheSizeBytes}_F("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=Tg:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=To(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),Tv(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&Ta(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}function Tv(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new a6(a3.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<Tf)throw new a6(a3.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is ${Tf})`);if(e.timeoutSeconds>Tm)throw new a6(a3.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is ${Tm})`)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tb{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ty({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new a6(a3.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new a6(a3.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ty(e),void 0!==e.credentials&&(this._authCredentials=os(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return Tc(this),Promise.resolve()}}function T_(e,t,r,n={}){var i;let s=(e=_q(e,Tb))._getSettings(),a=`${t}:${r}`;if(s.host!==Th&&s.host!==a&&aX("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=aG.MOCK_USER;else{t=rH(n.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);let s=n.mockUserToken.sub||n.mockUserToken.user_id;if(!s)throw new a6(a3.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new aG(s)}e._authCredentials=new a8(new a9(t,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TT{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new TT(this.firestore,e,this._query)}}class TS{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Tw(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new TS(this.firestore,e,this._key)}}class Tw extends TT{constructor(e,t,r){super(e,t,dS(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new TS(this.firestore,null,new o_(e))}withConverter(e){return new Tw(this.firestore,e,this._path)}}function TE(e,t,...r){if(e=nl(e),_M("collection","path",t),e instanceof Tb){let n=oy.fromString(t,...r);return _B(n),new Tw(e,null,n)}{if(!(e instanceof TS)&&!(e instanceof Tw))throw new a6(a3.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(oy.fromString(t,...r));return _B(n),new Tw(e.firestore,null,n)}}function TC(e,t,...r){if(e=nl(e),1==arguments.length&&(t=oo.newId()),_M("doc","path",t),e instanceof Tb){let n=oy.fromString(t,...r);return _j(n),new TS(e,null,new o_(n))}{if(!(e instanceof TS)&&!(e instanceof Tw))throw new a6(a3.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(oy.fromString(t,...r));return _j(n),new TS(e.firestore,e instanceof Tw?e.converter:null,new o_(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let TI="AsyncQueue";class Tx{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new vO(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new a5;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(oK(e))aZ(TI,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(e=>{throw this.failure=e,this.operationInProgress=!1,aJ("INTERNAL UNHANDLED ERROR: ",Tk(e)),e}).then(e=>(this.operationInProgress=!1,e))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let n=bI.createAndSchedule(this,e,t,r,e=>this.removeDelayedOperation(e));return this.delayedOperations.push(n),n}verifyNotFailed(){this.failure&&a1()}verifyOperationInProgress(){}async drain(){let e;do e=this.tail,await e;while(e!==this.tail)}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{for(let t of(this.delayedOperations.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.delayedOperations))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}}function Tk(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class TN extends Tb{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new Tx,this._persistenceKey=(null==n?void 0:n.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Tx(e),this._firestoreClient=void 0,await e}}}function TR(e,t){let r="object"==typeof e?e:n9(),n="string"==typeof e?e:t||uB,i=n1(r,"firestore").getImmediate({identifier:n});if(!i._initialized){let e=rG("firestore");e&&T_(i,...e)}return i}function TA(e){if(e._terminated)throw new a6(a3.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||TO(e),e._firestoreClient}function TO(e){var t,r,n;let i=e._freezeSettings(),s=Td(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);!e._componentsProvider&&(null===(r=i.localCache)||void 0===r?void 0:r._offlineComponentProvider)&&(null===(n=i.localCache)||void 0===n?void 0:n._onlineComponentProvider)&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new _1(e._authCredentials,e._appCheckCredentials,e._queue,s,e._componentsProvider&&TD(e._componentsProvider))}function TD(e){let t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TP(e,t=!0){aK(n6),n0(new nu("firestore",(e,{instanceIdentifier:r,options:n})=>{let i=e.getProvider("app").getImmediate(),s=new TN(new oe(e.getProvider("auth-internal")),new oi(e.getProvider("app-check-internal")),uV(i,r),i);return n=Object.assign({useFetchStreams:t},n),s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),n7(aq,a$,e),n7(aq,a$,"esm2017")}class TL{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TM{constructor(e){this._byteString=e}static fromBase64String(e){try{return new TM(uw.fromBase64String(e))}catch(e){throw new a6(a3.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new TM(uw.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TF{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new a6(a3.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ob(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tj{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TB{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new a6(a3.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new a6(a3.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ol(this._lat,e._lat)||ol(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TU{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return yd(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let TV=/^__.*__$/;class Tz{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new hO(e,this.data,this.fieldMask,t,this.fieldTransforms):new hN(e,this.data,t,this.fieldTransforms)}}class Tq{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new hO(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function T$(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw a1()}}class TG{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new TG(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=null===(t=this.path)||void 0===t?void 0:t.child(e),n=this.contextWith({path:r,arrayElement:!1});return n.validatePathSegment(e),n}childContextForFieldPath(e){var t;let r=null===(t=this.path)||void 0===t?void 0:t.child(e),n=this.contextWith({path:r,arrayElement:!1});return n.validatePath(),n}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return Ss(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(T$(this.dataSource)&&TV.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class TW{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||vx(e)}createContext(e,t,r,n=!1){return new TG({dataSource:e,methodName:t,targetDoc:r,path:ob.emptyPath(),arrayElement:!1,hasConverter:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function TK(e){let t=e._freezeSettings(),r=vx(e._databaseId);return new TW(e._databaseId,!!t.ignoreUndefinedProperties,r)}function TH(e,t,r,n,i,s={}){let a,o;let l=e.createContext(s.merge||s.mergeFields?2:0,t,r,i);St("Data must be an object, but it was:",l,n);let u=T6(n,l);if(s.merge)a=new u_(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let n of s.mergeFields){let i=Sr(t,n,r);if(!l.contains(i))throw new a6(a3.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Sa(e,i)||e.push(i)}a=new u_(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new Tz(new cO(u),a,o)}class TQ extends Tj{_toFieldTransform(e){if(2===e.dataSource)e.fieldMask.push(e.path);else if(1===e.dataSource)throw e.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof TQ}}function TY(e,t,r){return new TG({dataSource:3,targetDoc:t.settings.targetDoc,methodName:e._methodName,arrayElement:r},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class TZ extends Tj{_toFieldTransform(e){return new hy(e.path,new hl)}isEqual(e){return e instanceof TZ}}class TJ extends Tj{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=TY(this,e,!0),r=new hu(this._elements.map(e=>T3(e,t)));return new hy(e.path,r)}isEqual(e){return e instanceof TJ&&r8(this._elements,e._elements)}}class TX extends Tj{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=TY(this,e,!0),r=new hd(this._elements.map(e=>T3(e,t)));return new hy(e.path,r)}isEqual(e){return e instanceof TX&&r8(this._elements,e._elements)}}class T0 extends Tj{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new hp(e.serializer,hr(e.serializer,this._operand));return new hy(e.path,t)}isEqual(e){return e instanceof T0&&this._operand===e._operand}}function T1(e,t,r,n){let i=e.createContext(1,t,r);St("Data must be an object, but it was:",i,n);let s=[],a=cO.empty();return uc(n,(e,n)=>{let o=Si(t,e,r);n=nl(n);let l=i.childContextForFieldPath(o);if(n instanceof TQ)s.push(o);else{let e=T3(n,l);null!=e&&(s.push(o),a.set(o,e))}}),new Tq(a,new u_(s),i.fieldTransforms)}function T2(e,t,r,n,i,s){let a=e.createContext(1,t,r),o=[Sr(t,n,r)],l=[i];if(s.length%2!=0)throw new a6(a3.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(Sr(t,s[e])),l.push(s[e+1]);let u=[],c=cO.empty();for(let e=o.length-1;e>=0;--e)if(!Sa(u,o[e])){let t=o[e],r=l[e];r=nl(r);let n=a.childContextForFieldPath(t);if(r instanceof TQ)u.push(t);else{let e=T3(r,n);null!=e&&(u.push(t),c.set(t,e))}}return new Tq(c,new u_(u),a.fieldTransforms)}function T4(e,t,r,n=!1){return T3(r,e.createContext(n?4:3,t))}function T3(e,t){if(Se(e=nl(e)))return St("Unsupported field value:",t,e),T6(e,t);if(e instanceof Tj)return T9(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),!(e instanceof Array))return T7(e,t);if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");return T5(e,t)}function T6(e,t){let r={};return ud(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):uc(e,(e,n)=>{let i=T3(n,t.childContextForField(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function T5(e,t){let r=[],n=0;for(let i of e){let e=T3(i,t.childContextForArray(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}function T9(e,t){if(!T$(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}function T7(e,t){if(null===(e=nl(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return hr(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=op.fromDate(e);return{timestampValue:pp(t.serializer,r)}}if(e instanceof op){let r=new op(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:pp(t.serializer,r)}}if(e instanceof TB)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};else if(e instanceof TM)return{bytesValue:pm(t.serializer,e._byteString)};else if(e instanceof TS){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.createError(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:pb(e.firestore._databaseId||t.databaseId,e._key.path)}}else if(e instanceof TU)return T8(e,t);else throw t.createError(`Unsupported field value: ${_V(e)}`)}function T8(e,t){return{mapValue:{fields:{[uW]:{stringValue:uQ},[uY]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return he(t.serializer,e)})}}}}}}function Se(e){return"object"==typeof e&&null!==e&&!(e instanceof Array)&&!(e instanceof Date)&&!(e instanceof op)&&!(e instanceof TB)&&!(e instanceof TM)&&!(e instanceof TS)&&!(e instanceof Tj)&&!(e instanceof TU)}function St(e,t,r){if(!Se(r)||!_U(r)){let n=_V(r);if("an object"===n)throw t.createError(e+" a custom object");throw t.createError(e+" "+n)}}function Sr(e,t,r){if((t=nl(t))instanceof TF)return t._internalPath;if("string"==typeof t)return Si(e,t);throw Ss("Field path arguments must be of type string or ",e,!1,void 0,r)}let Sn=RegExp("[~\\*/\\[\\]]");function Si(e,t,r){if(t.search(Sn)>=0)throw Ss(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new TF(...t.split("."))._internalPath}catch(n){throw Ss(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function Ss(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new a6(a3.INVALID_ARGUMENT,o+e+l)}function Sa(e,t){return e.some(e=>e.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class So{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new TS(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let e=new Sl(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}}}get(e){if(this._document){let t=this._document.data.field(Su("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Sl extends So{data(){return super.data()}}function Su(e,t){return"string"==typeof t?Si(e,t):t instanceof TF?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sc(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new a6(a3.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Sd{}class Sh extends Sd{}function Sp(e,t,...r){let n=[];for(let i of(t instanceof Sd&&n.push(t),SD(n=n.concat(r)),n))e=i._apply(e);return e}class Sf extends Sh{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Sf(e,t,r)}_apply(e){let t=this._parse(e);return SR(e._query,t),new TT(e.firestore,e.converter,dO(e._query,t))}_parse(e){let t=TK(e.firestore);return Sw(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Sm(e,t,r){let n=t,i=Su("where",e);return Sf._create(i,n,r)}class Sg extends Sd{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Sg(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:cK.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(SA(e._query,t),new TT(e.firestore,e.converter,dO(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Sy extends Sh{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Sy(e,t)}_apply(e){let t=SE(e._query,this._field,this._direction);return new TT(e.firestore,e.converter,dD(e._query,t))}}function Sv(e,t="asc"){let r=t,n=Su("orderBy",e);return Sy._create(n,r)}class Sb extends Sh{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Sb(e,t,r)}_apply(e){return new TT(e.firestore,e.converter,dP(e._query,this._limit,this._limitType))}}class S_ extends Sh{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new S_(e,t,r)}_apply(e){let t=SS(e,this.type,this._docOrFields,this._inclusive);return new TT(e.firestore,e.converter,dL(e._query,t))}}class ST extends Sh{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new ST(e,t,r)}_apply(e){let t=SS(e,this.type,this._docOrFields,this._inclusive);return new TT(e.firestore,e.converter,dM(e._query,t))}}function SS(e,t,r,n){if(r[0]=nl(r[0]),r[0]instanceof So)return SC(e._query,e.firestore._databaseId,t,r[0]._document,n);{let i=TK(e.firestore);return SI(e._query,e.firestore._databaseId,i,t,r,n)}}function Sw(e,t,r,n,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new a6(a3.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){Sk(a,s);let t=[];for(let r of a)t.push(Sx(n,e,r));o={arrayValue:{values:t}}}else o=Sx(n,e,a)}else("in"===s||"not-in"===s||"array-contains-any"===s)&&Sk(a,s),o=T4(r,t,a,"in"===s||"not-in"===s);return cW.create(i,s,o)}function SE(e,t,r){if(null!==e.startAt)throw new a6(a3.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new a6(a3.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new cV(t,r)}function SC(e,t,r,n,i){if(!n)throw new a6(a3.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);let s=[];for(let r of dk(e))if(r.field.isKeyField())s.push(cg(t,n.key));else{let e=n.data.field(r.field);if(uP(e))throw new a6(a3.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null!==e)s.push(e);else{let e=r.field.canonicalString();throw new a6(a3.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}}return new cM(s,i)}function SI(e,t,r,n,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new a6(a3.INVALID_ARGUMENT,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new a6(a3.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof l}`);if(!dx(e)&&-1!==l.indexOf("/"))throw new a6(a3.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${l}' contains a slash.`);let r=e.path.child(oy.fromString(l));if(!o_.isDocumentKey(r))throw new a6(a3.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);let i=new o_(r);o.push(cg(t,i))}else{let e=T4(r,n,l);o.push(e)}}return new cM(o,s)}function Sx(e,t,r){if("string"==typeof(r=nl(r))){if(""===r)throw new a6(a3.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!dx(t)&&-1!==r.indexOf("/"))throw new a6(a3.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(oy.fromString(r));if(!o_.isDocumentKey(n))throw new a6(a3.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return cg(e,new o_(n))}if(r instanceof TS)return cg(e,r._key);throw new a6(a3.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${_V(r)}.`)}function Sk(e,t){if(!Array.isArray(e)||0===e.length)throw new a6(a3.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function SN(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function SR(e,t){let r=SO(e.filters,SN(t.op));if(null!==r){if(r===t.op)throw new a6(a3.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`);throw new a6(a3.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}}function SA(e,t){let r=e;for(let e of t.getFlattenedFilters())SR(r,e),r=dO(r,e)}function SO(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}function SD(e){let t=e.filter(e=>e instanceof Sg).length,r=e.filter(e=>e instanceof Sf).length;if(t>1||t>0&&r>0)throw new a6(a3.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SP{convertValue(e,t="none"){switch(uJ(e)){case 0:return null;case 1:return e.booleanValue;case 2:return uk(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(uN(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw a1()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return uc(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){var t,r,n;return new TU(null===(n=null===(r=null===(t=e.fields)||void 0===t?void 0:t[uY].arrayValue)||void 0===r?void 0:r.values)||void 0===n?void 0:n.map(e=>uk(e.doubleValue)))}convertGeoPoint(e){return new TB(uk(e.latitude),uk(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=uM(e);if(null==r)return null;return this.convertValue(r,t);case"estimate":return this.convertTimestamp(uF(e));default:return null}}convertTimestamp(e){let t=ux(e);return new op(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=oy.fromString(e);a2(fv(r));let n=new uU(r.get(1),r.get(3)),i=new o_(r.popFirst(5));return n.isEqual(t)||aJ(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SL(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class SM extends SP{constructor(e){super(),this.firestore=e}convertBytes(e){return new TM(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new TS(this.firestore,null,t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SF{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Sj extends So{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);{let t=new SB(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}}}get(e,t={}){if(this._document){let r=this._document.data.field(Su("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class SB extends Sj{data(e={}){return super.data(e)}}class SU{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new SF(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new SB(this._firestore,this._userDataWriter,r.key,r,new SF(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new a6(a3.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=SV(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function SV(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new SB(e._firestore,e._userDataWriter,r.doc.key,r.doc,new SF(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new SB(e._firestore,e._userDataWriter,t.doc.key,t.doc,new SF(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(s=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:Sz(t.type),doc:n,oldIndex:i,newIndex:s}})}}function Sz(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return a1()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sq(e){e=_q(e,TS);let t=_q(e.firestore,TN);return Tt(TA(t),e._key).then(r=>SY(t,e,r))}class S$ extends SP{constructor(e){super(),this.firestore=e}convertBytes(e){return new TM(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new TS(this.firestore,null,t)}}function SG(e){e=_q(e,TT);let t=_q(e.firestore,TN),r=TA(t),n=new S$(t);return Sc(e._query),Tr(r,e._query).then(r=>new SU(t,n,e,r))}function SW(e,t,r,...n){let i;e=_q(e,TS);let s=_q(e.firestore,TN),a=TK(s);return SQ(s,[(i="string"==typeof(t=nl(t))||t instanceof TF?T2(a,"updateDoc",e._key,t,r,n):T1(a,"updateDoc",e._key,t)).toMutation(e._key,hT.exists(!0))])}function SK(e){return SQ(_q(e.firestore,TN),[new hj(e._key,hT.none())])}function SH(e,t){let r=_q(e.firestore,TN),n=TC(e),i=SL(e.converter,t);return SQ(r,[TH(TK(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,hT.exists(!1))]).then(()=>n)}function SQ(e,t){return Tn(TA(e),t)}function SY(e,t,r){let n=r.docs.get(t._key),i=new S$(e);return new Sj(e,i,t._key,n,new SF(r.hasPendingWrites,r.fromCache),t.converter)}class SZ{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=_D.provider,this._offlineComponentProvider={build:t=>new _O(t,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}}function SJ(e,t){if((e=nl(e)).firestore===t)return e;throw new a6(a3.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.")}function SX(){return new TZ("serverTimestamp")}new WeakMap;class S0{constructor(){this.existenceFilterMismatchCallbacksById=new Map}static get instance(){return S1||hZ(S1=new S0),S1}notifyOnExistenceFilterMismatch(e){this.existenceFilterMismatchCallbacksById.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.existenceFilterMismatchCallbacksById;return r.set(t,e),()=>r.delete(t)}}let S1=null;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */TP("node");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let S2="firebasestorage.googleapis.com",S4="storageBucket",S3=12e4,S6=6e5,S5=1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S9 extends r6{constructor(e,t,r=0){super(S7(e),`Firebase Storage: ${t} (${S7(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,S9.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return S7(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function S7(e){return"storage/"+e}function S8(){let e="An unknown error occurred, please check the error payload for server response.";return new S9(m.UNKNOWN,e)}function we(e){return new S9(m.OBJECT_NOT_FOUND,"Object '"+e+"' does not exist.")}function wt(e){return new S9(m.QUOTA_EXCEEDED,"Quota for bucket '"+e+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function wr(){let e="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new S9(m.UNAUTHENTICATED,e)}function wn(){return new S9(m.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function wi(e){return new S9(m.UNAUTHORIZED,"User does not have permission to access '"+e+"'.")}function ws(){return new S9(m.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function wa(){return new S9(m.CANCELED,"User canceled the upload/download.")}function wo(e){return new S9(m.INVALID_URL,"Invalid URL '"+e+"'.")}function wl(e){return new S9(m.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}function wu(){return new S9(m.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+S4+"' property when initializing the app?")}function wc(){return new S9(m.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function wd(){return new S9(m.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function wh(){return new S9(m.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function wp(e){return new S9(m.INVALID_ARGUMENT,e)}function wf(){return new S9(m.APP_DELETED,"The Firebase app was deleted.")}function wm(e){return new S9(m.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function wg(e,t){return new S9(m.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function wy(e){throw new S9(m.INTERNAL_ERROR,"Internal error: "+e)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(m||(m={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wv{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=wv.makeFromUrl(e,t)}catch(t){return new wv(e,"")}if(""===r.path)return r;throw wl(e)}static makeFromUrl(e,t){let r=null,n="([A-Za-z0-9.\\-_]+)";function i(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}let s=RegExp("^gs://"+n+"(/(.*))?$","i"),a={bucket:1,path:3};function o(e){e.path_=decodeURIComponent(e.path)}let l="v[A-Za-z0-9_]+",u=t.replace(/[.]/g,"\\."),c="(/([^?#]*).*)?$",d=RegExp(`^https?://${u}/${l}/b/${n}/o${c}`,"i"),h=t===S2?"(?:storage.googleapis.com|storage.cloud.google.com)":t,p="([^?#]*)",f=[{regex:s,indices:a,postModify:i},{regex:d,indices:{bucket:1,path:3},postModify:o},{regex:RegExp(`^https?://${h}/${n}/${p}`,"i"),indices:{bucket:1,path:2},postModify:o}];for(let t=0;t<f.length;t++){let n=f[t],i=n.regex.exec(e);if(i){let e=i[n.indices.bucket],t=i[n.indices.path];t||(t=""),r=new wv(e,t),n.postModify(r);break}}if(null==r)throw wo(e);return r}}class wb{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w_(e,t,r){let n=1,i=null,s=null,a=!1,o=0;function l(){return 2===o}let u=!1;function c(...e){u||(u=!0,t.apply(null,e))}function d(t){i=setTimeout(()=>{i=null,e(p,l())},t)}function h(){s&&clearTimeout(s)}function p(e,...t){let r;if(u){h();return}if(e||l()||a){h(),c.call(null,e,...t);return}n<64&&(n*=2),1===o?(o=2,r=0):r=(n+Math.random())*1e3,d(r)}let f=!1;function m(e){!f&&(f=!0,h(),!u&&(null!==i?(e||(o=2),clearTimeout(i),d(0)):e||(o=1)))}return d(0),s=setTimeout(()=>{a=!0,m(!0)},r),m}function wT(e){e(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wS(e){return void 0!==e}function ww(e){return"function"==typeof e}function wE(e){return"object"==typeof e&&!Array.isArray(e)}function wC(e){return"string"==typeof e||e instanceof String}function wI(e){return wx()&&e instanceof Blob}function wx(){return"undefined"!=typeof Blob}function wk(e,t,r,n){if(n<t)throw wp(`Invalid value for '${e}'. Expected ${t} or greater.`);if(n>r)throw wp(`Invalid value for '${e}'. Expected ${r} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wN(e,t,r){let n=t;return null==r&&(n=`https://${t}`),`${r}://${n}/v0${e}`}function wR(e){let t=encodeURIComponent,r="?";for(let n in e)e.hasOwnProperty(n)&&(r=r+(t(n)+"=")+t(e[n])+"&");return r.slice(0,-1)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wA(e,t){let r=e>=500&&e<600,n=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return r||n||i}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(g||(g={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wO{constructor(e,t,r,n,i,s,a,o,l,u,c,d=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=n,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=a,this.errorCallback_=o,this.timeout_=l,this.progressCallback_=u,this.connectionFactory_=c,this.retry=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){let e=(e,t)=>{if(t){e(!1,new wD(!1,null,!0));return}let r=this.connectionFactory_();this.pendingConnection_=r;let n=e=>{let t=e.loaded,r=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,r)};null!==this.progressCallback_&&r.addUploadProgressListener(n),r.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&r.removeUploadProgressListener(n),this.pendingConnection_=null;let t=r.getErrorCode()===g.NO_ERROR,i=r.getStatus();if(!t||wA(i,this.additionalRetryCodes_)&&this.retry){e(!1,new wD(!1,null,r.getErrorCode()===g.ABORT));return}e(!0,new wD(-1!==this.successCodes_.indexOf(i),r))})},t=(e,t)=>{let r=this.resolve_,n=this.reject_,i=t.connection;if(t.wasSuccessCode)try{let e=this.callback_(i,i.getResponse());wS(e)?r(e):r()}catch(e){n(e)}else if(null!==i){let e=S8();e.serverResponse=i.getErrorText(),n(this.errorCallback_?this.errorCallback_(i,e):e)}else n(t.canceled?this.appDelete_?wf():wa():ws())};this.canceled_?t(!1,new wD(!1,null,!0)):this.backoffId_=w_(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&wT(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class wD{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function wP(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}function wL(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}function wM(e,t){t&&(e["X-Firebase-GMPID"]=t)}function wF(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}function wj(e,t,r,n,i,s,a=!0){let o=wR(e.urlParams),l=e.url+o,u=Object.assign({},e.headers);return wM(u,t),wP(u,r),wL(u,s),wF(u,n),new wO(l,e.method,u,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wB(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function wU(...e){let t=wB();if(void 0!==t){let r=new t;for(let t=0;t<e.length;t++)r.append(e[t]);return r.getBlob()}if(wx())return new Blob(e);throw new S9(m.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function wV(e,t,r){return e.webkitSlice?e.webkitSlice(t,r):e.mozSlice?e.mozSlice(t,r):e.slice?e.slice(t,r):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wz(e){if(/[^-A-Za-z0-9+/=]/.test(e))throw wg("base64","Invalid character found");return Buffer.from(e,"base64").toString("binary")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wq={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class w${constructor(e,t){this.data=e,this.contentType=t||null}}function wG(e,t){switch(e){case wq.RAW:return new w$(wW(t));case wq.BASE64:case wq.BASE64URL:return new w$(wH(e,t));case wq.DATA_URL:return new w$(wY(t),wZ(t))}throw S8()}function wW(e){let t=[];for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);n<=127?t.push(n):n<=2047?t.push(192|n>>6,128|63&n):(64512&n)==55296?r<e.length-1&&(64512&e.charCodeAt(r+1))==56320?(n=65536|(1023&n)<<10|1023&e.charCodeAt(++r),t.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n)):t.push(239,191,189):(64512&n)==56320?t.push(239,191,189):t.push(224|n>>12,128|n>>6&63,128|63&n)}return new Uint8Array(t)}function wK(e){let t;try{t=decodeURIComponent(e)}catch(e){throw wg(wq.DATA_URL,"Malformed data URL.")}return wW(t)}function wH(e,t){let r;switch(e){case wq.BASE64:{let r=-1!==t.indexOf("-"),n=-1!==t.indexOf("_");if(r||n)throw wg(e,"Invalid character '"+(r?"-":"_")+"' found: is it base64url encoded?");break}case wq.BASE64URL:{let r=-1!==t.indexOf("+"),n=-1!==t.indexOf("/");if(r||n)throw wg(e,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}}try{r=wz(t)}catch(t){if(t.message.includes("polyfill"))throw t;throw wg(e,"Invalid character found")}let n=new Uint8Array(r.length);for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);return n}class wQ{constructor(e){this.base64=!1,this.contentType=null;let t=e.match(/^data:([^,]+)?,/);if(null===t)throw wg(wq.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");let r=t[1]||null;null!=r&&(this.base64=wJ(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function wY(e){let t=new wQ(e);return t.base64?wH(wq.BASE64,t.rest):wK(t.rest)}function wZ(e){return new wQ(e).contentType}function wJ(e,t){return e.length>=t.length&&e.substring(e.length-t.length)===t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wX{constructor(e,t){let r=0,n="";wI(e)?(this.data_=e,r=e.size,n=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=n}size(){return this.size_}type(){return this.type_}slice(e,t){if(!wI(this.data_))return new wX(new Uint8Array(this.data_.buffer,e,t-e),!0);{let r=wV(this.data_,e,t);return null===r?null:new wX(r)}}static getBlob(...e){if(wx()){let t=e.map(e=>e instanceof wX?e.data_:e);return new wX(wU.apply(null,t))}{let t=e.map(e=>wC(e)?wG(wq.RAW,e).data:e.data_),r=0;t.forEach(e=>{r+=e.byteLength});let n=new Uint8Array(r),i=0;return t.forEach(e=>{for(let t=0;t<e.length;t++)n[i++]=e[t]}),new wX(n,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w0(e){let t;try{t=JSON.parse(e)}catch(e){return null}return wE(t)?t:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w1(e){if(0===e.length)return null;let t=e.lastIndexOf("/");return -1===t?"":e.slice(0,t)}function w2(e,t){let r=t.split("/").filter(e=>e.length>0).join("/");return 0===e.length?r:e+"/"+r}function w4(e){let t=e.lastIndexOf("/",e.length-2);return -1===t?e:e.slice(t+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w3(e,t){return t}class w6{constructor(e,t,r,n){this.server=e,this.local=t||e,this.writable=!!r,this.xform=n||w3}}let w5=null;function w9(e){return!wC(e)||e.length<2?e:w4(e)}function w7(){if(w5)return w5;let e=[];function t(e,t){return w9(t)}e.push(new w6("bucket")),e.push(new w6("generation")),e.push(new w6("metageneration")),e.push(new w6("name","fullPath",!0));let r=new w6("name");function n(e,t){return void 0!==t?Number(t):t}r.xform=t,e.push(r);let i=new w6("size");return i.xform=n,e.push(i),e.push(new w6("timeCreated")),e.push(new w6("updated")),e.push(new w6("md5Hash",null,!0)),e.push(new w6("cacheControl",null,!0)),e.push(new w6("contentDisposition",null,!0)),e.push(new w6("contentEncoding",null,!0)),e.push(new w6("contentLanguage",null,!0)),e.push(new w6("contentType",null,!0)),e.push(new w6("metadata","customMetadata",!0)),w5=e}function w8(e,t){function r(){let r=new wv(e.bucket,e.fullPath);return t._makeStorageReference(r)}Object.defineProperty(e,"ref",{get:r})}function Ee(e,t,r){let n={};n.type="file";let i=r.length;for(let e=0;e<i;e++){let i=r[e];n[i.local]=i.xform(n,t[i.server])}return w8(n,e),n}function Et(e,t,r){let n=w0(t);return null===n?null:Ee(e,n,r)}function Er(e,t,r,n){let i=w0(t);if(null===i||!wC(i.downloadTokens))return null;let s=i.downloadTokens;if(0===s.length)return null;let a=encodeURIComponent;return s.split(",").map(t=>{let i=e.bucket,s=e.fullPath;return wN("/b/"+a(i)+"/o/"+a(s),r,n)+wR({alt:"media",token:t})})[0]}function En(e,t){let r={},n=t.length;for(let i=0;i<n;i++){let n=t[i];n.writable&&(r[n.server]=e[n.local])}return JSON.stringify(r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ei="prefixes",Es="items";function Ea(e,t,r){let n={prefixes:[],items:[],nextPageToken:r.nextPageToken};if(r[Ei])for(let i of r[Ei]){let r=i.replace(/\/$/,""),s=e._makeStorageReference(new wv(t,r));n.prefixes.push(s)}if(r[Es])for(let i of r[Es]){let r=e._makeStorageReference(new wv(t,i.name));n.items.push(r)}return n}function Eo(e,t,r){let n=w0(r);return null===n?null:Ea(e,t,n)}class El{constructor(e,t,r,n){this.url=e,this.method=t,this.handler=r,this.timeout=n,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eu(e){if(!e)throw S8()}function Ec(e,t){return function(r,n){let i=Et(e,n,t);return Eu(null!==i),i}}function Ed(e,t){return function(r,n){let i=Eo(e,t,n);return Eu(null!==i),i}}function Eh(e,t){return function(r,n){let i=Et(e,n,t);return Eu(null!==i),Er(i,n,e.host,e._protocol)}}function Ep(e){return function(t,r){let n;return(n=401===t.getStatus()?t.getErrorText().includes("Firebase App Check token is invalid")?wn():wr():402===t.getStatus()?wt(e.bucket):403===t.getStatus()?wi(e.path):r).status=t.getStatus(),n.serverResponse=r.serverResponse,n}}function Ef(e){let t=Ep(e);return function(r,n){let i=t(r,n);return 404===r.getStatus()&&(i=we(e.path)),i.serverResponse=n.serverResponse,i}}function Em(e,t,r){let n=wN(t.fullServerUrl(),e.host,e._protocol),i="GET",s=e.maxOperationRetryTime,a=new El(n,i,Ec(e,r),s);return a.errorHandler=Ef(t),a}function Eg(e,t,r,n,i){let s={};t.isRoot?s.prefix="":s.prefix=t.path+"/",r&&r.length>0&&(s.delimiter=r),n&&(s.pageToken=n),i&&(s.maxResults=i);let a=wN(t.bucketOnlyServerUrl(),e.host,e._protocol),o="GET",l=e.maxOperationRetryTime,u=new El(a,o,Ed(e,t.bucket),l);return u.urlParams=s,u.errorHandler=Ep(t),u}function Ey(e,t,r){let n=wN(t.fullServerUrl(),e.host,e._protocol),i="GET",s=e.maxOperationRetryTime,a=new El(n,i,Eh(e,r),s);return a.errorHandler=Ef(t),a}function Ev(e,t){let r=new El(wN(t.fullServerUrl(),e.host,e._protocol),"DELETE",function(e,t){},e.maxOperationRetryTime);return r.successCodes=[200,204],r.errorHandler=Ef(t),r}function Eb(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}function E_(e,t,r){let n=Object.assign({},r);return n.fullPath=e.path,n.size=t.size(),n.contentType||(n.contentType=Eb(null,t)),n}function ET(e,t,r,n,i){let s=t.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},o=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();a["Content-Type"]="multipart/related; boundary="+o;let l=E_(t,n,i),u="--"+o+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+En(l,r)+"\r\n--"+o+"\r\nContent-Type: "+l.contentType+"\r\n\r\n",c="\r\n--"+o+"--",d=wX.getBlob(u,n,c);if(null===d)throw wc();let h={name:l.fullPath},p=wN(s,e.host,e._protocol),f="POST",m=e.maxUploadRetryTime,g=new El(p,f,Ec(e,r),m);return g.urlParams=h,g.headers=a,g.body=d.uploadData(),g.errorHandler=Ep(t),g}class ES{constructor(e,t,r,n){this.current=e,this.total=t,this.finalized=!!r,this.metadata=n||null}}function Ew(e,t){let r=null;try{r=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){Eu(!1)}let n=t||["active"];return Eu(!!r&&-1!==n.indexOf(r)),r}function EE(e,t,r,n,i){let s=t.bucketOnlyServerUrl(),a=E_(t,n,i),o={name:a.fullPath},l=wN(s,e.host,e._protocol),u="POST",c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n.size()}`,"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},d=En(a,r),h=new El(l,u,function(e){let t;Ew(e);try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){Eu(!1)}return Eu(wC(t)),t},e.maxUploadRetryTime);return h.urlParams=o,h.headers=c,h.body=d,h.errorHandler=Ep(t),h}function EC(e,t,r,n){let i={"X-Goog-Upload-Command":"query"},s=new El(r,"POST",function(e){let t=Ew(e,["active","final"]),r=null;try{r=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){Eu(!1)}r||Eu(!1);let i=Number(r);return Eu(!isNaN(i)),new ES(i,n.size(),"final"===t)},e.maxUploadRetryTime);return s.headers=i,s.errorHandler=Ep(t),s}let EI=null;function Ex(e,t,r,n,i,s,a,o){let l=new ES(0,0);if(a?(l.current=a.current,l.total=a.total):(l.current=0,l.total=n.size()),n.size()!==l.total)throw wd();let u=l.total-l.current,c=u;i>0&&(c=Math.min(c,i));let d=l.current,h=d+c,p="",f={"X-Goog-Upload-Command":p=0===c?"finalize":u===c?"upload, finalize":"upload","X-Goog-Upload-Offset":`${l.current}`},m=n.slice(d,h);if(null===m)throw wc();let g=new El(r,"POST",function(e,r){let i;let a=Ew(e,["active","final"]),o=l.current+c,u=n.size();return i="final"===a?Ec(t,s)(e,r):null,new ES(o,u,"final"===a,i)},t.maxUploadRetryTime);return g.headers=f,g.body=m.uploadData(),g.progressCallback=o||null,g.errorHandler=Ep(e),g}let Ek={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function EN(e){switch(e){case"running":case"pausing":case"canceling":return Ek.RUNNING;case"paused":return Ek.PAUSED;case"success":return Ek.SUCCESS;case"canceled":return Ek.CANCELED;default:return Ek.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ER{constructor(e,t,r){if(ww(e)||null!=t||null!=r)this.next=e,this.error=null!=t?t:void 0,this.complete=null!=r?r:void 0;else{let t=e;this.next=t.next,this.error=t.error,this.complete=t.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EA(e){return(...t)=>{Promise.resolve().then(()=>e(...t))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let EO=null;class ED{constructor(){this.errorText_="",this.sent_=!1,this.fetch_=iy.fetch,this.errorCode_=g.NO_ERROR}async send(e,t,r,n){if(this.sent_)throw wy("cannot .send() more than once");this.sent_=!0;try{let i=await this.fetch_(e,{method:t,headers:n||{},body:r});this.headers_=i.headers,this.statusCode_=i.status,this.errorCode_=g.NO_ERROR,this.body_=await i.arrayBuffer()}catch(e){this.errorText_=null==e?void 0:e.message,this.statusCode_=0,this.errorCode_=g.NETWORK_ERROR}}getErrorCode(){if(void 0===this.errorCode_)throw wy("cannot .getErrorCode() before receiving response");return this.errorCode_}getStatus(){if(void 0===this.statusCode_)throw wy("cannot .getStatus() before receiving response");return this.statusCode_}getErrorText(){return this.errorText_}abort(){}getResponseHeader(e){if(!this.headers_)throw wy("cannot .getResponseHeader() before receiving response");return this.headers_.get(e)}addUploadProgressListener(e){}removeUploadProgressListener(e){}}class EP extends ED{getResponse(){if(!this.body_)throw wy("cannot .getResponse() before receiving response");return Buffer.from(this.body_).toString("utf-8")}}function EL(){return EO?EO():new EP}class EM extends null{getResponse(){if(!this.body_)throw wy("cannot .getResponse() before sending");return this.body_}}class EF extends ED{constructor(){super(...arguments),this.stream_=null}async send(e,t,r,n){if(this.sent_)throw wy("cannot .send() more than once");this.sent_=!0;try{let i=await this.fetch_(e,{method:t,headers:n||{},body:r});this.headers_=i.headers,this.statusCode_=i.status,this.errorCode_=g.NO_ERROR,this.stream_=i.body}catch(e){this.errorText_=null==e?void 0:e.message,this.statusCode_=0,this.errorCode_=g.NETWORK_ERROR}}getResponse(){if(!this.stream_)throw wy("cannot .getResponse() before sending");return this.stream_}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ej{constructor(e,t){this._service=e,t instanceof wv?this._location=t:this._location=wv.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Ej(e,t)}get root(){let e=new wv(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return w4(this._location.path)}get storage(){return this._service}get parent(){let e=w1(this._location.path);if(null===e)return null;let t=new wv(this._location.bucket,e);return new Ej(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw wm(e)}}function EB(e,t,r){e._throwIfRoot("uploadBytes");let n=ET(e.storage,e._location,w7(),new wX(t,!0),r);return e.storage.makeRequestWithTokens(n,EL).then(t=>({metadata:t,ref:e}))}function EU(e,t){null!=t&&"number"==typeof t.maxResults&&wk("options.maxResults",1,1e3,t.maxResults);let r=t||{},n=Eg(e.storage,e._location,"/",r.pageToken,r.maxResults);return e.storage.makeRequestWithTokens(n,EL)}function EV(e){e._throwIfRoot("getDownloadURL");let t=Ey(e.storage,e._location,w7());return e.storage.makeRequestWithTokens(t,EL).then(e=>{if(null===e)throw wh();return e})}function Ez(e){e._throwIfRoot("deleteObject");let t=Ev(e.storage,e._location);return e.storage.makeRequestWithTokens(t,EL)}function Eq(e,t){let r=w2(e._location.path,t),n=new wv(e._location.bucket,r);return new Ej(e.storage,n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E$(e){return/^[A-Za-z]+:\/\//.test(e)}function EG(e,t){return new Ej(e,t)}function EW(e,t){if(e instanceof EY){let r=e;if(null==r._bucket)throw wu();let n=new Ej(r,r._bucket);return null!=t?EW(n,t):n}return void 0!==t?Eq(e,t):e}function EK(e,t){if(!(t&&E$(t)))return EW(e,t);if(e instanceof EY)return EG(e,t);throw wp("To use ref(service, url), the first argument must be a Storage instance.")}function EH(e,t){let r=null==t?void 0:t[S4];return null==r?null:wv.makeFromBucketSpec(r,e)}function EQ(e,t,r,n={}){e.host=`${t}:${r}`,e._protocol="http";let{mockUserToken:i}=n;i&&(e._overrideAuthToken="string"==typeof i?i:rH(i,e.app.options.projectId))}class EY{constructor(e,t,r,n,i){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=n,this._firebaseVersion=i,this._bucket=null,this._host=S2,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=S3,this._maxUploadRetryTime=S6,this._requests=new Set,null!=n?this._bucket=wv.makeFromBucketSpec(n,this._host):this._bucket=EH(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=wv.makeFromBucketSpec(this._url,e):this._bucket=EH(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){wk("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){wk("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){let e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Ej(this,e)}_makeRequest(e,t,r,n,i=!0){if(this._deleted)return new wb(wf());{let s=wj(e,this._appId,r,n,t,this._firebaseVersion,i);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}async makeRequestWithTokens(e,t){let[r,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,n).getPromise()}}let EZ="@firebase/storage",EJ="0.13.2",EX="storage";function E0(e,t,r){return EB(e=nl(e),t,r)}function E1(e){return EV(e=nl(e))}function E2(e){return Ez(e=nl(e))}function E4(e,t){return EK(e=nl(e),t)}function E3(e=n9(),t){let r=n1(e=nl(e),EX).getImmediate({identifier:t}),n=rG("storage");return n&&E6(r,...n),r}function E6(e,t,r,n={}){EQ(e,t,r,n)}function E5(e,{instanceIdentifier:t}){return new EY(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t,n6)}(function(){n0(new nu(EX,E5,"PUBLIC").setMultipleInstances(!0)),n7(EZ,EJ)})();let E9={apiKey:process.env.NEXT_PUBLIC_FIREBASE_API_KEY||"demo-key",authDomain:process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"demo.firebaseapp.com",projectId:process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID||"demo-project",storageBucket:process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"demo-project.appspot.com",messagingSenderId:process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"123456789",appId:process.env.NEXT_PUBLIC_FIREBASE_APP_ID||"demo-app-id"},E7=process.env.NEXT_PUBLIC_FIREBASE_API_KEY&&process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,E8=null,Ce=null,Ct=null,Cr=null;if(E7)try{E8=n5(E9),Ce=TR(E8),Ct=aR(E8),Cr=E3(E8)}catch(e){console.warn("Firebase initialization failed:",e)}else console.warn("Firebase credentials not found. Using mock services for development.");let Cn="planners",Ci="attachments";async function Cs(e,t,r){try{let n={title:t,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),technicianName:e.global.technicianName,originCity:e.global.originCity,totalCities:e.itinerary.length,totalStores:e.itinerary.reduce((e,t)=>e+t.stores.length,0),estimatedDays:Math.ceil(e.itinerary.reduce((e,t)=>e+t.stores.reduce((e,t)=>e+t.approxAssets,0),0)/e.global.assetsPerDay),data:e,userId:r||"anonymous",createdAt:SX(),updatedAt:SX()};return(await SH(TE(Ce,Cn),n)).id}catch(e){throw console.error("Erro ao salvar planejamento no Firebase:",e),Error("Falha ao salvar planejamento no Firebase")}}async function Ca(e){try{let t=e?Sp(TE(Ce,Cn),Sm("userId","==",e),Sv("updatedAt","desc")):Sp(TE(Ce,Cn),Sv("updatedAt","desc")),r=await SG(t),n=[];return r.forEach(e=>{let t=e.data();n.push({id:e.id,title:t.title,createdAt:t.createdAt?.toDate?.()?.toISOString()||t.createdAt,updatedAt:t.updatedAt?.toDate?.()?.toISOString()||t.updatedAt,technicianName:t.technicianName,originCity:t.originCity,totalCities:t.totalCities,totalStores:t.totalStores,estimatedDays:t.estimatedDays})}),n}catch(e){throw console.error("Erro ao carregar planejamentos do Firebase:",e),Error("Falha ao carregar planejamentos do Firebase")}}async function Co(e){try{let t=TC(Ce,Cn,e),r=await Sq(t);if(r.exists()){let e=r.data();return{metadata:{id:r.id,title:e.title,createdAt:e.createdAt?.toDate?.()?.toISOString()||e.createdAt,updatedAt:e.updatedAt?.toDate?.()?.toISOString()||e.updatedAt,technicianName:e.technicianName,originCity:e.originCity,totalCities:e.totalCities,totalStores:e.totalStores,estimatedDays:e.estimatedDays},data:e.data}}return null}catch(e){throw console.error("Erro ao carregar planejamento do Firebase:",e),Error("Falha ao carregar planejamento do Firebase")}}async function Cl(e,t){try{let r=TC(Ce,Cn,e);return await SW(r,{title:t,updatedAt:SX()}),!0}catch(e){throw console.error("Erro ao atualizar t\xedtulo no Firebase:",e),Error("Falha ao atualizar t\xedtulo no Firebase")}}async function Cu(e){try{let t=TC(Ce,Cn,e);return await SK(t),!0}catch(e){throw console.error("Erro ao excluir planejamento do Firebase:",e),Error("Falha ao excluir planejamento do Firebase")}}async function Cc(e,t,r){try{let n=`${Date.now()}_${e.name}`,i=`attachments/${r||"anonymous"}/${t}/${n}`,s=E4(Cr,i),a=await E0(s,e),o=await E1(a.ref);return await SH(TE(Ce,Ci),{plannerId:t,userId:r||"anonymous",fileName:e.name,filePath:i,downloadURL:o,fileSize:e.size,mimeType:e.type,createdAt:SX()}),o}catch(e){throw console.error("Erro ao fazer upload do anexo:",e),Error("Falha ao fazer upload do anexo")}}async function Cd(e){try{let t=Sp(TE(Ce,Ci),Sm("plannerId","==",e)),r=await SG(t),n=[];return r.forEach(e=>{let t=e.data();n.push({id:e.id,...t,createdAt:t.createdAt?.toDate?.()?.toISOString()||t.createdAt})}),n}catch(e){throw console.error("Erro ao carregar anexos:",e),Error("Falha ao carregar anexos")}}async function Ch(e,t){try{let r=E4(Cr,t);await E2(r);let n=TC(Ce,Ci,e);return await SK(n),!0}catch(e){throw console.error("Erro ao excluir anexo:",e),Error("Falha ao excluir anexo")}}function Cp(){let[e,t]=(0,b.useState)(null),[r,n]=(0,b.useState)(!1),[i,s]=(0,b.useState)(null),a=async(t,r)=>{try{if(s(null),!Ce)throw Error("Firebase n\xe3o configurado. Configure as credenciais para salvar planejamentos.");return await Cs(t,r,e?.uid)}catch(e){throw s(e instanceof Error?e.message:"Erro desconhecido"),e}},o=async()=>{try{if(s(null),!Ce)throw Error("Firebase n\xe3o configurado. Configure as credenciais para carregar planejamentos.");return await Ca(e?.uid)}catch(e){throw s(e instanceof Error?e.message:"Erro desconhecido"),e}},l=async(t,r)=>{try{return s(null),await Cc(t,r,e?.uid)}catch(e){throw s(e instanceof Error?e.message:"Erro desconhecido"),e}};return{user:e,loading:r,error:i,savePlanner:a,loadAllPlanners:o,loadPlannerById:async e=>{try{return s(null),await Co(e)}catch(e){throw s(e instanceof Error?e.message:"Erro desconhecido"),e}},updatePlannerTitle:async(e,t)=>{try{return s(null),await Cl(e,t)}catch(e){throw s(e instanceof Error?e.message:"Erro desconhecido"),e}},deletePlanner:async e=>{try{return s(null),await Cu(e)}catch(e){throw s(e instanceof Error?e.message:"Erro desconhecido"),e}},uploadFile:l,getAttachments:async e=>{try{return s(null),await Cd(e)}catch(e){throw s(e instanceof Error?e.message:"Erro desconhecido"),e}},deleteFile:async(e,t)=>{try{return s(null),await Ch(e,t)}catch(e){throw s(e instanceof Error?e.message:"Erro desconhecido"),e}}}}function Cf(e,t){let{metadata:r,data:n}=e,i=[["INVENTORY ROUTE PLANNER - EXPORTA\xc7\xc3O"],[""],["METADADOS DO PLANEJAMENTO"],["T\xedtulo",r.title],["T\xe9cnico",r.technicianName],["Cidade de Origem",r.originCity],["Total de Cidades",r.totalCities.toString()],["Total de Unidades",r.totalStores.toString()],["Dias Estimados",r.estimatedDays.toString()],["Criado em",new Date(r.createdAt).toLocaleDateString("pt-BR")],["Atualizado em",new Date(r.updatedAt).toLocaleDateString("pt-BR")],[""],["PAR\xc2METROS GLOBAIS"],["Produtividade (bens/dia)",n.global.assetsPerDay.toString()],["Di\xe1ria do T\xe9cnico",`R$ ${n.global.technicianDailyRate.toFixed(2)}`],["Data de In\xedcio",new Date(n.global.startDateISO).toLocaleDateString("pt-BR")],["Trabalhar Finais de Semana",n.global.workWeekends?"Sim":"N\xe3o"],[""],["PER DIEM"],["Caf\xe9 da Manh\xe3",`R$ ${n.global.perDiem.breakfast.toFixed(2)}`],["Almo\xe7o",`R$ ${n.global.perDiem.lunch.toFixed(2)}`],["Jantar",`R$ ${n.global.perDiem.dinner.toFixed(2)}`],["\xc1gua",`R$ ${n.global.perDiem.water.toFixed(2)}`],[""],["ITINER\xc1RIO DETALHADO"]];return i.push(["Ordem","Cidade","Hotel","Di\xe1ria do Hotel","Transporte Local/Dia","Custo Intermunicipal","Unidades","Total de Bens"]),n.itinerary.forEach((e,t)=>{let r=e.stores.reduce((e,t)=>e+t.approxAssets,0);i.push([(t+1).toString(),e.city,e.hotelName||"-",e.hotelNightly?`R$ ${e.hotelNightly.toFixed(2)}`:"-",e.localTransportPerDay?`R$ ${e.localTransportPerDay.toFixed(2)}`:"-",e.intercityCost?`R$ ${e.intercityCost.toFixed(2)}`:"-",e.stores.length.toString(),r.toString()])}),i.push([""]),i.push(["DETALHAMENTO DAS UNIDADES"]),i.push(["Cidade","Nome da Unidade","Endere\xe7o","Bens Estimados","Coordenadas"]),n.itinerary.forEach(e=>{e.stores.forEach(t=>{let r=t.lat&&t.lng?`${t.lat}, ${t.lng}`:"-";i.push([e.city,t.name,t.addressLine,t.approxAssets.toString(),r])})}),t&&(i.push([""]),i.push(["CRONOGRAMA EXECUTIVO"]),i.push(["Data","Tipo","Cidade","Detalhes","Bens Processados","Custo Transporte","Custo Hospedagem","Custo Alimenta\xe7\xe3o","Custo T\xe9cnico"]),t.days.forEach(e=>{i.push([new Date(e.dateISO).toLocaleDateString("pt-BR"),"TRAVEL"===e.type?"Viagem":"INVENTORY"===e.type?"Invent\xe1rio":"RETURN"===e.type?"Retorno":"DESCANSO"===e.type?"Descanso":"Desconhecido","DESCANSO"===e.type?"Fim de Semana":e.city,"DESCANSO"===e.type?"Descanso - S\xe1bado/Domingo":e.detail,"DESCANSO"===e.type?"-":e.assetsProcessed.toString(),"DESCANSO"===e.type?"-":`R$ ${e.costs.transport.toFixed(2)}`,"DESCANSO"===e.type?"-":`R$ ${e.costs.lodging.toFixed(2)}`,"DESCANSO"===e.type?"-":`R$ ${e.costs.perDiem.toFixed(2)}`,"DESCANSO"===e.type?"-":`R$ ${e.costs.technician.toFixed(2)}`])}),i.push([""]),i.push(["RESUMO DE CUSTOS"]),i.push(["Item","Valor"]),i.push(["Total de Dias",t.totalDays.toString()]),i.push(["Total de Bens",t.totalAssets.toString()]),i.push(["Custo Total",`R$ ${t.totalCosts.toFixed(2)}`])),n.returnTransportCost&&i.push(["Custo de Retorno",`R$ ${n.returnTransportCost.toFixed(2)}`]),i.map(e=>e.map(e=>"string"==typeof e&&e.includes(",")?`"${e}"`:e).join(",")).join("\n")}function Cm(e,t){let r=new Blob([e],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");if(void 0!==n.download){let e=URL.createObjectURL(r);n.setAttribute("href",e),n.setAttribute("download",`${t}.csv`),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)}}function Cg(e,t){Cm(Cf(e,t),`planejamento_${e.metadata.title.replace(/[^a-zA-Z0-9]/g,"_")}_${new Date().toISOString().split("T")[0]}`)}var Cy=r(8578);function Cv({onSelectPlanner:e,onExportPlanner:t}){let{loadAllPlanners:r,loadPlannerById:n,updatePlannerTitle:i,deletePlanner:s,loading:a,error:o}=Cp(),[l,u]=(0,b.useState)([]),[c,d]=(0,b.useState)(null),[h,p]=(0,b.useState)(""),[f,m]=(0,b.useState)(null),g=async()=>{try{let e=await r();u(e.sort((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime()))}catch(e){console.error("Erro ao carregar planejamentos:",e)}},v=e=>{d(e.id),p(e.title)},_=async e=>{if(h.trim())try{await i(e,h.trim()),await g()}catch(e){console.error("Erro ao atualizar t\xedtulo:",e),alert("Erro ao atualizar t\xedtulo. Tente novamente.")}d(null),p("")},T=()=>{d(null),p("")},S=async e=>{if(confirm("Tem certeza que deseja excluir este planejamento? Esta a\xe7\xe3o n\xe3o pode ser desfeita."))try{await s(e),await g(),f===e&&m(null)}catch(e){console.error("Erro ao excluir planejamento:",e),alert("Erro ao excluir planejamento. Tente novamente.")}},w=async t=>{try{let r=await n(t);r&&(m(t),e(r))}catch(e){console.error("Erro ao carregar planejamento:",e),alert("Erro ao carregar planejamento. Tente novamente.")}},E=async e=>{try{let r=await n(e);if(r){let e=(0,Cy.a)(r.data,{dailyWorkingHours:8,travelHoursPerLeg:2});t?t(r,e):Cg(r,e)}}catch(e){console.error("Erro ao exportar:",e),alert("Erro ao exportar o planejamento. Tente novamente.")}},C=e=>new Date(e).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return 0===l.length?(0,y.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-100 p-8 text-center",children:[y.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:y.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})}),y.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Nenhum Planejamento Salvo"}),y.jsx("p",{className:"text-gray-600",children:"Crie seu primeiro planejamento para come\xe7ar a organizar suas rotas de invent\xe1rio."})]}):(0,y.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden",children:[y.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 px-8 py-6",children:(0,y.jsxs)("div",{className:"flex items-center space-x-3",children:[y.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center",children:y.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),y.jsx("h2",{className:"text-2xl font-bold text-white",children:"Meus Planejamentos"})]})}),y.jsx("div",{className:"p-6",children:y.jsx("div",{className:"space-y-4",children:l.map(e=>y.jsx("div",{className:`border rounded-xl p-4 transition-all duration-200 ${f===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:(0,y.jsxs)("div",{className:"flex items-center justify-between",children:[(0,y.jsxs)("div",{className:"flex-1 min-w-0",children:[c===e.id?(0,y.jsxs)("div",{className:"flex items-center space-x-2",children:[y.jsx("input",{type:"text",value:h,onChange:e=>p(e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onKeyPress:t=>"Enter"===t.key&&_(e.id),autoFocus:!0}),y.jsx("button",{onClick:()=>_(e.id),className:"px-3 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors duration-200",children:y.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),y.jsx("button",{onClick:T,className:"px-3 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors duration-200",children:y.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):(0,y.jsxs)("div",{className:"flex items-center space-x-3",children:[y.jsx("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:e.title}),y.jsx("button",{onClick:()=>v(e),className:"text-gray-400 hover:text-gray-600 transition-colors duration-200",title:"Editar t\xedtulo",children:y.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]}),(0,y.jsxs)("div",{className:"mt-2 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600",children:[(0,y.jsxs)("div",{children:[y.jsx("span",{className:"font-medium",children:"T\xe9cnico:"})," ",e.technicianName]}),(0,y.jsxs)("div",{children:[y.jsx("span",{className:"font-medium",children:"Origem:"})," ",e.originCity]}),(0,y.jsxs)("div",{children:[y.jsx("span",{className:"font-medium",children:"Cidades:"})," ",e.totalCities]}),(0,y.jsxs)("div",{children:[y.jsx("span",{className:"font-medium",children:"Unidades:"})," ",e.totalStores]})]}),(0,y.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:["Criado: ",C(e.createdAt)," | Atualizado: ",C(e.updatedAt)]})]}),(0,y.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[y.jsx("button",{onClick:()=>w(e.id),className:`px-4 py-2 rounded-lg font-medium transition-all duration-200 ${f===e.id?"bg-blue-100 text-blue-700 border border-blue-200":"bg-blue-600 text-white hover:bg-blue-700"}`,children:f===e.id?"Selecionado":"Selecionar"}),(0,y.jsxs)("button",{onClick:()=>E(e.id),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200 flex items-center space-x-2",title:"Exportar para Excel",children:[y.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),y.jsx("span",{className:"hidden sm:inline",children:"Exportar"})]}),y.jsx("button",{onClick:()=>S(e.id),className:"px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors duration-200",title:"Excluir planejamento",children:y.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},e.id))})})]})}function Cb(){return y.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-6 mb-6",children:(0,y.jsxs)("div",{className:"flex items-start space-x-3",children:[y.jsx("div",{className:"flex-shrink-0",children:y.jsx("svg",{className:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,y.jsxs)("div",{className:"flex-1",children:[y.jsx("h3",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"Firebase N\xe3o Configurado"}),y.jsx("p",{className:"text-yellow-700 mb-4",children:"Para usar todas as funcionalidades (salvar planejamentos, anexos, etc.), voc\xea precisa configurar o Firebase. Por enquanto, voc\xea pode usar o modo de demonstra\xe7\xe3o."}),(0,y.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-yellow-200",children:[y.jsx("h4",{className:"font-medium text-yellow-800 mb-2",children:"Como configurar:"}),(0,y.jsxs)("ol",{className:"list-decimal list-inside space-y-1 text-sm text-yellow-700",children:[(0,y.jsxs)("li",{children:["Crie um projeto no ",y.jsx("a",{href:"https://console.firebase.google.com/",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-yellow-800",children:"Firebase Console"})]}),y.jsx("li",{children:"Habilite Firestore Database e Storage"}),(0,y.jsxs)("li",{children:["Crie um arquivo ",y.jsx("code",{className:"bg-yellow-100 px-1 rounded",children:".env.local"})," na raiz do projeto"]}),y.jsx("li",{children:"Adicione suas credenciais do Firebase"}),y.jsx("li",{children:"Reinicie o servidor de desenvolvimento"})]}),(0,y.jsxs)("p",{className:"text-xs text-yellow-600 mt-2",children:["Veja o arquivo ",y.jsx("code",{className:"bg-yellow-100 px-1 rounded",children:"FIREBASE_SETUP.md"})," para instru\xe7\xf5es detalhadas."]})]})]})]})})}let C_={global:{technicianName:"Jo\xe3o Silva",originCity:"S\xe3o Paulo",startDateISO:"2025-01-01",assetsPerDay:150,technicianDailyRate:200,perDiem:{breakfast:15,lunch:25,dinner:30,water:5},workWeekends:!1},itinerary:[{id:crypto.randomUUID(),city:"Campinas",arrivalTransportNote:"\xd4nibus executivo",intercityCost:45,hotelName:"Hotel Campinas Plaza",hotelNightly:120,localTransportPerDay:25,stores:[{id:crypto.randomUUID(),name:"Loja Centro",addressLine:"Rua das Flores, 123, Centro",approxAssets:200},{id:crypto.randomUUID(),name:"Loja Taquaral",addressLine:"Av. Taquaral, 456, Taquaral",approxAssets:150}]},{id:crypto.randomUUID(),city:"Sorocaba",arrivalTransportNote:"Van compartilhada",intercityCost:35,hotelName:"Hotel Sorocaba Business",hotelNightly:100,localTransportPerDay:20,stores:[{id:crypto.randomUUID(),name:"Loja Sorocaba",addressLine:"Rua da Paz, 789, Centro",approxAssets:180}]}],returnTransportCost:40};function CT(){let{savePlanner:e,error:t}=Cp(),[r,n]=(0,b.useState)(null),[i,s]=(0,b.useState)(!1),[a,o]=(0,b.useState)(!1),l=()=>{n(null),s(!0),o(!1)},u=()=>{n(C_),s(!0),o(!1)},c=async(t,r)=>{try{let n=await e(t,r);alert(`Planejamento "${r}" salvo com sucesso! ID: ${n}`),s(!1),o(!0)}catch(e){console.error("Erro ao salvar:",e),alert("Erro ao salvar o planejamento. Tente novamente.")}},d=e=>{n(e.data),s(!0),o(!1)},h=e=>{console.log("Exportando planejamento:",e.metadata.title)},p=()=>{s(!1),o(!0),n(null)},f=()=>{alert("Funcionalidade de rascunho temporariamente indispon\xedvel.")};return(0,y.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100",children:[y.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:y.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,y.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,y.jsxs)("div",{className:"flex items-center space-x-4",children:[y.jsx(v.default,{href:"/",className:"text-gray-500 hover:text-gray-700 transition-colors duration-200",children:y.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),y.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Planejador de Rotas"})]}),y.jsx("div",{className:"flex items-center space-x-4",children:(0,y.jsxs)(v.default,{href:"/planner/schedule",className:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200 flex items-center space-x-2 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5",children:[y.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),y.jsx("span",{children:"Ver Cronograma"})]})})]})})}),y.jsx("div",{className:"py-8",children:(0,y.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[t&&y.jsx(Cb,{}),!i&&!a&&(0,y.jsxs)("div",{className:"text-center mb-12",children:[y.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-full mb-6 shadow-lg",children:y.jsx("svg",{className:"w-10 h-10 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-1.447-.894L15 4m0 13V4m0 0L9 7"})})}),y.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-6",children:"Bem-vindo ao Planejador de Rotas"}),y.jsx("p",{className:"text-xl text-gray-600 mb-8 max-w-2xl mx-auto",children:"Crie novos planejamentos, carregue exemplos ou gerencie seus planejamentos existentes"}),(0,y.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[(0,y.jsxs)("button",{onClick:l,className:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white px-8 py-4 rounded-xl font-semibold text-lg transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1 flex items-center justify-center space-x-2",children:[y.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),y.jsx("span",{children:"Criar Novo Planejamento"})]}),(0,y.jsxs)("button",{onClick:u,className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white px-8 py-4 rounded-xl font-semibold text-lg transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1 flex items-center justify-center space-x-2",children:[y.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),y.jsx("span",{children:"Carregar Exemplo"})]}),(0,y.jsxs)("button",{onClick:()=>o(!0),className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-8 py-4 rounded-xl font-semibold text-lg transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1 flex items-center justify-center space-x-2",children:[y.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),y.jsx("span",{children:"Gerenciar Planejamentos"})]})]})]}),i&&(0,y.jsxs)("div",{className:"space-y-8",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between",children:[(0,y.jsxs)("div",{children:[y.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:r?"Editando Planejamento":"Novo Planejamento"}),y.jsx("p",{className:"text-gray-600 mt-1",children:r?"Modifique os dados do planejamento selecionado":"Preencha os dados para criar um novo planejamento"})]}),(0,y.jsxs)("div",{className:"flex items-center space-x-3",children:[r&&(0,y.jsxs)("button",{onClick:f,className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-colors duration-200 flex items-center space-x-2",children:[y.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),y.jsx("span",{children:"Limpar Rascunho"})]}),(0,y.jsxs)("button",{onClick:p,className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors duration-200 flex items-center space-x-2",children:[y.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),y.jsx("span",{children:"Voltar"})]})]})]}),y.jsx(rN,{initial:r||void 0,onSubmit:c})]}),a&&(0,y.jsxs)("div",{className:"space-y-8",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between",children:[(0,y.jsxs)("div",{children:[y.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Gerenciar Planejamentos"}),y.jsx("p",{className:"text-gray-600 mt-1",children:"Visualize, edite e exporte seus planejamentos salvos"})]}),(0,y.jsxs)("button",{onClick:()=>o(!1),className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors duration-200 flex items-center space-x-2",children:[y.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),y.jsx("span",{children:"Voltar"})]})]}),y.jsx(Cv,{onSelectPlanner:d,onExportPlanner:h})]}),!i&&!a&&(0,y.jsxs)("div",{className:"grid md:grid-cols-3 gap-6 mt-12",children:[(0,y.jsxs)("div",{className:"bg-white rounded-2xl p-6 shadow-xl border border-gray-100",children:[y.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-xl flex items-center justify-center mb-4",children:y.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),y.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"T\xe9cnico"}),y.jsx("p",{className:"text-gray-600 text-sm",children:"Defina o nome do t\xe9cnico, cidade de origem e par\xe2metros de produtividade para o planejamento."})]}),(0,y.jsxs)("div",{className:"bg-white rounded-2xl p-6 shadow-xl border border-gray-100",children:[y.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-500 rounded-xl flex items-center justify-center mb-4",children:y.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-1.447-.894L15 4m0 13V4m0 0L9 7"})})}),y.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Itiner\xe1rio"}),y.jsx("p",{className:"text-gray-600 text-sm",children:"Configure as cidades a visitar, hot\xe9is, custos de transporte e unidades em cada local."})]}),(0,y.jsxs)("div",{className:"bg-white rounded-2xl p-6 shadow-xl border border-gray-100",children:[y.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl flex items-center justify-center mb-4",children:y.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:y.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})})}),y.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Custos"}),y.jsx("p",{className:"text-gray-600 text-sm",children:"Controle despesas com hospedagem, alimenta\xe7\xe3o, transporte e di\xe1rias t\xe9cnicas."})]})]})]})})]})}},8015:(e,t,r)=>{"use strict";r.d(t,{default:()=>s});var n=r(326),i=r(434);function s(){return n.jsx("nav",{className:"bg-white shadow-lg border-b border-gray-200",children:n.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,n.jsxs)("div",{className:"flex justify-between items-center py-4",children:[(0,n.jsxs)(i.default,{href:"/",className:"flex items-center space-x-3 group",children:[n.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg group-hover:shadow-xl transition-all duration-300 transform group-hover:scale-110",children:n.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-1.447-.894L15 4m0 13V4m0 0L9 7"})})}),(0,n.jsxs)("div",{children:[n.jsx("span",{className:"text-xl font-bold text-gray-900",children:"Inventory Route Planner"}),n.jsx("span",{className:"block text-xs text-blue-600 font-medium",children:"Beta"})]})]}),(0,n.jsxs)("div",{className:"hidden md:flex items-center space-x-8",children:[(0,n.jsxs)(i.default,{href:"/",className:"text-gray-600 hover:text-gray-900 font-medium transition-colors duration-200 flex items-center space-x-2 group",children:[n.jsx("svg",{className:"w-4 h-4 group-hover:scale-110 transition-transform duration-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),n.jsx("span",{children:"In\xedcio"})]}),(0,n.jsxs)(i.default,{href:"/planner",className:"text-gray-600 hover:text-gray-900 font-medium transition-colors duration-200 flex items-center space-x-2 group",children:[n.jsx("svg",{className:"w-4 h-4 group-hover:scale-110 transition-transform duration-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),n.jsx("span",{children:"Planejador"})]}),(0,n.jsxs)(i.default,{href:"/planner/schedule",className:"text-gray-600 hover:text-gray-900 font-medium transition-colors duration-200 flex items-center space-x-2 group",children:[n.jsx("svg",{className:"w-4 h-4 group-hover:scale-110 transition-transform duration-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),n.jsx("span",{children:"Cronograma"})]})]}),n.jsx("div",{className:"hidden md:block",children:(0,n.jsxs)(i.default,{href:"/planner",className:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1 flex items-center space-x-2",children:[n.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),n.jsx("span",{children:"Come\xe7ar"})]})}),n.jsx("div",{className:"md:hidden",children:n.jsx("button",{className:"text-gray-600 hover:text-gray-900 p-2 rounded-lg hover:bg-gray-100 transition-colors duration-200",children:n.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})})]})})})}},8578:(e,t,r)=>{"use strict";function n(e,t){let{dailyWorkingHours:r=8,travelHoursPerLeg:n=2}=t,i=e.global.assetsPerDay||150,s=e.global.workWeekends||!1,a=[],o=new Date(e.global.startDateISO),l=0,u=e=>{let t=e.getDay();return 0===t||6===t},c=(e,t)=>{if(s)return;let r=new Date(e);for(r.setDate(r.getDate()+1);r<t;)u(r)&&a.push({dateISO:r.toISOString().split("T")[0],type:"DESCANSO",city:"Fim de Semana",detail:"Descanso - S\xe1bado/Domingo",assetsProcessed:0,costs:{transport:0,lodging:0,perDiem:0,technician:0}}),r.setDate(r.getDate()+1)},d=e=>{let t=new Date(e);if(t.setDate(t.getDate()+1),!s)for(;u(t);)t.setDate(t.getDate()+1);return t};e.itinerary.length>0&&(a.push({dateISO:o.toISOString().split("T")[0],type:"TRAVEL",city:e.itinerary[0].city,detail:`Entrada/Deslocamento/Sa\xedda: ${e.itinerary[0].city}`,assetsProcessed:0,costs:{transport:e.itinerary[0].intercityCost||0,lodging:0,perDiem:0,technician:0}}),c(new Date(o),o=d(o)));for(let t=0;t<e.itinerary.length;t++){let r=e.itinerary[t],n=r.stores.reduce((e,t)=>e+(t.approxAssets||0),0),s=Math.ceil(n/i);for(let t=0;t<s;t++){let s=n-t*i,u=Math.min(i,s);a.push({dateISO:o.toISOString().split("T")[0],type:"INVENTORY",city:r.city,detail:`Unidades: ${r.stores.length} | ${u} bens (hotel ⇄ unidade)`,assetsProcessed:u,costs:{transport:r.localTransportPerDay||0,lodging:r.hotelNightly||0,perDiem:Object.values(e.global.perDiem).reduce((e,t)=>e+t,0),technician:e.global.technicianDailyRate||0}}),l+=u,c(new Date(o),o=d(o))}if(t<e.itinerary.length-1){let r=e.itinerary[t+1];a.push({dateISO:o.toISOString().split("T")[0],type:"TRAVEL",city:r.city,detail:`Entrada/Deslocamento/Sa\xedda: ${r.city}`,assetsProcessed:0,costs:{transport:r.intercityCost||0,lodging:0,perDiem:0,technician:0}}),c(new Date(o),o=d(o))}}return e.itinerary.length>0&&a.push({dateISO:o.toISOString().split("T")[0],type:"RETURN",city:e.global.originCity,detail:"Retorno para cidade de origem",assetsProcessed:0,costs:{transport:e.returnTransportCost||0,lodging:0,perDiem:0,technician:0}}),a.sort((e,t)=>new Date(e.dateISO).getTime()-new Date(t.dateISO).getTime()),{days:a,totalDays:a.length,totalAssets:l,totalCosts:0}}function i(e,t){let r={transport:0,lodging:0,perDiem:0,technician:0,total:0};return t.days.filter(e=>"DESCANSO"!==e.type).forEach(e=>{r.transport+=e.costs.transport,r.lodging+=e.costs.lodging,r.perDiem+=e.costs.perDiem,r.technician+=e.costs.technician}),r.total=r.transport+r.lodging+r.perDiem+r.technician,r}r.d(t,{T:()=>i,a:()=>n})},5582:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p,metadata:()=>d,viewport:()=>h});var n=r(9510),i=r(5384),s=r.n(i);r(5023);var a=r(8570);let o=(0,a.createProxy)(String.raw`C:\Users\pedro\OneDrive\Área de Trabalho\logistica_web\src\components\Navbar.tsx`),{__esModule:l,$$typeof:u}=o;o.default;let c=(0,a.createProxy)(String.raw`C:\Users\pedro\OneDrive\Área de Trabalho\logistica_web\src\components\Navbar.tsx#default`),d={title:"Inventory Route Planner Beta",description:"Ferramenta profissional para planejamento de rotas log\xedsticas e controle de custos operacionais"},h={width:"device-width",initialScale:1};function p({children:e}){return n.jsx("html",{lang:"pt-BR",children:(0,n.jsxs)("body",{className:s().className,children:[n.jsx(c,{}),n.jsx("main",{children:e})]})})}},1535:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>a,__esModule:()=>s,default:()=>o});var n=r(8570);let i=(0,n.createProxy)(String.raw`C:\Users\pedro\OneDrive\Área de Trabalho\logistica_web\src\app\planner\page.tsx`),{__esModule:s,$$typeof:a}=i;i.default;let o=(0,n.createProxy)(String.raw`C:\Users\pedro\OneDrive\Área de Trabalho\logistica_web\src\app\planner\page.tsx#default`)},5023:()=>{},29:function(e,t){var r;!function(n,i){function s(e){return e.default||e}void 0!==(r=(function(){var e={};return i(e),s(e)}).apply(t,[]))&&(e.exports=r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;/**
     * @license
     * Copyright 2009 The Closure Library Authors
     * Copyright 2020 Daniel Wirtz / The long.js Authors.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     *
     * SPDX-License-Identifier: Apache-2.0
     */var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function r(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function n(e){return!0===(e&&e.__isLong__)}function i(e){var t=Math.clz32(e&-e);return e?31-t:t}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=n;var s={},a={};function o(e,t){var r,n,i;return t?(e>>>=0,(i=0<=e&&e<256)&&(n=a[e]))?n:(r=u(e,0,!0),i&&(a[e]=r),r):(e|=0,(i=-128<=e&&e<128)&&(n=s[e]))?n:(r=u(e,e<0?-1:0,!1),i&&(s[e]=r),r)}function l(e,t){if(isNaN(e))return t?v:y;if(t){if(e<0)return v;if(e>=f)return w}else{if(e<=-m)return E;if(e+1>=m)return S}return e<0?l(-e,t).neg():u(e%p|0,e/p|0,t)}function u(e,t,n){return new r(e,t,n)}r.fromInt=o,r.fromNumber=l,r.fromBits=u;var c=Math.pow;function d(e,t,r){if(0===e.length)throw Error("empty string");if("number"==typeof t?(r=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?v:y;if((r=r||10)<2||36<r)throw RangeError("radix");if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return d(e.substring(1),t,r).neg();for(var n,i=l(c(r,8)),s=y,a=0;a<e.length;a+=8){var o=Math.min(8,e.length-a),u=parseInt(e.substring(a,a+o),r);if(o<8){var h=l(c(r,o));s=s.mul(h).add(l(u))}else s=(s=s.mul(i)).add(l(u))}return s.unsigned=t,s}function h(e,t){return"number"==typeof e?l(e,t):"string"==typeof e?d(e,t):u(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}r.fromString=d,r.fromValue=h;var p=4294967296,f=18446744073709552e3,m=0x7fffffffffffffff,g=o(16777216),y=o(0);r.ZERO=y;var v=o(0,!0);r.UZERO=v;var b=o(1);r.ONE=b;var _=o(1,!0);r.UONE=_;var T=o(-1);r.NEG_ONE=T;var S=u(-1,2147483647,!1);r.MAX_VALUE=S;var w=u(-1,-1,!0);r.MAX_UNSIGNED_VALUE=w;var E=u(0,-2147483648,!1);r.MIN_VALUE=E;var C=r.prototype;C.toInt=function(){return this.unsigned?this.low>>>0:this.low},C.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},C.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(!this.eq(E))return"-"+this.neg().toString(e);var t=l(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}for(var i=l(c(e,6),this.unsigned),s=this,a="";;){var o=s.div(i),u=(s.sub(o.mul(i)).toInt()>>>0).toString(e);if((s=o).isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},C.getHighBits=function(){return this.high},C.getHighBitsUnsigned=function(){return this.high>>>0},C.getLowBits=function(){return this.low},C.getLowBitsUnsigned=function(){return this.low>>>0},C.getNumBitsAbs=function(){if(this.isNegative())return this.eq(E)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return 0!=this.high?t+33:t+1},C.isSafeInteger=function(){var e=this.high>>21;return!e||!this.unsigned&&-1===e&&!(0===this.low&&-2097152===this.high)},C.isZero=function(){return 0===this.high&&0===this.low},C.eqz=C.isZero,C.isNegative=function(){return!this.unsigned&&this.high<0},C.isPositive=function(){return this.unsigned||this.high>=0},C.isOdd=function(){return(1&this.low)==1},C.isEven=function(){return(1&this.low)==0},C.equals=function(e){return n(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},C.eq=C.equals,C.notEquals=function(e){return!this.eq(e)},C.neq=C.notEquals,C.ne=C.notEquals,C.lessThan=function(e){return 0>this.comp(e)},C.lt=C.lessThan,C.lessThanOrEqual=function(e){return 0>=this.comp(e)},C.lte=C.lessThanOrEqual,C.le=C.lessThanOrEqual,C.greaterThan=function(e){return this.comp(e)>0},C.gt=C.greaterThan,C.greaterThanOrEqual=function(e){return this.comp(e)>=0},C.gte=C.greaterThanOrEqual,C.ge=C.greaterThanOrEqual,C.compare=function(e){if(n(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},C.comp=C.compare,C.negate=function(){return!this.unsigned&&this.eq(E)?E:this.not().add(b)},C.neg=C.negate,C.add=function(e){n(e)||(e=h(e));var t,r,i=this.high>>>16,s=65535&this.high,a=this.low>>>16,o=65535&this.low,l=e.high>>>16,c=65535&e.high,d=e.low>>>16,p=65535&e.low,f=0,m=0;return t=0+((r=0+(o+p))>>>16),r&=65535,t+=a+d,m+=t>>>16,t&=65535,m+=s+c,f+=m>>>16,m&=65535,f+=i+l,u(t<<16|r,(f&=65535)<<16|m,this.unsigned)},C.subtract=function(e){return n(e)||(e=h(e)),this.add(e.neg())},C.sub=C.subtract,C.multiply=function(e){if(this.isZero())return this;if(n(e)||(e=h(e)),t)return u(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return this.unsigned?v:y;if(this.eq(E))return e.isOdd()?E:y;if(e.eq(E))return this.isOdd()?E:y;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return l(this.toNumber()*e.toNumber(),this.unsigned);var r,i,s=this.high>>>16,a=65535&this.high,o=this.low>>>16,c=65535&this.low,d=e.high>>>16,p=65535&e.high,f=e.low>>>16,m=65535&e.low,b=0,_=0;return r=0+((i=0+c*m)>>>16),i&=65535,r+=o*m,_+=r>>>16,r&=65535,r+=c*f,_+=r>>>16,r&=65535,_+=a*m,b+=_>>>16,_&=65535,_+=o*f,b+=_>>>16,_&=65535,_+=c*p,b+=_>>>16,_&=65535,b+=s*m+a*f+o*p+c*d,u(r<<16|i,(b&=65535)<<16|_,this.unsigned)},C.mul=C.multiply,C.divide=function(e){if(n(e)||(e=h(e)),e.isZero())throw Error("division by zero");if(t){var r,i,s;return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?v:y;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return _;s=v}else{if(this.eq(E))return e.eq(b)||e.eq(T)?E:e.eq(E)?b:(r=this.shr(1).div(e).shl(1)).eq(y)?e.isNegative()?b:T:(i=this.sub(e.mul(r)),s=r.add(i.div(e)));if(e.eq(E))return this.unsigned?v:y;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=y}for(i=this;i.gte(e);){for(var a=Math.ceil(Math.log(r=Math.max(1,Math.floor(i.toNumber()/e.toNumber())))/Math.LN2),o=a<=48?1:c(2,a-48),d=l(r),p=d.mul(e);p.isNegative()||p.gt(i);)r-=o,p=(d=l(r,this.unsigned)).mul(e);d.isZero()&&(d=b),s=s.add(d),i=i.sub(p)}return s},C.div=C.divide,C.modulo=function(e){return(n(e)||(e=h(e)),t)?u((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},C.mod=C.modulo,C.rem=C.modulo,C.not=function(){return u(~this.low,~this.high,this.unsigned)},C.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},C.clz=C.countLeadingZeros,C.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},C.ctz=C.countTrailingZeros,C.and=function(e){return n(e)||(e=h(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},C.or=function(e){return n(e)||(e=h(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},C.xor=function(e){return n(e)||(e=h(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},C.shiftLeft=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},C.shl=C.shiftLeft,C.shiftRight=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},C.shr=C.shiftRight,C.shiftRightUnsigned=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):32===e?u(this.high,0,this.unsigned):u(this.high>>>e-32,0,this.unsigned)},C.shru=C.shiftRightUnsigned,C.shr_u=C.shiftRightUnsigned,C.rotateLeft=function(e){var t;return(n(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?u(this.high,this.low,this.unsigned):e<32?(t=32-e,u(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,u(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},C.rotl=C.rotateLeft,C.rotateRight=function(e){var t;return(n(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?u(this.high,this.low,this.unsigned):e<32?(t=32-e,u(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,u(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},C.rotr=C.rotateRight,C.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},C.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},C.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},C.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},C.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,n){return n?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)},"function"==typeof BigInt&&(r.fromBigInt=function(e,t){return u(Number(BigInt.asIntN(32,e)),Number(BigInt.asIntN(32,e>>BigInt(32))),t)},r.fromValue=function(e,t){return"bigint"==typeof e?r.fromBigInt(e,t):h(e,t)},C.toBigInt=function(){var e=BigInt(this.low>>>0);return BigInt(this.unsigned?this.high>>>0:this.high)<<BigInt(32)|e}),e.default=r})},1513:e=>{"use strict";e.exports={i8:"1.9.15"}},6541:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Api":{"fields":{"name":{"type":"string","id":1},"methods":{"rule":"repeated","type":"Method","id":2},"options":{"rule":"repeated","type":"Option","id":3},"version":{"type":"string","id":4},"sourceContext":{"type":"SourceContext","id":5},"mixins":{"rule":"repeated","type":"Mixin","id":6},"syntax":{"type":"Syntax","id":7}}},"Method":{"fields":{"name":{"type":"string","id":1},"requestTypeUrl":{"type":"string","id":2},"requestStreaming":{"type":"bool","id":3},"responseTypeUrl":{"type":"string","id":4},"responseStreaming":{"type":"bool","id":5},"options":{"rule":"repeated","type":"Option","id":6},"syntax":{"type":"Syntax","id":7}}},"Mixin":{"fields":{"name":{"type":"string","id":1},"root":{"type":"string","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}}}}}}}}')},9987:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"options":{"go_package":"google.golang.org/protobuf/types/descriptorpb","java_package":"com.google.protobuf","java_outer_classname":"DescriptorProtos","csharp_namespace":"Google.Protobuf.Reflection","objc_class_prefix":"GPB","cc_enable_arenas":true,"optimize_for":"SPEED"},"nested":{"FileDescriptorSet":{"edition":"proto2","fields":{"file":{"rule":"repeated","type":"FileDescriptorProto","id":1}},"extensions":[[536000000,536000000]]},"Edition":{"edition":"proto2","values":{"EDITION_UNKNOWN":0,"EDITION_LEGACY":900,"EDITION_PROTO2":998,"EDITION_PROTO3":999,"EDITION_2023":1000,"EDITION_2024":1001,"EDITION_1_TEST_ONLY":1,"EDITION_2_TEST_ONLY":2,"EDITION_99997_TEST_ONLY":99997,"EDITION_99998_TEST_ONLY":99998,"EDITION_99999_TEST_ONLY":99999,"EDITION_MAX":2147483647}},"FileDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"package":{"type":"string","id":2},"dependency":{"rule":"repeated","type":"string","id":3},"publicDependency":{"rule":"repeated","type":"int32","id":10},"weakDependency":{"rule":"repeated","type":"int32","id":11},"optionDependency":{"rule":"repeated","type":"string","id":15},"messageType":{"rule":"repeated","type":"DescriptorProto","id":4},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":5},"service":{"rule":"repeated","type":"ServiceDescriptorProto","id":6},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":7},"options":{"type":"FileOptions","id":8},"sourceCodeInfo":{"type":"SourceCodeInfo","id":9},"syntax":{"type":"string","id":12},"edition":{"type":"Edition","id":14}}},"DescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"field":{"rule":"repeated","type":"FieldDescriptorProto","id":2},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":6},"nestedType":{"rule":"repeated","type":"DescriptorProto","id":3},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":4},"extensionRange":{"rule":"repeated","type":"ExtensionRange","id":5},"oneofDecl":{"rule":"repeated","type":"OneofDescriptorProto","id":8},"options":{"type":"MessageOptions","id":7},"reservedRange":{"rule":"repeated","type":"ReservedRange","id":9},"reservedName":{"rule":"repeated","type":"string","id":10},"visibility":{"type":"SymbolVisibility","id":11}},"nested":{"ExtensionRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2},"options":{"type":"ExtensionRangeOptions","id":3}}},"ReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"ExtensionRangeOptions":{"edition":"proto2","fields":{"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999},"declaration":{"rule":"repeated","type":"Declaration","id":2,"options":{"retention":"RETENTION_SOURCE"}},"features":{"type":"FeatureSet","id":50},"verification":{"type":"VerificationState","id":3,"options":{"default":"UNVERIFIED","retention":"RETENTION_SOURCE"}}},"extensions":[[1000,536870911]],"nested":{"Declaration":{"fields":{"number":{"type":"int32","id":1},"fullName":{"type":"string","id":2},"type":{"type":"string","id":3},"reserved":{"type":"bool","id":5},"repeated":{"type":"bool","id":6}},"reserved":[[4,4]]},"VerificationState":{"values":{"DECLARATION":0,"UNVERIFIED":1}}}},"FieldDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":3},"label":{"type":"Label","id":4},"type":{"type":"Type","id":5},"typeName":{"type":"string","id":6},"extendee":{"type":"string","id":2},"defaultValue":{"type":"string","id":7},"oneofIndex":{"type":"int32","id":9},"jsonName":{"type":"string","id":10},"options":{"type":"FieldOptions","id":8},"proto3Optional":{"type":"bool","id":17}},"nested":{"Type":{"values":{"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Label":{"values":{"LABEL_OPTIONAL":1,"LABEL_REPEATED":3,"LABEL_REQUIRED":2}}}},"OneofDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"options":{"type":"OneofOptions","id":2}}},"EnumDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"value":{"rule":"repeated","type":"EnumValueDescriptorProto","id":2},"options":{"type":"EnumOptions","id":3},"reservedRange":{"rule":"repeated","type":"EnumReservedRange","id":4},"reservedName":{"rule":"repeated","type":"string","id":5},"visibility":{"type":"SymbolVisibility","id":6}},"nested":{"EnumReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"EnumValueDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"type":"EnumValueOptions","id":3}}},"ServiceDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"method":{"rule":"repeated","type":"MethodDescriptorProto","id":2},"options":{"type":"ServiceOptions","id":3}}},"MethodDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"inputType":{"type":"string","id":2},"outputType":{"type":"string","id":3},"options":{"type":"MethodOptions","id":4},"clientStreaming":{"type":"bool","id":5},"serverStreaming":{"type":"bool","id":6}}},"FileOptions":{"edition":"proto2","fields":{"javaPackage":{"type":"string","id":1},"javaOuterClassname":{"type":"string","id":8},"javaMultipleFiles":{"type":"bool","id":10},"javaGenerateEqualsAndHash":{"type":"bool","id":20,"options":{"deprecated":true}},"javaStringCheckUtf8":{"type":"bool","id":27},"optimizeFor":{"type":"OptimizeMode","id":9,"options":{"default":"SPEED"}},"goPackage":{"type":"string","id":11},"ccGenericServices":{"type":"bool","id":16},"javaGenericServices":{"type":"bool","id":17},"pyGenericServices":{"type":"bool","id":18},"deprecated":{"type":"bool","id":23},"ccEnableArenas":{"type":"bool","id":31,"options":{"default":true}},"objcClassPrefix":{"type":"string","id":36},"csharpNamespace":{"type":"string","id":37},"swiftPrefix":{"type":"string","id":39},"phpClassPrefix":{"type":"string","id":40},"phpNamespace":{"type":"string","id":41},"phpMetadataNamespace":{"type":"string","id":44},"rubyPackage":{"type":"string","id":45},"features":{"type":"FeatureSet","id":50},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[42,42],[38,38],"php_generic_services"],"nested":{"OptimizeMode":{"values":{"SPEED":1,"CODE_SIZE":2,"LITE_RUNTIME":3}}}},"MessageOptions":{"edition":"proto2","fields":{"messageSetWireFormat":{"type":"bool","id":1},"noStandardDescriptorAccessor":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"mapEntry":{"type":"bool","id":7},"deprecatedLegacyJsonFieldConflicts":{"type":"bool","id":11,"options":{"deprecated":true}},"features":{"type":"FeatureSet","id":12},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4],[5,5],[6,6],[8,8],[9,9]]},"FieldOptions":{"edition":"proto2","fields":{"ctype":{"type":"CType","id":1,"options":{"default":"STRING"}},"packed":{"type":"bool","id":2},"jstype":{"type":"JSType","id":6,"options":{"default":"JS_NORMAL"}},"lazy":{"type":"bool","id":5},"unverifiedLazy":{"type":"bool","id":15},"deprecated":{"type":"bool","id":3},"weak":{"type":"bool","id":10,"options":{"deprecated":true}},"debugRedact":{"type":"bool","id":16},"retention":{"type":"OptionRetention","id":17},"targets":{"rule":"repeated","type":"OptionTargetType","id":19},"editionDefaults":{"rule":"repeated","type":"EditionDefault","id":20},"features":{"type":"FeatureSet","id":21},"featureSupport":{"type":"FeatureSupport","id":22},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4],[18,18]],"nested":{"CType":{"values":{"STRING":0,"CORD":1,"STRING_PIECE":2}},"JSType":{"values":{"JS_NORMAL":0,"JS_STRING":1,"JS_NUMBER":2}},"OptionRetention":{"values":{"RETENTION_UNKNOWN":0,"RETENTION_RUNTIME":1,"RETENTION_SOURCE":2}},"OptionTargetType":{"values":{"TARGET_TYPE_UNKNOWN":0,"TARGET_TYPE_FILE":1,"TARGET_TYPE_EXTENSION_RANGE":2,"TARGET_TYPE_MESSAGE":3,"TARGET_TYPE_FIELD":4,"TARGET_TYPE_ONEOF":5,"TARGET_TYPE_ENUM":6,"TARGET_TYPE_ENUM_ENTRY":7,"TARGET_TYPE_SERVICE":8,"TARGET_TYPE_METHOD":9}},"EditionDefault":{"fields":{"edition":{"type":"Edition","id":3},"value":{"type":"string","id":2}}},"FeatureSupport":{"fields":{"editionIntroduced":{"type":"Edition","id":1},"editionDeprecated":{"type":"Edition","id":2},"deprecationWarning":{"type":"string","id":3},"editionRemoved":{"type":"Edition","id":4}}}}},"OneofOptions":{"edition":"proto2","fields":{"features":{"type":"FeatureSet","id":1},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumOptions":{"edition":"proto2","fields":{"allowAlias":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"deprecatedLegacyJsonFieldConflicts":{"type":"bool","id":6,"options":{"deprecated":true}},"features":{"type":"FeatureSet","id":7},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[5,5]]},"EnumValueOptions":{"edition":"proto2","fields":{"deprecated":{"type":"bool","id":1},"features":{"type":"FeatureSet","id":2},"debugRedact":{"type":"bool","id":3},"featureSupport":{"type":"FieldOptions.FeatureSupport","id":4},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"ServiceOptions":{"edition":"proto2","fields":{"features":{"type":"FeatureSet","id":34},"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"MethodOptions":{"edition":"proto2","fields":{"deprecated":{"type":"bool","id":33},"idempotencyLevel":{"type":"IdempotencyLevel","id":34,"options":{"default":"IDEMPOTENCY_UNKNOWN"}},"features":{"type":"FeatureSet","id":35},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"nested":{"IdempotencyLevel":{"values":{"IDEMPOTENCY_UNKNOWN":0,"NO_SIDE_EFFECTS":1,"IDEMPOTENT":2}}}},"UninterpretedOption":{"edition":"proto2","fields":{"name":{"rule":"repeated","type":"NamePart","id":2},"identifierValue":{"type":"string","id":3},"positiveIntValue":{"type":"uint64","id":4},"negativeIntValue":{"type":"int64","id":5},"doubleValue":{"type":"double","id":6},"stringValue":{"type":"bytes","id":7},"aggregateValue":{"type":"string","id":8}},"nested":{"NamePart":{"fields":{"namePart":{"rule":"required","type":"string","id":1},"isExtension":{"rule":"required","type":"bool","id":2}}}}},"FeatureSet":{"edition":"proto2","fields":{"fieldPresence":{"type":"FieldPresence","id":1,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_2023","edition_defaults.value":"EXPLICIT"}},"enumType":{"type":"EnumType","id":2,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"OPEN"}},"repeatedFieldEncoding":{"type":"RepeatedFieldEncoding","id":3,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"PACKED"}},"utf8Validation":{"type":"Utf8Validation","id":4,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"VERIFY"}},"messageEncoding":{"type":"MessageEncoding","id":5,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_LEGACY","edition_defaults.value":"LENGTH_PREFIXED"}},"jsonFormat":{"type":"JsonFormat","id":6,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"ALLOW"}},"enforceNamingStyle":{"type":"EnforceNamingStyle","id":7,"options":{"retention":"RETENTION_SOURCE","targets":"TARGET_TYPE_METHOD","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"STYLE2024"}},"defaultSymbolVisibility":{"type":"VisibilityFeature.DefaultSymbolVisibility","id":8,"options":{"retention":"RETENTION_SOURCE","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"EXPORT_TOP_LEVEL"}}},"extensions":[[1000,9994],[9995,9999],[10000,10000]],"reserved":[[999,999]],"nested":{"FieldPresence":{"values":{"FIELD_PRESENCE_UNKNOWN":0,"EXPLICIT":1,"IMPLICIT":2,"LEGACY_REQUIRED":3}},"EnumType":{"values":{"ENUM_TYPE_UNKNOWN":0,"OPEN":1,"CLOSED":2}},"RepeatedFieldEncoding":{"values":{"REPEATED_FIELD_ENCODING_UNKNOWN":0,"PACKED":1,"EXPANDED":2}},"Utf8Validation":{"values":{"UTF8_VALIDATION_UNKNOWN":0,"VERIFY":2,"NONE":3}},"MessageEncoding":{"values":{"MESSAGE_ENCODING_UNKNOWN":0,"LENGTH_PREFIXED":1,"DELIMITED":2}},"JsonFormat":{"values":{"JSON_FORMAT_UNKNOWN":0,"ALLOW":1,"LEGACY_BEST_EFFORT":2}},"EnforceNamingStyle":{"values":{"ENFORCE_NAMING_STYLE_UNKNOWN":0,"STYLE2024":1,"STYLE_LEGACY":2}},"VisibilityFeature":{"fields":{},"reserved":[[1,536870911]],"nested":{"DefaultSymbolVisibility":{"values":{"DEFAULT_SYMBOL_VISIBILITY_UNKNOWN":0,"EXPORT_ALL":1,"EXPORT_TOP_LEVEL":2,"LOCAL_ALL":3,"STRICT":4}}}}}},"FeatureSetDefaults":{"edition":"proto2","fields":{"defaults":{"rule":"repeated","type":"FeatureSetEditionDefault","id":1},"minimumEdition":{"type":"Edition","id":4},"maximumEdition":{"type":"Edition","id":5}},"nested":{"FeatureSetEditionDefault":{"fields":{"edition":{"type":"Edition","id":3},"overridableFeatures":{"type":"FeatureSet","id":4},"fixedFeatures":{"type":"FeatureSet","id":5}},"reserved":[[1,1],[2,2],"features"]}}},"SourceCodeInfo":{"edition":"proto2","fields":{"location":{"rule":"repeated","type":"Location","id":1}},"extensions":[[536000000,536000000]],"nested":{"Location":{"fields":{"path":{"rule":"repeated","type":"int32","id":1,"options":{"packed":true}},"span":{"rule":"repeated","type":"int32","id":2,"options":{"packed":true}},"leadingComments":{"type":"string","id":3},"trailingComments":{"type":"string","id":4},"leadingDetachedComments":{"rule":"repeated","type":"string","id":6}}}}},"GeneratedCodeInfo":{"edition":"proto2","fields":{"annotation":{"rule":"repeated","type":"Annotation","id":1}},"nested":{"Annotation":{"fields":{"path":{"rule":"repeated","type":"int32","id":1,"options":{"packed":true}},"sourceFile":{"type":"string","id":2},"begin":{"type":"int32","id":3},"end":{"type":"int32","id":4},"semantic":{"type":"Semantic","id":5}},"nested":{"Semantic":{"values":{"NONE":0,"SET":1,"ALIAS":2}}}}}},"SymbolVisibility":{"edition":"proto2","values":{"VISIBILITY_UNSET":0,"VISIBILITY_LOCAL":1,"VISIBILITY_EXPORT":2}}}}}}}}')},7674:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')},3795:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Type":{"fields":{"name":{"type":"string","id":1},"fields":{"rule":"repeated","type":"Field","id":2},"oneofs":{"rule":"repeated","type":"string","id":3},"options":{"rule":"repeated","type":"Option","id":4},"sourceContext":{"type":"SourceContext","id":5},"syntax":{"type":"Syntax","id":6}}},"Field":{"fields":{"kind":{"type":"Kind","id":1},"cardinality":{"type":"Cardinality","id":2},"number":{"type":"int32","id":3},"name":{"type":"string","id":4},"typeUrl":{"type":"string","id":6},"oneofIndex":{"type":"int32","id":7},"packed":{"type":"bool","id":8},"options":{"rule":"repeated","type":"Option","id":9},"jsonName":{"type":"string","id":10},"defaultValue":{"type":"string","id":11}},"nested":{"Kind":{"values":{"TYPE_UNKNOWN":0,"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Cardinality":{"values":{"CARDINALITY_UNKNOWN":0,"CARDINALITY_OPTIONAL":1,"CARDINALITY_REQUIRED":2,"CARDINALITY_REPEATED":3}}}},"Enum":{"fields":{"name":{"type":"string","id":1},"enumvalue":{"rule":"repeated","type":"EnumValue","id":2},"options":{"rule":"repeated","type":"Option","id":3},"sourceContext":{"type":"SourceContext","id":4},"syntax":{"type":"Syntax","id":5}}},"EnumValue":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"rule":"repeated","type":"Option","id":3}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}},"Any":{"fields":{"type_url":{"type":"string","id":1},"value":{"type":"bytes","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')}};var __webpack_require__=require("../../webpack-runtime.js");__webpack_require__.C(exports);var __webpack_exec__=e=>__webpack_require__(__webpack_require__.s=e),__webpack_exports__=__webpack_require__.X(0,[215],()=>__webpack_exec__(4736));module.exports=__webpack_exports__})();