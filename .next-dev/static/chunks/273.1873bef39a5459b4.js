(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[273],{357:function(e,t,n){"use strict";var r,o;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(o=n.g.process)?void 0:o.env)?n.g.process:n(8081)},8081:function(e){!function(){var t={229:function(e){var t,n,r,o=e.exports={};function l(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===l||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:l}catch(e){t=l}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var u=[],c=!1,s=-1;function f(){c&&r&&(c=!1,r.length?u=r.concat(u):s=-1,u.length&&d())}function d(){if(!c){var e=i(f);c=!0;for(var t=u.length;t;){for(r=u,u=[];++s<t;)r&&r[s].run();s=-1,t=u.length}r=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function h(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||c||i(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=h,o.addListener=h,o.once=h,o.off=h,o.removeListener=h,o.removeAllListeners=h,o.emit=h,o.prependListener=h,o.prependOnceListener=h,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var l=n[e]={exports:{}},a=!0;try{t[e](l,l.exports,r),a=!1}finally{a&&delete n[e]}return l.exports}r.ab="//";var o=r(229);e.exports=o}()},273:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return D}});var r,o,l,a,i,u,c,s=n(7437),f=n(2265);function d(e,t){return Object.freeze({...e,...t})}let p=(0,f.createContext)(null),h=p.Provider;function m(){let e=(0,f.useContext)(p);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}var g=n(7691),v=n.n(g);function y(){return(y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}let b=(0,f.forwardRef)(function({bounds:e,boundsOptions:t,center:n,children:r,className:o,id:l,placeholder:a,style:i,whenReady:u,zoom:c,...s},d){let[p]=(0,f.useState)({className:o,id:l,style:i}),[m,v]=(0,f.useState)(null);(0,f.useImperativeHandle)(d,()=>m?.map??null,[m]);let b=(0,f.useCallback)(r=>{if(null!==r&&null===m){let o=new g.Map(r,s);null!=n&&null!=c?o.setView(n,c):null!=e&&o.fitBounds(e,t),null!=u&&o.whenReady(u),v(Object.freeze({__version:1,map:o}))}},[]);(0,f.useEffect)(()=>()=>{m?.map.remove()},[m]);let x=m?f.createElement(h,{value:m},r):a??null;return f.createElement("div",y({},p,{ref:b}),x)});function x(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function w(e,t){return null==t?function(t,n){let r=(0,f.useRef)();return r.current||(r.current=e(t,n)),r}:function(n,r){let o=(0,f.useRef)();o.current||(o.current=e(n,r));let l=(0,f.useRef)(n),{instance:a}=o.current;return(0,f.useEffect)(function(){l.current!==n&&(t(a,n,l.current),l.current=n)},[a,n,r]),o}}var j=n(4887);function L(e){return(0,f.forwardRef)(function(t,n){let{instance:r,context:o}=e(t).current;return(0,f.useImperativeHandle)(n,()=>r),null==t.children?null:f.createElement(h,{value:o},t.children)})}let C=L((r=w(function({children:e,...t},n){let r=new g.Control.Layers(void 0,void 0,t);return x(r,d(n,{layersControl:r}))},function(e,t,n){t.collapsed!==n.collapsed&&(!0===t.collapsed?e.collapse():e.expand())}),function(e){let t=m(),n=r(e,t),{instance:o}=n.current,l=(0,f.useRef)(e.position),{position:a}=e;return(0,f.useEffect)(function(){return o.addTo(t.map),function(){o.remove()}},[t.map,o]),(0,f.useEffect)(function(){null!=a&&a!==l.current&&(o.setPosition(a),l.current=a)},[o,a]),n}));function k(e){return function(t){let n=m(),r=(0,f.useRef)(t),[o,l]=(0,f.useState)(null),{layersControl:a,map:i}=n,u=(0,f.useCallback)(t=>{null!=a&&(r.current.checked&&i.addLayer(t),e(a,t,r.current.name),l(t))},[a,i]),c=(0,f.useCallback)(e=>{a?.removeLayer(e),l(null)},[a]),s=(0,f.useMemo)(()=>d(n,{layerContainer:{addLayer:u,removeLayer:c}}),[n,u,c]);return(0,f.useEffect)(()=>{null!==o&&r.current!==t&&(!0===t.checked&&(null==r.current.checked||!1===r.current.checked)?i.addLayer(o):!0===r.current.checked&&(null==t.checked||!1===t.checked)&&i.removeLayer(o),r.current=t)}),t.children?f.createElement(h,{value:s},t.children):null}}function S(e,t){let n=(0,f.useRef)(t);(0,f.useEffect)(function(){t!==n.current&&null!=e.attributionControl&&(null!=n.current&&e.attributionControl.removeAttribution(n.current),null!=t&&e.attributionControl.addAttribution(t)),n.current=t},[e,t])}function E(e,t){let n=(0,f.useRef)();(0,f.useEffect)(function(){return null!=t&&e.instance.on(t),n.current=t,function(){null!=n.current&&e.instance.off(n.current),n.current=null}},[e,t])}function O(e,t){let n=e.pane??t.pane;return n?{...e,pane:n}:e}function T(e,t){(0,f.useEffect)(function(){return(t.layerContainer??t.map).addLayer(e.instance),function(){t.layerContainer?.removeLayer(e.instance),t.map.removeLayer(e.instance)}},[t,e])}function N(e){return function(t){let n=m(),r=e(O(t,n),n);return S(n.map,t.attribution),E(r.current,t.eventHandlers),T(r.current,n),r}}C.BaseLayer=k(function(e,t,n){e.addBaseLayer(t,n)}),C.Overlay=k(function(e,t,n){e.addOverlay(t,n)});let P=(o=N(w(function({url:e,...t},n){return x(new g.TileLayer(e,O(t,n)),n)},function(e,t,n){!function(e,t,n){let{opacity:r,zIndex:o}=t;null!=r&&r!==n.opacity&&e.setOpacity(r),null!=o&&o!==n.zIndex&&e.setZIndex(o)}(e,t,n);let{url:r}=t;null!=r&&r!==n.url&&e.setUrl(r)})),(0,f.forwardRef)(function(e,t){let{instance:n}=o(e).current;return(0,f.useImperativeHandle)(t,()=>n),null})),R=L(N(w(function({position:e,...t},n){let r=new g.Marker(e,t);return x(r,d(n,{overlayContainer:r}))},function(e,t,n){t.position!==n.position&&e.setLatLng(t.position),null!=t.icon&&t.icon!==n.icon&&e.setIcon(t.icon),null!=t.zIndexOffset&&t.zIndexOffset!==n.zIndexOffset&&e.setZIndexOffset(t.zIndexOffset),null!=t.opacity&&t.opacity!==n.opacity&&e.setOpacity(t.opacity),null!=e.dragging&&t.draggable!==n.draggable&&(!0===t.draggable?e.dragging.enable():e.dragging.disable())}))),I=(l=function(e,t){return x(new g.Popup(e,t.overlayContainer),t)},a=function(e,t,{position:n},r){(0,f.useEffect)(function(){let{instance:o}=e;function l(e){e.popup===o&&(o.update(),r(!0))}function a(e){e.popup===o&&r(!1)}return t.map.on({popupopen:l,popupclose:a}),null==t.overlayContainer?(null!=n&&o.setLatLng(n),o.openOn(t.map)):t.overlayContainer.bindPopup(o),function(){t.map.off({popupopen:l,popupclose:a}),t.overlayContainer?.unbindPopup(),t.map.removeLayer(o)}},[e,t,r,n])},i=w(l),u=function(e,t){let n=m(),r=i(O(e,n),n);return S(n.map,e.attribution),E(r.current,e.eventHandlers),a(r.current,n,e,t),r},(0,f.forwardRef)(function(e,t){let[n,r]=(0,f.useState)(!1),{instance:o}=u(e,r).current;(0,f.useImperativeHandle)(t,()=>o),(0,f.useEffect)(function(){n&&o.update()},[o,n,e.children]);let l=o._contentNode;return l?(0,j.createPortal)(e.children,l):null})),_=L((c=w(function({positions:e,...t},n){let r=new g.Polyline(e,t);return x(r,d(n,{overlayContainer:r}))},function(e,t,n){t.positions!==n.positions&&e.setLatLngs(t.positions)}),function(e){let t=m(),n=c(O(e,t),t);return E(n.current,e.eventHandlers),T(n.current,t),function(e,t){let n=(0,f.useRef)();(0,f.useEffect)(function(){if(t.pathOptions!==n.current){let r=t.pathOptions??{};e.instance.setStyle(r),n.current=r}},[e,t])}(n.current,e),n}));n(966);var B=n(1887);let z=n(357).env.NEXT_PUBLIC_CONTACT_EMAIL;async function M(e){try{let t="geocodeCache:".concat(e);{let e=localStorage.getItem(t);if(e)return JSON.parse(e)}let n=new URL("https://nominatim.openstreetmap.org/search");n.searchParams.set("format","jsonv2"),n.searchParams.set("limit","1"),n.searchParams.set("q",e),z&&n.searchParams.set("email",z),await new Promise(e=>setTimeout(e,1e3));let r=await fetch(n.toString(),{headers:{"Accept-Language":"pt-BR"}});if(!r.ok)return null;let o=await r.json(),l=null==o?void 0:o[0];if(!l)return null;let a={lat:Number(l.lat),lng:Number(l.lon)};try{localStorage.setItem(t,JSON.stringify(a))}catch(e){}return a}catch(e){return null}}async function A(e,t){let n=[],r=(e,t,r)=>n.push({label:e,lat:t,lng:r});if("stores"===t){for(let t of e.itinerary)for(let e of t.stores)if("number"==typeof e.lat&&"number"==typeof e.lng)r("".concat(t.city," - ").concat(e.name),e.lat,e.lng);else if(e.addressLine){let n=await M(e.addressLine);n&&r("".concat(t.city," - ").concat(e.name),n.lat,n.lng)}}else for(let t of e.itinerary){let e=t.stores.find(e=>"number"==typeof e.lat&&"number"==typeof e.lng);if(e)r("".concat(t.city),e.lat,e.lng);else{let e=await M(t.city);e&&r("".concat(t.city),e.lat,e.lng)}}return n}async function H(e,t,n){if(e.length<2)return null;let r=e=>e.map(e=>"".concat(e.lng,",").concat(e.lat)).join(";"),o=[];for(let t=0;t<e.length;t+=19){let n=e.slice(t,t+20);0!==t&&n.unshift(e[t]),o.push(n)}let l=0,a=0,i=[],u="car"===t?"driving":"bike"===t?"cycling":"walking";for(let e of o){var c;let t=new URL("".concat(n.replace(/\/$/,""),"/route/v1/").concat(u,"/").concat(r(e)));t.searchParams.set("overview","full"),t.searchParams.set("geometries","geojson"),t.searchParams.set("steps","false"),t.searchParams.set("annotations","duration,distance");let o=await fetch(t.toString());if(!o.ok)continue;let s=await o.json(),f=null==s?void 0:null===(c=s.routes)||void 0===c?void 0:c[0];if(!(null==f?void 0:f.geometry))continue;let d=f.geometry.coordinates;i.push(...d),l+=f.distance||0,a+=f.duration||0}return i.length?{line:{type:"LineString",coordinates:i},distanceKm:l/1e3,durationHrs:a/3600}:null}let U=n(357).env.NEXT_PUBLIC_OSRM_URL||"https://router.project-osrm.org",K=new(v()).Icon({iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41]});function Z(e){let{bounds:t}=e,n=m().map;return(0,f.useEffect)(()=>{t&&n.fitBounds(t,{padding:[30,30]})},[t,n]),null}function D(){var e;let t=(0,B.dY)(),[n,r]=(0,f.useState)("car"),[o,l]=(0,f.useState)("cities"),[a,i]=(0,f.useState)([]),[u,c]=(0,f.useState)([]),[d,p]=(0,f.useState)(null),[h,m]=(0,f.useState)([]),[g,y]=(0,f.useState)(0),[x,w]=(0,f.useState)(0),[j,L]=(0,f.useState)(!1),k=(0,f.useMemo)(()=>{if(!a.length&&!d)return null;let e=v().latLngBounds([]);return a.forEach(t=>e.extend([t.lat,t.lng])),(null==d?void 0:d.coordinates)&&d.coordinates.forEach(t=>{let[n,r]=t;return e.extend([r,n])}),e},[a,d]);async function S(){var e,r;if(!t)return;L(!0),p(null),c([]),y(0),w(0),m([]);let l=await A(t,o),a=[],u=[...null!==(e=await F(t.global.originCity))&&void 0!==e?e:[],...l.map(e=>{let{lat:t,lng:n}=e;return{lat:t,lng:n}}),...null!==(r=await F(t.global.originCity))&&void 0!==r?r:[]];if(u.length<2){L(!1);return}let s=await H(u,n,U),f=0,d=0;s&&(p(s.line),f=s.distanceKm,d=s.durationHrs);let h=0,g=0;for(let e of t.itinerary){let t=await J(e);if(!t)continue;let n=await V(e);if(0===n.length)continue;let r=await H([t,...n,t],"car",U);(null==r?void 0:r.line)&&(m(e=>[...e,r.line]),h+=r.distanceKm,g+=r.durationHrs,a.push({label:"Hotel – ".concat(e.city),lat:t.lat,lng:t.lng}))}i([...l,...a]),y(f+h),w(d+g),L(!1)}return(0,f.useEffect)(()=>{S()},[]),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-end gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Tipo de mapa"}),(0,s.jsxs)("select",{className:"input",defaultValue:"osm",onChange:()=>{},children:[(0,s.jsx)("option",{value:"osm",children:"OSM Standard"}),(0,s.jsx)("option",{value:"positron",children:"CartoDB Positron"}),(0,s.jsx)("option",{value:"esri",children:"Esri Sat\xe9lite"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Perfil"}),(0,s.jsxs)("select",{className:"input",value:n,onChange:e=>r(e.target.value),children:[(0,s.jsx)("option",{value:"car",children:"Carro"}),(0,s.jsx)("option",{value:"bike",children:"Bike"}),(0,s.jsx)("option",{value:"foot",children:"A p\xe9"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Rota por"}),(0,s.jsxs)("select",{className:"input",value:o,onChange:e=>l(e.target.value),children:[(0,s.jsx)("option",{value:"cities",children:"Cidades"}),(0,s.jsx)("option",{value:"stores",children:"Lojas"})]})]}),(0,s.jsx)("button",{className:"btn-secondary",disabled:j,onClick:()=>void S(),children:"Recalcular"}),(0,s.jsxs)("div",{className:"text-sm text-background-600",children:[a.length," pontos resolvidos",u.length?", ".concat(u.length," ignorados"):"",g?" • ".concat(g.toFixed(1)," km"):"",x?" • ".concat(x.toFixed(1)," h"):""]})]}),(0,s.jsxs)(b,{className:"w-full h-[480px] rounded-lg overflow-hidden border border-background-200",center:[-15.79,-47.88],zoom:4,scrollWheelZoom:!0,children:[(0,s.jsxs)(C,{position:"topright",children:[(0,s.jsx)(C.BaseLayer,{checked:!0,name:"OSM Standard",children:(0,s.jsx)(P,{attribution:"\xa9 OpenStreetMap contributors",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"})}),(0,s.jsx)(C.BaseLayer,{name:"CartoDB Positron",children:(0,s.jsx)(P,{attribution:"\xa9 OpenStreetMap contributors \xa9 CARTO",url:"https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png"})}),(0,s.jsx)(C.BaseLayer,{name:"Esri Sat\xe9lite",children:(0,s.jsx)(P,{attribution:"Tiles \xa9 Esri",url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"})})]}),a.map((e,t)=>(0,s.jsx)(R,{position:[e.lat,e.lng],children:(0,s.jsx)(I,{children:(0,s.jsx)("div",{className:"text-sm",children:(0,s.jsx)("strong",{children:e.label})})})},t)),d&&(0,s.jsx)(_,{positions:null===(e=d.coordinates)||void 0===e?void 0:e.map(e=>{let[t,n]=e;return[n,t]}),color:"#2563eb",weight:4}),h.map((e,t)=>{var n;return(0,s.jsx)(_,{positions:null===(n=e.coordinates)||void 0===n?void 0:n.map(e=>{let[t,n]=e;return[n,t]}),pathOptions:{color:"#10b981",weight:3,dashArray:"6 6"}},"daily-".concat(t))}),(0,s.jsx)(Z,{bounds:k})]})]})}async function F(e){let t=await M(e);return t?[t]:null}async function J(e){if(e.hotelName&&e.hotelName.trim()){let t=await M("".concat(e.hotelName,", ").concat(e.city));if(t)return t}return await M(e.city)}async function V(e){let t=[];for(let n of e.stores)if("number"==typeof n.lat&&"number"==typeof n.lng)t.push({lat:n.lat,lng:n.lng});else if(n.addressLine){let e=await M(n.addressLine);e&&t.push(e)}if(0===t.length){let n=await M(e.city);n&&t.push(n)}return t}v().Marker.prototype.options.icon=K},966:function(){}}]);